(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        //Allow using this built library as an AMD module
        //in another project. That other project will only
        //see this AMD call, not the internal modules in
        //the closure below.
        define(factory);
    } else {
        //Browser globals case. Just assign the
        //result to a property on the global.
        root.sword = factory();
    }
}(this, function () {
    //console.log = function() {};
    //almond, and your modules will be inlined here
/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
//Going sloppy to avoid 'use strict' string cost, but strict practices should
//be followed.
/*jslint sloppy: true */
/*global setTimeout: false */

var requirejs, require, define;
(function (undef) {
    var main, req, makeMap, handlers,
        defined = {},
        waiting = {},
        config = {},
        defining = {},
        hasOwn = Object.prototype.hasOwnProperty,
        aps = [].slice;

    function hasProp(obj, prop) {
        return hasOwn.call(obj, prop);
    }

    /**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */
    function normalize(name, baseName) {
        var nameParts, nameSegment, mapValue, foundMap,
            foundI, foundStarMap, starI, i, j, part,
            baseParts = baseName && baseName.split("/"),
            map = config.map,
            starMap = (map && map['*']) || {};

        //Adjust any relative paths.
        if (name && name.charAt(0) === ".") {
            //If have a base name, try to normalize against it,
            //otherwise, assume it is a top-level require that will
            //be relative to baseUrl in the end.
            if (baseName) {
                //Convert baseName to array, and lop off the last part,
                //so that . matches that "directory" and not name of the baseName's
                //module. For instance, baseName of "one/two/three", maps to
                //"one/two/three.js", but we want the directory, "one/two" for
                //this normalization.
                baseParts = baseParts.slice(0, baseParts.length - 1);

                name = baseParts.concat(name.split("/"));

                //start trimDots
                for (i = 0; i < name.length; i += 1) {
                    part = name[i];
                    if (part === ".") {
                        name.splice(i, 1);
                        i -= 1;
                    } else if (part === "..") {
                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {
                            //End of the line. Keep at least one non-dot
                            //path segment at the front so it can be mapped
                            //correctly to disk. Otherwise, there is likely
                            //no path mapping for a path starting with '..'.
                            //This can still fail, but catches the most reasonable
                            //uses of ..
                            break;
                        } else if (i > 0) {
                            name.splice(i - 1, 2);
                            i -= 2;
                        }
                    }
                }
                //end trimDots

                name = name.join("/");
            } else if (name.indexOf('./') === 0) {
                // No baseName, so this is ID is resolved relative
                // to baseUrl, pull off the leading dot.
                name = name.substring(2);
            }
        }

        //Apply map config if available.
        if ((baseParts || starMap) && map) {
            nameParts = name.split('/');

            for (i = nameParts.length; i > 0; i -= 1) {
                nameSegment = nameParts.slice(0, i).join("/");

                if (baseParts) {
                    //Find the longest baseName segment match in the config.
                    //So, do joins on the biggest to smallest lengths of baseParts.
                    for (j = baseParts.length; j > 0; j -= 1) {
                        mapValue = map[baseParts.slice(0, j).join('/')];

                        //baseName segment has  config, find if it has one for
                        //this name.
                        if (mapValue) {
                            mapValue = mapValue[nameSegment];
                            if (mapValue) {
                                //Match, update name to the new value.
                                foundMap = mapValue;
                                foundI = i;
                                break;
                            }
                        }
                    }
                }

                if (foundMap) {
                    break;
                }

                //Check for a star map match, but just hold on to it,
                //if there is a shorter segment match later in a matching
                //config, then favor over this star map.
                if (!foundStarMap && starMap && starMap[nameSegment]) {
                    foundStarMap = starMap[nameSegment];
                    starI = i;
                }
            }

            if (!foundMap && foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
            }

            if (foundMap) {
                nameParts.splice(0, foundI, foundMap);
                name = nameParts.join('/');
            }
        }

        return name;
    }

    function makeRequire(relName, forceSync) {
        return function () {
            //A version of a require function that passes a moduleName
            //value for items that may need to
            //look up paths relative to the moduleName
            return req.apply(undef, aps.call(arguments, 0).concat([relName, forceSync]));
        };
    }

    function makeNormalize(relName) {
        return function (name) {
            return normalize(name, relName);
        };
    }

    function makeLoad(depName) {
        return function (value) {
            defined[depName] = value;
        };
    }

    function callDep(name) {
        if (hasProp(waiting, name)) {
            var args = waiting[name];
            delete waiting[name];
            defining[name] = true;
            main.apply(undef, args);
        }

        if (!hasProp(defined, name) && !hasProp(defining, name)) {
            throw new Error('No ' + name);
        }
        return defined[name];
    }

    //Turns a plugin!resource to [plugin, resource]
    //with the plugin being undefined if the name
    //did not have a plugin prefix.
    function splitPrefix(name) {
        var prefix,
            index = name ? name.indexOf('!') : -1;
        if (index > -1) {
            prefix = name.substring(0, index);
            name = name.substring(index + 1, name.length);
        }
        return [prefix, name];
    }

    /**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */
    makeMap = function (name, relName) {
        var plugin,
            parts = splitPrefix(name),
            prefix = parts[0];

        name = parts[1];

        if (prefix) {
            prefix = normalize(prefix, relName);
            plugin = callDep(prefix);
        }

        //Normalize according
        if (prefix) {
            if (plugin && plugin.normalize) {
                name = plugin.normalize(name, makeNormalize(relName));
            } else {
                name = normalize(name, relName);
            }
        } else {
            name = normalize(name, relName);
            parts = splitPrefix(name);
            prefix = parts[0];
            name = parts[1];
            if (prefix) {
                plugin = callDep(prefix);
            }
        }

        //Using ridiculous property names for space reasons
        return {
            f: prefix ? prefix + '!' + name : name, //fullName
            n: name,
            pr: prefix,
            p: plugin
        };
    };

    function makeConfig(name) {
        return function () {
            return (config && config.config && config.config[name]) || {};
        };
    }

    handlers = {
        require: function (name) {
            return makeRequire(name);
        },
        exports: function (name) {
            var e = defined[name];
            if (typeof e !== 'undefined') {
                return e;
            } else {
                return (defined[name] = {});
            }
        },
        module: function (name) {
            return {
                id: name,
                uri: '',
                exports: defined[name],
                config: makeConfig(name)
            };
        }
    };

    main = function (name, deps, callback, relName) {
        var cjsModule, depName, ret, map, i,
            args = [],
            usingExports;

        //Use name if no relName
        relName = relName || name;

        //Call the callback to define the module, if necessary.
        if (typeof callback === 'function') {

            //Pull out the defined dependencies and pass the ordered
            //values to the callback.
            //Default to [require, exports, module] if no deps
            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;
            for (i = 0; i < deps.length; i += 1) {
                map = makeMap(deps[i], relName);
                depName = map.f;

                //Fast path CommonJS standard dependencies.
                if (depName === "require") {
                    args[i] = handlers.require(name);
                } else if (depName === "exports") {
                    //CommonJS module spec 1.1
                    args[i] = handlers.exports(name);
                    usingExports = true;
                } else if (depName === "module") {
                    //CommonJS module spec 1.1
                    cjsModule = args[i] = handlers.module(name);
                } else if (hasProp(defined, depName) ||
                           hasProp(waiting, depName) ||
                           hasProp(defining, depName)) {
                    args[i] = callDep(depName);
                } else if (map.p) {
                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                    args[i] = defined[depName];
                } else {
                    throw new Error(name + ' missing ' + depName);
                }
            }

            ret = callback.apply(defined[name], args);

            if (name) {
                //If setting exports via "module" is in play,
                //favor that over return value and exports. After that,
                //favor a non-undefined return value over exports use.
                if (cjsModule && cjsModule.exports !== undef &&
                        cjsModule.exports !== defined[name]) {
                    defined[name] = cjsModule.exports;
                } else if (ret !== undef || !usingExports) {
                    //Use the return value from the function.
                    defined[name] = ret;
                }
            }
        } else if (name) {
            //May just be an object definition for the module. Only
            //worry about defining if have a module name.
            defined[name] = callback;
        }
    };

    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {
        if (typeof deps === "string") {
            if (handlers[deps]) {
                //callback in this case is really relName
                return handlers[deps](callback);
            }
            //Just return the module wanted. In this scenario, the
            //deps arg is the module name, and second arg (if passed)
            //is just the relName.
            //Normalize module name, if it contains . or ..
            return callDep(makeMap(deps, callback).f);
        } else if (!deps.splice) {
            //deps is a config object, not an array.
            config = deps;
            if (callback.splice) {
                //callback is an array, which means it is a dependency list.
                //Adjust args if there are dependencies
                deps = callback;
                callback = relName;
                relName = null;
            } else {
                deps = undef;
            }
        }

        //Support require(['a'])
        callback = callback || function () {};

        //If relName is a function, it is an errback handler,
        //so remove it.
        if (typeof relName === 'function') {
            relName = forceSync;
            forceSync = alt;
        }

        //Simulate async callback;
        if (forceSync) {
            main(undef, deps, callback, relName);
        } else {
            //Using a non-zero value because of concern for what old browsers
            //do, and latest browsers "upgrade" to 4 if lower value is used:
            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
            //If want a value immediately, use require('id') instead -- something
            //that works in almond on the global level, but not guaranteed and
            //unlikely to work in other AMD implementations.
            setTimeout(function () {
                main(undef, deps, callback, relName);
            }, 4);
        }

        return req;
    };

    /**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */
    req.config = function (cfg) {
        config = cfg;
        if (config.deps) {
            req(config.deps, config.callback);
        }
        return req;
    };

    define = function (name, deps, callback) {

        //This module may not have dependencies
        if (!deps.splice) {
            //deps is not an array, so probably means
            //an object literal or factory function for
            //the value. Adjust args.
            callback = deps;
            deps = [];
        }

        if (!hasProp(defined, name) && !hasProp(waiting, name)) {
            waiting[name] = [name, deps, callback];
        }
    };

    define.amd = {
        jQuery: true
    };
}());

define("almond", function(){});

/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function() {function m(a){throw a;}var p=void 0,t,aa=this;function v(a,b){var c=a.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var g;c.length&&(g=c.shift());)!c.length&&b!==p?d[g]=b:d=d[g]?d[g]:d[g]={}};var w="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;new (w?Uint8Array:Array)(256);var x;for(x=0;256>x;++x)for(var y=x,ba=7,y=y>>>1;y;y>>>=1)--ba;var z=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,
2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,
2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,
2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,
3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,
936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],A=w?new Uint32Array(z):z;function B(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,g,f,h,e,k,l,q,s,r;for(s=0;s<b;++s)a[s]>c&&(c=a[s]),a[s]<d&&(d=a[s]);g=1<<c;f=new (w?Uint32Array:Array)(g);h=1;e=0;for(k=2;h<=c;){for(s=0;s<b;++s)if(a[s]===h){l=0;q=e;for(r=0;r<h;++r)l=l<<1|q&1,q>>=1;for(r=l;r<g;r+=k)f[r]=h<<16|s;++e}++h;e<<=1;k<<=1}return[f,c,d]};var C=[],D;for(D=0;288>D;D++)switch(!0){case 143>=D:C.push([D+48,8]);break;case 255>=D:C.push([D-144+400,9]);break;case 279>=D:C.push([D-256+0,7]);break;case 287>=D:C.push([D-280+192,8]);break;default:m("invalid literal: "+D)}
var ca=function(){function a(a){switch(!0){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,
a-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:m("invalid length: "+a)}}var b=[],c,d;for(c=3;258>=c;c++)d=a(c),b[c]=d[2]<<24|d[1]<<
16|d[0];return b}();w&&new Uint32Array(ca);function E(a,b){this.l=[];this.m=32768;this.d=this.f=this.c=this.t=0;this.input=w?new Uint8Array(a):a;this.u=!1;this.n=F;this.K=!1;if(b||!(b={}))b.index&&(this.c=b.index),b.bufferSize&&(this.m=b.bufferSize),b.bufferType&&(this.n=b.bufferType),b.resize&&(this.K=b.resize);switch(this.n){case G:this.a=32768;this.b=new (w?Uint8Array:Array)(32768+this.m+258);break;case F:this.a=0;this.b=new (w?Uint8Array:Array)(this.m);this.e=this.W;this.B=this.R;this.q=this.V;break;default:m(Error("invalid inflate mode"))}}
var G=0,F=1;
E.prototype.r=function(){for(;!this.u;){var a=H(this,3);a&1&&(this.u=!0);a>>>=1;switch(a){case 0:var b=this.input,c=this.c,d=this.b,g=this.a,f=p,h=p,e=p,k=d.length,l=p;this.d=this.f=0;f=b[c++];f===p&&m(Error("invalid uncompressed block header: LEN (first byte)"));h=f;f=b[c++];f===p&&m(Error("invalid uncompressed block header: LEN (second byte)"));h|=f<<8;f=b[c++];f===p&&m(Error("invalid uncompressed block header: NLEN (first byte)"));e=f;f=b[c++];f===p&&m(Error("invalid uncompressed block header: NLEN (second byte)"));e|=
f<<8;h===~e&&m(Error("invalid uncompressed block header: length verify"));c+h>b.length&&m(Error("input buffer is broken"));switch(this.n){case G:for(;g+h>d.length;){l=k-g;h-=l;if(w)d.set(b.subarray(c,c+l),g),g+=l,c+=l;else for(;l--;)d[g++]=b[c++];this.a=g;d=this.e();g=this.a}break;case F:for(;g+h>d.length;)d=this.e({H:2});break;default:m(Error("invalid inflate mode"))}if(w)d.set(b.subarray(c,c+h),g),g+=h,c+=h;else for(;h--;)d[g++]=b[c++];this.c=c;this.a=g;this.b=d;break;case 1:this.q(da,ea);break;
case 2:fa(this);break;default:m(Error("unknown BTYPE: "+a))}}return this.B()};
var I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=w?new Uint16Array(I):I,K=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=w?new Uint16Array(K):K,ga=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],O=w?new Uint8Array(ga):ga,ha=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ia=w?new Uint16Array(ha):ha,ja=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,
12,12,13,13],P=w?new Uint8Array(ja):ja,Q=new (w?Uint8Array:Array)(288),R,la;R=0;for(la=Q.length;R<la;++R)Q[R]=143>=R?8:255>=R?9:279>=R?7:8;var da=B(Q),S=new (w?Uint8Array:Array)(30),T,ma;T=0;for(ma=S.length;T<ma;++T)S[T]=5;var ea=B(S);function H(a,b){for(var c=a.f,d=a.d,g=a.input,f=a.c,h;d<b;)h=g[f++],h===p&&m(Error("input buffer is broken")),c|=h<<d,d+=8;h=c&(1<<b)-1;a.f=c>>>b;a.d=d-b;a.c=f;return h}
function U(a,b){for(var c=a.f,d=a.d,g=a.input,f=a.c,h=b[0],e=b[1],k,l,q;d<e;){k=g[f++];if(k===p)break;c|=k<<d;d+=8}l=h[c&(1<<e)-1];q=l>>>16;a.f=c>>q;a.d=d-q;a.c=f;return l&65535}
function fa(a){function b(a,b,c){var d,e,f,g;for(g=0;g<a;)switch(d=U(this,b),d){case 16:for(f=3+H(this,2);f--;)c[g++]=e;break;case 17:for(f=3+H(this,3);f--;)c[g++]=0;e=0;break;case 18:for(f=11+H(this,7);f--;)c[g++]=0;e=0;break;default:e=c[g++]=d}return c}var c=H(a,5)+257,d=H(a,5)+1,g=H(a,4)+4,f=new (w?Uint8Array:Array)(J.length),h,e,k,l;for(l=0;l<g;++l)f[J[l]]=H(a,3);h=B(f);e=new (w?Uint8Array:Array)(c);k=new (w?Uint8Array:Array)(d);a.q(B(b.call(a,c,h,e)),B(b.call(a,d,h,k)))}t=E.prototype;
t.q=function(a,b){var c=this.b,d=this.a;this.C=a;for(var g=c.length-258,f,h,e,k;256!==(f=U(this,a));)if(256>f)d>=g&&(this.a=d,c=this.e(),d=this.a),c[d++]=f;else{h=f-257;k=L[h];0<O[h]&&(k+=H(this,O[h]));f=U(this,b);e=ia[f];0<P[f]&&(e+=H(this,P[f]));d>=g&&(this.a=d,c=this.e(),d=this.a);for(;k--;)c[d]=c[d++-e]}for(;8<=this.d;)this.d-=8,this.c--;this.a=d};
t.V=function(a,b){var c=this.b,d=this.a;this.C=a;for(var g=c.length,f,h,e,k;256!==(f=U(this,a));)if(256>f)d>=g&&(c=this.e(),g=c.length),c[d++]=f;else{h=f-257;k=L[h];0<O[h]&&(k+=H(this,O[h]));f=U(this,b);e=ia[f];0<P[f]&&(e+=H(this,P[f]));d+k>g&&(c=this.e(),g=c.length);for(;k--;)c[d]=c[d++-e]}for(;8<=this.d;)this.d-=8,this.c--;this.a=d};
t.e=function(){var a=new (w?Uint8Array:Array)(this.a-32768),b=this.a-32768,c,d,g=this.b;if(w)a.set(g.subarray(32768,a.length));else{c=0;for(d=a.length;c<d;++c)a[c]=g[c+32768]}this.l.push(a);this.t+=a.length;if(w)g.set(g.subarray(b,b+32768));else for(c=0;32768>c;++c)g[c]=g[b+c];this.a=32768;return g};
t.W=function(a){var b,c=this.input.length/this.c+1|0,d,g,f,h=this.input,e=this.b;a&&("number"===typeof a.H&&(c=a.H),"number"===typeof a.P&&(c+=a.P));2>c?(d=(h.length-this.c)/this.C[2],f=258*(d/2)|0,g=f<e.length?e.length+f:e.length<<1):g=e.length*c;w?(b=new Uint8Array(g),b.set(e)):b=e;return this.b=b};
t.B=function(){var a=0,b=this.b,c=this.l,d,g=new (w?Uint8Array:Array)(this.t+(this.a-32768)),f,h,e,k;if(0===c.length)return w?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);f=0;for(h=c.length;f<h;++f){d=c[f];e=0;for(k=d.length;e<k;++e)g[a++]=d[e]}f=32768;for(h=this.a;f<h;++f)g[a++]=b[f];this.l=[];return this.buffer=g};
t.R=function(){var a,b=this.a;w?this.K?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b);return this.buffer=a};function V(a){a=a||{};this.files=[];this.v=a.comment}V.prototype.L=function(a){this.j=a};V.prototype.s=function(a){var b=a[2]&65535|2;return b*(b^1)>>8&255};V.prototype.k=function(a,b){a[0]=(A[(a[0]^b)&255]^a[0]>>>8)>>>0;a[1]=(6681*(20173*(a[1]+(a[0]&255))>>>0)>>>0)+1>>>0;a[2]=(A[(a[2]^a[1]>>>24)&255]^a[2]>>>8)>>>0};V.prototype.T=function(a){var b=[305419896,591751049,878082192],c,d;w&&(b=new Uint32Array(b));c=0;for(d=a.length;c<d;++c)this.k(b,a[c]&255);return b};function W(a,b){b=b||{};this.input=w&&a instanceof Array?new Uint8Array(a):a;this.c=0;this.ba=b.verify||!1;this.j=b.password}var na={O:0,M:8},X=[80,75,1,2],Y=[80,75,3,4],Z=[80,75,5,6];function oa(a,b){this.input=a;this.offset=b}
oa.prototype.parse=function(){var a=this.input,b=this.offset;(a[b++]!==X[0]||a[b++]!==X[1]||a[b++]!==X[2]||a[b++]!==X[3])&&m(Error("invalid file header signature"));this.version=a[b++];this.ia=a[b++];this.Z=a[b++]|a[b++]<<8;this.I=a[b++]|a[b++]<<8;this.A=a[b++]|a[b++]<<8;this.time=a[b++]|a[b++]<<8;this.U=a[b++]|a[b++]<<8;this.p=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.z=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.J=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.h=a[b++]|a[b++]<<
8;this.g=a[b++]|a[b++]<<8;this.F=a[b++]|a[b++]<<8;this.ea=a[b++]|a[b++]<<8;this.ga=a[b++]|a[b++]<<8;this.fa=a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24;this.$=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.filename=String.fromCharCode.apply(null,w?a.subarray(b,b+=this.h):a.slice(b,b+=this.h));this.X=w?a.subarray(b,b+=this.g):a.slice(b,b+=this.g);this.v=w?a.subarray(b,b+this.F):a.slice(b,b+this.F);this.length=b-this.offset};function pa(a,b){this.input=a;this.offset=b}var qa={N:1,ca:8,da:2048};
pa.prototype.parse=function(){var a=this.input,b=this.offset;(a[b++]!==Y[0]||a[b++]!==Y[1]||a[b++]!==Y[2]||a[b++]!==Y[3])&&m(Error("invalid local file header signature"));this.Z=a[b++]|a[b++]<<8;this.I=a[b++]|a[b++]<<8;this.A=a[b++]|a[b++]<<8;this.time=a[b++]|a[b++]<<8;this.U=a[b++]|a[b++]<<8;this.p=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.z=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.J=(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0;this.h=a[b++]|a[b++]<<8;this.g=a[b++]|a[b++]<<8;this.filename=
String.fromCharCode.apply(null,w?a.subarray(b,b+=this.h):a.slice(b,b+=this.h));this.X=w?a.subarray(b,b+=this.g):a.slice(b,b+=this.g);this.length=b-this.offset};
function $(a){var b=[],c={},d,g,f,h;if(!a.i){if(a.o===p){var e=a.input,k;if(!a.D)a:{var l=a.input,q;for(q=l.length-12;0<q;--q)if(l[q]===Z[0]&&l[q+1]===Z[1]&&l[q+2]===Z[2]&&l[q+3]===Z[3]){a.D=q;break a}m(Error("End of Central Directory Record not found"))}k=a.D;(e[k++]!==Z[0]||e[k++]!==Z[1]||e[k++]!==Z[2]||e[k++]!==Z[3])&&m(Error("invalid signature"));a.ha=e[k++]|e[k++]<<8;a.ja=e[k++]|e[k++]<<8;a.ka=e[k++]|e[k++]<<8;a.aa=e[k++]|e[k++]<<8;a.Q=(e[k++]|e[k++]<<8|e[k++]<<16|e[k++]<<24)>>>0;a.o=(e[k++]|
e[k++]<<8|e[k++]<<16|e[k++]<<24)>>>0;a.w=e[k++]|e[k++]<<8;a.v=w?e.subarray(k,k+a.w):e.slice(k,k+a.w)}d=a.o;f=0;for(h=a.aa;f<h;++f)g=new oa(a.input,d),g.parse(),d+=g.length,b[f]=g,c[g.filename]=f;a.Q<d-a.o&&m(Error("invalid file header size"));a.i=b;a.G=c}}t=W.prototype;t.Y=function(){var a=[],b,c,d;this.i||$(this);d=this.i;b=0;for(c=d.length;b<c;++b)a[b]=d[b].filename;return a};
t.r=function(a,b){var c;this.G||$(this);c=this.G[a];c===p&&m(Error(a+" not found"));var d;d=b||{};var g=this.input,f=this.i,h,e,k,l,q,s,r,M;f||$(this);f[c]===p&&m(Error("wrong index"));e=f[c].$;h=new pa(this.input,e);h.parse();e+=h.length;k=h.z;if(0!==(h.I&qa.N)){!d.password&&!this.j&&m(Error("please set password"));s=this.S(d.password||this.j);r=e;for(M=e+12;r<M;++r)ra(this,s,g[r]);e+=12;k-=12;r=e;for(M=e+k;r<M;++r)g[r]=ra(this,s,g[r])}switch(h.A){case na.O:l=w?this.input.subarray(e,e+k):this.input.slice(e,
e+k);break;case na.M:l=(new E(this.input,{index:e,bufferSize:h.J})).r();break;default:m(Error("unknown compression type"))}if(this.ba){var u=p,n,N="number"===typeof u?u:u=0,ka=l.length;n=-1;for(N=ka&7;N--;++u)n=n>>>8^A[(n^l[u])&255];for(N=ka>>3;N--;u+=8)n=n>>>8^A[(n^l[u])&255],n=n>>>8^A[(n^l[u+1])&255],n=n>>>8^A[(n^l[u+2])&255],n=n>>>8^A[(n^l[u+3])&255],n=n>>>8^A[(n^l[u+4])&255],n=n>>>8^A[(n^l[u+5])&255],n=n>>>8^A[(n^l[u+6])&255],n=n>>>8^A[(n^l[u+7])&255];q=(n^4294967295)>>>0;h.p!==q&&m(Error("wrong crc: file=0x"+
h.p.toString(16)+", data=0x"+q.toString(16)))}return l};t.L=function(a){this.j=a};function ra(a,b,c){c^=a.s(b);a.k(b,c);return c}t.k=V.prototype.k;t.S=V.prototype.T;t.s=V.prototype.s;v("Zlib.Unzip",W);v("Zlib.Unzip.prototype.decompress",W.prototype.r);v("Zlib.Unzip.prototype.getFilenames",W.prototype.Y);v("Zlib.Unzip.prototype.setPassword",W.prototype.L);}).call(this); //@ sourceMappingURL=unzip.min.js.map
;
define("unzip", (function (global) {
    return function () {
        var ret, fn;
        return ret || global.Zlib;
    };
}(this)));

/*global setImmediate: false, setTimeout: false, console: false */
(function () {

    var async = {};

    // global on the server, window in the browser
    var root, previous_async;

    root = this;
    if (root != null) {
      previous_async = root.async;
    }

    async.noConflict = function () {
        root.async = previous_async;
        return async;
    };

    function only_once(fn) {
        var called = false;
        return function() {
            if (called) throw new Error("Callback was already called.");
            called = true;
            fn.apply(root, arguments);
        }
    }

    //// cross-browser compatiblity functions ////

    var _each = function (arr, iterator) {
        if (arr.forEach) {
            return arr.forEach(iterator);
        }
        for (var i = 0; i < arr.length; i += 1) {
            iterator(arr[i], i, arr);
        }
    };

    var _map = function (arr, iterator) {
        if (arr.map) {
            return arr.map(iterator);
        }
        var results = [];
        _each(arr, function (x, i, a) {
            results.push(iterator(x, i, a));
        });
        return results;
    };

    var _reduce = function (arr, iterator, memo) {
        if (arr.reduce) {
            return arr.reduce(iterator, memo);
        }
        _each(arr, function (x, i, a) {
            memo = iterator(memo, x, i, a);
        });
        return memo;
    };

    var _keys = function (obj) {
        if (Object.keys) {
            return Object.keys(obj);
        }
        var keys = [];
        for (var k in obj) {
            if (obj.hasOwnProperty(k)) {
                keys.push(k);
            }
        }
        return keys;
    };

    //// exported async module functions ////

    //// nextTick implementation with browser-compatible fallback ////
    if (typeof process === 'undefined' || !(process.nextTick)) {
        if (typeof setImmediate === 'function') {
            async.nextTick = function (fn) {
                // not a direct alias for IE10 compatibility
                setImmediate(fn);
            };
            async.setImmediate = async.nextTick;
        }
        else {
            async.nextTick = function (fn) {
                setTimeout(fn, 0);
            };
            async.setImmediate = async.nextTick;
        }
    }
    else {
        async.nextTick = process.nextTick;
        if (typeof setImmediate !== 'undefined') {
            async.setImmediate = setImmediate;
        }
        else {
            async.setImmediate = async.nextTick;
        }
    }

    async.each = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        _each(arr, function (x) {
            iterator(x, only_once(function (err) {
                if (err) {
                    callback(err);
                    callback = function () {};
                }
                else {
                    completed += 1;
                    if (completed >= arr.length) {
                        callback(null);
                    }
                }
            }));
        });
    };
    async.forEach = async.each;

    async.eachSeries = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        var iterate = function () {
            iterator(arr[completed], function (err) {
                if (err) {
                    callback(err);
                    callback = function () {};
                }
                else {
                    completed += 1;
                    if (completed >= arr.length) {
                        callback(null);
                    }
                    else {
                        iterate();
                    }
                }
            });
        };
        iterate();
    };
    async.forEachSeries = async.eachSeries;

    async.eachLimit = function (arr, limit, iterator, callback) {
        var fn = _eachLimit(limit);
        fn.apply(null, [arr, iterator, callback]);
    };
    async.forEachLimit = async.eachLimit;

    var _eachLimit = function (limit) {

        return function (arr, iterator, callback) {
            callback = callback || function () {};
            if (!arr.length || limit <= 0) {
                return callback();
            }
            var completed = 0;
            var started = 0;
            var running = 0;

            (function replenish () {
                if (completed >= arr.length) {
                    return callback();
                }

                while (running < limit && started < arr.length) {
                    started += 1;
                    running += 1;
                    iterator(arr[started - 1], function (err) {
                        if (err) {
                            callback(err);
                            callback = function () {};
                        }
                        else {
                            completed += 1;
                            running -= 1;
                            if (completed >= arr.length) {
                                callback();
                            }
                            else {
                                replenish();
                            }
                        }
                    });
                }
            })();
        };
    };


    var doParallel = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.each].concat(args));
        };
    };
    var doParallelLimit = function(limit, fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [_eachLimit(limit)].concat(args));
        };
    };
    var doSeries = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.eachSeries].concat(args));
        };
    };


    var _asyncMap = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (err, v) {
                results[x.index] = v;
                callback(err);
            });
        }, function (err) {
            callback(err, results);
        });
    };
    async.map = doParallel(_asyncMap);
    async.mapSeries = doSeries(_asyncMap);
    async.mapLimit = function (arr, limit, iterator, callback) {
        return _mapLimit(limit)(arr, iterator, callback);
    };

    var _mapLimit = function(limit) {
        return doParallelLimit(limit, _asyncMap);
    };

    // reduce only has a series version, as doing reduce in parallel won't
    // work in many situations.
    async.reduce = function (arr, memo, iterator, callback) {
        async.eachSeries(arr, function (x, callback) {
            iterator(memo, x, function (err, v) {
                memo = v;
                callback(err);
            });
        }, function (err) {
            callback(err, memo);
        });
    };
    // inject alias
    async.inject = async.reduce;
    // foldl alias
    async.foldl = async.reduce;

    async.reduceRight = function (arr, memo, iterator, callback) {
        var reversed = _map(arr, function (x) {
            return x;
        }).reverse();
        async.reduce(reversed, memo, iterator, callback);
    };
    // foldr alias
    async.foldr = async.reduceRight;

    var _filter = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.filter = doParallel(_filter);
    async.filterSeries = doSeries(_filter);
    // select alias
    async.select = async.filter;
    async.selectSeries = async.filterSeries;

    var _reject = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (!v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.reject = doParallel(_reject);
    async.rejectSeries = doSeries(_reject);

    var _detect = function (eachfn, arr, iterator, main_callback) {
        eachfn(arr, function (x, callback) {
            iterator(x, function (result) {
                if (result) {
                    main_callback(x);
                    main_callback = function () {};
                }
                else {
                    callback();
                }
            });
        }, function (err) {
            main_callback();
        });
    };
    async.detect = doParallel(_detect);
    async.detectSeries = doSeries(_detect);

    async.some = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (v) {
                    main_callback(true);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(false);
        });
    };
    // any alias
    async.any = async.some;

    async.every = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (!v) {
                    main_callback(false);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(true);
        });
    };
    // all alias
    async.all = async.every;

    async.sortBy = function (arr, iterator, callback) {
        async.map(arr, function (x, callback) {
            iterator(x, function (err, criteria) {
                if (err) {
                    callback(err);
                }
                else {
                    callback(null, {value: x, criteria: criteria});
                }
            });
        }, function (err, results) {
            if (err) {
                return callback(err);
            }
            else {
                var fn = function (left, right) {
                    var a = left.criteria, b = right.criteria;
                    return a < b ? -1 : a > b ? 1 : 0;
                };
                callback(null, _map(results.sort(fn), function (x) {
                    return x.value;
                }));
            }
        });
    };

    async.auto = function (tasks, callback) {
        callback = callback || function () {};
        var keys = _keys(tasks);
        if (!keys.length) {
            return callback(null);
        }

        var results = {};

        var listeners = [];
        var addListener = function (fn) {
            listeners.unshift(fn);
        };
        var removeListener = function (fn) {
            for (var i = 0; i < listeners.length; i += 1) {
                if (listeners[i] === fn) {
                    listeners.splice(i, 1);
                    return;
                }
            }
        };
        var taskComplete = function () {
            _each(listeners.slice(0), function (fn) {
                fn();
            });
        };

        addListener(function () {
            if (_keys(results).length === keys.length) {
                callback(null, results);
                callback = function () {};
            }
        });

        _each(keys, function (k) {
            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];
            var taskCallback = function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (args.length <= 1) {
                    args = args[0];
                }
                if (err) {
                    var safeResults = {};
                    _each(_keys(results), function(rkey) {
                        safeResults[rkey] = results[rkey];
                    });
                    safeResults[k] = args;
                    callback(err, safeResults);
                    // stop subsequent errors hitting callback multiple times
                    callback = function () {};
                }
                else {
                    results[k] = args;
                    async.setImmediate(taskComplete);
                }
            };
            var requires = task.slice(0, Math.abs(task.length - 1)) || [];
            var ready = function () {
                return _reduce(requires, function (a, x) {
                    return (a && results.hasOwnProperty(x));
                }, true) && !results.hasOwnProperty(k);
            };
            if (ready()) {
                task[task.length - 1](taskCallback, results);
            }
            else {
                var listener = function () {
                    if (ready()) {
                        removeListener(listener);
                        task[task.length - 1](taskCallback, results);
                    }
                };
                addListener(listener);
            }
        });
    };

    async.waterfall = function (tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor !== Array) {
          var err = new Error('First argument to waterfall must be an array of functions');
          return callback(err);
        }
        if (!tasks.length) {
            return callback();
        }
        var wrapIterator = function (iterator) {
            return function (err) {
                if (err) {
                    callback.apply(null, arguments);
                    callback = function () {};
                }
                else {
                    var args = Array.prototype.slice.call(arguments, 1);
                    var next = iterator.next();
                    if (next) {
                        args.push(wrapIterator(next));
                    }
                    else {
                        args.push(callback);
                    }
                    async.setImmediate(function () {
                        iterator.apply(null, args);
                    });
                }
            };
        };
        wrapIterator(async.iterator(tasks))();
    };

    var _parallel = function(eachfn, tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor === Array) {
            eachfn.map(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            eachfn.each(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.parallel = function (tasks, callback) {
        _parallel({ map: async.map, each: async.each }, tasks, callback);
    };

    async.parallelLimit = function(tasks, limit, callback) {
        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);
    };

    async.series = function (tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor === Array) {
            async.mapSeries(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            async.eachSeries(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.iterator = function (tasks) {
        var makeCallback = function (index) {
            var fn = function () {
                if (tasks.length) {
                    tasks[index].apply(null, arguments);
                }
                return fn.next();
            };
            fn.next = function () {
                return (index < tasks.length - 1) ? makeCallback(index + 1): null;
            };
            return fn;
        };
        return makeCallback(0);
    };

    async.apply = function (fn) {
        var args = Array.prototype.slice.call(arguments, 1);
        return function () {
            return fn.apply(
                null, args.concat(Array.prototype.slice.call(arguments))
            );
        };
    };

    var _concat = function (eachfn, arr, fn, callback) {
        var r = [];
        eachfn(arr, function (x, cb) {
            fn(x, function (err, y) {
                r = r.concat(y || []);
                cb(err);
            });
        }, function (err) {
            callback(err, r);
        });
    };
    async.concat = doParallel(_concat);
    async.concatSeries = doSeries(_concat);

    async.whilst = function (test, iterator, callback) {
        if (test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.whilst(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doWhilst = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            if (test()) {
                async.doWhilst(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.until = function (test, iterator, callback) {
        if (!test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.until(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doUntil = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            if (!test()) {
                async.doUntil(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.queue = function (worker, concurrency) {
        if (concurrency === undefined) {
            concurrency = 1;
        }
        function _insert(q, data, pos, callback) {
          if(data.constructor !== Array) {
              data = [data];
          }
          _each(data, function(task) {
              var item = {
                  data: task,
                  callback: typeof callback === 'function' ? callback : null
              };

              if (pos) {
                q.tasks.unshift(item);
              } else {
                q.tasks.push(item);
              }

              if (q.saturated && q.tasks.length === concurrency) {
                  q.saturated();
              }
              async.setImmediate(q.process);
          });
        }

        var workers = 0;
        var q = {
            tasks: [],
            concurrency: concurrency,
            saturated: null,
            empty: null,
            drain: null,
            push: function (data, callback) {
              _insert(q, data, false, callback);
            },
            unshift: function (data, callback) {
              _insert(q, data, true, callback);
            },
            process: function () {
                if (workers < q.concurrency && q.tasks.length) {
                    var task = q.tasks.shift();
                    if (q.empty && q.tasks.length === 0) {
                        q.empty();
                    }
                    workers += 1;
                    var next = function () {
                        workers -= 1;
                        if (task.callback) {
                            task.callback.apply(task, arguments);
                        }
                        if (q.drain && q.tasks.length + workers === 0) {
                            q.drain();
                        }
                        q.process();
                    };
                    var cb = only_once(next);
                    worker(task.data, cb);
                }
            },
            length: function () {
                return q.tasks.length;
            },
            running: function () {
                return workers;
            }
        };
        return q;
    };

    async.cargo = function (worker, payload) {
        var working     = false,
            tasks       = [];

        var cargo = {
            tasks: tasks,
            payload: payload,
            saturated: null,
            empty: null,
            drain: null,
            push: function (data, callback) {
                if(data.constructor !== Array) {
                    data = [data];
                }
                _each(data, function(task) {
                    tasks.push({
                        data: task,
                        callback: typeof callback === 'function' ? callback : null
                    });
                    if (cargo.saturated && tasks.length === payload) {
                        cargo.saturated();
                    }
                });
                async.setImmediate(cargo.process);
            },
            process: function process() {
                if (working) return;
                if (tasks.length === 0) {
                    if(cargo.drain) cargo.drain();
                    return;
                }

                var ts = typeof payload === 'number'
                            ? tasks.splice(0, payload)
                            : tasks.splice(0);

                var ds = _map(ts, function (task) {
                    return task.data;
                });

                if(cargo.empty) cargo.empty();
                working = true;
                worker(ds, function () {
                    working = false;

                    var args = arguments;
                    _each(ts, function (data) {
                        if (data.callback) {
                            data.callback.apply(null, args);
                        }
                    });

                    process();
                });
            },
            length: function () {
                return tasks.length;
            },
            running: function () {
                return working;
            }
        };
        return cargo;
    };

    var _console_fn = function (name) {
        return function (fn) {
            var args = Array.prototype.slice.call(arguments, 1);
            fn.apply(null, args.concat([function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (typeof console !== 'undefined') {
                    if (err) {
                        if (console.error) {
                            console.error(err);
                        }
                    }
                    else if (console[name]) {
                        _each(args, function (x) {
                            console[name](x);
                        });
                    }
                }
            }]));
        };
    };
    async.log = _console_fn('log');
    async.dir = _console_fn('dir');
    /*async.info = _console_fn('info');
    async.warn = _console_fn('warn');
    async.error = _console_fn('error');*/

    async.memoize = function (fn, hasher) {
        var memo = {};
        var queues = {};
        hasher = hasher || function (x) {
            return x;
        };
        var memoized = function () {
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            var key = hasher.apply(null, args);
            if (key in memo) {
                callback.apply(null, memo[key]);
            }
            else if (key in queues) {
                queues[key].push(callback);
            }
            else {
                queues[key] = [callback];
                fn.apply(null, args.concat([function () {
                    memo[key] = arguments;
                    var q = queues[key];
                    delete queues[key];
                    for (var i = 0, l = q.length; i < l; i++) {
                      q[i].apply(null, arguments);
                    }
                }]));
            }
        };
        memoized.memo = memo;
        memoized.unmemoized = fn;
        return memoized;
    };

    async.unmemoize = function (fn) {
      return function () {
        return (fn.unmemoized || fn).apply(null, arguments);
      };
    };

    async.times = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.map(counter, iterator, callback);
    };

    async.timesSeries = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.mapSeries(counter, iterator, callback);
    };

    async.compose = function (/* functions... */) {
        var fns = Array.prototype.reverse.call(arguments);
        return function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            async.reduce(fns, args, function (newargs, fn, cb) {
                fn.apply(that, newargs.concat([function () {
                    var err = arguments[0];
                    var nextargs = Array.prototype.slice.call(arguments, 1);
                    cb(err, nextargs);
                }]))
            },
            function (err, results) {
                callback.apply(that, [err].concat(results));
            });
        };
    };

    var _applyEach = function (eachfn, fns /*args...*/) {
        var go = function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            return eachfn(fns, function (fn, cb) {
                fn.apply(that, args.concat([cb]));
            },
            callback);
        };
        if (arguments.length > 2) {
            var args = Array.prototype.slice.call(arguments, 2);
            return go.apply(this, args);
        }
        else {
            return go;
        }
    };
    async.applyEach = doParallel(_applyEach);
    async.applyEachSeries = doSeries(_applyEach);

    async.forever = function (fn, callback) {
        function next(err) {
            if (err) {
                if (callback) {
                    return callback(err);
                }
                throw err;
            }
            fn(next);
        }
        next();
    };

    // AMD / RequireJS
    if (typeof define !== 'undefined' && define.amd) {
        define('async',[], function () {
            return async;
        });
    }
    // Node.js
    else if (typeof module !== 'undefined' && module.exports) {
        module.exports = async;
    }
    // included directly via <script> tag
    else {
        root.async = async;
    }

}());

define('tools',[], function () {
    //Read a modules conf file a return it as Object
    function readConf(inConfString) {
        var lines = inConfString.split(/[\r\n]+/g),
            configData = {},
            splittedLine = null;

        configData["GlobalOptionFilter"] = [];
        configData["Feature"] = [];

        lines.forEach(function(line, index) {
            splittedLine = line.split(/=(.+)/);
            if (splittedLine[0] !== "")
                if (splittedLine[0].search(/\[.*\]/) !== -1)
                    configData["moduleKey"] = splittedLine[0].replace("[", "").replace("]", "");
                else
                    if (splittedLine[0] === "GlobalOptionFilter")
                        configData[splittedLine[0]].push(splittedLine[1]);
                    else if (splittedLine[0] === "Feature")
                        configData[splittedLine[0]].push(splittedLine[1]);
                    else if (splittedLine[0] === "Versification")
                        configData[splittedLine[0]] = splittedLine[1].toLowerCase();
                    else
                        configData[splittedLine[0]] = splittedLine[1];
        });

        return configData;
    }

    function dynamicSort(property) {
        return function (obj1,obj2) {
            return obj1[property] > obj2[property] ? 1
                : obj1[property] < obj2[property] ? -1 : 0;
        };
    }

    function dynamicSortMultiple() {
        /*
         * save the arguments object as it will be overwritten
         * note that arguments object is an array-like object
         * consisting of the names of the properties to sort by
         */
        var props = arguments;
        return function (obj1, obj2) {
            var i = 0, result = 0, numberOfProperties = props.length;
            /* try getting a different result from 0 (equal)
             * as long as we have extra properties to compare
             */
            while(result === 0 && i < numberOfProperties) {
                result = dynamicSort(props[i])(obj1, obj2);
                i++;
            }
            return result;
        };
    }

    function cleanArray(actual){
        var newArray = [];
        for(var i = 0; i<actual.length; i++){
            if (actual[i]){
                newArray.push(actual[i]);
            }
        }
        return newArray;
    }

    function convertArray(inArray) {
        var obj = {};
        inArray.forEach(function (item) {
            if(item)
                obj[item.book] = item.id;
        });
        return obj;
    }

    function convertObject(inObject) {
        var a = [];
        for (var key in inObject) {
            a.push(inObject[key]);
        }
        return a;
    }

    return {
        readConf: readConf,
        dynamicSort: dynamicSort,
        dynamicSortMultiple: dynamicSortMultiple,
        cleanArray: cleanArray,
        convertArray: convertArray,
        convertObject: convertObject
    };
});
/*
 IDBWrapper - A cross-browser wrapper for IndexedDB
 Copyright (c) 2011 - 2013 Jens Arps
 http://jensarps.de/

 Licensed under the MIT (X11) license
*/
(function(h,j,i){"function"===typeof define?define('idb',j):"undefined"!==typeof module&&module.exports?module.exports=j():i[h]=j()})("IDBStore",function(){var h=function(b){throw b;},j={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:h,indexes:[]},i=function(b,c){"undefined"==typeof c&&"function"==typeof b&&(c=b);"[object Object]"!=Object.prototype.toString.call(b)&&(b={});for(var a in j)this[a]="undefined"!=typeof b[a]?b[a]:j[a];
this.dbName=this.storePrefix+this.storeName;this.dbVersion=parseInt(this.dbVersion,10)||1;c&&(this.onStoreReady=c);a="object"==typeof window?window:self;this.idb=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB;this.keyRange=a.IDBKeyRange||a.webkitIDBKeyRange||a.mozIDBKeyRange;this.features={hasAutoIncrement:!a.mozIndexedDB};this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"};this.openDB()};
i.prototype={constructor:i,version:"1.4.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var b=this.idb.open(this.dbName,this.dbVersion),c=!1;b.onerror=function(a){var b=!1;"error"in a.target?b="VersionError"==a.target.error.name:"errorCode"in a.target&&(b=12==a.target.errorCode);if(b)this.onError(Error("The version number provided is lower than the existing one."));
else this.onError(a)}.bind(this);b.onsuccess=function(a){if(!c)if(this.db)this.onStoreReady();else if(this.db=a.target.result,"string"==typeof this.db.version)this.onError(Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));else if(this.db.objectStoreNames.contains(this.storeName)){this.store=this.db.transaction([this.storeName],this.consts.READ_ONLY).objectStore(this.storeName);var b=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(a){var e=
a.name;e?(this.normalizeIndexData(a),this.hasIndex(e)?(this.indexComplies(this.store.index(e),a)||(c=!0,this.onError(Error('Cannot modify index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),b.splice(b.indexOf(e),1)):(c=!0,this.onError(Error('Cannot create new index "'+e+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))):(c=!0,this.onError(Error("Cannot create index: No index name given.")))},this);b.length&&(c=!0,this.onError(Error('Cannot delete index(es) "'+
b.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")));c||this.onStoreReady()}else this.onError(Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."))}.bind(this);b.onupgradeneeded=function(a){this.db=a.target.result;if(this.db.objectStoreNames.contains(this.storeName))this.store=a.target.transaction.objectStore(this.storeName);else{a={autoIncrement:this.autoIncrement};if(null!==this.keyPath)a.keyPath=this.keyPath;
this.store=this.db.createObjectStore(this.storeName,a)}var b=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(a){var e=a.name;e||(c=!0,this.onError(Error("Cannot create index: No index name given.")));this.normalizeIndexData(a);this.hasIndex(e)?(this.indexComplies(this.store.index(e),a)||(this.store.deleteIndex(e),this.store.createIndex(e,a.keyPath,{unique:a.unique,multiEntry:a.multiEntry})),b.splice(b.indexOf(e),1)):this.store.createIndex(e,a.keyPath,{unique:a.unique,
multiEntry:a.multiEntry})},this);b.length&&b.forEach(function(a){this.store.deleteIndex(a)},this)}.bind(this)},deleteDatabase:function(){this.idb.deleteDatabase&&this.idb.deleteDatabase(this.dbName)},put:function(b,c,a,d){null!==this.keyPath&&(d=a,a=c,c=b);d||(d=h);a||(a=k);var f=!1,e=null,g=this.db.transaction([this.storeName],this.consts.READ_WRITE);g.oncomplete=function(){(f?a:d)(e)};g.onabort=d;g.onerror=d;null!==this.keyPath?(this._addIdPropertyIfNeeded(c),b=g.objectStore(this.storeName).put(c)):
b=g.objectStore(this.storeName).put(c,b);b.onsuccess=function(a){f=!0;e=a.target.result};b.onerror=d;return g},get:function(b,c,a){a||(a=h);c||(c=k);var d=!1,f=null,e=this.db.transaction([this.storeName],this.consts.READ_ONLY);e.oncomplete=function(){(d?c:a)(f)};e.onabort=a;e.onerror=a;b=e.objectStore(this.storeName).get(b);b.onsuccess=function(a){d=!0;f=a.target.result};b.onerror=a;return e},remove:function(b,c,a){a||(a=h);c||(c=k);var d=!1,f=null,e=this.db.transaction([this.storeName],this.consts.READ_WRITE);
e.oncomplete=function(){(d?c:a)(f)};e.onabort=a;e.onerror=a;b=e.objectStore(this.storeName)["delete"](b);b.onsuccess=function(a){d=!0;f=a.target.result};b.onerror=a;return e},batch:function(b,c,a){a||(a=h);c||(c=k);"[object Array]"!=Object.prototype.toString.call(b)&&a(Error("dataArray argument must be of type Array."));var d=this.db.transaction([this.storeName],this.consts.READ_WRITE);d.oncomplete=function(){(g?c:a)(g)};d.onabort=a;d.onerror=a;var f=b.length,e=!1,g=!1,l=function(){f--;0===f&&!e&&
(g=e=!0)};b.forEach(function(b){var c=b.type,f=b.key,g=b.value,b=function(b){d.abort();e||(e=!0,a(b,c,f))};if("remove"==c)g=d.objectStore(this.storeName)["delete"](f),g.onsuccess=l,g.onerror=b;else if("put"==c)null!==this.keyPath?(this._addIdPropertyIfNeeded(g),g=d.objectStore(this.storeName).put(g)):g=d.objectStore(this.storeName).put(g,f),g.onsuccess=l,g.onerror=b},this);return d},putBatch:function(b,c,a){return this.batch(b.map(function(a){return{type:"put",value:a}}),c,a)},removeBatch:function(b,
c,a){return this.batch(b.map(function(a){return{type:"remove",key:a}}),c,a)},getBatch:function(b,c,a,d){a||(a=h);c||(c=k);d||(d="sparse");"[object Array]"!=Object.prototype.toString.call(b)&&a(Error("keyArray argument must be of type Array."));var f=this.db.transaction([this.storeName],this.consts.READ_ONLY);f.oncomplete=function(){(l?c:a)(i)};f.onabort=a;f.onerror=a;var e=[],g=b.length,l=!1,i=null,j=function(a){a.target.result||"dense"==d?e.push(a.target.result):"sparse"==d&&e.length++;g--;0===g&&
(l=!0,i=e)};b.forEach(function(b){b=f.objectStore(this.storeName).get(b);b.onsuccess=j;b.onerror=function(b){i=b;a(b);f.abort()}},this);return f},getAll:function(b,c){c||(c=h);b||(b=k);var a=this.db.transaction([this.storeName],this.consts.READ_ONLY),d=a.objectStore(this.storeName);d.getAll?this._getAllNative(a,d,b,c):this._getAllCursor(a,d,b,c);return a},_getAllNative:function(b,c,a,d){var f=!1,e=null;b.oncomplete=function(){(f?a:d)(e)};b.onabort=d;b.onerror=d;b=c.getAll();b.onsuccess=function(a){f=
!0;e=a.target.result};b.onerror=d},_getAllCursor:function(b,c,a,d){var f=[],e=!1,g=null;b.oncomplete=function(){(e?a:d)(g)};b.onabort=d;b.onerror=d;b=c.openCursor();b.onsuccess=function(a){(a=a.target.result)?(f.push(a.value),a["continue"]()):(e=!0,g=f)};b.onError=d},clear:function(b,c){c||(c=h);b||(b=k);var a=!1,d=null,f=this.db.transaction([this.storeName],this.consts.READ_WRITE);f.oncomplete=function(){(a?b:c)(d)};f.onabort=c;f.onerror=c;var e=f.objectStore(this.storeName).clear();e.onsuccess=
function(b){a=!0;d=b.target.result};e.onerror=c;return f},_addIdPropertyIfNeeded:function(b){!this.features.hasAutoIncrement&&"undefined"==typeof b[this.keyPath]&&(b[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(b){return this.store.indexNames.contains(b)},normalizeIndexData:function(b){b.keyPath=b.keyPath||b.name;b.unique=!!b.unique;b.multiEntry=!!b.multiEntry},indexComplies:function(b,c){return["keyPath","unique","multiEntry"].every(function(a){if("multiEntry"==
a&&void 0===b[a]&&!1===c[a])return!0;if("keyPath"==a&&"[object Array]"==Object.prototype.toString.call(c[a])){var a=c.keyPath,d=b.keyPath;if("string"==typeof d)return a.toString()==d;if(!("function"==typeof d.contains||"function"==typeof d.indexOf)||d.length!==a.length)return!1;for(var f=0,e=a.length;f<e;f++)if(!(d.contains&&d.contains(a[f])||d.indexOf(-1!==a[f])))return!1;return!0}return c[a]==b[a]})},iterate:function(b,c){var c=m({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,
writeAccess:!1,onEnd:null,onError:h},c||{}),a="desc"==c.order.toLowerCase()?"PREV":"NEXT";c.filterDuplicates&&(a+="_NO_DUPLICATE");var d=!1,f=this.db.transaction([this.storeName],this.consts[c.writeAccess?"READ_WRITE":"READ_ONLY"]),e=f.objectStore(this.storeName);c.index&&(e=e.index(c.index));f.oncomplete=function(){if(d)if(c.onEnd)c.onEnd();else b(null);else c.onError(null)};f.onabort=c.onError;f.onerror=c.onError;a=e.openCursor(c.keyRange,this.consts[a]);a.onerror=c.onError;a.onsuccess=function(a){if(a=
a.target.result){if(b(a.value,a,f),c.autoContinue)a["continue"]()}else d=!0};return f},query:function(b,c){var a=[],c=c||{};c.onEnd=function(){b(a)};return this.iterate(function(b){a.push(b)},c)},count:function(b,c){var c=m({index:null,keyRange:null},c||{}),a=c.onError||h,d=!1,f=null,e=this.db.transaction([this.storeName],this.consts.READ_ONLY);e.oncomplete=function(){(d?b:a)(f)};e.onabort=a;e.onerror=a;var g=e.objectStore(this.storeName);c.index&&(g=g.index(c.index));g=g.count(c.keyRange);g.onsuccess=
function(a){d=!0;f=a.target.result};g.onError=a;return e},makeKeyRange:function(b){var c="undefined"!=typeof b.lower,a="undefined"!=typeof b.upper,d="undefined"!=typeof b.only;switch(!0){case d:b=this.keyRange.only(b.only);break;case c&&a:b=this.keyRange.bound(b.lower,b.upper,b.excludeLower,b.excludeUpper);break;case c:b=this.keyRange.lowerBound(b.lower,b.excludeLower);break;case a:b=this.keyRange.upperBound(b.upper,b.excludeUpper);break;default:throw Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.');
}return b}};var k=function(){},n={},m=function(b,c){var a,d;for(a in c)d=c[a],d!==n[a]&&d!==b[a]&&(b[a]=d);return b};i.version=i.prototype.version;return i},this);

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('idbPluginWrapper',["idb"], function (IDB) {
    var isInitialized = false,
        db = null;

    function getDB (inCallback) {
        if (isInitialized) {
            inCallback(null, db);
        } else {
            db = new IDB({
                storeName: "swordjs",
                dbVersion: 4,
                indexes: [
                    {name: "modules", keyPath: "moduleKey", unique: true}
                ],
                onStoreReady: function() {
                    isInitialized = true;
                    inCallback(null, db);
                },
                onError: function(inError) {
                    isInitialized = false;
                    inCallback(inError);
                },
            });
        }
    }

    function getIDBWrapper () {
        return IDB;
    }

    return {
        getDB: getDB,
        getIDBWrapper: getIDBWrapper
    };
});
/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('dataMgr',["async", "tools", "idbPluginWrapper"], function (async, tools, IDB) {
    var dataMgr = {};

    //get some data by id
    function get(inId, inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.get(inId,
                    function (inResponse) {
                        inCallback(null, inResponse);
                    },
                    function (inError) {inCallback(inError);}
                );
            else inCallback(inError);
        });
    }

    //Read a module's config file and save it as an Object
    function saveConfig(inConfBlob, inCallback) {
        var confReader = new FileReader();
        confReader.readAsText(inConfBlob);
        confReader.onload = function(e) {
            var configData = tools.readConf(e.target.result);

            //Save config data to the database and continue to build the index
            IDB.getDB(function (inError, db) {
                if(!inError)
                    db.put(configData,
                        function (inId) {
                            inCallback(null, {id: inId, modKey: configData.moduleKey, v11n: configData.Versification});
                        },
                        function (inError) {inCallback(inError);}
                    );
                else inCallback(inError);
            });
        };
    }

    //Save the binary module files like *.bzz
    function saveModule(inFiles, inDoc, inCallback) {
        //console.log("saveModule", inFiles, inDoc);
        var z = inFiles.length,
            args = {},
            path = null,
            driver = null;

        args.docId = inDoc.id;

        async.eachSeries(inFiles, function (file, ittCallback) {
            var path = file.name.split("/"),
                driver = path[path.length-3];
            IDB.getDB(function (inError, db) {
                if(!inError)
                    db.put({fileName: path[path.length-1], modKey: inDoc.modKey, driver: driver, blob: file.blob},
                        function (inId) {
                            args[path[path.length-1].split(".")[0]] = inId;
                            ittCallback(null);
                        },
                        function (inError) {ittCallback(inError);}
                    );
                else inCallback(inError);
            });
        }, function (inError) {
            if(!inError) updateBinaryIds(args, inCallback);
            else inCallback(inError);
        });
    }

    function updateBinaryIds(inIds, inCallback) {
        //console.log("updateBinaryIds", inIds, inCallback);
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.get(inIds.docId,
                    function (inModule) {
                        inModule.nt = inIds.nt;
                        inModule.ot = inIds.ot;
                        db.put(inModule, function(inResponse) {
                                inCallback(null);
                            },
                            function (inError) {inCallback(inError);}
                        );
                    },
                    function (inError) {inCallback(inError);}
                );
            else inCallback(inError);
        });
    }

    function getBlob(inId, inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.get(inId,
                    function (inBlob) {inCallback(null, inBlob.blob);},
                    function (inError) {inCallback(inError);}
                );
            else inCallback(inError);
        });
    }

    function saveBCVPos(inOT, inNT, inDoc, inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.put({modKey: inDoc.modKey, ot: inOT, nt: inNT},
                    function (inPosResId) {
                        db.get(inDoc.id,
                            function (inModule) {
                                inModule["bcvPosID"] = inPosResId;
                                db.put(inModule,
                                    function(inId) {
                                        inCallback(null);
                                    },
                                    function (inError) {inCallback(inError);}
                                );
                            },
                            function (inError) {inCallback(inError);}
                        );
                    },
                    function (inError) {inCallback(inError);}
                );
            else inCallback(inError);
        });
    }

    function getModules(inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.query(function (inResults) {
                    inCallback(null, inResults);
                },
                {
                    onError: function (inError) {inCallback(inError);},
                    index: "modules"
                });
            else inCallback(inError);
        });
    }

    function remove(inId, inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.remove(inId,
                    inCallback(null),
                    function (inError) { inCallback(inError);}
                );
            else inCallback(inError);
        });
    }

    function removeModule(inModuleKey, inCallback) {
        IDB.getDB(function (inError, db) {
            if(!inError) {
                getModules(function (inError, inModules) {
                    if(!inError) {
                        var found = false;
                        inModules.forEach(function(mod) {
                            if(mod.moduleKey === inModuleKey) {
                                found = true;
                                var a = (mod.blobIds) ? tools.convertObject(mod.blobIds) : [mod.bcvPosID, mod.nt, mod.ot, mod.id];
                                //Remove undefined values
                                a = a.filter(function(e){return e;});
                                db.removeBatch(a,
                                    function() {
                                        if(inCallback) inCallback(null);
                                    },
                                    function(inError) {
                                        if (inCallback) inCallback(inError);
                                    }
                                );
                            }
                        });
                        if(!found)
                            inCallback({message: "Couldn't find the module."});
                    } else if(inCallback) inCallback(inError);

                });
            } else if(inCallback) inCallback(inError);
        });
    }

    function clearDatabase() {
        IDB.getDB(function (inError, db) {
            if(!inError)
                db.clear(
                    function () {
                        //console.log("cleared database");
                    },
                    function (inError) { console.log(inError);}
                );
            else inCallback(inError);
        });
    }

    function getIDBWrapper () {
        return IDB.getIDBWrapper();
    }

    function errorHandler(inError, inCallback) {
        console.log(inError, inCallback);
    }

    return {
        clearDatabase: clearDatabase,
        saveConfig: saveConfig,
        saveModule: saveModule,
        saveBCVPos: saveBCVPos,
        getBlob: getBlob,
        get: get,
        remove: remove,
        removeModule: removeModule,
        getModules: getModules,
        getIDBWrapper: getIDBWrapper
    };
});
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function() {var m=void 0,p=!0,s=this;function t(a,d){var b=a.split("."),c=s;!(b[0]in c)&&c.execScript&&c.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)!b.length&&d!==m?c[e]=d:c=c[e]?c[e]:c[e]={}};var u="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;function v(a){var d=a.length,b=0,c=Number.POSITIVE_INFINITY,e,f,g,h,l,k,n,q,r;for(q=0;q<d;++q)a[q]>b&&(b=a[q]),a[q]<c&&(c=a[q]);e=1<<b;f=new (u?Uint32Array:Array)(e);g=1;h=0;for(l=2;g<=b;){for(q=0;q<d;++q)if(a[q]===g){k=0;n=h;for(r=0;r<g;++r)k=k<<1|n&1,n>>=1;for(r=k;r<e;r+=l)f[r]=g<<16|q;++h}++g;h<<=1;l<<=1}return[f,b,c]};function x(a,d,b){this.t=[];this.q=b?b:32768;this.u=0;this.a=d===m?0:d;this.d=this.e=0;this.input=u?new Uint8Array(a):a;this.c=new (u?Uint8Array:Array)(this.q);this.b=0;this.s=this.l=!1;this.f=0;this.status=z}var z=0;
x.prototype.i=function(a,d){var b=!1;a!==m&&(this.input=a);d!==m&&(this.a=d);for(;!b;)switch(this.status){case z:case 1:var c;var e=m;this.status=1;B(this);if(0>(e=C(this,3)))D(this),c=-1;else{e&1&&(this.l=p);e>>>=1;switch(e){case 0:this.g=0;break;case 1:this.g=1;break;case 2:this.g=2;break;default:throw Error("unknown BTYPE: "+e);}this.status=2;c=m}0>c&&(b=p);break;case 2:case 3:switch(this.g){case 0:var f;var g=m,h=m,l=this.input,k=this.a;this.status=3;if(k+4>=l.length)f=-1;else{g=l[k++]|l[k++]<<
8;h=l[k++]|l[k++]<<8;if(g===~h)throw Error("invalid uncompressed block header: length verify");this.d=this.e=0;this.a=k;this.m=g;this.status=4;f=m}0>f&&(b=p);break;case 1:this.status=3;this.k=E;this.n=F;this.status=4;break;case 2:0>I(this)&&(b=p)}break;case 4:case 5:switch(this.g){case 0:var n;a:{var q=this.input,r=this.a,G=this.c,A=this.b,H=this.m;for(this.status=5;H--;){A===G.length&&(G=J(this));if(r>=q.length){this.a=r;this.b=A;this.m=H+1;n=-1;break a}G[A++]=q[r++]}0>H&&(this.status=6);this.a=
r;this.b=A;n=0}0>n&&(b=p);break;case 1:case 2:0>K(this)&&(b=p)}break;case 6:this.l?b=p:this.status=z}var y,w=this.b;this.s?u?(y=new Uint8Array(w),y.set(this.c.subarray(this.f,w))):y=this.c.slice(this.f,w):y=u?this.c.subarray(this.f,w):this.c.slice(this.f,w);this.buffer=y;this.f=w;return this.buffer};
var L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=u?new Uint16Array(L):L,N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],aa=u?new Uint16Array(N):N,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],P=u?new Uint8Array(O):O,Q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ba=u?new Uint16Array(Q):Q,R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,
13,13],S=u?new Uint8Array(R):R,T=new (u?Uint8Array:Array)(288),U,V;U=0;for(V=T.length;U<V;++U)T[U]=143>=U?8:255>=U?9:279>=U?7:8;var E=v(T),W=new (u?Uint8Array:Array)(30),X,Y;X=0;for(Y=W.length;X<Y;++X)W[X]=5;var F=v(W);function C(a,d){for(var b=a.e,c=a.d,e=a.input,f=a.a,g;c<d;){if(e.length<=f)return-1;g=e[f++];b|=g<<c;c+=8}g=b&(1<<d)-1;a.e=b>>>d;a.d=c-d;a.a=f;return g}
function Z(a,d){for(var b=a.e,c=a.d,e=a.input,f=a.a,g=d[0],h=d[1],l,k,n;c<h;){if(e.length<=f)return-1;l=e[f++];b|=l<<c;c+=8}k=g[b&(1<<h)-1];n=k>>>16;a.e=b>>n;a.d=c-n;a.a=f;return k&65535}function B(a){a.r=a.a;a.p=a.d;a.o=a.e}function D(a){a.a=a.r;a.d=a.p;a.e=a.o}
function I(a){function d(){function a(b,c,d){for(var e,g,f,h=0,k,h=0;h<b;){e=Z(this,c);if(0>e)throw Error("not enough input");switch(e){case 16:if(0>(k=C(this,2)))throw Error("not enough input");for(f=3+k;f--;)d[h++]=g;break;case 17:if(0>(k=C(this,3)))throw Error("not enough input");for(f=3+k;f--;)d[h++]=0;g=0;break;case 18:if(0>(k=C(this,7)))throw Error("not enough input");for(f=11+k;f--;)d[h++]=0;g=0;break;default:g=d[h++]=e}}return d}var d;for(k=0;k<e;++k){if(0>(d=C(this,3)))throw Error("not enough input");
f[M[k]]=d}g=v(f);h=new (u?Uint8Array:Array)(b);l=new (u?Uint8Array:Array)(c);this.k=v(a.call(this,b,g,h));this.n=v(a.call(this,c,g,l))}var b,c,e,f=new (u?Uint8Array:Array)(M.length),g,h,l,k=0;a.status=3;B(a);b=C(a,5)+257;c=C(a,5)+1;e=C(a,4)+4;if(0>b||0>c||0>e)return D(a),-1;try{d.call(a)}catch(n){return D(a),-1}a.status=4;return 0}
function K(a){var d=a.c,b=a.b,c,e,f,g,h=a.k,l=a.n,k=d.length,n;for(a.status=5;;){B(a);c=Z(a,h);if(0>c)return a.b=b,D(a),-1;if(256===c)break;if(256>c)b===k&&(d=J(a),k=d.length),d[b++]=c;else{e=c-257;g=aa[e];if(0<P[e]){n=C(a,P[e]);if(0>n)return a.b=b,D(a),-1;g+=n}c=Z(a,l);if(0>c)return a.b=b,D(a),-1;f=ba[c];if(0<S[c]){n=C(a,S[c]);if(0>n)return a.b=b,D(a),-1;f+=n}b+g>=k&&(d=J(a),k=d.length);for(;g--;)d[b]=d[b++-f];if(a.a===a.input.length)return a.b=b,-1}}for(;8<=a.d;)a.d-=8,a.a--;a.b=b;a.status=6}
function J(a){var d,b=a.input.length/a.a+1|0,c,e,f,g=a.input,h=a.c;2>b?(c=(g.length-a.a)/a.k[2],f=258*(c/2)|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*b;u?(d=new Uint8Array(e),d.set(h)):d=h;a.c=d;return a.c}x.prototype.j=function(){return u?this.c.subarray(0,this.b):this.c.slice(0,this.b)};function $(a){this.input=a===m?new (u?Uint8Array:Array):a;this.a=0;this.h=new x(this.input,this.a);this.c=this.h.c}
$.prototype.i=function(a){var d;if(a!==m)if(u){var b=new Uint8Array(this.input.length+a.length);b.set(this.input,0);b.set(a,this.input.length);this.input=b}else this.input=this.input.concat(a);var c;if(c=this.method===m){var e;var f=this.a,g=this.input,h=g[f++],l=g[f++];if(h===m||l===m)e=-1;else{switch(h&15){case 8:this.method=8;break;default:throw Error("unsupported compression method");}if(0!==((h<<8)+l)%31)throw Error("invalid fcheck flag:"+((h<<8)+l)%31);if(l&32)throw Error("fdict flag is not supported");
this.a=f;e=m}c=0>e}if(c)return new (u?Uint8Array:Array);d=this.h.i(this.input,this.a);this.a=this.h.a;return d};$.prototype.j=function(){return this.h.j()};t("Zlib.InflateStream",$);t("Zlib.InflateStream.prototype.decompress",$.prototype.i);t("Zlib.InflateStream.prototype.getBytes",$.prototype.j);}).call(this); //@ sourceMappingURL=inflate_stream.min.js.map
;
define("inflateStream", (function (global) {
    return function () {
        var ret, fn;
        return ret || global.Zlib;
    };
}(this)));

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('zText',["async", "inflateStream"], function (async, Zlib) {
    var zText = {},
        zlibReader = new FileReader(),
        textReader = new FileReader();


    zText.getRawEntry = function (inBlob, inPos, inVList, inEcoding, inIntro, inCallback) {
        if (!inPos[inVList[0].chapter-1]) {
            inCallback({message: "Wrong passage. The requested chapter is not available in this module."});
        } else {
            var bookStartPos = inPos[inVList[0].chapter-1].bookStartPos,
                startPos = inPos[inVList[0].chapter-1].startPos,
                length = inPos[inVList[0].chapter-1].length,
                chapterStartPos = bookStartPos + startPos,
                chapterEndPos = chapterStartPos + length,
                blob = inBlob.slice(bookStartPos, chapterEndPos);

            zlibReader.readAsArrayBuffer(blob);
            zlibReader.onload = function (evt) {
                var view = new Uint8Array(evt.target.result);
                //We need to initialize a new InflateStream on every request
                var inflator = new Zlib.InflateStream();
                var infBlob = new Blob([inflator.decompress(view)]);


                /*inflator.push(view, true);
                if (inflator.err) {
                    inCallback(inflator.err);
                    throw new Error(inflator.err);
                }*/
                //var infBlob = new Blob([pako.inflate(view)]); //inflator.result

                //Read raw text entry
                var rawText = [],
                    verseStart = 0,
                    verseEnd = 0,
                    z = 0,
                    gotIntro = false;
                async.whilst(
                    function () {return z < inVList.length;},
                    function (cb) {
                        if(inIntro && !gotIntro) {
                            verseStart = (inVList[z].chapter === 1) ? 0 : inPos[inVList[z].chapter-2].startPos + inPos[inVList[z].chapter-2].length;
                            verseEnd = startPos;
                        } else {
                            verseStart = startPos + inPos[inVList[z].chapter-1].verses[inVList[z].verse-1].startPos;
                            verseEnd = verseStart + inPos[inVList[z].chapter-1].verses[inVList[z].verse-1].length;
                        }
                        if (!inEcoding)
                            textReader.readAsText(infBlob.slice(verseStart, verseEnd), "CP1252");
                        else
                            textReader.readAsText(infBlob.slice(verseStart, verseEnd), inEcoding);
                        textReader.onload = function(e) {
                            if(inIntro && !gotIntro) {
                                if (e.target.result !== "")
                                    rawText.push({text: e.target.result, osis: inVList[z].book + "." + inVList[z].chapter + ".0", verse: 0});
                                gotIntro = true;
                            } else {
                                rawText.push({text: e.target.result, osis: inVList[z].osis, verse: inVList[z].verse});
                                z++;
                            }
                            cb();
                        };
                    },
                    function (inError) {
                        //console.log(rawText);
                        inCallback(inError, rawText);
                    }
                );

            };
        }

    };

    return zText;
});
/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.10',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            // Do not load if it is an empty: url
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                errback(e);
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes,
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});

/** @license
 * RequireJS plugin for loading JSON files
 * - depends on Text plugin and it was HEAVILY "inspired" by it as well.
 * Author: Miller Medeiros
 * Version: 0.3.2 (2013/08/17)
 * Released under the MIT license
 */
define('json',['text'], function(text){

    var CACHE_BUST_QUERY_PARAM = 'bust',
        CACHE_BUST_FLAG = '!bust',
        jsonParse = (typeof JSON !== 'undefined' && typeof JSON.parse === 'function')? JSON.parse : function(val){
            return eval('('+ val +')'); //quick and dirty
        },
        buildMap = {};

    function cacheBust(url){
        url = url.replace(CACHE_BUST_FLAG, '');
        url += (url.indexOf('?') < 0)? '?' : '&';
        return url + CACHE_BUST_QUERY_PARAM +'='+ Math.round(2147483647 * Math.random());
    }

    //API
    return {

        load : function(name, req, onLoad, config) {
            if ( config.isBuild && (config.inlineJSON === false || name.indexOf(CACHE_BUST_QUERY_PARAM +'=') !== -1) ) {
                //avoid inlining cache busted JSON or if inlineJSON:false
                onLoad(null);
            } else {
                text.get(req.toUrl(name), function(data){
                    if (config.isBuild) {
                        buildMap[name] = data;
                        onLoad(data);
                    } else {
                        onLoad(jsonParse(data));
                    }
                },
                    onLoad.error, {
                        accept: 'application/json'
                    }
                );
            }
        },

        normalize : function (name, normalize) {
            // used normalize to avoid caching references to a "cache busted" request
            if (name.indexOf(CACHE_BUST_FLAG) !== -1) {
                name = cacheBust(name);
            }
            // resolve any relative paths
            return normalize(name);
        },

        //write method based on RequireJS official text plugin by James Burke
        //https://github.com/jrburke/requirejs/blob/master/text.js
        write : function(pluginName, moduleName, write){
            if(moduleName in buildMap){
                var content = buildMap[moduleName];
                write('define("'+ pluginName +'!'+ moduleName +'", function(){ return '+ content +';});\n');
            }
        }

    };
});


define("json!../data/kjv.json", function(){ return {
"ot": [
    {"name": "Genesis", "abbrev": "Gen", "maxChapter": 50},
    {"name": "Exodus", "abbrev": "Exod", "maxChapter": 40},
    {"name": "Leviticus", "abbrev": "Lev", "maxChapter": 27},
    {"name": "Numbers", "abbrev": "Num", "maxChapter": 36},
    {"name": "Deuteronomy", "abbrev": "Deut", "maxChapter": 34},
    {"name": "Joshua", "abbrev": "Josh", "maxChapter": 24},
    {"name": "Judges", "abbrev": "Judg", "maxChapter": 21},
    {"name": "Ruth", "abbrev": "Ruth", "maxChapter": 4},
    {"name": "I Samuel", "abbrev": "1Sam", "maxChapter": 31},
    {"name": "II Samuel", "abbrev": "2Sam", "maxChapter": 24},
    {"name": "I Kings", "abbrev": "1Kgs", "maxChapter": 22},
    {"name": "II Kings", "abbrev": "2Kgs", "maxChapter": 25},
    {"name": "I Chronicles", "abbrev": "1Chr", "maxChapter": 29},
    {"name": "II Chronicles", "abbrev": "2Chr", "maxChapter": 36},
    {"name": "Ezra", "abbrev": "Ezra", "maxChapter": 10},
    {"name": "Nehemiah", "abbrev": "Neh", "maxChapter": 13},
    {"name": "Esther", "abbrev": "Esth", "maxChapter": 10},
    {"name": "Job", "abbrev": "Job", "maxChapter": 42},
    {"name": "Psalms", "abbrev": "Ps", "maxChapter": 150},
    {"name": "Proverbs", "abbrev": "Prov", "maxChapter": 31},
    {"name": "Ecclesiastes", "abbrev": "Eccl", "maxChapter": 12},
    {"name": "Song of Solomon", "abbrev": "Song", "maxChapter": 8},
    {"name": "Isaiah", "abbrev": "Isa", "maxChapter": 66},
    {"name": "Jeremiah", "abbrev": "Jer", "maxChapter": 52},
    {"name": "Lamentations", "abbrev": "Lam", "maxChapter": 5},
    {"name": "Ezekiel", "abbrev": "Ezek", "maxChapter": 48},
    {"name": "Daniel", "abbrev": "Dan", "maxChapter": 12},
    {"name": "Hosea", "abbrev": "Hos", "maxChapter": 14},
    {"name": "Joel", "abbrev": "Joel", "maxChapter": 3},
    {"name": "Amos", "abbrev": "Amos", "maxChapter": 9},
    {"name": "Obadiah", "abbrev": "Obad", "maxChapter": 1},
    {"name": "Jonah", "abbrev": "Jonah", "maxChapter": 4},
    {"name": "Micah", "abbrev": "Mic", "maxChapter": 7},
    {"name": "Nahum", "abbrev": "Nah", "maxChapter": 3},
    {"name": "Habakkuk", "abbrev": "Hab", "maxChapter": 3},
    {"name": "Zephaniah", "abbrev": "Zeph", "maxChapter": 3},
    {"name": "Haggai", "abbrev": "Hag", "maxChapter": 2},
    {"name": "Zechariah", "abbrev": "Zech", "maxChapter": 14},
    {"name": "Malachi", "abbrev": "Mal", "maxChapter": 4}
],
"nt": [
    {"name": "Matthew", "abbrev": "Matt", "maxChapter": 28},
    {"name": "Mark", "abbrev": "Mark", "maxChapter": 16},
    {"name": "Luke", "abbrev": "Luke", "maxChapter": 24},
    {"name": "John", "abbrev": "John", "maxChapter": 21},
    {"name": "Acts", "abbrev": "Acts", "maxChapter": 28},
    {"name": "Romans", "abbrev": "Rom", "maxChapter": 16},
    {"name": "I Corinthians", "abbrev": "1Cor", "maxChapter": 16},
    {"name": "II Corinthians", "abbrev": "2Cor", "maxChapter": 13},
    {"name": "Galatians", "abbrev": "Gal", "maxChapter": 6},
    {"name": "Ephesians", "abbrev": "Eph", "maxChapter": 6},
    {"name": "Philippians", "abbrev": "Phil", "maxChapter": 4},
    {"name": "Colossians", "abbrev": "Col", "maxChapter": 4},
    {"name": "I Thessalonians", "abbrev": "1Thess", "maxChapter": 5},
    {"name": "II Thessalonians", "abbrev": "2Thess", "maxChapter": 3},
    {"name": "I Timothy", "abbrev": "1Tim", "maxChapter": 6},
    {"name": "II Timothy", "abbrev": "2Tim", "maxChapter": 4},
    {"name": "Titus", "abbrev": "Titus", "maxChapter": 3},
    {"name": "Philemon", "abbrev": "Phlm", "maxChapter": 1},
    {"name": "Hebrews", "abbrev": "Heb", "maxChapter": 13},
    {"name": "James", "abbrev": "Jas", "maxChapter": 5},
    {"name": "I Peter", "abbrev": "1Pet", "maxChapter": 5},
    {"name": "II Peter", "abbrev": "2Pet", "maxChapter": 3},
    {"name": "I John", "abbrev": "1John", "maxChapter": 5},
    {"name": "II John", "abbrev": "2John", "maxChapter": 1},
    {"name": "III John", "abbrev": "3John", "maxChapter": 1},
    {"name": "Jude", "abbrev": "Jude", "maxChapter": 1},
    {"name": "Revelation of John", "abbrev": "Rev", "maxChapter": 22}
],
"osisToBookNum": {
    "Gen"   : 0,
    "Exod"  : 1,
    "Lev"   : 2,
    "Num"   : 3,
    "Deut"  : 4,
    "Josh"  : 5,
    "Judg"  : 6,
    "Ruth"  : 7,
    "1Sam"  : 8,
    "2Sam"  : 9,
    "1Kgs"  : 10,
    "2Kgs"  : 11,
    "1Chr"  : 12,
    "2Chr"  : 13,
    "Ezra"  : 14,
    "Neh"   : 15,
    "Esth"  : 16,
    "Job"   : 17,
    "Ps"    : 18,
    "Prov"  : 19,
    "Eccl"  : 20,
    "Song"  : 21,
    "Isa"   : 22,
    "Jer"   : 23,
    "Lam"   : 24,
    "Ezek"  : 25,
    "Dan"   : 26,
    "Hos"   : 27,
    "Joel"  : 28,
    "Amos"  : 29,
    "Obad"  : 30,
    "Jonah" : 31,
    "Mic"   : 32,
    "Nah"   : 33,
    "Hab"   : 34,
    "Zeph"  : 35,
    "Hag"   : 36,
    "Zech"  : 37,
    "Mal"   : 38,
    "Matt"  : 39,
    "Mark"  : 40,
    "Luke"  : 41,
    "John"  : 42,
    "Acts"  : 43,
    "Rom"   : 44,
    "1Cor"  : 45,
    "2Cor"  : 46,
    "Gal"   : 47,
    "Eph"   : 48,
    "Phil"  : 49,
    "Col"   : 50,
    "1Thess"    : 51,
    "2Thess"    : 52,
    "1Tim"  : 53,
    "2Tim"  : 54,
    "Titus" : 55,
    "Phlm"  : 56,
    "Heb"   : 57,
    "Jas"   : 58,
    "1Pet"  : 59,
    "2Pet"  : 60,
    "1John" : 61,
    "2John" : 62,
    "3John" : 63,
    "Jude"  : 64,
    "Rev"   : 65
},
"versesInChapter": [
    [31, 25, 24, 26, 32, 22, 24, 22, 29, 32, 32, 20, 18, 24, 21, 16, 27, 33, 38,
    18, 34, 24, 20, 67, 34, 35, 46, 22, 35, 43, 55, 32, 20, 31, 29, 43, 36,
    30, 23, 23, 57, 38, 34, 34, 28, 34, 31, 22, 33, 26],

    [22, 25, 22, 31, 23, 30, 25, 32, 35, 29, 10, 51, 22, 31, 27, 36, 16, 27, 25,
    26, 36, 31, 33, 18, 40, 37, 21, 43, 46, 38, 18, 35, 23, 35, 35, 38, 29,
    31, 43, 38],

    [17, 16, 17, 35, 19, 30, 38, 36, 24, 20, 47, 8, 59, 57, 33, 34, 16, 30, 37,
    27, 24, 33, 44, 23, 55, 46, 34],

    [54, 34, 51, 49, 31, 27, 89, 26, 23, 36, 35, 16, 33, 45, 41, 50, 13, 32, 22,
    29, 35, 41, 30, 25, 18, 65, 23, 31, 40, 16, 54, 42, 56, 29, 34, 13],

    [46, 37, 29, 49, 33, 25, 26, 20, 29, 22, 32, 32, 18, 29, 23, 22, 20, 22, 21,
    20, 23, 30, 25, 22, 19, 19, 26, 68, 29, 20, 30, 52, 29, 12],

    [18, 24, 17, 24, 15, 27, 26, 35, 27, 43, 23, 24, 33, 15, 63, 10, 18, 28, 51,
    9, 45, 34, 16, 33],

    [36, 23, 31, 24, 31, 40, 25, 35, 57, 18, 40, 15, 25, 20, 20, 31, 13, 31, 30,
    48, 25],

    [22, 23, 18, 22],

    [28, 36, 21, 22, 12, 21, 17, 22, 27, 27, 15, 25, 23, 52, 35, 23, 58, 30, 24,
    42, 15, 23, 29, 22, 44, 25, 12, 25, 11, 31, 13],

    [27, 32, 39, 12, 25, 23, 29, 18, 13, 19, 27, 31, 39, 33, 37, 23, 29, 33, 43,
    26, 22, 51, 39, 25],

    [53, 46, 28, 34, 18, 38, 51, 66, 28, 29, 43, 33, 34, 31, 34, 34, 24, 46, 21,
    43, 29, 53],

    [18, 25, 27, 44, 27, 33, 20, 29, 37, 36, 21, 21, 25, 29, 38, 20, 41, 37, 37,
    21, 26, 20, 37, 20, 30],

    [54, 55, 24, 43, 26, 81, 40, 40, 44, 14, 47, 40, 14, 17, 29, 43, 27, 17, 19,
    8, 30, 19, 32, 31, 31, 32, 34, 21, 30],

    [17, 18, 17, 22, 14, 42, 22, 18, 31, 19, 23, 16, 22, 15, 19, 14, 19, 34, 11,
    37, 20, 12, 21, 27, 28, 23, 9, 27, 36, 27, 21, 33, 25, 33, 27, 23],

    [11, 70, 13, 24, 17, 22, 28, 36, 15, 44],

    [11, 20, 32, 23, 19, 19, 73, 18, 38, 39, 36, 47, 31],

    [22, 23, 15, 17, 14, 14, 10, 17, 32, 3],

    [22, 13, 26, 21, 27, 30, 21, 22, 35, 22, 20, 25, 28, 22, 35, 22, 16, 21, 29,
    29, 34, 30, 17, 25, 6, 14, 23, 28, 25, 31, 40, 22, 33, 37, 16, 33, 24, 41,
    30, 24, 34, 17],

    [6, 12, 8, 8, 12, 10, 17, 9, 20, 18, 7, 8, 6, 7, 5, 11, 15, 50, 14, 9, 13,
    31, 6, 10, 22, 12, 14, 9, 11, 12, 24, 11, 22, 22, 28, 12, 40, 22, 13, 17,
    13, 11, 5, 26, 17, 11, 9, 14, 20, 23, 19, 9, 6, 7, 23, 13, 11, 11, 17, 12,
    8, 12, 11, 10, 13, 20, 7, 35, 36, 5, 24, 20, 28, 23, 10, 12, 20, 72, 13,
    19, 16, 8, 18, 12, 13, 17, 7, 18, 52, 17, 16, 15, 5, 23, 11, 13, 12, 9, 9,
    5, 8, 28, 22, 35, 45, 48, 43, 13, 31, 7, 10, 10, 9, 8, 18, 19, 2, 29, 176,
    7, 8, 9, 4, 8, 5, 6, 5, 6, 8, 8, 3, 18, 3, 3, 21, 26, 9, 8, 24, 13, 10, 7,
    12, 15, 21, 10, 20, 14, 9, 6],

    [33, 22, 35, 27, 23, 35, 27, 36, 18, 32, 31, 28, 25, 35, 33, 33, 28, 24, 29,
    30, 31, 29, 35, 34, 28, 28, 27, 28, 27, 33, 31],

    [18, 26, 22, 16, 20, 12, 29, 17, 18, 20, 10, 14],

    [17, 17, 11, 16, 16, 13, 13, 14],

    [31, 22, 26, 6, 30, 13, 25, 22, 21, 34, 16, 6, 22, 32, 9, 14, 14, 7, 25, 6,
    17, 25, 18, 23, 12, 21, 13, 29, 24, 33, 9, 20, 24, 17, 10, 22, 38, 22, 8,
    31, 29, 25, 28, 28, 25, 13, 15, 22, 26, 11, 23, 15, 12, 17, 13, 12, 21,
    14, 21, 22, 11, 12, 19, 12, 25, 24],

    [19, 37, 25, 31, 31, 30, 34, 22, 26, 25, 23, 17, 27, 22, 21, 21, 27, 23, 15,
    18, 14, 30, 40, 10, 38, 24, 22, 17, 32, 24, 40, 44, 26, 22, 19, 32, 21,
    28, 18, 16, 18, 22, 13, 30, 5, 28, 7, 47, 39, 46, 64, 34],

    [22, 22, 66, 22, 22],

    [28, 10, 27, 17, 17, 14, 27, 18, 11, 22, 25, 28, 23, 23, 8, 63, 24, 32, 14,
    49, 32, 31, 49, 27, 17, 21, 36, 26, 21, 26, 18, 32, 33, 31, 15, 38, 28,
    23, 29, 49, 26, 20, 27, 31, 25, 24, 23, 35],

    [21, 49, 30, 37, 31, 28, 28, 27, 27, 21, 45, 13],

    [11, 23, 5, 19, 15, 11, 16, 14, 17, 15, 12, 14, 16, 9],

    [20, 32, 21],

    [15, 16, 15, 13, 27, 14, 17, 14, 15],

    [21],

    [17, 10, 10, 11],

    [16, 13, 12, 13, 15, 16, 20],

    [15, 13, 19],

    [17, 20, 19],

    [18, 15, 20],

    [15, 23],

    [21, 13, 10, 14, 11, 15, 14, 23, 17, 12, 17, 14, 9, 21],

    [14, 17, 18, 6],

    [25, 23, 17, 25, 48, 34, 29, 34, 38, 42, 30, 50, 58, 36, 39, 28, 27, 35, 30,
    34, 46, 46, 39, 51, 46, 75, 66, 20],

    [45, 28, 35, 41, 43, 56, 37, 38, 50, 52, 33, 44, 37, 72, 47, 20],

    [80, 52, 38, 44, 39, 49, 50, 56, 62, 42, 54, 59, 35, 35, 32, 31, 37, 43, 48,
    47, 38, 71, 56, 53],

    [51, 25, 36, 54, 47, 71, 53, 59, 41, 42, 57, 50, 38, 31, 27, 33, 26, 40, 42,
    31, 25],

    [26, 47, 26, 37, 42, 15, 60, 40, 43, 48, 30, 25, 52, 28, 41, 40, 34, 28, 41,
    38, 40, 30, 35, 27, 27, 32, 44, 31],

    [32, 29, 31, 25, 21, 23, 25, 39, 33, 21, 36, 21, 14, 23, 33, 27],

    [31, 16, 23, 21, 13, 20, 40, 13, 27, 33, 34, 31, 13, 40, 58, 24],

    [24, 17, 18, 18, 21, 18, 16, 24, 15, 18, 33, 21, 14],

    [24, 21, 29, 31, 26, 18],

    [23, 22, 21, 32, 33, 24],

    [30, 30, 21, 23],

    [29, 23, 25, 18],

    [10, 20, 13, 18, 28],

    [12, 17, 18],

    [20, 15, 16, 16, 25, 21],

    [18, 26, 17, 22],

    [16, 15, 15],

    [25],

    [14, 18, 19, 16, 14, 20, 28, 13, 28, 39, 40, 29, 25],

    [27, 26, 18, 17, 20],

    [25, 25, 22, 19, 14],

    [21, 22, 18],

    [10, 29, 24, 21, 21],

    [13],

    [14],

    [25],

    [20, 29, 22, 11, 14, 17, 17, 13, 21, 11, 19, 17, 18, 20, 8, 21, 18, 24, 21,
    15, 27, 21]
]
};});


define("json!../data/german.json", function(){ return {
"ot": [
    {"name": "Genesis", "abbrev": "Gen", "maxChapter": 50},
    {"name": "Exodus", "abbrev": "Exod", "maxChapter": 40},
    {"name": "Leviticus", "abbrev": "Lev", "maxChapter": 27},
    {"name": "Numbers", "abbrev": "Num", "maxChapter": 36},
    {"name": "Deuteronomy", "abbrev": "Deut", "maxChapter": 34},
    {"name": "Joshua", "abbrev": "Josh", "maxChapter": 24},
    {"name": "Judges", "abbrev": "Judg", "maxChapter": 21},
    {"name": "Ruth", "abbrev": "Ruth", "maxChapter": 4},
    {"name": "I Samuel", "abbrev": "1Sam", "maxChapter": 31},
    {"name": "II Samuel", "abbrev": "2Sam", "maxChapter": 24},
    {"name": "I Kings", "abbrev": "1Kgs", "maxChapter": 22},
    {"name": "II Kings", "abbrev": "2Kgs", "maxChapter": 25},
    {"name": "I Chronicles", "abbrev": "1Chr", "maxChapter": 29},
    {"name": "II Chronicles", "abbrev": "2Chr", "maxChapter": 36},
    {"name": "Ezra", "abbrev": "Ezra", "maxChapter": 10},
    {"name": "Nehemiah", "abbrev": "Neh", "maxChapter": 13},
    {"name": "Esther", "abbrev": "Esth", "maxChapter": 10},
    {"name": "Job", "abbrev": "Job", "maxChapter": 42},
    {"name": "Psalms", "abbrev": "Ps", "maxChapter": 150},
    {"name": "Proverbs", "abbrev": "Prov", "maxChapter": 31},
    {"name": "Ecclesiastes", "abbrev": "Eccl", "maxChapter": 12},
    {"name": "Song of Solomon", "abbrev": "Song", "maxChapter": 8},
    {"name": "Isaiah", "abbrev": "Isa", "maxChapter": 66},
    {"name": "Jeremiah", "abbrev": "Jer", "maxChapter": 52},
    {"name": "Lamentations", "abbrev": "Lam", "maxChapter": 5},
    {"name": "Ezekiel", "abbrev": "Ezek", "maxChapter": 48},
    {"name": "Daniel", "abbrev": "Dan", "maxChapter": 12},
    {"name": "Hosea", "abbrev": "Hos", "maxChapter": 14},
    {"name": "Joel", "abbrev": "Joel", "maxChapter": 4},
    {"name": "Amos", "abbrev": "Amos", "maxChapter": 9},
    {"name": "Obadiah", "abbrev": "Obad", "maxChapter": 1},
    {"name": "Jonah", "abbrev": "Jonah", "maxChapter": 4},
    {"name": "Micah", "abbrev": "Mic", "maxChapter": 7},
    {"name": "Nahum", "abbrev": "Nah", "maxChapter": 3},
    {"name": "Habakkuk", "abbrev": "Hab", "maxChapter": 3},
    {"name": "Zephaniah", "abbrev": "Zeph", "maxChapter": 3},
    {"name": "Haggai", "abbrev": "Hag", "maxChapter": 2},
    {"name": "Zechariah", "abbrev": "Zech", "maxChapter": 14},
    {"name": "Malachi", "abbrev": "Mal", "maxChapter": 3}
],
"versesInChapter": [
    [31, 25, 24, 26, 32, 22, 24, 22, 29, 32, 32, 20, 18, 24, 21, 16, 27, 33, 38, 18, 34, 24, 20, 67, 34, 35, 46, 22, 35, 43, 54, 33, 20, 31, 29, 43, 36, 30, 23, 23, 57, 38, 34, 34, 28, 34, 31, 22, 33, 26],

    [22, 25, 22, 31, 23, 30, 29, 28, 35, 29, 10, 51, 22, 31, 27, 36, 16, 27, 25, 26, 37, 30, 33, 18, 40, 37, 21, 43, 46, 38, 18, 35, 23, 35, 35, 38, 29, 31, 43, 38],

    [17, 16, 17, 35, 26, 23, 38, 36, 24, 20, 47, 8, 59, 57, 33, 34, 16, 30, 37, 27, 24, 33, 44, 23, 55, 46, 34],

    [54, 34, 51, 49, 31, 27, 89, 26, 23, 36, 35, 16, 33, 45, 41, 35, 28, 32, 22, 29, 35, 41, 30, 25, 19, 65, 23, 31, 39, 17, 54, 42, 56, 29, 34, 13],

    [46, 37, 29, 49, 33, 25, 26, 20, 29, 22, 32, 31, 19, 29, 23, 22, 20, 22, 21, 20, 23, 29, 26, 22, 19, 19, 26, 69, 28, 20, 30, 52, 29, 12],

    [18, 24, 17, 24, 15, 27, 26, 35, 27, 43, 23, 24, 33, 15, 63, 10, 18, 28, 51, 9, 45, 34, 16, 33],

    [36, 23, 31, 24, 31, 40, 25, 35, 57, 18, 40, 15, 25, 20, 20, 31, 13, 31, 30, 48, 25],

    [22, 23, 18, 22],

    [28, 36, 21, 22, 12, 21, 17, 22, 27, 27, 15, 25, 23, 52, 35, 23, 58, 30, 24, 42, 16, 23, 28, 23, 44, 25, 12, 25, 11, 31, 13],

    [27, 32, 39, 12, 25, 23, 29, 18, 13, 19, 27, 31, 39, 33, 37, 23, 29, 32, 44, 26, 22, 51, 39, 25],

    [53, 46, 28, 20, 32, 38, 51, 66, 28, 29, 43, 33, 34, 31, 34, 34, 24, 46, 21, 43, 29, 54],

    [18, 25, 27, 44, 27, 33, 20, 29, 37, 36, 20, 22, 25, 29, 39, 20, 41, 37, 37, 21, 26, 20, 37, 20, 30],

    [54, 55, 24, 43, 41, 66, 40, 40, 44, 14, 47, 41, 14, 17, 29, 43, 27, 17, 19, 8, 30, 19, 32, 31, 31, 32, 34, 21, 30],

    [18, 17, 17, 22, 14, 42, 22, 18, 31, 19, 23, 16, 23, 14, 19, 14, 19, 34, 11, 37, 20, 12, 21, 27, 28, 23, 9, 27, 36, 27, 21, 33, 25, 33, 27, 23],

    [11, 70, 13, 24, 17, 22, 28, 36, 15, 44],

    [11, 20, 38, 17, 19, 19, 73, 18, 37, 40, 36, 47, 31],

    [22, 23, 15, 17, 14, 14, 10, 17, 32, 3],

    [22, 13, 26, 21, 27, 30, 21, 22, 35, 22, 20, 25, 28, 22, 35, 22, 16, 21, 29, 29, 34, 30, 17, 25, 6, 14, 23, 28, 25, 31, 40, 22, 33, 37, 16, 33, 24, 41, 30, 32, 26, 17],

    [6, 12, 9, 9, 13, 11, 18, 10, 21, 18, 7, 9, 6, 7, 5, 11, 15, 51, 15, 10, 14, 32, 6, 10, 22, 12, 14, 9, 11, 13, 25, 11, 22, 23, 28, 13, 40, 23, 14, 18, 14, 12, 5, 27, 18, 12, 10, 15, 21, 23, 21, 11, 7, 9, 24, 14, 12, 12, 18, 14, 9, 13, 12, 11, 14, 20, 8, 36, 37, 6, 24, 20, 28, 23, 11, 13, 21, 72, 13, 20, 17, 8, 19, 13, 14, 17, 7, 19, 53, 17, 16, 16, 5, 23, 11, 13, 12, 9, 9, 5, 8, 29, 22, 35, 45, 48, 43, 14, 31, 7, 10, 10, 9, 8, 18, 19, 2, 29, 176, 7, 8, 9, 4, 8, 5, 6, 5, 6, 8, 8, 3, 18, 3, 3, 21, 26, 9, 8, 24, 14, 10, 8, 12, 15, 21, 10, 20, 14, 9, 6],

    [33, 22, 35, 27, 23, 35, 27, 36, 18, 32, 31, 28, 25, 35, 33, 33, 28, 24, 29, 30, 31, 29, 35, 34, 28, 28, 27, 28, 27, 33, 31],

    [18, 26, 22, 17, 19, 12, 29, 17, 18, 20, 10, 14],

    [17, 17, 11, 16, 16, 12, 14, 14],

    [31, 22, 26, 6, 30, 13, 25, 23, 20, 34, 16, 6, 22, 32, 9, 14, 14, 7, 25, 6, 17, 25, 18, 23, 12, 21, 13, 29, 24, 33, 9, 20, 24, 17, 10, 22, 38, 22, 8, 31, 29, 25, 28, 28, 25, 13, 15, 22, 26, 11, 23, 15, 12, 17, 13, 12, 21, 14, 21, 22, 11, 12, 19, 11, 25, 24],

    [19, 37, 25, 31, 31, 30, 34, 23, 25, 25, 23, 17, 27, 22, 21, 21, 27, 23, 15, 18, 14, 30, 40, 10, 38, 24, 22, 17, 32, 24, 40, 44, 26, 22, 19, 32, 21, 28, 18, 16, 18, 22, 13, 30, 5, 28, 7, 47, 39, 46, 64, 34],

    [22, 22, 66, 22, 22],

    [28, 10, 27, 17, 17, 14, 27, 18, 11, 22, 25, 28, 23, 23, 8, 63, 24, 32, 14, 44, 37, 31, 49, 27, 17, 21, 36, 26, 21, 26, 18, 32, 33, 31, 15, 38, 28, 23, 29, 49, 26, 20, 27, 31, 25, 24, 23, 35],

    [21, 49, 33, 34, 30, 29, 28, 27, 27, 21, 45, 13],

    [9, 25, 5, 19, 15, 11, 16, 14, 17, 15, 11, 15, 15, 10],

    [20, 27, 5, 21],

    [15, 16, 15, 13, 27, 14, 17, 14, 15],

    [21],

    [16, 11, 10, 11],

    [16, 13, 12, 14, 14, 16, 20],

    [14, 14, 19],

    [17, 20, 19],

    [18, 15, 20],

    [15, 23],

    [17, 17, 10, 14, 11, 15, 14, 23, 17, 12, 17, 14, 9, 21],

    [14, 17, 24],

    [25, 23, 17, 25, 48, 34, 29, 34, 38, 42, 30, 50, 58, 36, 39, 28, 27, 35, 30, 34, 46, 46, 39, 51, 46, 75, 66, 20],

    [45, 28, 35, 41, 43, 56, 37, 38, 50, 52, 33, 44, 37, 72, 47, 20],

    [80, 52, 38, 44, 39, 49, 50, 56, 62, 42, 54, 59, 35, 35, 32, 31, 37, 43, 48, 47, 38, 71, 56, 53],

    [51, 25, 36, 54, 47, 71, 53, 59, 41, 42, 57, 50, 38, 31, 27, 33, 26, 40, 42, 31, 25],

    [26, 47, 26, 37, 42, 15, 60, 40, 43, 48, 30, 25, 52, 28, 41, 40, 34, 28, 40, 38, 40, 30, 35, 27, 27, 32, 44, 31],

    [32, 29, 31, 25, 21, 23, 25, 39, 33, 21, 36, 21, 14, 23, 33, 27],

    [31, 16, 23, 21, 13, 20, 40, 13, 27, 33, 34, 31, 13, 40, 58, 24],

    [24, 17, 18, 18, 21, 18, 16, 24, 15, 18, 33, 21, 13],

    [24, 21, 29, 31, 26, 18],

    [23, 22, 21, 32, 33, 24],

    [30, 30, 21, 23],

    [29, 23, 25, 18],

    [10, 20, 13, 18, 28],

    [12, 17, 18],

    [20, 15, 16, 16, 25, 21],

    [18, 26, 17, 22],

    [16, 15, 15],

    [25],

    [14, 18, 19, 16, 14, 20, 28, 13, 28, 39, 40, 29, 25],

    [27, 26, 18, 17, 20],

    [25, 25, 22, 19, 14],

    [21, 22, 18],

    [10, 29, 24, 21, 21],

    [13],

    [15],

    [25],

    [20, 29, 22, 11, 14, 17, 17, 13, 21, 11, 19, 18, 18, 20, 8, 21, 18, 24, 21, 15, 27, 21]
]
}
;});

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('versificationMgr',["json!../data/kjv.json", "json!../data/german.json"], function (kjv, german) {
    var versificationMgr = {};

    versificationMgr.kjv = kjv;
    german["nt"] = kjv.nt;
    german["osisToBookNum"] = kjv.osisToBookNum;
    versificationMgr.german = german;

    function getBooksInOT (v11n) {
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n].ot.length;
        else
            return versificationMgr.kjv.ot.length;
    }

    function getBooksInNT (v11n) {
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n].nt.length;
        else
            return versificationMgr.kjv.nt.length;
    }

    function getChapterMax (inBookNum, v11n) {
        inBookNum = (inBookNum < 0) ? 0 : inBookNum;
        var booksOT = getBooksInOT(v11n);
        var testament = (inBookNum < booksOT) ? "ot" : "nt";
        inBookNum = (inBookNum < booksOT) ? inBookNum : inBookNum - booksOT;
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n][testament][inBookNum].maxChapter;
        else
            return versificationMgr.kjv[testament][inBookNum].maxChapter;
    }

    function getVersesInChapter (inBookNum, inChapter, v11n) {
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n].versesInChapter[inBookNum][parseInt(inChapter, 10)-1];
        else
            return versificationMgr.kjv.versesInChapter[inBookNum][parseInt(inChapter, 10)-1];
    }

    function getBook(inBookNum, v11n) {
        inBookNum = (inBookNum < 0) ? 0 : inBookNum;
        var booksOT = getBooksInOT(v11n);
        var testament = (inBookNum < booksOT) ? "ot" : "nt";
        inBookNum = (inBookNum < booksOT) ? inBookNum : inBookNum - booksOT;
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n][testament][inBookNum];
        else
            return versificationMgr.kjv[testament][inBookNum];
    }

    function getBookNum(inOsis, v11n) {
        //console.log(inOsis, v11n, versificationMgr.kjv.osisToBookNum[inOsis]);
        if (v11n !== undefined && versificationMgr[v11n])
            return versificationMgr[v11n].osisToBookNum[inOsis];
        else
            return versificationMgr.kjv.osisToBookNum[inOsis];
    }

    function getAllBooks(v11n) {
        var books = [];
        if (v11n !== undefined && versificationMgr[v11n]) {
            books.push.apply(books, versificationMgr[v11n].ot);
            books.push.apply(books, versificationMgr[v11n].nt);
        } else {
            books.push.apply(books, versificationMgr.kjv.ot);
            books.push.apply(books, versificationMgr.kjv.nt);
        }
        return books;
    }

    return {
        getBooksInOT: getBooksInOT,
        getBooksInNT: getBooksInNT,
        getChapterMax: getChapterMax,
        getVersesInChapter: getVersesInChapter,
        getBook: getBook,
        getBookNum: getBookNum,
        getAllBooks: getAllBooks
    };
});

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('installMgr',["unzip", "dataMgr", "zText", "versificationMgr", "async", "tools"], function (Zlib, dataMgr, zText, versificationMgr, async, tools) {
    var start = 0,
        buf = null,
        isEnd = false;

    //Get a list of all available repos/sources from CrossWire's masterRepoList.conf
    function getRepositories(inCallback) {
        download("http://crosswire.org/ftpmirror/pub/sword/masterRepoList.conf", "text", function (inError, inResponse) {
            if (inResponse === "" && !inError) {
                inCallback("Couldn't download master repo list!");
            } else if (!inError) {
                var repos = [],
                    split = null,
                    type = "",
                    repoName = "";
                inResponse.split(/[\r\n]+/g).forEach(function (repo) {
                    split = repo.split("|");
                    if(split.length > 1 && split[0].search("CrossWire") !== -1) {
                        repoName = split[0].split("=")[2];
                        switch (repoName) {
                            case "CrossWire":
                                type = "main";
                            break;
                            case "CrossWire Beta":
                                type = "beta";
                            break;
                            case "CrossWire av11n":
                                type = "av";
                            break;
                            case "CrossWire Attic":
                                type = "attic";
                            break;
                            case "CrossWire Wycliffe":
                                type = "wycliffe";
                            break;
                            case "CrossWire av11n Attic":
                                type = "avattic";
                            break;
                        }
                        repos.push({
                            name: repoName,
                            type: type,
                            url: "http://crosswire.org/ftpmirror" + split[2].replace("raw", "packages") + "/rawzip/",
                            confUrl: "http://crosswire.org/ftpmirror" + split[2] + "/mods.d"
                        });
                    }
                });
                //console.log("REPOS", repos);
                inCallback(inError, repos);
            } else {
                inCallback(inError);
            }
        });
    }

    //dirty hack to get a list of modules that is available in a repository.
    //FIXME: unpack mods.d.tar.gz in Javascript (untar is the problem) or ask CrossWire to compress it as zip/gzip
    function getModules(inRepo, inCallback) {
        download(inRepo.confUrl, "document", function (inError, inResponse) {
            if (!inError) {
                var tasks = [],
                    url = "",
                    a = inResponse.getElementsByTagName("a");
                for(var i=0;i<a.length;i++) {
                    if (a[i].href.search(".conf") !== -1) {
                        url = a[i].baseURI + "/" + a[i].textContent;
                        tasks.push((function (url) {
                            return function (cb) {
                                download(url, "text", function (inError, inConf) {
                                    var configData = tools.readConf(inConf);
                                    if (configData.ModDrv === "zText") {
                                        //configData["url"] = inRepo.url + configData.moduleKey + ".zip";
                                        configData["url"] = "http://www.crosswire.org/sword/servlet/SwordMod.Verify?modName=" + configData.moduleKey + "&" + inRepo.type + "=true&pkgType=raw";
                                        cb(inError, configData);
                                    } else {
                                        cb(inError);
                                    }
                                });
                            };
                        })(url));
                    }
                }
                async.parallel(tasks, function (inError, inModules) {
                    inCallback(inError, tools.cleanArray(inModules).sort(tools.dynamicSortMultiple("Lang", "moduleKey")));
                });
            } else {
                inCallback(inError);
            }

        });
    }

    function download(url, reponseType, inCallback, inProgressCallback) {
        var xhr = new XMLHttpRequest({mozSystem: true, mozAnon: true});
        xhr.open('GET', url, true);
        //xhr.setRequestHeader("Accept-Encoding", "gzip, deflate");
        xhr.responseType = reponseType; //"blob";
        xhr.onreadystatechange = function (evt) {
            //console.log(xhr.readyState, evt, xhr.status);
            if (xhr.readyState == 4) {
                if(xhr.status === 200)
                    inCallback(null, xhr.response);
                else
                    inCallback({message: "Couldn't download module.", error: xhr.status});
            }
        };
        xhr.onprogress = inProgressCallback;
        xhr.onerror = function (inError) {
            inCallback(inError);
        };
        xhr.send(null);
    }

    //Install a module. inUrl can be an url or a file blob (zipped module file)
    function installModule (inUrl, inCallback, inProgressCallback) {
        if(typeof inUrl === "string") {
            download(inUrl, "document", function (inError, inResponse) {
                if(!inError) {
                    var newUrl = inResponse.getElementsByTagName("a")[0].href;
                    download(newUrl, "blob", function (inError, inBlob) {
                        if(!inError) _installModule(inBlob, inCallback);
                        else inCallback(inError);
                    },
                    inProgressCallback);
                } else inCallback(inError);
            });
        } else {
            _installModule(inUrl, inCallback);
        }
    }

    function _installModule(inBlob, inCallback) {
        var blob = null;
        var zipReader = new FileReader();
        zipReader.onload = function(evt) {
            var unzip = new Zlib.Unzip(new Uint8Array(evt.target.result));
            var filenames = unzip.getFilenames();
            filenames.forEach(function (name, index) {
                if(name.search(".conf") !== -1) {
                    dataMgr.saveConfig(new Blob([unzip.decompress(name)]),
                        function (inError, inDoc) {
                            if(!inError) buildIndex(unzip, inDoc.v11n, inDoc, inCallback);
                            else inCallback(inError);
                        });
                }
            });
        };
        zipReader.readAsArrayBuffer(inBlob);
    }

    //Remove a module
    function removeModule(inModuleKey, inCallback) {
        if(typeof inModuleKey === "string")
            dataMgr.removeModule(inModuleKey, inCallback);
        else
            inCallback({message: "inModuleKey must be a string!"});
    }

    //Build the index with all entry points for a book or chapter
    function buildIndex(inUnzip, inV11n, inDoc, inCallback) {
        var files = {};
        files["bin"] = [];

        var filenames = inUnzip.getFilenames();
        filenames.forEach(function (name, index) {
            if(name.search("nt.bzs") !== -1)
                files["ntB"] = name;
            else if(name.search("nt.bzv") !== -1)
                files["ntCV"] = name;
            else if(name.search("ot.bzs") !== -1)
                files["otB"] = name;
            else if(name.search("ot.bzv") !== -1)
                files["otCV"] = name;
            else if (name.search(".conf") === -1)
                files.bin.push({blob: new Blob([inUnzip.decompress(name)]), name: name});
        });

        async.series([
            function (cb) {
                dataMgr.saveModule(files.bin, inDoc, function (inError, inResponse) {
                    if(!inError) cb(null);
                    else cb(inError);
                });
            },
            function (cb) {
                var bookPosOT = null,
                    chapterVersePosOT = null,
                    bookPosNT = null,
                    chapterVersePosNT = null;

                if (files.otB) {
                    bookPosOT = getBookPositions(inUnzip.decompress(files.otB));
                    chapterVersePosOT = getChapterVersePositions(inUnzip.decompress(files.otCV), bookPosOT, "ot", inV11n);
                }
                if (files.ntB) {
                    bookPosNT = getBookPositions(inUnzip.decompress(files.ntB));
                    chapterVersePosNT = getChapterVersePositions(inUnzip.decompress(files.ntCV), bookPosNT, "nt", inV11n);
                }
                //console.log(chapterVersePosOT, chapterVersePosNT);

                dataMgr.saveBCVPos(chapterVersePosOT, chapterVersePosNT, inDoc, function (inError, inResponse) {
                    if(!inError) cb(null);
                    else cb(inError);
                });
            }
            ], function (inError, inResult) {
                if(!inError) inCallback(null, inDoc.id);
                else {
                    //If we got an error while saving the blob files, delete the config entry in the database
                    dataMgr.remove(inDoc.id, function (inError) {
                        //console.log(inError);
                    });
                    inCallback(inError);
                }

            }
        );
    }

    //Get the positions of each book
    function getBookPositions(inBuf, inCallback) {
        var startPos = 0,
            length = 0,
            unused = 0,
            res = null,
            end = false,
            bookPositions = [];
        start = 0;

        while(!end) {
            res = getIntFromStream(inBuf);
            startPos = res[0];
            end = res[1];
            if (!end) {
                res = getIntFromStream(inBuf);
                length = res[0];
                end = res[1];
                if (!end) {
                    res = getIntFromStream(inBuf);
                    unused = res[0];
                    end = res[1];
                    if (end)
                        break;
                    bookPositions.push({startPos: startPos, length: length, unused: unused});
                }
            }
        }
        return bookPositions;
    }

    //dump some bytes in the chapter and verse index file
    function dumpBytes(inBuf) {
        start = 0;

        for (var i=0;i<4;i++) {
            getShortIntFromStream(inBuf);
            getInt48FromStream(inBuf);
            getShortIntFromStream(inBuf);
        }
    }
    // ### This code is based on the zTextReader class from cross-connect (https://code.google.com/p/cross-connect), Copyright (C) 2011 Thomas Dilts ###

    //Get the position of each chapter and verse
    function getChapterVersePositions(inBuf, inBookPositions, inTestament, inV11n) {
        dumpBytes(inBuf);
        var booksStart = (inTestament === "ot") ? 0 : versificationMgr.getBooksInOT(inV11n);
        var booksEnd = (inTestament === "ot") ? versificationMgr.getBooksInOT(inV11n) : versificationMgr.getBooksInOT(inV11n)+versificationMgr.getBooksInNT(inV11n);
        var chapterZ = 0,
            verseZ = 0,
            chapterStartPos = 0,
            lastNonZeroStartPos = 0,
            length = 0,
            chapterLength = 0,
            bookStartPos = 0,
            booknum = 0,
            verseMax = 0,
            bookData = null,
            startPos = 0,
            chapt = {},
            chapters = {};

        for (var b = booksStart; b<booksEnd; b++) {
            bookData = versificationMgr.getBook(b, inV11n);
            chapters[bookData.abbrev] = [];
            //console.log(bookData);
            for (var c = 0; c<bookData.maxChapter; c++) {
                chapterStartPos = 0;
                lastNonZeroStartPos = 0;
                chapt = {};
                chapt["verses"] = [];
                length = 0;
                verseMax = versificationMgr.getVersesInChapter(b,c+1, inV11n);
                for (var v = 0; v<verseMax; v++) {
                    booknum = getShortIntFromStream(inBuf)[0];
                    startPos = getInt48FromStream(inBuf)[0];

                    if (startPos !== 0)
                        lastNonZeroStartPos = startPos;

                    length = getShortIntFromStream(inBuf)[0];
                    //console.log("startPos, length", startPos, length);
                    if (v === 0) {
                        chapterStartPos = startPos;
                        bookStartPos = 0;
                        if (booknum < inBookPositions.length) {
                            //console.log("inBookPositions.startPos", inBookPositions[booknum].startPos, booknum, inBookPositions.length);
                            bookStartPos = inBookPositions[booknum].startPos;
                        }
                        chapt["startPos"] = chapterStartPos;
                        chapt["booknum"] = b;
                        //chapt["bookRelativeChapterNum"] = c;
                        chapt["bookStartPos"] = bookStartPos;
                    }
                    if (booknum === 0 && startPos === 0 && length === 0) {
                        if (chapt !== {}) {
                            chapt["verses"].push({startPos: 0, length: 0});
                        }
                    } else {
                        if (chapt !== {}) {
                            chapt["verses"].push({startPos: startPos - chapterStartPos, length: length});
                        }
                    }
                } //end verse
                if (chapt != {}) {
                    //console.log("LENGTH:", lastNonZeroStartPos, chapterStartPos, length);
                    chapterLength = lastNonZeroStartPos - chapterStartPos + length;
                    if (!isNaN(chapterLength) && chapterLength !== 0) {
                        chapt["length"] = chapterLength;
                        chapters[bookData.abbrev].push(chapt);
                    } else {
                        delete chapters[bookData.abbrev];
                    }

                }
                // dump a post for the chapter break
                getShortIntFromStream(inBuf);
                getInt48FromStream(inBuf);
                getShortIntFromStream(inBuf);
            } //end chpaters
            // dump a post for the book break
            getShortIntFromStream(inBuf);
            getInt48FromStream(inBuf);
            getShortIntFromStream(inBuf);
        } //end books
        return chapters;
    }

    function getIntFromStream(inBuf, inCallback) {
        buf = inBuf.subarray(start, start+4);
        isEnd = false;
        start = start+4;
        if (buf.length !== 4)
            isEnd = true;
        if (inCallback)
            inCallback(buf[3] * 0x100000 + buf[2] * 0x10000 + buf[1] * 0x100 + buf[0], isEnd);
        return [buf[3] * 0x100000 + buf[2] * 0x10000 + buf[1] * 0x100 + buf[0], isEnd];
    }

    function getShortIntFromStream(inBuf, inCallback) {
        buf = inBuf.subarray(start, start+2);
        isEnd = false;
        start = start+2;
        if (buf.length !== 2)
            isEnd = true;
        if (inCallback)
            inCallback(buf[1] * 0x100 + buf[0], isEnd);
        return [buf[1] * 0x100 + buf[0], isEnd];
    }

    function getInt48FromStream(inBuf, inCallback) {
        buf = inBuf.subarray(start, start+6);
        isEnd = false;
        start = start+6;
        if (buf.length !== 6)
            isEnd = true;
        if (inCallback)
            inCallback(buf[1] * 0x100000000000 + buf[0] * 0x100000000 + buf[5] * 0x1000000 + buf[4] * 0x10000 + buf[3] * 0x100 + buf[2], isEnd);
        return [buf[1] * 0x100000000000 + buf[0] * 0x100000000 + buf[5] * 0x1000000 + buf[4] * 0x10000 + buf[3] * 0x100 + buf[2], isEnd];
    }

    return {
        getRepositories: getRepositories,
        getModules: getModules,
        installModule: installModule,
        removeModule: removeModule
    };
});
;(function(g){

    // summary: A simple feature detection function/framework.
    //
    // name: String
    //      The name of the feature to detect, as defined by the overall `has` tests.
    //      Tests can be registered via `has.add(testname, testfunction)`.
    //
    // example:
    //      mylibrary.bind = has("native-bind") ? function(fn, context){
    //          return fn.bind(context);
    //      } : function(fn, context){
    //          return function(){
    //              fn.apply(context, arguments);
    //          }
    //      }

    var NON_HOST_TYPES = { "boolean": 1, "number": 1, "string": 1, "undefined": 1 },
        VENDOR_PREFIXES = ["Webkit", "Moz", "O", "ms", "Khtml"],
        d = isHostType(g, "document") && g.document,
        el = d && isHostType(d, "createElement") && d.createElement("DiV"),
        freeExports = typeof exports == "object" && exports,
        freeModule = typeof module == "object" && module,
        testCache = {}
    ;

    function has(/* String */name){
        if(typeof testCache[name] == "function"){
            testCache[name] = testCache[name](g, d, el);
        }
        return testCache[name]; // Boolean
    }

    function add(/* String */name, /* Function */test, /* Boolean? */now){
        // summary: Register a new feature detection test for some named feature
        //
        // name: String
        //      The name of the feature to test.
        //
        // test: Function
        //      A test function to register. If a function, queued for testing until actually
        //      needed. The test function should return a boolean indicating
        //      the presence of a feature or bug.
        //
        // now: Boolean?
        //      Optional. Omit if `test` is not a function. Provides a way to immediately
        //      run the test and cache the result.
        // example:
        //      A redundant test, testFn with immediate execution:
        //  |       has.add("javascript", function(){ return true; }, true);
        //
        // example:
        //      Again with the redundantness. You can do this in your tests, but we should
        //      not be doing this in any internal has.js tests
        //  |       has.add("javascript", true);
        //
        // example:
        //      Three things are passed to the testFunction. `global`, `document`, and a generic element
        //      from which to work your test should the need arise.
        //  |       has.add("bug-byid", function(g, d, el){
        //  |           // g  == global, typically window, yadda yadda
        //  |           // d  == document object
        //  |           // el == the generic element. a `has` element.
        //  |           return false; // fake test, byid-when-form-has-name-matching-an-id is slightly longer
        //  |       });
        testCache[name] = now ? test(g, d, el) : test;
    }

    // cssprop adapted from http://gist.github.com/598008 (thanks, ^pi)
    function cssprop(name, el){
        var supported = false,
            capitalized = name.charAt(0).toUpperCase() + name.slice(1),
            length = VENDOR_PREFIXES.length,
            style = el.style;

        if(typeof style[name] == "string"){
            supported = true;
        }else{
            while(length--){
                if(typeof style[VENDOR_PREFIXES[length] + capitalized] == "string"){
                    supported = true;
                    break;
                }
            }
        }
        return supported;
    }

    function clearElement(el){
        if(el){
            while(el.lastChild){
                el.removeChild(el.lastChild);
            }
        }
        return el;
    }

    // Host objects can return type values that are different from their actual
    // data type. The objects we are concerned with usually return non-primitive
    // types of object, function, or unknown.
    function isHostType(object, property){
        var type = typeof object[property];
        return type == "object" ? !!object[property] : !NON_HOST_TYPES[type];
    }

        has.add = add;
    has.clearElement = clearElement;
    has.cssprop = cssprop;
    has.isHostType = isHostType;
    has._tests = testCache;

    has.add("dom", function(g, d, el){
        return d && el && isHostType(g, "location") && isHostType(d, "documentElement") &&
            isHostType(d, "getElementById") && isHostType(d, "getElementsByName") &&
            isHostType(d, "getElementsByTagName") && isHostType(d, "createComment") &&
            isHostType(d, "createElement") && isHostType(d, "createTextNode") &&
            isHostType(el, "appendChild") && isHostType(el, "insertBefore") &&
            isHostType(el, "removeChild") && isHostType(el, "getAttribute") &&
            isHostType(el, "setAttribute") && isHostType(el, "removeAttribute") &&
            isHostType(el, "style") && typeof el.style.cssText == "string";
    });

    // Stop repeat background-image requests and reduce memory consumption in IE6 SP1
    // http://misterpixel.blogspot.com/2006/09/forensic-analysis-of-ie6.html
    // http://blogs.msdn.com/b/cwilso/archive/2006/11/07/ie-re-downloading-background-images.aspx?PageIndex=1
    // http://support.microsoft.com/kb/823727
    try{
        document.execCommand("BackgroundImageCache", false, true);
    }catch(e){}

    // Expose has()
    // some AMD build optimizers, like r.js, check for specific condition patterns like the following:
    if(typeof define == "function" && typeof define.amd == "object" && define.amd){
        define("has", [],function(){
            return has;
        });
    }
    // check for `exports` after `define` in case a build optimizer adds an `exports` object
    else if(freeExports){
        // in Node.js or RingoJS v0.8.0+
        if(freeModule && freeModule.exports == freeExports){
          (freeModule.exports = has).has = has;
        }
        // in Narwhal or RingoJS v0.7.0-
        else{
          freeExports.has = has;
        }
    }
    // in a browser or Rhino
    else{
        // use square bracket notation so Closure Compiler won't munge `has`
        // http://code.google.com/closure/compiler/docs/api-tutorial3.html#export
        g["has"] = has;
    }
})(this);

(function(){var l,la,s,T={}.hasOwnProperty;this.bcv_parser=l=function(){function k(){var b,h,c;this.options={};c=k.prototype.options;for(b in c)T.call(c,b)&&(h=c[b],this.options[b]=h);this.versification_system(this.options.versification_system)}k.prototype.s="";k.prototype.entities=[];k.prototype.passage=null;k.prototype.regexps={};k.prototype.options={consecutive_combination_strategy:"combine",osis_compaction_strategy:"b",book_sequence_strategy:"ignore",invalid_sequence_strategy:"ignore",sequence_combination_strategy:"combine",
invalid_passage_strategy:"ignore",zero_chapter_strategy:"error",zero_verse_strategy:"error",non_latin_digits_strategy:"ignore",book_alone_strategy:"ignore",captive_end_digits_strategy:"delete",end_range_digits_strategy:"verse",include_apocrypha:!1,ps151_strategy:"c",versification_system:"default",case_sensitive:"none"};k.prototype.parse=function(b){var h;this.reset();this.s=b;b=this.replace_control_characters(b);h=this.match_books(b);b=h[0];this.passage.books=h[1];this.entities=this.match_passages(b);
return this};k.prototype.reset=function(){this.s="";this.entities=[];if(this.passage)return this.passage.books=[],this.passage.indices={};this.passage=new la;this.passage.options=this.options;return this.passage.translations=this.translations};k.prototype.set_options=function(b){var h,c;for(h in b)if(T.call(b,h))if(c=b[h],"include_apocrypha"===h||"versification_system"===h||"case_sensitive"===h)this[h](c);else this.options[h]=c;return this};k.prototype.include_apocrypha=function(b){if(null==b||!0!==
b&&!1!==b)return this;this.options.include_apocrypha=b;this.regexps.books=this.regexps.get_books(b,this.options.case_sensitive);!0===b?this.translations["default"].chapters.Ps[150]=this.translations["default"].chapters.Ps151[0]:!1===b&&151===this.translations["default"].chapters.Ps.length&&this.translations["default"].chapters.Ps.pop();return this};k.prototype.versification_system=function(b){var h,c;if(null==b||null==this.translations.alternates[b])return this;this.options.versification_system=b;
null==(c=this.translations.alternates)["default"]&&(c["default"]={order:null,chapters:{}});null!=this.translations.alternates[b].order&&(null==this.translations.alternates["default"].order&&(this.translations.alternates["default"].order=s.shallow_clone(this.translations["default"].order)),this.translations["default"].order=s.shallow_clone(this.translations.alternates[b].order));if(null!=this.translations.alternates[b].chapters)for(h in c=this.translations.alternates[b].chapters,c)T.call(c,h)&&(b=
c[h],null==this.translations.alternates["default"].chapters[h]&&(this.translations.alternates["default"].chapters[h]=s.shallow_clone_array(this.translations["default"].chapters[h])),this.translations["default"].chapters[h]=s.shallow_clone_array(b));this.include_apocrypha(this.options.include_apocrypha);return this};k.prototype.case_sensitive=function(b){if(null==b||"none"!==b&&"books"!==b||b===this.options.case_sensitive)return this;this.options.case_sensitive=b;this.regexps.books=this.regexps.get_books(this.options.include_apocrypha,
b);return this};k.prototype.replace_control_characters=function(b){b=b.replace(this.regexps.control," ");"replace"===this.options.non_latin_digits_strategy&&(b=b.replace(/[\u0660\u06f0\u07c0\u0966\u09e6\u0a66\u0ae6\u0b660\u0c66\u0ce6\u0d66\u0e50\u0ed0\u0f20\u1040\u1090\u17e0\u1810\u1946\u19d0\u1a80\u1a90\u1b50\u1bb0\u1c40\u1c50\ua620\ua8d0\ua900\ua9d0\uaa50\uabf0\uff10]/g,"0"),b=b.replace(/[\u0661\u06f1\u07c1\u0967\u09e7\u0a67\u0ae7\u0b67\u0be7\u0c67\u0ce7\u0d67\u0e51\u0ed1\u0f21\u1041\u1091\u17e1\u1811\u1947\u19d1\u1a81\u1a91\u1b51\u1bb1\u1c41\u1c51\ua621\ua8d1\ua901\ua9d1\uaa51\uabf1\uff11]/g,
"1"),b=b.replace(/[\u0662\u06f2\u07c2\u0968\u09e8\u0a68\u0ae8\u0b68\u0be8\u0c68\u0ce8\u0d68\u0e52\u0ed2\u0f22\u1042\u1092\u17e2\u1812\u1948\u19d2\u1a82\u1a92\u1b52\u1bb2\u1c42\u1c52\ua622\ua8d2\ua902\ua9d2\uaa52\uabf2\uff12]/g,"2"),b=b.replace(/[\u0663\u06f3\u07c3\u0969\u09e9\u0a69\u0ae9\u0b69\u0be9\u0c69\u0ce9\u0d69\u0e53\u0ed3\u0f23\u1043\u1093\u17e3\u1813\u1949\u19d3\u1a83\u1a93\u1b53\u1bb3\u1c43\u1c53\ua623\ua8d3\ua903\ua9d3\uaa53\uabf3\uff13]/g,"3"),b=b.replace(/[\u0664\u06f4\u07c4\u096a\u09ea\u0a6a\u0aea\u0b6a\u0bea\u0c6a\u0cea\u0d6a\u0e54\u0ed4\u0f24\u1044\u1094\u17e4\u1814\u194a\u19d4\u1a84\u1a94\u1b54\u1bb4\u1c44\u1c54\ua624\ua8d4\ua904\ua9d4\uaa54\uabf4\uff14]/g,
"4"),b=b.replace(/[\u0665\u06f5\u07c5\u096b\u09eb\u0a6b\u0aeb\u0b6b\u0beb\u0c6b\u0ceb\u0d6b\u0e55\u0ed5\u0f25\u1045\u1095\u17e5\u1815\u194b\u19d5\u1a85\u1a95\u1b55\u1bb5\u1c45\u1c55\ua625\ua8d5\ua905\ua9d5\uaa55\uabf5\uff15]/g,"5"),b=b.replace(/[\u0666\u06f6\u07c6\u096c\u09ec\u0a6c\u0aec\u0b6c\u0bec\u0c6c\u0cec\u0d6c\u0e56\u0ed6\u0f26\u1046\u1096\u17e6\u1816\u194c\u19d6\u1a86\u1a96\u1b56\u1bb6\u1c46\u1c56\ua626\ua8d6\ua906\ua9d6\uaa56\uabf6\uff16]/g,"6"),b=b.replace(/[\u0667\u06f7\u07c7\u096d\u09ed\u0a6d\u0aed\u0b6d\u0bed\u0c6d\u0ced\u0d6d\u0e57\u0ed7\u0f27\u1047\u1097\u17e7\u1817\u194d\u19d7\u1a87\u1a97\u1b57\u1bb7\u1c47\u1c57\ua627\ua8d7\ua907\ua9d7\uaa57\uabf7\uff17]/g,
"7"),b=b.replace(/[\u0668\u06f8\u07c8\u096e\u09ee\u0a6e\u0aee\u0b6e\u0bee\u0c6e\u0cee\u0d6e\u0e58\u0ed8\u0f28\u1048\u1098\u17e8\u1818\u194e\u19d8\u1a88\u1a98\u1b58\u1bb8\u1c48\u1c58\ua628\ua8d8\ua908\ua9d8\uaa58\uabf8\uff18]/g,"8"),b=b.replace(/[\u0669\u06f9\u07c9\u096f\u09ef\u0a6f\u0aef\u0b6f\u0bef\u0c6f\u0cef\u0d6f\u0e59\u0ed9\u0f29\u1049\u1099\u17e9\u1819\u194f\u19d9\u1a89\u1a99\u1b59\u1bb9\u1c49\u1c59\ua629\ua8d9\ua909\ua9d9\uaa59\uabf9\uff19]/g,"9"));return b};k.prototype.match_books=function(b){var h,
c,e,f,n;c=[];n=this.regexps.books;e=0;for(f=n.length;e<f;e++)h=n[e],b=b.replace(h.regexp,function(b,e,f){c.push({value:f,parsed:h.osis});return""+e+"\u001f"+(c.length-1)+(null!=h.extra?"/"+h.extra:"")+"\u001f"});b=b.replace(this.regexps.translations,function(b){c.push({value:b,parsed:b.toLowerCase()});return"\u001e"+(c.length-1)+"\u001e"});return[b,this.get_book_indices(c,b)]};k.prototype.get_book_indices=function(b,h){var c,e,f;c=0;for(f=/([\x1f\x1e])(\d+)(?:\/\d+)?\1/g;e=f.exec(h);)b[e[2]].start_index=
e.index+c,c+=b[e[2]].value.length-e[0].length;return b};k.prototype.match_passages=function(b){var h,c,e,f,n,q;for(c=[];f=this.regexps.escaped_passage.exec(b);)e=f[0],q=f[1],h=f[2],n=q.length,f.index+=e.length-n,/\s[2-9]\d\d\s*$|\s\d{4,}\s*$/.test(q)&&(e=/\s+\d+\s*$/,q=q.replace(e,"")),/[\d\x1f\x1e)]$/.test(q)||(q=this.replace_match_end(q)),"delete"===this.options.captive_end_digits_strategy&&(f=f.index+q.length,b.length>f&&/^\w/.test(b.substr(f,1))&&(q=q.replace(/[\s*]+\d+$/,"")),q=q.replace(/(\x1e[)\]]?)[\s*]*\d+$/,
"$1")),q=q.replace(/[A-Z]+/g,function(b){return b.toLowerCase()}),e=q.substr(0,1==="\u001f")?0:q.split("\u001f")[0].length,f={value:na.parse(q),type:"base",start_index:this.passage.books[h].start_index-e,match:q},"full"===this.options.book_alone_strategy&&1===f.value.length&&"b"===f.value[0].type&&0===e&&1===this.passage.books[h].parsed.length&&/^[234]/.test(this.passage.books[h].parsed[0])&&this.create_book_range(b,f,h),h=this.passage.handle_obj(f)[0],c=c.concat(h),n=this.adjust_regexp_end(h,n,q.length),
0<n&&(this.regexps.escaped_passage.lastIndex-=n);return c};k.prototype.adjust_regexp_end=function(b,h,c){var e;e=0;0<b.length?e=h-b[b.length-1].indices[1]-1:h!==c&&(e=h-c);return e};k.prototype.replace_match_end=function(b){var h,c;for(c=b.length;h=this.regexps.match_end_split.exec(b);)c=h.index+h[0].length;c<b.length&&(b=b.substr(0,c));return b};k.prototype.create_book_range=function(b,h,c){var e,f,n,q,ga;e=[k.prototype.regexps.first,k.prototype.regexps.second,k.prototype.regexps.third];n=parseInt(this.passage.books[c].parsed[0].substr(0,
1),10);for(f=ga=1;1<=n?ga<n:ga>n;f=1<=n?++ga:--ga)if(q=f===n-1?k.prototype.regexps.range_and:k.prototype.regexps.range_only,q=b.match(RegExp("(?:^|\\W)("+e[f-1]+"\\s*"+q+"\\s*)\\x1f"+c+"\\x1f","i")),null!=q)return this.add_book_range_object(h,q,f);return!1};k.prototype.add_book_range_object=function(b,h,c){var e;e=h[1].length;b.value[0]={type:"b_range_pre",value:[{type:"b_pre",value:c.toString(),indices:[h.index,h.index+e]},b.value[0]],indices:[0,b.value[0].indices[1]+e]};b.value[0].value[1].indices[0]+=
e;b.value[0].value[1].indices[1]+=e;b.start_index-=e;return b.match=h[1]+b.match};k.prototype.osis=function(){var b,h,c,e,f;h=[];f=this.parsed_entities();c=0;for(e=f.length;c<e;c++)b=f[c],0<b.osis.length&&h.push(b.osis);return h.join(",")};k.prototype.osis_and_translations=function(){var b,h,c,e,f;h=[];f=this.parsed_entities();c=0;for(e=f.length;c<e;c++)b=f[c],0<b.osis.length&&h.push([b.osis,b.translations.join(",")]);return h};k.prototype.osis_and_indices=function(){var b,h,c,e,f;h=[];f=this.parsed_entities();
c=0;for(e=f.length;c<e;c++)b=f[c],0<b.osis.length&&h.push({osis:b.osis,translations:b.translations,indices:b.indices});return h};k.prototype.parsed_entities=function(){var b,h,c,e,f,n,q,k,l,t,r,s,C;n=[];h=t=0;for(s=this.entities.length;0<=s?t<s:t>s;h=0<=s?++t:--t)if(b=this.entities[h],b.type&&"translation_sequence"===b.type&&0<n.length&&h===n[n.length-1].entity_id+1&&(n[n.length-1].indices[1]=b.absolute_indices[1]),null!=b.passages&&("b"!==b.type&&"b_range"!==b.type||"ignore"!==this.options.book_alone_strategy)){l=
[];k=null;if(null!=b.passages[0].translations)for(r=b.passages[0].translations,e=0,q=r.length;e<q;e++)f=r[e],c=0<(null!=(C=f.osis)?C.length:void 0)?f.osis:"",null==k&&(k=f.alias),l.push(c);else l=[""],k="default";f=[];e=b.passages.length;for(c=r=0;0<=e?r<e:r>e;c=0<=e?++r:--r){q=b.passages[c];null==q.type&&(q.type=b.type);if(!1===q.valid.valid&&("ignore"===this.options.invalid_sequence_strategy&&"sequence"===b.type&&this.snap_sequence("ignore",b,f,c,e),"ignore"===this.options.invalid_passage_strategy))continue;
"b"!==q.type&&"b_range"!==q.type||"ignore"!==this.options.book_sequence_strategy||"sequence"!==b.type?(null==q.absolute_indices&&(q.absolute_indices=b.absolute_indices),f.push({osis:q.valid.valid?this.to_osis(q.start,q.end,k):"",type:q.type,indices:q.absolute_indices,translations:l,start:q.start,end:q.end,enclosed_indices:q.enclosed_absolute_indices,entity_id:h,entities:[q]})):this.snap_sequence("book",b,f,c,e)}if(0!==f.length)if(1<f.length&&"combine"===this.options.consecutive_combination_strategy&&
(f=this.combine_consecutive_passages(f,k)),"separate"===this.options.sequence_combination_strategy)n=n.concat(f);else{k=[];c=f.length-1;null!=f[c].enclosed_indices&&0<=f[c].enclosed_indices[1]&&(b.absolute_indices[1]=f[c].enclosed_indices[1]);e=0;for(q=f.length;e<q;e++)c=f[e],0<c.osis.length&&k.push(c.osis);n.push({osis:k.join(","),indices:b.absolute_indices,translations:l,entity_id:h,entities:f})}}return n};k.prototype.to_osis=function(b,h,c){var e;null==h.c&&null==h.v&&b.b===h.b&&null==b.c&&null==
b.v&&"first_chapter"===this.options.book_alone_strategy&&(h.c=1);null==b.c&&(b.c=1);null==b.v&&(b.v=1);null==h.c&&(h.c=this.passage.translations[c].chapters[h.b].length);null==h.v&&(h.v=this.passage.translations[c].chapters[h.b][h.c-1]);this.options.include_apocrypha&&"b"===this.options.ps151_strategy&&(151===b.c&&"Ps"===b.b||151===h.c&&"Ps"===h.b)&&this.fix_ps151(b,h,c);"b"===this.options.osis_compaction_strategy&&1===b.c&&1===b.v&&h.c===this.passage.translations[c].chapters[h.b].length&&h.v===this.passage.translations[c].chapters[h.b][h.c-
1]?(c=b.b,e=h.b):2>=this.options.osis_compaction_strategy.length&&1===b.v&&h.v===this.passage.translations[c].chapters[h.b][h.c-1]?(c=b.b+"."+b.c.toString(),e=h.b+"."+h.c.toString()):(c=b.b+"."+b.c.toString()+"."+b.v.toString(),e=h.b+"."+h.c.toString()+"."+h.v.toString());c=c===e?c:c+"-"+e;null!=b.extra&&(c=b.extra+","+c);null!=h.extra&&(c+=","+h.extra);return c};k.prototype.fix_ps151=function(b,h,c){if(151===b.c&&"Ps"===b.b){if(151===h.c&&"Ps"===h.b)return b.b="Ps151",b.c=1,h.b="Ps151",h.c=1;b.extra=
this.to_osis({b:"Ps151",c:1,v:b.v},{b:"Ps151",c:1,v:this.passage.translations[c].chapters.Ps151[0]},c);b.b="Prov";b.c=1;return b.v=1}h.extra=this.to_osis({b:"Ps151",c:1,v:1},{b:"Ps151",c:1,v:h.v},c);h.c=150;return h.v=this.passage.translations[c].chapters.Ps[149]};k.prototype.combine_consecutive_passages=function(b,h){var c,e,f,n,q,k,l,t,r,s;l=[];t={};q=b.length-1;c=-1;e=!1;for(f=s=0;0<=q?s<=q:s>=q;f=0<=q?++s:--s)k=b[f],0<k.osis.length?(r=l.length-1,n=!1,k.enclosed_indices[0]!==c&&(c=k.enclosed_indices[0]),
0<=c&&(f===q||b[f+1].enclosed_indices[0]!==k.enclosed_indices[0])&&(e=n=!0),this.is_verse_consecutive(t,k.start,h)?(l[r].end=k.end,l[r].is_enclosed_last=n,l[r].indices[1]=k.indices[1],l[r].enclosed_indices[1]=k.enclosed_indices[1],l[r].osis=this.to_osis(l[r].start,k.end,h)):l.push(k),t={b:k.end.b,c:k.end.c,v:k.end.v}):(l.push(k),t={});e&&this.snap_enclosed_indices(l);return l};k.prototype.snap_enclosed_indices=function(b){var h,c,e;c=0;for(e=b.length;c<e;c++)h=b[c],null!=h.is_enclosed_last&&(0>h.enclosed_indices[0]&&
h.is_enclosed_last&&(h.indices[1]=h.enclosed_indices[1]),delete h.is_enclosed_last);return b};k.prototype.is_verse_consecutive=function(b,h,c){var e;if(null==b.b)return!1;e=null!=this.passage.translations[c].order?this.passage.translations[c].order:this.passage.translations["default"].order;if(b.b===h.b)if(b.c===h.c){if(b.v===h.v-1)return!0}else{if(1===h.v&&b.c===h.c-1&&b.v===this.passage.translations[c].chapters[b.b][b.c-1])return!0}else if(1===h.c&&1===h.v&&e[b.b]===e[h.b]-1&&b.c===this.passage.translations[c].chapters[b.b].length&&
b.v===this.passage.translations[c].chapters[b.b][b.c-1])return!0;return!1};k.prototype.snap_sequence=function(b,h,c,e,f){var n;n=h.passages[e];n.absolute_indices[0]===h.absolute_indices[0]&&e<f-1&&this.get_snap_sequence_i(h.passages,e,f)!==e?(h.absolute_indices[0]=h.passages[e+1].absolute_indices[0],this.remove_absolute_indices(h.passages,e+1)):n.absolute_indices[1]===h.absolute_indices[1]&&0<e?h.absolute_indices[1]=0<c.length?c[c.length-1].indices[1]:h.passages[e-1].absolute_indices[1]:"book"===
b&&e<f-1&&!this.starts_with_book(h.passages[e+1])&&(h.passages[e+1].absolute_indices[0]=n.absolute_indices[0]);return h};k.prototype.get_snap_sequence_i=function(b,h,c){var e,f,n;for(e=f=n=h+1;n<=c?f<c:f>c;e=n<=c?++f:--f){if(this.starts_with_book(b[e]))return e;if(b[e].valid.valid)break}return h};k.prototype.starts_with_book=function(b){return"b"===b.type.substr(0,1)||("range"===b.type||"ff"===b.type)&&"b"===b.start.type.substr(0,1)?!0:!1};k.prototype.remove_absolute_indices=function(b,h){var c,e,
f,n,q,k;if(0>b[h].enclosed_absolute_indices[0])return!1;c=b[h].enclosed_absolute_indices;f=c[0];c=c[1];k=b.slice(h);n=0;for(q=k.length;n<q;n++)if(e=k[n],e.enclosed_absolute_indices[0]===f&&e.enclosed_absolute_indices[1]===c)e.enclosed_absolute_indices=[-1,-1];else break;return!0};return k}();la=function(){function k(){}k.prototype.books=[];k.prototype.indices={};k.prototype.options={};k.prototype.translations={};k.prototype.handle_array=function(b,h,c){var e,f,n;null==h&&(h=[]);null==c&&(c={});f=
0;for(n=b.length;f<n;f++){e=b[f];if("stop"===e.type)break;c=this.handle_obj(e,h,c);h=c[0];c=c[1]}return[h,c]};k.prototype.handle_obj=function(b,h,c){return null!=b.type&&null!=this[b.type]?this[b.type](b,h,c):[h,c]};k.prototype.b=function(b,h,c){var e,f,n,q,k;b.start_context=s.shallow_clone(c);b.passages=[];c=[];k=this.books[b.value].parsed;n=0;for(q=k.length;n<q;n++)e=k[n],f=this.validate_ref(b.start_context.translations,{b:e}),e={start:{b:e},end:{b:e},valid:f},0===b.passages.length&&f.valid?b.passages.push(e):
c.push(e);0===b.passages.length&&b.passages.push(c.shift());0<c.length&&(b.passages[0].alternates=c);null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));h.push(b);c={b:b.passages[0].start.b};null!=b.start_context.translations&&(c.translations=b.start_context.translations);return[h,c]};k.prototype.b_range=function(b,h,c){return this.range(b,h,c)};k.prototype.b_range_pre=function(b,
h,c){var e,f;b.start_context=s.shallow_clone(c);b.passages=[];e=this.pluck("b",b.value);c=this.b(e,[],c);e=c[0][0];c=c[1];null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));f={b:b.value[0].value+e.passages[0].start.b.substr(1),type:"b"};b.passages=[{start:f,end:e.passages[0].end,valid:e.passages[0].valid}];null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);h.push(b);return[h,c]};k.prototype.base=function(b,h,c){this.indices=
this.calculate_indices(b.match,b.start_index);return this.handle_array(b.value,h,c)};k.prototype.bc=function(b,h,c){var e,f,n,k,l,w,t,r,I;b.start_context=s.shallow_clone(c);b.passages=[];this.reset_context(c,["b","c","v"]);n=this.pluck("c",b.value).value;e=[];I=this.books[this.pluck("b",b.value).value].parsed;t=0;for(r=I.length;t<r;t++)f=I[t],k="c",w=this.validate_ref(b.start_context.translations,{b:f,c:n}),l={start:{b:f},end:{b:f},valid:w},w.messages.start_chapter_not_exist_in_single_chapter_book&&
(l.valid=this.validate_ref(b.start_context.translations,{b:f,v:n}),l.start.c=1,l.end.c=1,k="v"),l.start[k]=n,f=this.fix_start_zeroes(l.valid,l.start.c,l.start.v),l.start.c=f[0],l.start.v=f[1],l.end[k]=l.start[k],0===b.passages.length&&l.valid.valid?b.passages.push(l):e.push(l);0===b.passages.length&&b.passages.push(e.shift());0<e.length&&(b.passages[0].alternates=e);null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);null==b.absolute_indices&&(b.absolute_indices=
this.get_absolute_indices(b.indices));this.set_context_from_object(c,["b","c","v"],b.passages[0].start);h.push(b);return[h,c]};k.prototype.bc_title=function(b,h,c){var e,f,n,k;b.start_context=s.shallow_clone(c);c=this.bc(this.pluck("bc",b.value),[],c);e=c[0][0];c=c[1];if("Ps"!==e.passages[0].start.b.substr(0,2)&&null!=e.passages[0].alternates)for(f=n=0,k=e.passages[0].alternates.length;0<=k?n<k:n>k;f=0<=k?++n:--n)if("Ps"===e.passages[0].alternates[f].start.b.substr(0,2)){e.passages[0]=e.passages[0].alternates[f];
break}if("Ps"!==e.passages[0].start.b.substr(0,2))return h.push(e),[h,c];this.books[this.pluck("b",e.value).value].parsed=["Ps"];e=this.pluck("title",b.value);b.value[1]={type:"v",value:[{type:"integer",value:1,indices:e.indices}],indices:e.indices};b.original_type="bc_title";b.type="bcv";return this.bcv(b,h,b.start_context)};k.prototype.bcv=function(b,h,c){var e,f,n,k,l,w,t,r;b.start_context=s.shallow_clone(c);b.passages=[];this.reset_context(c,["b","c","v"]);n=this.pluck("bc",b.value);k=this.pluck("c",
n.value).value;l=this.pluck("v",b.value).value;e=[];r=this.books[this.pluck("b",n.value).value].parsed;w=0;for(t=r.length;w<t;w++)f=r[w],n=this.validate_ref(b.start_context.translations,{b:f,c:k,v:l}),l=this.fix_start_zeroes(n,k,l),k=l[0],l=l[1],f={start:{b:f,c:k,v:l},end:{b:f,c:k,v:l},valid:n},0===b.passages.length&&n.valid?b.passages.push(f):e.push(f);0===b.passages.length&&b.passages.push(e.shift());0<e.length&&(b.passages[0].alternates=e);null!=b.start_context.translations&&(b.passages[0].translations=
b.start_context.translations);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));this.set_context_from_object(c,["b","c","v"],b.passages[0].start);h.push(b);return[h,c]};k.prototype.bv=function(b,h,c){var e;b.start_context=s.shallow_clone(c);e=b.value;e={indices:b.indices,value:[{type:"bc",value:[e[0],{type:"c",value:[{type:"integer",value:1}]}]},e[1]]};c=this.bcv(e,[],c);e=c[0][0];c=c[1];b.passages=e.passages;null!=b.start_context.translations&&(b.passages[0].translations=
b.start_context.translations);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));h.push(b);return[h,c]};k.prototype.c=function(b,h,c){var e,f;b.start_context=s.shallow_clone(c);e="integer"===b.type?b.value:this.pluck("integer",b.value).value;f=this.validate_ref(b.start_context.translations,{b:c.b,c:e});if(!f.valid&&f.messages.start_chapter_not_exist_in_single_chapter_book)return this.v(b,h,c);e=this.fix_start_zeroes(f,e)[0];b.passages=[{start:{b:c.b,c:e},end:{b:c.b,
c:e},valid:f}];null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);h.push(b);c.c=e;this.reset_context(c,["v"]);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));return[h,c]};k.prototype.c_psalm=function(b,h,c){var e;b.original_type=b.type;b.original_value=b.value;b.type="bc";e=parseInt(this.books[b.value].value.match(/^\d+/)[0],10);b.value=[{type:"b",value:b.original_value,indices:b.indices},{type:"c",value:[{type:"integer",
value:e,indices:b.indices}],indices:b.indices}];return this.bc(b,h,c)};k.prototype.c_title=function(b,h,c){b.start_context=s.shallow_clone(c);if("Ps"!==c.b)return this.c(b.value[0],h,c);c=this.pluck("title",b.value);b.value[1]={type:"v",value:[{type:"integer",value:1,indices:c.indices}],indices:c.indices};b.original_type="c_title";b.type="cv";return this.cv(b,h,b.start_context)};k.prototype.cv=function(b,h,c){var e,f,n;b.start_context=s.shallow_clone(c);e=this.pluck("c",b.value).value;f=this.pluck("v",
b.value).value;n=this.validate_ref(b.start_context.translations,{b:c.b,c:e,v:f});f=this.fix_start_zeroes(n,e,f);e=f[0];f=f[1];b.passages=[{start:{b:c.b,c:e,v:f},end:{b:c.b,c:e,v:f},valid:n}];null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);h.push(b);c.c=e;c.v=f;null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));return[h,c]};k.prototype.cb_range=function(b,h,c){var e,f,n;b.original_type=b.type;b.type="range";f=b.value;e=
f[0];n=f[1];f=f[2];b.original_value=[e,n,f];b.value=[{type:"bc",value:[e,n],indices:b.indices},f];f.indices[1]=b.indices[1];return this.range(b,h,c)};k.prototype.cv_psalm=function(b,h,c){var e,f;b.start_context=s.shallow_clone(c);b.original_type=b.type;f=b.original_value=b.value;e=f[0];f=f[1];b.type="bcv";e=this.c_psalm(e,[],b.start_context)[0][0];b.value=[e,f];return this.bcv(b,h,c)};k.prototype.ff=function(b,h,c){b.start_context=s.shallow_clone(c);b.value.push({type:"integer",indices:b.indices,
value:999});c=this.range(b,[],b.start_context);b=c[0][0];c=c[1];b.value.pop();null!=b.passages[0].valid.end_verse_not_exist&&delete b.passages[0].valid.end_verse_not_exist;null!=b.passages[0].valid.end_chapter_not_exist&&delete b.passages[0].valid.end_chapter_not_exist;null!=b.passages[0].end.original_c&&delete b.passages[0].end.original_c;h.push(b);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));return[h,c]};k.prototype.integer_title=function(b,h,c){b.start_context=
s.shallow_clone(c);if("Ps"!==c.b)return this.integer(b.value[0],h,c);b.value[0]={type:"c",value:[b.value[0]],indices:[b.value[0].indices[0],b.value[0].indices[1]]};c=[b.indices[1]-5,b.indices[1]];b.value[1]={type:"v",value:[{type:"integer",value:1,indices:c}],indices:c};b.original_type="integer_title";b.type="cv";return this.cv(b,h,b.start_context)};k.prototype.integer=function(b,h,c){return null!=c.v?this.v(b,h,c):this.c(b,h,c)};k.prototype.sequence=function(b,h,c){var e,f,n,k,l,w,t,r;b.start_context=
s.shallow_clone(c);b.passages=[];t=b.value;n=0;for(l=t.length;n<l;n++)for(e=t[n],c=this.handle_array(e,[],c),e=c[0],e=e[0],c=c[1],r=e.passages,k=0,w=r.length;k<w;k++)f=r[k],null==f.type&&(f.type=e.type),null==f.absolute_indices&&(f.absolute_indices=e.absolute_indices),null!=e.start_context.translations&&(f.translations=e.start_context.translations),f.enclosed_absolute_indices="sequence_post_enclosed"===e.type?e.absolute_indices:[-1,-1],b.passages.push(f);null==b.absolute_indices&&(b.absolute_indices=
0<b.passages.length&&"sequence"===b.type?[b.passages[0].absolute_indices[0],b.passages[b.passages.length-1].absolute_indices[1]]:this.get_absolute_indices(b.indices));h.push(b);return[h,c]};k.prototype.sequence_post_enclosed=function(b,h,c){return this.sequence(b,h,c)};k.prototype.v=function(b,h,c){var e,f,n;f="integer"===b.type?b.value:this.pluck("integer",b.value).value;b.start_context=s.shallow_clone(c);e=null!=c.c?c.c:1;n=this.validate_ref(b.start_context.translations,{b:c.b,c:e,v:f});f=this.fix_start_zeroes(n,
0,f)[1];b.passages=[{start:{b:c.b,c:e,v:f},end:{b:c.b,c:e,v:f},valid:n}];null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));h.push(b);c.v=f;return[h,c]};k.prototype.range=function(b,h,c){var e,f,n,k,l;b.start_context=s.shallow_clone(c);f=b.value;n=f[0];e=f[1];if("v"===e.type&&("bc"===n.type||"c"===n.type)&&"verse"===this.options.end_range_digits_strategy)return this.range_change_integer_end(b,
h);c=this.handle_obj(n,[],c);n=c[0][0];c=c[1];c=this.handle_obj(e,[],c);e=c[0][0];c=c[1];b.value=[n,e];b.indices=[n.indices[0],e.indices[1]];delete b.absolute_indices;k={b:n.passages[0].start.b,c:n.passages[0].start.c,v:n.passages[0].start.v,type:n.type};f={b:e.passages[0].end.b,c:e.passages[0].end.c,v:e.passages[0].end.v,type:e.type};e.passages[0].valid.messages.start_chapter_is_zero&&(f.c=0);e.passages[0].valid.messages.start_verse_is_zero&&(f.v=0);l=this.validate_ref(b.start_context.translations,
k,f);if(l.valid){if(e=this.range_handle_valid(l,b,n,k,e,f,h),n=e[0],e=e[1],n)return e}else return this.range_handle_invalid(l,b,n,k,e,f,h);null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));b.passages=[{start:k,end:f,valid:l}];null!=b.start_context.translations&&(b.passages[0].translations=b.start_context.translations);h.push(b);return[h,c]};k.prototype.range_change_end=function(b,h,c){var e;e=b.value[1];"integer"===e.type?(e.original_value=e.value,e.value=c):"v"===
e.type?(e=this.pluck("integer",e.value),e.original_value=e.value,e.value=c):"cv"===e.type&&(e=this.pluck("c",e.value),e.original_value=e.value,e.value=c);return this.handle_obj(b,h,b.start_context)};k.prototype.range_change_integer_end=function(b,h){var c,e;c=b.value;e=c[0];c=c[1];b.original_type=b.type;b.original_value=[e,c];b.type="integer"===e.type?"cv":e.type+"v";"integer"===e.type&&(b.value[0]={type:"c",value:[e],indices:e.indices});"integer"===c.type&&(b.value[1]={type:"v",value:[c],indices:c.indices});
return this.handle_obj(b,h,b.start_context)};k.prototype.range_change_cv_end=function(b,h){var c,e,f;c=b.value;f=c[0];c=c[1];b.original_type=b.type;b.original_value=[f,c];b.type="sequence";e=c.value;c=e[0];e=e[1];c=s.shallow_clone(c);c.original_type=c.type;c.type="v";b.value=[[{type:"range",value:[f,c],indices:[f.indices[0],c.indices[1]]}],[e]];return this.sequence(b,h,b.start_context)};k.prototype.range_validate=function(b,h,c,e){b.messages.end_chapter_not_exist?(c.original_c=c.c,c.c=b.messages.end_chapter_not_exist,
null!=c.v&&(c.v=this.validate_ref(e.start_context.translations,{b:c.b,c:c.c,v:999}).messages.end_verse_not_exist)):b.messages.end_verse_not_exist&&(c.original_v=c.v,c.v=b.messages.end_verse_not_exist);b.messages.end_verse_is_zero&&"allow"!==this.options.zero_verse_strategy&&(c.v=b.messages.end_verse_is_zero);b.messages.end_chapter_is_zero&&(c.c=b.messages.end_chapter_is_zero);b=this.fix_start_zeroes(b,h.c,h.v);h.c=b[0];h.v=b[1];return!0};k.prototype.range_check_new_end=function(b,h,c,e){var f,n;f=
0;n=null;e.messages.end_chapter_before_start?n="c":e.messages.end_verse_before_start&&(n="v");null!=n&&(f=this.range_get_new_end_value(h,c,e,n));0<f&&(h={b:c.b,c:c.c,v:c.v},h[n]=f,b=this.validate_ref(b,h),b.valid||(f=0));return f};k.prototype.range_get_new_end_value=function(b,h,c,e){var f;f=0;if("c"===e&&c.messages.end_chapter_is_zero||"v"===e&&c.messages.end_verse_is_zero)return f;10<=b[e]&&10>h[e]&&b[e]-10*Math.floor(b[e]/10)<h[e]?f=h[e]+10*Math.floor(b[e]/10):100<=b[e]&&100>h[e]&&b[e]-100<h[e]&&
(f=h[e]+100);return f};k.prototype.range_handle_valid=function(b,h,c,e,f,n,k){if(b.messages.end_chapter_not_exist&&"verse"===this.options.end_range_digits_strategy&&null==e.v&&("integer"===f.type||"v"===f.type)&&(c="v"===f.type?this.pluck("integer",f.value):f.value,c=this.validate_ref(h.start_context.translations,{b:e.b,c:e.c,v:c}),c.valid))return[!0,this.range_change_integer_end(h,k)];if(b.messages.end_chapter_not_exist&&"verse"===this.options.end_range_digits_strategy&&null!=e.v&&"cv"===f.type&&
(c=this.validate_ref(h.start_context.translations,{b:n.b,c:e.c,v:n.c}),c.valid&&(c=this.validate_ref(h.start_context.translations,{b:n.b,c:e.c,v:n.v})),c.valid))return[!0,this.range_change_cv_end(h,k)];this.range_validate(b,e,n,h);return[!1,null]};k.prototype.range_handle_invalid=function(b,h,c,e,f,n,k){if((b.messages.end_chapter_before_start||b.messages.end_verse_before_start)&&("integer"===f.type||"v"===f.type)||b.messages.end_chapter_before_start&&"cv"===f.type)if(b=this.range_check_new_end(h.start_context.translations,
e,n,b),0<b)return this.range_change_end(h,k,b);if("verse"===this.options.end_range_digits_strategy&&void 0===e.v&&("integer"===f.type||"v"===f.type)&&(b="v"===f.type?this.pluck("integer",f.value):f.value,e=this.validate_ref(h.start_context.translations,{b:e.b,c:e.c,v:b}),e.valid))return this.range_change_integer_end(h,k);e=[h.type,"sequence"];h.original_type=e[0];h.type=e[1];c=[[c,f],[[c],[f]]];h.original_value=c[0];h.value=c[1];return this.handle_obj(h,k,h.start_context)};k.prototype.translation_sequence=
function(b,h,c){var e,f,n,k,l;f=[];f.push({translation:this.books[b.value[0].value].parsed});l=b.value[1];n=0;for(k=l.length;n<k;n++)e=l[n],e=this.books[this.pluck("translation",e).value].parsed,null!=e&&f.push({translation:e});n=0;for(k=f.length;n<k;n++)e=f[n],null!=this.translations.aliases[e.translation]?(e.alias=this.translations.aliases[e.translation].alias,e.osis=this.translations.aliases[e.translation].osis):(e.alias="default",e.osis=e.translation.toUpperCase());if(0<h.length){n=0;for(e=k=
l=h.length-1;0>=l?0>=k:0<=k;e=0>=l?++k:--k)if(null!=h[e].original_type&&(h[e].type=h[e].original_type),null!=h[e].original_value&&(h[e].value=h[e].original_value),"translation_sequence"===h[e].type){n=e+1;break}n<h.length&&(h[n].start_context.translations=f,c=this.handle_array(h.slice(n),[],h[n].start_context),c=c[1])}null==b.absolute_indices&&(b.absolute_indices=this.get_absolute_indices(b.indices));h.push(b);this.reset_context(c,["translations"]);return[h,c]};k.prototype.pluck=function(b,h){var c,
e,f;e=0;for(f=h.length;e<f;e++)if(c=h[e],null!=c.type&&c.type===b)return"c"===b||"v"===b?this.pluck("integer",c.value):c;return null};k.prototype.set_context_from_object=function(b,h,c){var e,f,k,l;l=[];f=0;for(k=h.length;f<k;f++)e=h[f],null!=c[e]&&l.push(b[e]=c[e]);return l};k.prototype.reset_context=function(b,h){var c,e,f,k;k=[];e=0;for(f=h.length;e<f;e++)c=h[e],k.push(delete b[c]);return k};k.prototype.fix_start_zeroes=function(b,h,c){b.valid&&(b.messages.start_chapter_is_zero&&(h=b.messages.start_chapter_is_zero),
b.messages.start_verse_is_zero&&"allow"!==this.options.zero_verse_strategy&&(c=b.messages.start_verse_is_zero));return[h,c]};k.prototype.calculate_indices=function(b,h){var c,e,f,k,l,s,w,t,r,I,C,D;w="book";e=[];f=0;h=parseInt(h,10);s=[b];D=["\u001e","\u001f"];t=0;for(I=D.length;t<I;t++){c=D[t];l=[];r=0;for(C=s.length;r<C;r++)k=s[r],l=l.concat(k.split(c));s=l}t=0;for(r=s.length;t<r;t++)k=s[t],w="book"===w?"rest":"book",l=k.length,0!==l&&("book"===w?(k=k.replace(/\/\d+$/,""),c=f+l,0<e.length&&e[e.length-
1].index===h?e[e.length-1].end=c:e.push({start:f,end:c,index:h}),f+=l+2,h=this.books[k].start_index+this.books[k].value.length-f,e.push({start:c+1,end:c+1,index:h})):(c=f+l-1,0<e.length&&e[e.length-1].index===h?e[e.length-1].end=c:e.push({start:f,end:c,index:h}),f+=l));return e};k.prototype.get_absolute_indices=function(b){var h,c,e,f,k,l,s;e=b[0];b=b[1];h=f=null;s=this.indices;k=0;for(l=s.length;k<l;k++)if(c=s[k],null===f&&c.start<=e&&e<=c.end&&(f=e+c.index),c.start<=b&&b<=c.end){h=b+c.index+1;break}return[f,
h]};k.prototype.validate_ref=function(b,h,c){var e,f;b||(b=[{translation:"default",osis:"",alias:"default"}]);f=b[0];if(null==f)return{valid:!1,messages:{translation_invalid:!0}};e={};null==f.alias&&(f.alias="default");if(null==f.alias)return{valid:!1,messages:{translation_invalid:!0}};null==this.translations.aliases[f.alias]&&(f.alias="default",e.translation_unknown=!0);e=this.validate_start_ref(f.alias,h,!0,e);b=e[0];e=e[1];c&&(h=this.validate_end_ref(f.alias,h,c,b,e),b=h[0],e=h[1]);return{valid:b,
messages:e}};k.prototype.validate_start_ref=function(b,h,c,e){var f,k;"default"!==b&&null==(null!=(f=this.translations[b])?f.chapters[h.b]:void 0)&&this.promote_book_to_translation(h.b,b);f=null!=(null!=(k=this.translations[b])?k.order:void 0)?b:"default";if(null!=this.translations[f].order[h.b]){null==h.c&&(h.c=1);h.c=parseInt(h.c,10);if(isNaN(h.c))return e.start_chapter_not_numeric=!0,[!1,e];0===h.c&&(e.start_chapter_is_zero=1,"error"===this.options.zero_chapter_strategy?c=!1:h.c=1);0<h.c&&null!=
this.translations[b].chapters[h.b][h.c-1]?null!=h.v&&(h.v=parseInt(h.v,10),isNaN(h.v)?(c=!1,e.start_verse_not_numeric=!0):0===h.v?(e.start_verse_is_zero=1,"error"===this.options.zero_verse_strategy?c=!1:"upgrade"===this.options.zero_verse_strategy&&(h.v=1)):h.v>this.translations[b].chapters[h.b][h.c-1]&&(c=!1,e.start_verse_not_exist=this.translations[b].chapters[h.b][h.c-1])):(c=!1,1!==h.c&&1===this.translations[b].chapters[h.b].length?e.start_chapter_not_exist_in_single_chapter_book=1:0<h.c&&(e.start_chapter_not_exist=
this.translations[b].chapters[h.b].length))}else c=!1,e.start_book_not_exist=!0;return[c,e]};k.prototype.validate_end_ref=function(b,h,c,e,f){var k,l;"default"!==b&&null==(null!=(k=this.translations[b])?k.chapters[c.b]:void 0)&&this.promote_book_to_translation(c.b,b);k=null!=(null!=(l=this.translations[b])?l.order:void 0)?b:"default";null!=c.c&&(c.c=parseInt(c.c,10));null!=c.v&&(c.v=parseInt(c.v,10));null==c.c||isNaN(c.c)||0!==c.c||(f.end_chapter_is_zero=1,"error"===this.options.zero_chapter_strategy?
e=!1:c.c=1);null!=this.translations[k].order[c.b]?(null!=this.translations[k].order[h.b]&&this.translations[k].order[h.b]>this.translations[k].order[c.b]&&(e=!1,f.end_book_before_start=!0),h.b!==c.b||null==c.c||isNaN(c.c)||(null==h.c&&(h.c=1),!isNaN(parseInt(h.c,10))&&h.c>c.c?(e=!1,f.end_chapter_before_start=!0):h.c!==c.c||null==c.v||isNaN(c.v)||(null==h.v&&(h.v=1),!isNaN(parseInt(h.v,10))&&h.v>c.v&&(e=!1,f.end_verse_before_start=!0))),null==c.c||isNaN(c.c)||null!=this.translations[b].chapters[c.b][c.c-
1]||(1===this.translations[b].chapters[c.b].length?f.end_chapter_not_exist_in_single_chapter_book=1:0<c.c&&(f.end_chapter_not_exist=this.translations[b].chapters[c.b].length)),null==c.v||isNaN(c.v)||(null==c.c&&(c.c=this.translations[b].chapters[c.b].length),c.v>this.translations[b].chapters[c.b][c.c-1]?f.end_verse_not_exist=this.translations[b].chapters[c.b][c.c-1]:0===c.v&&(f.end_verse_is_zero=1,"error"===this.options.zero_verse_strategy?e=!1:"upgrade"===this.options.zero_verse_strategy&&(c.v=1)))):
(e=!1,f.end_book_not_exist=!0);null!=c.c&&isNaN(c.c)&&(e=!1,f.end_chapter_not_numeric=!0);null!=c.v&&isNaN(c.v)&&(e=!1,f.end_verse_not_numeric=!0);return[e,f]};k.prototype.promote_book_to_translation=function(b,h){var c,e,f;null==(c=this.translations)[h]&&(c[h]={});null==(c=this.translations[h]).chapters&&(c.chapters={});return null!=(null!=(e=this.translations.alternates[h])?null!=(f=e.chapters)?f[b]:void 0:void 0)?this.translations[h].chapters[b]=this.translations.alternates[h].chapters[b]:this.translations[h].chapters[b]=
s.shallow_clone_array(this.translations["default"].chapters[b])};return k}();s={shallow_clone:function(k){var b,h,c;if(null==k)return k;h={};for(b in k)T.call(k,b)&&(c=k[b],h[b]=c);return h},shallow_clone_array:function(k){var b,h,c,e;if(null==k)return k;h=[];b=c=0;for(e=k.length;0<=e?c<=e:c>=e;b=0<=e?++c:--c)"undefined"!==typeof k[b]&&(h[b]=k[b]);return h}};l.prototype.regexps.translations=/(?:(?:A(?:MP|SV)|RSV|N(?:RSV|LT|I(?:RV|V)|KJV|A(?:B(?:RE)?|SB?))|MSG|TNIV|CE[BV]|E[RS]V|HCSB|KJV))\b/gi;l.prototype.translations=
{aliases:{ceb:{osis:"CEB",alias:"ceb"},kjv:{osis:"KJV",alias:"kjv"},nab:{osis:"NAB",alias:"nab"},nabre:{osis:"NABRE",alias:"nab"},nas:{osis:"NASB",alias:"default"},nirv:{osis:"NIRV",alias:"kjv"},niv:{osis:"NIV",alias:"kjv"},nkjv:{osis:"NKJV",alias:"nkjv"},nlt:{osis:"NLT",alias:"nlt"},nrsv:{osis:"NRSV",alias:"nrsv"},tniv:{osis:"TNIV",alias:"kjv"},"default":{osis:"",alias:"default"}},"default":{order:{Gen:1,Exod:2,Lev:3,Num:4,Deut:5,Josh:6,Judg:7,Ruth:8,"1Sam":9,"2Sam":10,"1Kgs":11,"2Kgs":12,"1Chr":13,
"2Chr":14,Ezra:15,Neh:16,Esth:17,Job:18,Ps:19,Prov:20,Eccl:21,Song:22,Isa:23,Jer:24,Lam:25,Ezek:26,Dan:27,Hos:28,Joel:29,Amos:30,Obad:31,Jonah:32,Mic:33,Nah:34,Hab:35,Zeph:36,Hag:37,Zech:38,Mal:39,Matt:40,Mark:41,Luke:42,John:43,Acts:44,Rom:45,"1Cor":46,"2Cor":47,Gal:48,Eph:49,Phil:50,Col:51,"1Thess":52,"2Thess":53,"1Tim":54,"2Tim":55,Titus:56,Phlm:57,Heb:58,Jas:59,"1Pet":60,"2Pet":61,"1John":62,"2John":63,"3John":64,Jude:65,Rev:66,Tob:67,Jdt:68,GkEsth:69,Wis:70,Sir:71,Bar:72,PrAzar:73,Sus:74,Bel:75,
SgThree:76,EpJer:77,"1Macc":78,"2Macc":79,"3Macc":80,"4Macc":81,"1Esd":82,"2Esd":83,PrMan:84},chapters:{Gen:[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,55,32,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],Exod:[22,25,22,31,23,30,25,32,35,29,10,51,22,31,27,36,16,27,25,26,36,31,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],Lev:[17,16,17,35,19,30,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],Num:[54,34,51,49,31,27,89,26,
23,36,35,16,33,45,41,50,13,32,22,29,35,41,30,25,18,65,23,31,40,16,54,42,56,29,34,13],Deut:[46,37,29,49,33,25,26,20,29,22,32,32,18,29,23,22,20,22,21,20,23,30,25,22,19,19,26,68,29,20,30,52,29,12],Josh:[18,24,17,24,15,27,26,35,27,43,23,24,33,15,63,10,18,28,51,9,45,34,16,33],Judg:[36,23,31,24,31,40,25,35,57,18,40,15,25,20,20,31,13,31,30,48,25],Ruth:[22,23,18,22],"1Sam":[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,15,23,29,22,44,25,12,25,11,31,13],"2Sam":[27,32,39,12,25,23,29,18,13,19,
27,31,39,33,37,23,29,33,43,26,22,51,39,25],"1Kgs":[53,46,28,34,18,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,53],"2Kgs":[18,25,27,44,27,33,20,29,37,36,21,21,25,29,38,20,41,37,37,21,26,20,37,20,30],"1Chr":[54,55,24,43,26,81,40,40,44,14,47,40,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],"2Chr":[17,18,17,22,14,42,22,18,31,19,23,16,22,15,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],Ezra:[11,70,13,24,17,22,28,36,15,44],Neh:[11,20,32,23,19,19,73,18,38,39,36,47,31],Esth:[22,
23,15,17,14,14,10,17,32,3],Job:[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,24,34,17],Ps:[6,12,8,8,12,10,17,9,20,18,7,8,6,7,5,11,15,50,14,9,13,31,6,10,22,12,14,9,11,12,24,11,22,22,28,12,40,22,13,17,13,11,5,26,17,11,9,14,20,23,19,9,6,7,23,13,11,11,17,12,8,12,11,10,13,20,7,35,36,5,24,20,28,23,10,12,20,72,13,19,16,8,18,12,13,17,7,18,52,17,16,15,5,23,11,13,12,9,9,5,8,28,22,35,45,48,43,13,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,
6,5,6,8,8,3,18,3,3,21,26,9,8,24,13,10,7,12,15,21,10,20,14,9,6],Prov:[33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31],Eccl:[18,26,22,16,20,12,29,17,18,20,10,14],Song:[17,17,11,16,16,13,13,14],Isa:[31,22,26,6,30,13,25,22,21,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,12,25,24],Jer:[19,37,25,31,31,30,34,22,26,25,23,17,27,22,21,21,27,23,15,18,14,
30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],Lam:[22,22,66,22,22],Ezek:[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,49,32,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],Dan:[21,49,30,37,31,28,28,27,27,21,45,13],Hos:[11,23,5,19,15,11,16,14,17,15,12,14,16,9],Joel:[20,32,21],Amos:[15,16,15,13,27,14,17,14,15],Obad:[21],Jonah:[17,10,10,11],Mic:[16,13,12,13,15,16,20],Nah:[15,13,19],Hab:[17,20,19],Zeph:[18,15,20],
Hag:[15,23],Zech:[21,13,10,14,11,15,14,23,17,12,17,14,9,21],Mal:[14,17,18,6],Matt:[25,23,17,25,48,34,29,34,38,42,30,50,58,36,39,28,27,35,30,34,46,46,39,51,46,75,66,20],Mark:[45,28,35,41,43,56,37,38,50,52,33,44,37,72,47,20],Luke:[80,52,38,44,39,49,50,56,62,42,54,59,35,35,32,31,37,43,48,47,38,71,56,53],John:[51,25,36,54,47,71,53,59,41,42,57,50,38,31,27,33,26,40,42,31,25],Acts:[26,47,26,37,42,15,60,40,43,48,30,25,52,28,41,40,34,28,41,38,40,30,35,27,27,32,44,31],Rom:[32,29,31,25,21,23,25,39,33,21,36,
21,14,23,33,27],"1Cor":[31,16,23,21,13,20,40,13,27,33,34,31,13,40,58,24],"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,14],Gal:[24,21,29,31,26,18],Eph:[23,22,21,32,33,24],Phil:[30,30,21,23],Col:[29,23,25,18],"1Thess":[10,20,13,18,28],"2Thess":[12,17,18],"1Tim":[20,15,16,16,25,21],"2Tim":[18,26,17,22],Titus:[16,15,15],Phlm:[25],Heb:[14,18,19,16,14,20,28,13,28,39,40,29,25],Jas:[27,26,18,17,20],"1Pet":[25,25,22,19,14],"2Pet":[21,22,18],"1John":[10,29,24,21,21],"2John":[13],"3John":[15],Jude:[25],Rev:[20,
29,22,11,14,17,17,13,21,11,19,17,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,16,21,6,13,18,22,17,15],Jdt:[16,28,10,15,24,21,32,36,14,23,23,20,20,19,14,25],GkEsth:[22,23,15,17,14,14,10,17,32,13,12,6,18,19,16,24],Wis:[16,24,19,20,23,25,30,21,18,21,26,27,19,31,19,29,21,25,22],Sir:[30,18,31,31,15,37,36,19,18,31,34,18,26,27,20,30,32,33,30,31,28,27,27,34,26,29,30,26,28,25,31,24,33,31,26,31,31,34,35,30,22,25,33,23,26,20,25,25,16,29,30],Bar:[22,35,37,37,9],PrAzar:[68],Sus:[64],Bel:[42],SgThree:[39],
EpJer:[73],"1Macc":[64,70,60,61,68,63,50,32,73,89,74,53,53,49,41,24],"2Macc":[36,32,40,50,27,31,42,36,29,38,38,45,26,46,39],"3Macc":[29,33,30,21,51,41,23],"4Macc":[35,24,21,26,38,35,23,29,32,21,27,19,27,20,32,25,24,24],"1Esd":[58,30,24,63,73,34,15,96,55],"2Esd":[40,48,36,52,56,59,70,63,47,59,46,51,58,48,63,78],PrMan:[15],Ps151:[7]}},alternates:{vulgate:{chapters:{Ps:[6,13,9,10,13,11,18,10,39,8,9,6,7,5,10,15,51,15,10,14,32,6,10,22,12,14,9,11,13,25,11,22,23,28,13,40,23,14,18,14,12,5,26,18,12,10,15,
21,23,21,11,7,9,24,13,12,12,18,14,9,13,12,11,14,20,8,36,37,6,24,20,28,23,11,13,21,72,13,20,17,8,19,13,14,17,7,19,53,17,16,16,5,23,11,13,12,9,9,5,8,29,22,35,45,48,43,14,31,7,10,10,9,26,9,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,14,10,8,12,15,21,10,11,20,14,9,7]}},ceb:{chapters:{"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,16,21,6,13,18,22,18,15],PrAzar:[67],EpJer:[72],"1Esd":[55,26,24,63,
71,33,15,92,55]}},kjv:{chapters:{"3John":[14]}},nab:{chapters:{Gen:[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,54,33,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],Exod:[22,25,22,31,23,30,29,28,35,29,10,51,22,31,27,36,16,27,25,26,37,30,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],Lev:[17,16,17,35,26,23,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],Num:[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,35,28,32,22,29,35,41,
30,25,19,65,23,31,39,17,54,42,56,29,34,13],Deut:[46,37,29,49,33,25,26,20,29,22,32,31,19,29,23,22,20,22,21,20,23,29,26,22,19,19,26,69,28,20,30,52,29,12],"1Sam":[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,16,23,28,23,44,25,12,25,11,31,13],"2Sam":[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,32,44,26,22,51,39,25],"1Kgs":[53,46,28,20,32,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,54],"2Kgs":[18,25,27,44,27,33,20,29,37,36,20,22,25,29,38,20,41,37,37,21,26,20,37,20,30],"1Chr":[54,
55,24,43,41,66,40,40,44,14,47,41,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],"2Chr":[18,17,17,22,14,42,22,18,31,19,23,16,23,14,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],Neh:[11,20,38,17,19,19,72,18,37,40,36,47,31],Job:[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,32,26,17],Ps:[6,11,9,9,13,11,18,10,21,18,7,9,6,7,5,11,15,51,15,10,14,32,6,10,22,12,14,9,11,13,25,11,22,23,28,13,40,23,14,18,14,12,5,27,
18,12,10,15,21,23,21,11,7,9,24,14,12,12,18,14,9,13,12,11,14,20,8,36,37,6,24,20,28,23,11,13,21,72,13,20,17,8,19,13,14,17,7,19,53,17,16,16,5,23,11,13,12,9,9,5,8,29,22,35,45,48,43,14,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,14,10,8,12,15,21,10,20,14,9,6],Eccl:[18,26,22,17,19,12,29,17,18,20,10,14],Song:[17,17,11,16,16,12,14,14],Isa:[31,22,26,6,30,13,25,23,20,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,
26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,11,25,24],Jer:[19,37,25,31,31,30,34,23,25,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],Ezek:[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,44,37,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],Dan:[21,49,100,34,30,29,28,27,27,21,45,13,64,42],Hos:[9,25,5,19,15,11,16,14,17,15,11,15,15,10],Joel:[20,27,5,21],Jonah:[16,11,10,11],Mic:[16,
13,12,14,14,16,20],Nah:[14,14,19],Zech:[17,17,10,14,11,15,14,23,17,12,17,14,9,21],Mal:[14,17,24],Acts:[26,47,26,37,42,15,60,40,43,49,30,25,52,28,41,40,34,28,40,38,40,30,35,27,27,32,44,31],"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,17,21,6,13,18,22,18,15],Sir:[30,18,31,31,15,37,36,19,18,31,34,18,26,27,20,30,32,33,30,31,28,27,27,33,26,29,30,26,28,25,31,24,33,31,26,31,31,34,35,30,22,25,33,23,26,20,25,25,
16,29,30],Bar:[22,35,38,37,9,72],"2Macc":[36,32,40,50,27,31,42,36,29,38,38,46,26,46,39]}},nlt:{chapters:{Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21]}},nrsv:{chapters:{"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21]}}}};l.prototype.regexps.space="[\\s\\xa0]";l.prototype.regexps.escaped_passage=RegExp("(?:^|[^\\x1f\\x1e\\dA-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:(?:ch(?:apters?|a?pts?\\.?|a?p?s?\\.?)?\\s*\\d+\\s*(?:[\\u2013\\u2014\\-]|through|thru|to)\\s*\\d+\\s*(?:from|of|in)(?:\\s+the\\s+book\\s+of)?\\s*)|(?:ch(?:apters?|a?pts?\\.?|a?p?s?\\.?)?\\s*\\d+\\s*(?:from|of|in)(?:\\s+the\\s+book\\s+of)?\\s*)|(?:\\d+(?:th|nd|st)\\s*ch(?:apter|a?pt\\.?|a?p?\\.?)?\\s*(?:from|of|in)(?:\\s+the\\s+book\\s+of)?\\s*))?\\x1f(\\d+)(?:/\\d+)?\\x1f(?:/\\d+\\x1f|[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014]|title(?![a-z])|see"+
l.prototype.regexps.space+"+also|ff(?![a-z0-9])|f(?![a-z0-9])|chapters|chapter|through|compare|chapts|verses|chpts|chapt|verse|chap|thru|also|chp|chs|cha|and|see|ver|vss|ch|to|cf|vs|vv|v|[a-e](?!\\w)|$)+)","gi");l.prototype.regexps.match_end_split=/\d+\W*title|\d+\W*(?:ff(?![a-z0-9])|f(?![a-z0-9]))(?:[\s\xa0*]*\.)?|\d+[\s\xa0*]*[a-e](?!\w)|\x1e(?:[\s\xa0*]*[)\]\uff09])?|[\d\x1f]+/gi;l.prototype.regexps.control=/[\x1e\x1f]/g;l.prototype.regexps.pre_book="[^A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff]";
l.prototype.regexps.first="(?:1st|1|I|First)\\.?"+l.prototype.regexps.space+"*";l.prototype.regexps.second="(?:2nd|2|II|Second)\\.?"+l.prototype.regexps.space+"*";l.prototype.regexps.third="(?:3rd|3|III|Third)\\.?"+l.prototype.regexps.space+"*";l.prototype.regexps.range_and="(?:[&\u2013\u2014-]|(?:and|compare|cf|see"+l.prototype.regexps.space+"+also|also|see)|(?:through|thru|to))";l.prototype.regexps.range_only="(?:[\u2013\u2014-]|(?:through|thru|to))";l.prototype.regexps.get_books=function(k,b){var h,
c,e,f,n;c=[{osis:["Ps"],apocrypha:!0,extra:"2",regexp:/(\b)(Ps151)(?=\.1)/g},{osis:["Gen"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(G(?:n|e(?:n(?:i(?:[ei]s(?:[eiu]s)|s[eiu]s)|sis|n(?:e(?:is(?:[uie]s)?|es[iue]s|s[eiu]s)|i(?:[ei]s(?:[eiu]s)|s[uie]s)|sis)|e(?:is(?:[ieu]s)?|es[iue]s|s(?:[ei]s?|us)))?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Exod"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ex(?:o(?:d(?:[ui]s|[se])?)?|d)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Bel"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Bel(?:[\\s\\xa0]*(?:and[\\s\\xa0]*(?:S(?:erpent|nake)|Dragon|the[\\s\\xa0]*(?:S(?:erpent|nake)|Dragon))|&[\\s\\xa0]*(?:S(?:erpent|nake)|Dragon|the[\\s\\xa0]*(?:S(?:erpent|nake)|Dragon))))?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Lev"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(L(?:e(?:v(?:i(?:t(?:cus|[ie]cus))?|et(?:cus|[ei]cus))?)?|iv(?:[ie]t(?:cus|[ie]cus))|v))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Num"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(N(?:u(?:m(?:b(?:ers?)?)?)?|m))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Sir"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Ben[\\s\\xa0]*Sira|The[\\s\\xa0]*Wisdom[\\s\\xa0]*of[\\s\\xa0]*Jesus(?:[\\s\\xa0]*(?:Son[\\s\\xa0]*of[\\s\\xa0]*Sirach|ben[\\s\\xa0]*Sirach)|,[\\s\\xa0]*Son[\\s\\xa0]*of[\\s\\xa0]*Sirach)|Wisdom[\\s\\xa0]*of[\\s\\xa0]*Jesus(?:[\\s\\xa0]*(?:Son[\\s\\xa0]*of[\\s\\xa0]*Sirach|ben[\\s\\xa0]*Sirach)|,[\\s\\xa0]*Son[\\s\\xa0]*of[\\s\\xa0]*Sirach)|Sir(?:ach)?|Ecc(?:l(?:us(?:iasticus)?|esiasticus)|s)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Wis"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Wis(?:[\\s\\xa0]*of[\\s\\xa0]*Solomon|om[\\s\\xa0]*of[\\s\\xa0]*Solomon|d(?:[\\s\\xa0]*of[\\s\\xa0]*Solomon|om(?:[\\s\\xa0]*of[\\s\\xa0]*Solomon)?)?)?|The[\\s\\xa0]*Wis(?:[\\s\\xa0]*of[\\s\\xa0]*Solomon|om[\\s\\xa0]*of[\\s\\xa0]*Solomon|d(?:[\\s\\xa0]*of[\\s\\xa0]*Solomon|om[\\s\\xa0]*of[\\s\\xa0]*Solomon))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Lam"],
regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(L(?:a(?:m(?:[ie]ntations?)?)?|m))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["EpJer"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Let(?:[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|\\.[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|ter[\\s\\xa0]*of[\\s\\xa0]*Jeremiah)|The[\\s\\xa0]*(?:Ep(?:[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|\\.[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|istle[\\s\\xa0]*of[\\s\\xa0]*Jeremiah)|Let(?:[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|\\.[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|ter[\\s\\xa0]*of[\\s\\xa0]*Jeremiah))|Ep(?:\\.[\\s\\xa0]*of[\\s\\xa0]*Jeremiah|istle[\\s\\xa0]*of[\\s\\xa0]*Jerem(?:iah|y)|Jer|[\\s\\xa0]*(?:of[\\s\\xa0]*Jeremiah|Jer))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Rev"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(R(?:e(?:v(?:el(?:ations?)?|[oa]lations?|lations?)?)?|v))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["PrMan"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:The[\\s\\xa0]*Pr(?:ayer(?:s[\\s\\xa0]*(?:Manasseh|of[\\s\\xa0]*Manasseh)|[\\s\\xa0]*(?:Manasseh|of[\\s\\xa0]*Manasseh))|[\\s\\xa0]*(?:Manasseh|of[\\s\\xa0]*Manasseh))|Pr(?:ayer(?:s[\\s\\xa0]*(?:Manasseh|of[\\s\\xa0]*Manasseh)|[\\s\\xa0]*(?:Manasseh|of[\\s\\xa0]*Manasseh))|[\\s\\xa0]*(?:Man(?:asseh)?|of[\\s\\xa0]*Manasseh)|Man)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Deut"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(D(?:t|e(?:et(?:ron(?:omy|my)|(?:[oe]ron(?:omy|my)))|u(?:t(?:ron(?:omy|my)|(?:[eo]ron(?:omy|my)))?)?)|u(?:et(?:ron(?:omy|my)|(?:[eo]ron(?:omy|my)))?|ut(?:ron(?:omy|my)|(?:[eo]ron(?:omy|my))))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Josh"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:sh|o(?:s(?:h(?:ua)?|ua)?|us(?:hua|ua))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Judg"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:gs?|udg(?:es)?|dgs?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Ruth"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(R(?:th?|u(?:th?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["1Esd"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:First[\s\xa0]*Esd(?:r(?:as)?)?|I(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?)|1(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?|Esd|st(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?))))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["2Esd"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:2(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?|nd(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?)|Esd)|Second[\s\xa0]*Esd(?:r(?:as)?)?|II(?:\.[\s\xa0]*Esd(?:r(?:as)?)?|[\s\xa0]*Esd(?:r(?:as)?)?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},{osis:["Isa"],
regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(I(?:s(?:i(?:[ia](?:(?:[ia](?:(?:[ia]ha?|ha?))|ha?))|ha)|a(?:a(?:[ai](?:(?:[ai]ha?|ha?))|ha?)|i(?:[ai](?:(?:[ia]ha?|ha?))|sha?|ha?)?|ha?)?|sah)?|a))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["2Sam"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:II(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[ls]?)?)?|ma?))|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[sl]?)?)?|ma?)))|Second[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[ls]?)?)?|ma?))|2(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[sl]?)?)?|ma?)?)|nd(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[sl]?)?)?|ma?))|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[ls]?)?)?|ma?)))|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[sl]?)?)?|ma?))|Sam)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Sam"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:1(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[ls]?)?)?|ma?)?)|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[ls]?)?)?|ma?))|st(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[ls]?)?)?|ma?))|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[ls]?)?)?|ma?)))|Sam)|I(?:[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ae]l[sl]?)?)?|ma?))|\.[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[sl]?)?)?|ma?)))|First[\s\xa0]*(?:Kingdoms|S(?:a(?:m(?:u[ea]l[sl]?)?)?|ma?)))|Samu(?:[ae]l[ls]?))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["2Kgs"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:Fourth[\s\xa0]*Kingdoms|I(?:I(?:[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?|\.[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?)|V(?:\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms))|Second[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?|2(?:nd(?:[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?|\.[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?)|Kgs|[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?|\.[\s\xa0]*K(?:n(?:gs?|s)?|i(?:n(?:gs?|s)?|gs?|s)?|gs?|s)?)|4(?:th(?:\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms)|\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Kgs"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:3(?:rd(?:\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms)|\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms)|I(?:[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?|II(?:\.[\s\xa0]*Kingdoms|[\s\xa0]*Kingdoms)|\.[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?)|Third[\s\xa0]*Kingdoms|1(?:[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?|Kgs|\.[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?|st(?:[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?|\.[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?))|First[\s\xa0]*K(?:n(?:gs?|s)?|gs?|i(?:n(?:gs?|s)?|gs?)?|s)?)|K(?:gs|in(?:gs)?|ngs))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["2Chr"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:2(?:[\s\xa0]*(?:C(?:ron(?:[oi]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[io]cles?)?|oron[io]cles?)|Paralipomenon)|\.[\s\xa0]*(?:C(?:ron(?:[io]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[io]cles?)|oron[io]cles?)|Paralipomenon)|nd(?:\.[\s\xa0]*(?:C(?:ron(?:[io]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[io]cles?)|oron[io]cles?)|Paralipomenon)|[\s\xa0]*(?:C(?:ron(?:[oi]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[oi]cles?)|oron[oi]cles?)|Paralipomenon))|Chr)|II(?:\.[\s\xa0]*(?:C(?:ron(?:[io]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[oi]cles?)|oron[oi]cles?)|Paralipomenon)|[\s\xa0]*(?:C(?:ron(?:[oi]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[oi]cles?)|oron[oi]cles?)|Paralipomenon))|Second[\s\xa0]*(?:C(?:ron(?:[io]cles?)?|h(?:r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?|oron[io]cles?)|oron[oi]cles?)|Paralipomenon)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Chr"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:I(?:\.[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[io]cles?)|Paralipomenon)|[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[oi]cles?)|Paralipomenon))|Choronicle|1(?:\.[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[oi]cles?)|Paralipomenon)|Chr|[\s\xa0]*(?:Paralipomenon|C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)?|ron(?:[oi]cles?)?|oron[io]cles?))|st(?:\.[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[io]cles?)|Paralipomenon)|[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[io]cles?)|Paralipomenon)))|First[\s\xa0]*(?:C(?:h(?:oron(?:ocles?|icles)|r(?:o(?:n(?:ocles?|ic(?:les?|als))?)?|n)?)|ron(?:[io]cles?)?|oron[oi]cles?)|Paralipomenon))|(?:C(?:ron[io]cles?|h(?:oron(?:ocles?|icles)|ron(?:ocles?|ic(?:les?|als)))|oron[oi]cles?)|Paralipomenon))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Ezra"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(E(?:zra?|sra))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Neh"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ne(?:h(?:(?:[ie]m(?:i(?:h|i(?:[ai]h|h)|a(?:[ai]h|h)?)|a(?:h|[ai](?:(?:[ia]h|h)))))|amiah?)?)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["GkEsth"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+
")((?:G(?:k(?:Esth|[\\s\\xa0]*Esth?)|r(?:[\\s\\xa0]*Esth?|eek[\\s\\xa0]*Est(?:h(?:er)?)?))|Esther[\\s\\xa0]*\\(Greek\\)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Esth"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Es(?:t(?:h(?:er|r)?|er)?)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Job"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:b|ob))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Ps"],extra:"1",regexp:RegExp("(\\b)((?:(?:(?:1[02-5]|[2-9])?(?:1"+l.prototype.regexps.space+"*st|2"+l.prototype.regexps.space+"*nd|3"+l.prototype.regexps.space+"*rd))|1?1[123]"+l.prototype.regexps.space+"*th|(?:150|1[0-4][04-9]|[1-9][04-9]|[4-9])"+l.prototype.regexps.space+"*th)"+l.prototype.regexps.space+"*Psalm)\\b","gi")},{osis:["Ps"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:P(?:s(?:l(?:a(?:ms?|lms?)?|m(?:as|[ms])?)|sm?|m(?:ls?|m|a(?:l(?:ms?|s)?)?)?|a(?:a(?:ms|a|lms?)|m(?:ms?|as|l(?:ms?|[sa])?|s)?|l(?:m(?:[mal]s?|s)?|a(?:ms?|s)?|s|lms?)?)?)?|l(?:ms|s(?:s(?:s(?:ss?)?)?|ms?|a(?:ms?)?)|a(?:m(?:as|s)?|as?|s(?:m(?:as?|s)?|s)?))|a(?:m[sl]s|l(?:[lm]s|sms?)|s(?:ss|m(?:ls|s)|lms?)))|Salms?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["PrAzar"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Azariah?|The[\\s\\xa0]*Pr(?:[\\s\\xa0]*of[\\s\\xa0]*Azariah?|ayer(?:s[\\s\\xa0]*of[\\s\\xa0]*Azariah?|[\\s\\xa0]*of[\\s\\xa0]*Azariah?))|Pr(?:[\\s\\xa0]*(?:Azar|of[\\s\\xa0]*Azariah?)|Az(?:ar|r)|ayer(?:s[\\s\\xa0]*of[\\s\\xa0]*Azariah?|[\\s\\xa0]*of[\\s\\xa0]*Azariah?))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Prov"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+
")((?:Oroverbs|P(?:o(?:rverbs|verbs)|v|r(?:o(?:b(?:verbs|erbs)|v(?:e(?:bs|rbs?))?)?|v(?:erbs?|bs?)?|everbs?)?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Eccl"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Ec(?:l(?:es(?:i(?:stes|a(?:tes|stes?|iastes))|sia(?:tes|stes)))?|c(?:l(?:es(?:s(?:aistes|ia(?:tes|stes))|a(?:stes|i(?:tes|stes|astes))|i(?:a(?:i(?:stes|astes)|st(?:es?|ies)?|tes?|a(?:tes|stes))|tes|stes|iastes))?)?)?)?|Qo(?:h(?:eleth)?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["SgThree"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:The[\s\xa0]*Song[\s\xa0]*of[\s\xa0]*(?:3[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|Three[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|the[\s\xa0]*(?:3[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|Three[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)))|S(?:[\s\xa0]*(?:of[\s\xa0]*(?:3(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))|Th(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y)|ree(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))))|3(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))|Th(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y)|ree(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))))|ong[\s\xa0]*Three|\.[\s\xa0]*(?:of[\s\xa0]*(?:3(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))|Th(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y)|ree(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))))|3(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))|Th(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y)|ree(?:[\s\xa0]*(?:Ch|Y)|\.[\s\xa0]*(?:Ch|Y))))|ng[\s\xa0]*Three|g(?:Three|[\s\xa0]*Three)))|Song[\s\xa0]*of[\s\xa0]*(?:3[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|Three[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|the[\s\xa0]*(?:3[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews)|Three[\s\xa0]*(?:You(?:ng[\s\xa0]*Men|ths)|Holy[\s\xa0]*Children|Jews))))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Song"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:S(?:o[Sln]?|gs?|ngs?|[\\s\\xa0]*of[\\s\\xa0]*S|S)|The[\\s\\xa0]*Song(?:s[\\s\\xa0]*of[\\s\\xa0]*S(?:o(?:lom[oa]ns?|ngs?)|alom[oa]ns?)|[\\s\\xa0]*of[\\s\\xa0]*S(?:o(?:lom[ao]ns?|ngs?)|alom[ao]ns?)))|Song(?:s(?:[\\s\\xa0]*of[\\s\\xa0]*S(?:o(?:lom[ao]ns?|ngs?)|alom[ao]ns?))?|[\\s\\xa0]*of[\\s\\xa0]*S(?:o(?:lom[oa]ns?|ngs?)|alom[oa]ns?))?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},
{osis:["Jer"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:r|e(?:r(?:im(?:ah|i(?:[ia]h|h))|m[mi]ah|e(?:m(?:i(?:ih|ah?|e|ha?)?|a(?:h|i(?:ah|h))))?|a(?:m(?:a(?:ih|h)|i(?:ih|ah?|ha?))|iah))?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Ezek"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(E(?:z(?:e(?:(?:[ie]k(?:el|iel))|k(?:el|i[ae]l)?)?|i(?:(?:[ie]k(?:el|iel))|k(?:el|iel))|k)|x(?:[ei](?:(?:[ie]k(?:el|iel))|k(?:el|iel)))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Dan"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(D(?:a(?:n(?:i[ae]l)?)?|[nl]))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Hos"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(H(?:o(?:s(?:ea)?)?|s))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Joel"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:l|oel?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Amos"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Am(?:os?|s)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Obad"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ob(?:idah|a(?:d(?:iah?)?)?|d)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Jonah"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:nh|on(?:ah)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Mic"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Mi(?:c(?:ah?|hah?)?)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Nah"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Na(?:h(?:um?)?)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Hab"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Hab(?:bak(?:[ua]kk?|k[ua]kk?)|ak(?:[ua]kk?|k[au]kk?)|k)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Zeph"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Z(?:e(?:p(?:h(?:an(?:aiah?|iah?))?)?|faniah?)|ph?|a(?:phania|faniah?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Hag"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(H(?:gg?|ag(?:ai|g(?:ai|ia[hi])?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Zech"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+
")(Zach[ae]r(?:[ai](?:(?:[ai]h|h)))|Z(?:ch?|a(?:kariah|ch?)|e(?:kariah?|c(?:h(?:ar(?:i(?:ih|ah?|h)|a(?:[ia]h|h))|er[ia](?:(?:[ai]h|h)))?)?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Mal"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Mal(?:ichi|ac(?:hi?|i))?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Matt"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:Mtt|The[\\s\\xa0]*Gospel[\\s\\xa0]*(?:according[\\s\\xa0]*to[\\s\\xa0]*(?:M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)|S(?:aint[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|t(?:\\.[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)|[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t))))|of[\\s\\xa0]*(?:M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|S(?:aint[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|t(?:\\.[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t))))))|(?:M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)|S(?:aint[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)|t(?:\\.[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)))|Gospel[\\s\\xa0]*(?:according[\\s\\xa0]*to[\\s\\xa0]*(?:M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|S(?:aint[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|t(?:\\.[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t))))|of[\\s\\xa0]*(?:M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|S(?:aint[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[ht](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)|t(?:\\.[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[ht](?:iew|(?:[th](?:iew|ew))|ew))))?|t)|[\\s\\xa0]*M(?:at(?:t(?:iew|t(?:iew|h(?:iew|ew)|ew)|ew|h(?:iew|(?:[th](?:iew|ew))|ew|we)|we)?|h(?:iew|ew|(?:[th](?:iew|(?:[ht](?:iew|ew))|ew))))?|t)))))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Mark"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(The[\\s\\xa0]*Gospel[\\s\\xa0]*(?:according[\\s\\xa0]*to[\\s\\xa0]*(?:M(?:rk?|ark?|k)|S(?:aint[\\s\\xa0]*M(?:rk?|ark?|k)|t(?:\\.[\\s\\xa0]*M(?:rk?|ark?|k)|[\\s\\xa0]*M(?:rk?|ark?|k))))|of[\\s\\xa0]*(?:M(?:rk?|ark?|k)|S(?:aint[\\s\\xa0]*M(?:rk?|ark?|k)|t(?:\\.[\\s\\xa0]*M(?:rk?|ark?|k)|[\\s\\xa0]*M(?:rk?|ark?|k)))))|(?:Gospel[\\s\\xa0]*(?:according[\\s\\xa0]*to[\\s\\xa0]*(?:M(?:rk?|ark?|k)|S(?:aint[\\s\\xa0]*M(?:rk?|ark?|k)|t(?:\\.[\\s\\xa0]*M(?:rk?|ark?|k)|[\\s\\xa0]*M(?:rk?|ark?|k))))|of[\\s\\xa0]*(?:M(?:rk?|ark?|k)|S(?:aint[\\s\\xa0]*M(?:rk?|ark?|k)|t(?:\\.[\\s\\xa0]*M(?:rk?|ark?|k)|[\\s\\xa0]*M(?:rk?|ark?|k)))))|M(?:rk?|ark?|k)|S(?:aint[\\s\\xa0]*M(?:rk?|ark?|k)|t(?:\\.[\\s\\xa0]*M(?:rk?|ark?|k)|[\\s\\xa0]*M(?:rk?|ark?|k)))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Luke"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(The[\\s\\xa0]*Gospel[\\s\\xa0]*(?:of[\\s\\xa0]*(?:S(?:aint[\\s\\xa0]*L(?:u(?:ke?)?|k)|t(?:[\\s\\xa0]*L(?:u(?:ke?)?|k)|\\.[\\s\\xa0]*L(?:u(?:ke?)?|k)))|L(?:u(?:ke?)?|k))|according[\\s\\xa0]*to[\\s\\xa0]*(?:S(?:aint[\\s\\xa0]*L(?:u(?:ke?)?|k)|t(?:[\\s\\xa0]*L(?:u(?:ke?)?|k)|\\.[\\s\\xa0]*L(?:u(?:ke?)?|k)))|L(?:u(?:ke?)?|k)))|(?:S(?:aint[\\s\\xa0]*L(?:u(?:ke?)?|k)|t(?:[\\s\\xa0]*L(?:u(?:ke?)?|k)|\\.[\\s\\xa0]*L(?:u(?:ke?)?|k)))|L(?:u(?:ke?)?|k)|Gospel[\\s\\xa0]*(?:of[\\s\\xa0]*(?:S(?:aint[\\s\\xa0]*L(?:u(?:ke?)?|k)|t(?:[\\s\\xa0]*L(?:u(?:ke?)?|k)|\\.[\\s\\xa0]*L(?:u(?:ke?)?|k)))|L(?:u(?:ke?)?|k))|according[\\s\\xa0]*to[\\s\\xa0]*(?:S(?:aint[\\s\\xa0]*L(?:u(?:ke?)?|k)|t(?:[\\s\\xa0]*L(?:u(?:ke?)?|k)|\\.[\\s\\xa0]*L(?:u(?:ke?)?|k)))|L(?:u(?:ke?)?|k)))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["1John"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:First[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|I(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?))|1(?:st(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?))|[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)|John)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["2John"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:2(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)|John|nd(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)))|II(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?))|Second[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["3John"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:3(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)|John|rd(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)))|III(?:[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)|\.[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?))|Third[\s\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["John"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(The[\\s\\xa0]*Gospel[\\s\\xa0]*(?:of[\\s\\xa0]*(?:S(?:t(?:[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|\\.[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?))|aint[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?))|J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?))|according[\\s\\xa0]*to[\\s\\xa0]*(?:S(?:t(?:[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?)|\\.[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?))|aint[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[ho]n|n)?))|J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?)))|(?:S(?:t(?:[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)|\\.[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?))|aint[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?))|Gospel[\\s\\xa0]*(?:of[\\s\\xa0]*(?:S(?:t(?:[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?)|\\.[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?))|aint[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?))|J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?))|according[\\s\\xa0]*to[\\s\\xa0]*(?:S(?:t(?:[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)|\\.[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[nm]?)|h(?:[oh]n|n)?))|aint[\\s\\xa0]*J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?))|J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[oh]n|n)?)))|J(?:phn|n|o(?:phn|nh|on|h[mn]?)|h(?:[ho]n|n)?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Acts"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")((?:The[\\s\\xa0]*Acts[\\s\\xa0]*of[\\s\\xa0]*the[\\s\\xa0]*Apostles|Ac(?:t(?:s(?:ss?|[\\s\\xa0]*of[\\s\\xa0]*the[\\s\\xa0]*Apostles)?)?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Rom"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(R(?:pmans|m(?:ns?|s)?|o(?:amns|s|m(?:s|a(?:n(?:ds|s)?|sn))?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["2Cor"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:2(?:nd(?:[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ia]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?))|[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ia]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|Cor|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[ao]ns)?|[na]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?))|II(?:[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ia]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ai]ns)|ons))?|i[oa]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?))|Second[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Cor"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:First[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[oa]ns)?|[na]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|I(?:[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ai]ns)|ons))?|i[oa]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ai]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?))|1(?:st(?:[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ia]ns)|ons))?|i[ao]ns)?|[na]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ia]ns)|ons))?|i[ao]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?))|[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[oa]ns)?|[an]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)|Cor|\.[\s\xa0]*C(?:hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))|o(?:r(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[ao]s|s)?|[ai]ns)|ons))?|i[ao]ns)?|[na]thians)?|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|anthians|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains))|th(?:ians?)?)?)?)))|C(?:or(?:i(?:n(?:ith(?:i(?:nas|ans)|a(?:ns|ins))|t(?:h(?:a(?:i(?:ns|ans)|ns)|o(?:ians|ans)|i(?:ians|n(?:as|s)|a(?:n(?:[oa]s|s)?|[ia]ns)|ons))|i[oa]ns)|[na]thians)|th(?:oans|a(?:ns|ins)|i(?:ians|ns|ans))|inthi(?:ians|ans))|n(?:i(?:nth(?:ians|a(?:ns|ins))|th(?:ians|a(?:i(?:ns|ans)|ns)))|th(?:ains|i(?:ians|ns|ans)))|ri(?:th(?:ians|ains)|nth(?:ians|ains)))|hor(?:anthians|nthians|i(?:nth(?:i(?:ns|ans)|ains)|thians))))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Gal"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(G(?:a(?:l(?:a(?:t(?:o(?:ns|ans)|ns|a(?:ns|s|i(?:ns|[oa]ns)|[ao]ns)|i(?:o(?:n(?:[an]s|s)|s|ans)|a(?:n(?:[ai]s|s)?|s|[ia]ns)|n(?:a(?:ns|s)|s)|i(?:ns|[ao]ns)))?)?|lati(?:ns|[ao]ns))?)?|l))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Eph"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(E(?:sphesians|p(?:e(?:hesians|sians)|h(?:e(?:s(?:ains?|i(?:an[ds]?|ons))?)?|s(?:ians?)?|isians?)?)?|hp(?:[ei]sians)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Phil"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ph(?:l(?:pp?|ip(?:ians|p(?:ians)?)?)|p|i(?:l(?:p(?:eans|i(?:ns|ans?)|a(?:n|ins)|p(?:pians|i(?:ians|ans?))?)?|l(?:l(?:ip(?:pians|i(?:ians|ans?))|p(?:ians|pians))|p(?:pians?|i(?:ans?|ens)|ans)|i(?:p(?:a(?:i(?:ns?|ans)|ns?)|i(?:ians|e(?:ns|ans)|ns|a(?:ns?|[ia]ns))|p(?:pians|a(?:ns|ins)|i(?:[ie]ans|a(?:ns?|ins)|ns)|eans?)|eans?)?)?)|i(?:p(?:a(?:i(?:ns?|ans)|ns?)|e(?:ns|ans)|i(?:ians|ns|ans?|ens)|p(?:a(?:i(?:ns|ans)|ns?)|i(?:ians|ns?|a(?:ns?|[ia]ns)|ens)|pians?|eans?)?)?)?)?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Col"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(C(?:al(?:l(?:asi[oa]ns|os(?:sians|i[oa]ns))|[ao]s(?:si(?:[ao]ns|i[oa]ns)))|o(?:l(?:os(?:s(?:i(?:ans?|ons)|ans)?|i[oa]ns)|l[oa]si(?:[oa]ns)|as(?:si[oa]ns|i[oa]ns))?)?)|Cal[ao]si(?:[oa]ns))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["2Thess"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:II(?:[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[ao](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[ao](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?)|2(?:nd(?:[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[ao](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?)|[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|Thess)|Second[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Thess"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:I(?:[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[ao](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?)|1(?:[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[ao](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|Thess|st(?:[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?|\.[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ic]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ae]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?))|First[\s\xa0]*Th(?:s(?:ss?)?|es(?:elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)|s(?:al(?:on(?:eans|a(?:i(?:ns?|ans)|ns)|o(?:ians|ans)|i(?:(?:[oa](?:ns?|ans))|ns|ions|ens|c(?:i[ea]ns|ans))|ciens)|lonians)|elon(?:ains|ians?)|oloni(?:ns|ans?)|s)?)?)?)|Thes(?:s(?:elon(?:ains|ians?)|oloni(?:ns|ans?)|al(?:lonians|on(?:eans|a(?:i(?:ns?|ans)|ns)|i(?:(?:[ao](?:ns?|ans))|ns|ions|c(?:i[ea]ns|ans))|o(?:ians|ans)|ciens)))|elon(?:ains|ians?)|olonians?|al(?:oni(?:[ci]ans|ns|ans?|ons)|lonians)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["2Tim"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:II(?:[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m))|2(?:Tim|[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|nd(?:[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m))|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m))|Second[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Tim"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:1(?:Tim|[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|st(?:[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)))|I(?:[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m)|\.[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m))|First[\s\xa0]*T(?:omothy|i(?:m(?:ot(?:hy?|y))?)?|himot(?:hy|y)|m))|Timothy?)(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Titus"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ti(?:t(?:us)?)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Phlm"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ph(?:ile(?:m(?:on)?)?|mn?|l(?:[ei]mon|mn?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Heb"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(H(?:brew(?:ws|s)|w(?:brew(?:ws|s)|(?:[we]brew(?:ws|s)))|e(?:b(?:e(?:rws|w[ewr]s)|r(?:e(?:s|w(?:ws|s)?)|rws|w(?:es|s)|s)|w(?:ers|res))?|(?:[we]brew(?:ws|s)))))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Jas"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:a(?:m(?:es?)?|s)?|ms?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["2Pet"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:II(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?)|2(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|nd(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?)|Pet|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?)|Second[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Pet"],regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:1(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|Pet|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|st(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?))|I(?:[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?|\.[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?)|First[\s\xa0]*P(?:tr?|e(?:t(?:er?|r)?|r)?)?)|Peter)(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Jude"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:ude|de))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Tob"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(T(?:ob(?:i(?:as|t)?|t)?|b))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Jdt"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:d(?:th?|ith?)|ud(?:th?|ith?)))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Bar"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Bar(?:uch)?)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Sus"],apocrypha:!0,regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(S(?:hoshana|us(?:annah?)?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["2Macc"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:2(?:nd(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|Macc|\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*M(?:a(?:c(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)?|c))|Second[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|II(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["3Macc"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:III(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|Third[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|3(?:[\s\xa0]*M(?:ac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|c)|rd(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|Macc|\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["4Macc"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:IV(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|Fourth[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|4(?:[\s\xa0]*M(?:ac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|c)|Macc|th(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)))(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["1Macc"],apocrypha:!0,regexp:/(^|[^0-9A-Za-z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u024f\u1e00-\u1eff\u2c60-\u2c7f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua7ff])((?:First[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|I(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[es]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|1(?:st(?:\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[se]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)|Macc|\.[\s\xa0]*Mac(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[se]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[es]?|e(?:e[es]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?|[\s\xa0]*M(?:a(?:c(?:c(?:c(?:ab(?:b(?:e[es]?|be)|e(?:e[es]?|s)?))?|ab(?:e(?:e(?:es?|s)?|s)?|b(?:be[se]?|e(?:e[se]?|s)?)))?|ab(?:b(?:be(?:e[se]?|s)?|e(?:e(?:es?|s)?|s)?)|e(?:e(?:es?|s)?|s)?))?)?|c)))|Maccabees)(?:(?=[\d\s\xa0.:,;\x1e\x1f&\(\)\uff08\uff09\[\]\/"'\*=~\-\u2013\u2014])|$)/gi},
{osis:["Ezek","Ezra"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ez)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Hab","Hag"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ha)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Heb","Hab"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Hb)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["John","Jonah","Job","Josh","Joel"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Jo)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Jude","Judg"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(J(?:d|ud?))(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Matt","Mark","Mal"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ma)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)",
"gi")},{osis:["Phil","Phlm"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ph)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")},{osis:["Zeph","Zech"],regexp:RegExp("(^|"+l.prototype.regexps.pre_book+")(Ze)(?:(?=[\\d\\s\\xa0.:,;\\x1e\\x1f&\\(\\)\uff08\uff09\\[\\]/\"'\\*=~\\-\\u2013\\u2014])|$)","gi")}];if(!0===k&&"none"===b)return c;e=[];f=0;for(n=c.length;f<n;f++)if(h=c[f],null==h.apocrypha||!0!==h.apocrypha)"books"===b&&(h.regexp=RegExp(h.regexp.source,
"g")),e.push(h);return e};l.prototype.regexps.books=l.prototype.regexps.get_books(!1,"none");var na=function(){function k(b){return'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c){function e(m){a<ha||(a>ha&&(ha=a,oa=[]),oa.push(m))}function f(){var m,b,d,e,c,h,f;h=c=a;m=ia();null===m&&(m=ja(),null===m&&(m=s(),
null===m&&(m=U(),null===m&&(m=V(),null===m&&(m=C(),null===m&&(m=L(),null===m&&(m=D(),null===m&&(m=J(),null===m&&(m=E(),null===m&&(m=r(),null===m&&(m=W(),null===m&&(m=M(),null===m&&(m=t(),null===m&&(m=N(),null===m&&(m=w(),null===m&&(m=X(),null===m&&(m=Y(),null===m&&(m=O(),null===m&&(m=P())))))))))))))))))));if(null!==m){f=a;d=y();d=null!==d?d:"";null!==d?(e=q(),null!==e?d=[d,e]:(d=null,a=f)):(d=null,a=f);if(null!==d)for(b=[];null!==d;)b.push(d),f=a,d=y(),d=null!==d?d:"",null!==d?(e=q(),null!==e?d=
[d,e]:(d=null,a=f)):(d=null,a=f);else b=null;null!==b?m=[m,b]:(m=null,a=h)}else m=null,a=h;null!==m&&(b=m[1],b.unshift([m[0]]),m={type:"sequence",value:b,indices:[c,a-1]});null===m&&(a=c);return m}function l(){var m,g,d,c,f,v,k,n,Q,ca;Q=n=a;40===b.charCodeAt(a)?(m="(",a++):(m=null,0===p&&e('"("'));if(null!==m)if(g=u(),null!==g)if(d=y(),d=null!==d?d:"",null!==d)if(c=q(),null!==c){f=[];ca=a;v=y();v=null!==v?v:"";null!==v?(k=q(),null!==k?v=[v,k]:(v=null,a=ca)):(v=null,a=ca);for(;null!==v;)f.push(v),
ca=a,v=y(),v=null!==v?v:"",null!==v?(k=q(),null!==k?v=[v,k]:(v=null,a=ca)):(v=null,a=ca);null!==f?(v=u(),null!==v?(41===b.charCodeAt(a)?(k=")",a++):(k=null,0===p&&e('")"')),null!==k?m=[m,g,d,c,f,v,k]:(m=null,a=Q)):(m=null,a=Q)):(m=null,a=Q)}else m=null,a=Q;else m=null,a=Q;else m=null,a=Q;else m=null,a=Q;null!==m&&(g=m[4],"undefined"===typeof g&&(g=[]),g.unshift([m[3]]),m={type:"sequence_post_enclosed",value:g,indices:[n,a-1]});null===m&&(a=n);return m}function q(){var a;a=l();null===a&&(a=ia(),null===
a&&(a=ja(),null===a&&(a=s(),null===a&&(a=U(),null===a&&(a=V(),null===a&&(a=C(),null===a&&(a=L(),null===a&&(a=D(),null===a&&(a=J(),null===a&&(a=E(),null===a&&(a=r(),null===a&&(a=W(),null===a&&(a=M(),null===a&&(a=t(),null===a&&(a=N(),null===a&&(a=w(),null===a&&(a=X(),null===a&&(a=Y(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=da(),null===a&&(a=ea(),null===a&&(a=Z(),null===a&&(a=$(),null===a&&(a=F(),null===a&&(a=G(),null===a&&(a=z(),null===a&&(a=x()))))))))))))))))))))))))))));return a}function s(){var m,
b,d,e,c;c=e=a;m=V();null===m&&(m=C(),null===m&&(m=L(),null===m&&(m=D(),null===m&&(m=J(),null===m&&(m=E(),null===m&&(m=r(),null===m&&(m=W(),null===m&&(m=M(),null===m&&(m=X(),null===m&&(m=Y(),null===m&&(m=N(),null===m&&(m=O(),null===m&&(m=P(),null===m&&(m=da(),null===m&&(m=ea(),null===m&&(m=Z(),null===m&&(m=$(),null===m&&(m=F(),null===m&&(m=G(),null===m&&(m=z(),null===m&&(m=x())))))))))))))))))))));null!==m?(b=R(),null!==b?(d=U(),null===d&&(d=V(),null===d&&(d=C(),null===d&&(d=L(),null===d&&(d=D(),null===
d&&(d=J(),null===d&&(d=E(),null===d&&(d=r(),null===d&&(d=W(),null===d&&(d=M(),null===d&&(d=X(),null===d&&(d=Y(),null===d&&(d=N(),null===d&&(d=O(),null===d&&(d=P(),null===d&&(d=da(),null===d&&(d=ea(),null===d&&(d=Z(),null===d&&(d=F(),null===d&&(d=G(),null===d&&(d=$(),null===d&&(d=z(),null===d&&(d=x())))))))))))))))))))))),null!==d?m=[m,b,d]:(m=null,a=c)):(m=null,a=c)):(m=null,a=c);null!==m&&(m={type:"range",value:[m[0],m[2]],indices:[e,a-1]});null===m&&(a=e);return m}function w(){var m,g,d,c,f,v,k;
v=f=a;31===b.charCodeAt(a)?(m="\u001f",a++):(m=null,0===p&&e('"\\x1F"'));null!==m?(g=ka(),null!==g?(k=a,47===b.charCodeAt(a)?(d="/",a++):(d=null,0===p&&e('"/"')),null!==d?(/^[a-z]/.test(b.charAt(a))?(c=b.charAt(a),a++):(c=null,0===p&&e("[a-z]")),null!==c?d=[d,c]:(d=null,a=k)):(d=null,a=k),d=null!==d?d:"",null!==d?(31===b.charCodeAt(a)?(c="\u001f",a++):(c=null,0===p&&e('"\\x1F"')),null!==c?m=[m,g,d,c]:(m=null,a=v)):(m=null,a=v)):(m=null,a=v)):(m=null,a=v);null!==m&&(m={type:"b",value:m[1].value,indices:[f,
a-1]});null===m&&(a=f);return m}function t(){var m,b,d,e,c,h;h=c=a;m=w();null!==m?(b=R(),null!==b?(e=a,p++,d=s(),null===d&&(d=U(),null===d&&(d=L(),null===d&&(d=D(),null===d&&(d=J(),null===d&&(d=E(),null===d&&(d=r(),null===d&&(d=M()))))))),p--,null===d?d="":(d=null,a=e),null!==d?(e=w(),null!==e?m=[m,b,d,e]:(m=null,a=h)):(m=null,a=h)):(m=null,a=h)):(m=null,a=h);null!==m&&(m={type:"b_range",value:[m[0],m[3]],indices:[c,a-1]});null===m&&(a=c);return m}function r(){var b,g,d,e,c,h,f,k,l,n;f=h=a;b=w();
if(null!==b){k=a;g=H();null!==g?(l=a,p++,n=a,d=z(),null!==d?(e=B(),null!==e?(c=x(),null!==c?d=[d,e,c]:(d=null,a=n)):(d=null,a=n)):(d=null,a=n),p--,null!==d?(d="",a=l):d=null,null!==d?g=[g,d]:(g=null,a=k)):(g=null,a=k);if(null===g){d=B();if(null!==d)for(g=[];null!==d;)g.push(d),d=B();else g=null;if(null===g){d=aa();if(null!==d)for(g=[];null!==d;)g.push(d),d=aa();else g=null;if(null===g){d=R();if(null!==d)for(g=[];null!==d;)g.push(d),d=R();else g=null;null===g&&(g=u())}}}null!==g?(d=z(),null!==d?b=
[b,g,d]:(b=null,a=f)):(b=null,a=f)}else b=null,a=f;null!==b&&(b={type:"bc",value:[b[0],b[2]],indices:[h,a-1]});null===b&&(a=h);return b}function I(){var m,g,d,c,f,v,k;k=v=a;m=w();null!==m?(g=u(),null!==g?(44===b.charCodeAt(a)?(d=",",a++):(d=null,0===p&&e('","')),null!==d?(c=u(),null!==c?(f=z(),null!==f?m=[m,g,d,c,f]:(m=null,a=k)):(m=null,a=k)):(m=null,a=k)):(m=null,a=k)):(m=null,a=k);null!==m&&(m={type:"bc",value:[m[0],m[4]],indices:[v,a-1]});null===m&&(a=v);return m}function C(){var b,g,d,e;e=d=
a;b=E();null===b&&(b=r());null!==b?(g=pa(),null!==g?b=[b,g]:(b=null,a=e)):(b=null,a=e);null!==b&&(b={type:"bc_title",value:[b[0],b[1]],indices:[d,a-1]});null===b&&(a=d);return b}function D(){var m,g,d,c,f,k,l,n;k=f=a;m=E();null===m&&(m=r());null!==m?(l=a,p++,n=a,46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(d=H(),null!==d?(c=x(),null!==c?g=[g,d,c]:(g=null,a=n)):(g=null,a=n)):(g=null,a=n),p--,null===g?g="":(g=null,a=l),null!==g?(l=a,d=B(),null===d&&(d=y()),d=null!==d?d:"",null!==
d?(c=H(),null!==c?d=[d,c]:(d=null,a=l)):(d=null,a=l),null===d&&(d=B()),null!==d?(c=F(),null===c&&(c=x()),null!==c?m=[m,g,d,c]:(m=null,a=k)):(m=null,a=k)):(m=null,a=k)):(m=null,a=k);null!==m&&(m={type:"bcv",value:[m[0],m[3]],indices:[f,a-1]});null===m&&(a=f);return m}function J(){var b,g,d,e,c,h,f,k,l;f=h=a;b=E();null===b&&(b=r());null!==b?(g=aa(),null!==g?(d=F(),null===d&&(d=x()),null!==d?(k=a,p++,l=a,e=B(),null!==e?(c=x(),null!==c?e=[e,c]:(e=null,a=l)):(e=null,a=l),p--,null===e?e="":(e=null,a=k),
null!==e?b=[b,g,d,e]:(b=null,a=f)):(b=null,a=f)):(b=null,a=f)):(b=null,a=f);null!==b&&(b={type:"bcv",value:[b[0],b[2]],indices:[h,a-1]});null===b&&(a=h);return b}function V(){var m,g,d,c,f,k,l,n,q,s,r;q=n=a;m=I();null!==m?(g=u(),null!==g?(44===b.charCodeAt(a)?(d=",",a++):(d=null,0===p&&e('","')),null!==d?(c=u(),null!==c?(f=F(),null===f&&(f=x()),null!==f?(s=a,p++,r=a,k=B(),null!==k?(l=x(),null!==l?k=[k,l]:(k=null,a=r)):(k=null,a=r),p--,null===k?k="":(k=null,a=s),null!==k?m=[m,g,d,c,f,k]:(m=null,a=
q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q);null!==m&&(m={type:"bcv",value:[m[0],m[4]],indices:[n,a-1]});null===m&&(a=n);return m}function ja(){var m,g,d,c,f,k,l,n,q;q=n=a;m=w();null!==m?(45===b.charCodeAt(a)?(g="-",a++):(g=null,0===p&&e('"-"')),null===g&&(g=S()),g=null!==g?g:"",null!==g?(d=z(),null!==d?(45===b.charCodeAt(a)?(c="-",a++):(c=null,0===p&&e('"-"')),null!==c?(f=x(),null!==f?(45===b.charCodeAt(a)?(k="-",a++):(k=null,0===p&&e('"-"')),null!==k?(l=x(),null!==l?
m=[m,g,d,c,f,k,l]:(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q)):(m=null,a=q);null!==m&&(m={type:"range",value:[{type:"bcv",value:[{type:"bc",value:[m[0],m[2]],indices:[m[0].indices[0],m[2].indices[1]]},m[4]],indices:[m[0].indices[0],m[4].indices[1]]},m[6]],indices:[n,a-1]});null===m&&(a=n);return m}function M(){var b,g,d,e,c,h,f;c=e=a;b=w();if(null!==b){d=B();if(null!==d)for(g=[];null!==d;)g.push(d),d=B();else g=null;if(null===g){d=aa();if(null!==d)for(g=[];null!==
d;)g.push(d),d=aa();else g=null;if(null===g){d=R();if(null!==d)for(g=[];null!==d;)g.push(d),d=R();else g=null;if(null===g){h=a;d=y();if(null!==d)for(g=[];null!==d;)g.push(d),d=y();else g=null;null!==g?(f=a,p++,d=H(),p--,null!==d?(d="",a=f):d=null,null!==d?g=[g,d]:(g=null,a=h)):(g=null,a=h);null===g&&(g=u())}}}null!==g?(d=F(),null===d&&(d=x()),null!==d?b=[b,g,d]:(b=null,a=c)):(b=null,a=c)}else b=null,a=c;null!==b&&(b={type:"bv",value:[b[0],b[2]],indices:[e,a-1]});null===b&&(a=e);return b}function O(){var b,
g,d,e,c,h;h=c=a;b=fa();null!==b?(g=z(),null!==g?(d=ma(),d=null!==d?d:"",null!==d?(e=w(),null!==e?b=[b,g,d,e]:(b=null,a=h)):(b=null,a=h)):(b=null,a=h)):(b=null,a=h);null!==b&&(b={type:"bc",value:[b[3],b[1]],indices:[c,a-1]});null===b&&(a=c);return b}function ia(){var b,g,d,e,c,h,f,k;k=f=a;b=fa();null!==b?(g=z(),null!==g?(d=R(),null!==d?(e=z(),null!==e?(c=ma(),c=null!==c?c:"",null!==c?(h=w(),null!==h?b=[b,g,d,e,c,h]:(b=null,a=k)):(b=null,a=k)):(b=null,a=k)):(b=null,a=k)):(b=null,a=k)):(b=null,a=k);
null!==b&&(b={type:"cb_range",value:[b[5],b[1],b[3]],indices:[f,a-1]});null===b&&(a=f);return b}function X(){var b,g,d,e,c,h;h=c=a;b=O();null!==b?(g=y(),g=null!==g?g:"",null!==g?(d=H(),null!==d?(e=x(),null!==e?b=[b,g,d,e]:(b=null,a=h)):(b=null,a=h)):(b=null,a=h)):(b=null,a=h);null!==b&&(b={type:"bcv",value:[b[0],b[3]],indices:[c,a-1]});null===b&&(a=c);return b}function P(){var m,g,d,c,f,k,l;l=k=a;m=z();null!==m?("th"===b.substr(a,2)?(g="th",a+=2):(g=null,0===p&&e('"th"')),null===g&&("nd"===b.substr(a,
2)?(g="nd",a+=2):(g=null,0===p&&e('"nd"')),null===g&&("st"===b.substr(a,2)?(g="st",a+=2):(g=null,0===p&&e('"st"')))),null!==g?(d=fa(),null!==d?(c=ma(),c=null!==c?c:"",null!==c?(f=w(),null!==f?m=[m,g,d,c,f]:(m=null,a=l)):(m=null,a=l)):(m=null,a=l)):(m=null,a=l)):(m=null,a=l);null!==m&&(m={type:"bc",value:[m[4],m[0]],indices:[k,a-1]});null===m&&(a=k);return m}function Y(){var b,g,d,e,c,h;h=c=a;b=P();null!==b?(g=y(),g=null!==g?g:"",null!==g?(d=H(),null!==d?(e=x(),null!==e?b=[b,g,d,e]:(b=null,a=h)):(b=
null,a=h)):(b=null,a=h)):(b=null,a=h);null!==b&&(b={type:"bcv",value:[b[0],b[3]],indices:[c,a-1]});null===b&&(a=c);return b}function N(){var m,g,d,c,f;f=c=a;31===b.charCodeAt(a)?(m="\u001f",a++):(m=null,0===p&&e('"\\x1F"'));null!==m?(g=ka(),null!==g?("/1\u001f"===b.substr(a,3)?(d="/1\u001f",a+=3):(d=null,0===p&&e('"/1\\x1F"')),null!==d?m=[m,g,d]:(m=null,a=f)):(m=null,a=f)):(m=null,a=f);null!==m&&(m={type:"c_psalm",value:m[1].value,indices:[c,a-1]});null===m&&(a=c);return m}function W(){var b,g,d,
e,c,h;h=c=a;b=N();null!==b?(g=y(),g=null!==g?g:"",null!==g?(d=H(),null!==d?(e=x(),null!==e?b=[b,g,d,e]:(b=null,a=h)):(b=null,a=h)):(b=null,a=h)):(b=null,a=h);null!==b&&(b={type:"cv_psalm",value:[b[0],b[3]],indices:[c,a-1]});null===b&&(a=c);return b}function da(){var b,g,d,e,c;c=e=a;b=fa();null!==b?(g=z(),null!==g?(d=pa(),null!==d?b=[b,g,d]:(b=null,a=c)):(b=null,a=c)):(b=null,a=c);null!==b&&(b={type:"c_title",value:[b[1],b[2]],indices:[e,a-1]});null===b&&(a=e);return b}function Z(){var m,g,d,c,f,k,
l,n;k=f=a;m=z();null!==m?(l=a,p++,n=a,46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(d=H(),null!==d?(c=x(),null!==c?g=[g,d,c]:(g=null,a=n)):(g=null,a=n)):(g=null,a=n),p--,null===g?g="":(g=null,a=l),null!==g?(l=a,d=B(),d=null!==d?d:"",null!==d?(c=H(),null!==c?d=[d,c]:(d=null,a=l)):(d=null,a=l),null===d&&(d=B()),null!==d?(c=F(),null===c&&(c=x()),null!==c?m=[m,g,d,c]:(m=null,a=k)):(m=null,a=k)):(m=null,a=k)):(m=null,a=k);null!==m&&(m={type:"cv",value:[m[0],m[3]],indices:[f,a-1]});
null===m&&(a=f);return m}function $(){var b,g,d,e,c,h,f,k,l;f=h=a;b=z();null!==b?(g=aa(),null!==g?(d=F(),null===d&&(d=x()),null!==d?(k=a,p++,l=a,e=B(),null!==e?(c=x(),null!==c?e=[e,c]:(e=null,a=l)):(e=null,a=l),p--,null===e?e="":(e=null,a=k),null!==e?b=[b,g,d,e]:(b=null,a=f)):(b=null,a=f)):(b=null,a=f)):(b=null,a=f);null!==b&&(b={type:"cv",value:[b[0],b[2]],indices:[h,a-1]});null===b&&(a=h);return b}function z(){var b,g,d,e;e=d=a;b=fa();b=null!==b?b:"";null!==b?(g=G(),null!==g?b=[b,g]:(b=null,a=e)):
(b=null,a=e);null!==b&&(b={type:"c",value:[b[1]],indices:[d,a-1]});null===b&&(a=d);return b}function U(){var m,g,d,c,f,k,l,n;l=k=a;m=D();null===m&&(m=J(),null===m&&(m=r(),null===m&&(m=Z(),null===m&&(m=$(),null===m&&(m=G(),null===m&&(m=z(),null===m&&(m=x())))))));null!==m?(g=u(),null!==g?(n=a,"ff"===b.substr(a,2)?(d="ff",a+=2):(d=null,0===p&&e('"ff"')),null!==d?(f=a,p++,/^[a-z0-9]/.test(b.charAt(a))?(c=b.charAt(a),a++):(c=null,0===p&&e("[a-z0-9]")),p--,null===c?c="":(c=null,a=f),null!==c?d=[d,c]:(d=
null,a=n)):(d=null,a=n),null===d&&(n=a,102===b.charCodeAt(a)?(d="f",a++):(d=null,0===p&&e('"f"')),null!==d?(f=a,p++,/^[a-z0-9]/.test(b.charAt(a))?(c=b.charAt(a),a++):(c=null,0===p&&e("[a-z0-9]")),p--,null===c?c="":(c=null,a=f),null!==c?d=[d,c]:(d=null,a=n)):(d=null,a=n)),null!==d?(c=A(),c=null!==c?c:"",null!==c?(n=a,p++,/^[a-z]/.test(b.charAt(a))?(f=b.charAt(a),a++):(f=null,0===p&&e("[a-z]")),p--,null===f?f="":(f=null,a=n),null!==f?m=[m,g,d,c,f]:(m=null,a=l)):(m=null,a=l)):(m=null,a=l)):(m=null,a=
l)):(m=null,a=l);null!==m&&(m={type:"ff",value:[m[0]],indices:[k,a-1]});null===m&&(a=k);return m}function ea(){var m,g,d,c,f;f=c=a;m=G();null!==m?(g=B(),null===g&&(g=y()),g=null!==g?g:"",null!==g?("title"===b.substr(a,5)?(d="title",a+=5):(d=null,0===p&&e('"title"')),null!==d?m=[m,g,d]:(m=null,a=f)):(m=null,a=f)):(m=null,a=f);null!==m&&(m={type:"integer_title",value:[m[0]],indices:[c,a-1]});null===m&&(a=c);return m}function T(){var c,g,d,f,k;k=f=a;31===b.charCodeAt(a)?(c="\u001f",a++):(c=null,0===
p&&e('"\\x1F"'));null!==c?(g=ka(),null!==g?("/2\u001f"===b.substr(a,3)?(d="/2\u001f",a+=3):(d=null,0===p&&e('"/2\\x1F"')),null!==d?c=[c,g,d]:(c=null,a=k)):(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"b",value:c[1].value,indices:[f,a-1]});null===c&&(a=f);return c}function E(){var c,g,d,f,k,l;k=f=a;c=T();null!==c?(".1"===b.substr(a,2)?(g=".1",a+=2):(g=null,0===p&&e('".1"')),null!==g?(l=a,p++,/^[0-9]/.test(b.charAt(a))?(d=b.charAt(a),a++):(d=null,0===p&&e("[0-9]")),p--,null===d?d="":(d=null,a=l),null!==
d?c=[c,g,d]:(c=null,a=k)):(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"bc",value:[c[0],{type:"c",value:[{type:"integer",value:151,indices:[a-2,a-1]}],indices:[a-2,a-1]}],indices:[f,a-1]});null===c&&(a=f);return c}function L(){var c,g,d,f,k;k=f=a;c=E();null!==c?(46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(d=G(),null!==d?c=[c,g,d]:(c=null,a=k)):(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"bcv",value:[c[0],{type:"v",value:[c[2]],indices:[c[2].indices[0],c[2].indices[1]]}],
indices:[f,a-1]});null===c&&(a=f);return c}function F(){var c,g,d,f,k,l,n,q,s,r;q=n=a;c=H();c=null!==c?c:"";null!==c?(g=G(),null!==g?(d=u(),null!==d?(s=a,p++,l=a,"ff"===b.substr(a,2)?(f="ff",a+=2):(f=null,0===p&&e('"ff"')),null!==f?(r=a,p++,/^[a-z0-9]/.test(b.charAt(a))?(k=b.charAt(a),a++):(k=null,0===p&&e("[a-z0-9]")),p--,null===k?k="":(k=null,a=r),null!==k?f=[f,k]:(f=null,a=l)):(f=null,a=l),null===f&&(l=a,102===b.charCodeAt(a)?(f="f",a++):(f=null,0===p&&e('"f"')),null!==f?(r=a,p++,/^[a-z0-9]/.test(b.charAt(a))?
(k=b.charAt(a),a++):(k=null,0===p&&e("[a-z0-9]")),p--,null===k?k="":(k=null,a=r),null!==k?f=[f,k]:(f=null,a=l)):(f=null,a=l)),p--,null===f?f="":(f=null,a=s),null!==f?(/^[a-e]/.test(b.charAt(a))?(k=b.charAt(a),a++):(k=null,0===p&&e("[a-e]")),null!==k?(s=a,p++,/^[a-z]/.test(b.charAt(a))?(l=b.charAt(a),a++):(l=null,0===p&&e("[a-z]")),p--,null===l?l="":(l=null,a=s),null!==l?c=[c,g,d,f,k,l]:(c=null,a=q)):(c=null,a=q)):(c=null,a=q)):(c=null,a=q)):(c=null,a=q)):(c=null,a=q);null!==c&&(c={type:"v",value:[c[1]],
indices:[n,a-1]});null===c&&(a=n);return c}function x(){var b,g,c,e;e=c=a;b=H();b=null!==b?b:"";null!==b?(g=G(),null!==g?b=[b,g]:(b=null,a=e)):(b=null,a=e);null!==b&&(b={type:"v",value:[b[1]],indices:[c,a-1]});null===b&&(a=c);return b}function fa(){var c,g,d,f,k,l;k=f=a;c=u();null!==c?("chapters"===b.substr(a,8)?(g="chapters",a+=8):(g=null,0===p&&e('"chapters"')),null===g&&("chapter"===b.substr(a,7)?(g="chapter",a+=7):(g=null,0===p&&e('"chapter"')),null===g&&(l=a,"chapts"===b.substr(a,6)?(g="chapts",
a+=6):(g=null,0===p&&e('"chapts"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"chpts"===b.substr(a,5)?(g="chpts",a+=5):(g=null,0===p&&e('"chpts"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"chapt"===b.substr(a,5)?(g="chapt",a+=5):(g=null,0===p&&e('"chapt"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"chap"===b.substr(a,4)?(g="chap",a+=4):(g=null,0===p&&
e('"chap"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"chp"===b.substr(a,3)?(g="chp",a+=3):(g=null,0===p&&e('"chp"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"chs"===b.substr(a,3)?(g="chs",a+=3):(g=null,0===p&&e('"chs"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"cha"===b.substr(a,3)?(g="cha",a+=3):(g=null,0===p&&e('"cha"')),null!==g?(d=A(),d=null!==
d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l),null===g&&(l=a,"ch"===b.substr(a,2)?(g="ch",a+=2):(g=null,0===p&&e('"ch"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=l)):(g=null,a=l)))))))))),null!==g?(d=u(),null!==d?c=[c,g,d]:(c=null,a=k)):(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"c_explicit"});null===c&&(a=f);return c}function H(){var c,g,d,f,k,l;l=k=a;c=u();null!==c?("verses"===b.substr(a,6)?(g="verses",a+=6):(g=null,0===p&&e('"verses"')),null===g&&("verse"===b.substr(a,
5)?(g="verse",a+=5):(g=null,0===p&&e('"verse"')),null===g&&(f=a,"ver"===b.substr(a,3)?(g="ver",a+=3):(g=null,0===p&&e('"ver"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=f)):(g=null,a=f),null===g&&(f=a,"vss"===b.substr(a,3)?(g="vss",a+=3):(g=null,0===p&&e('"vss"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=f)):(g=null,a=f),null===g&&(f=a,"vs"===b.substr(a,2)?(g="vs",a+=2):(g=null,0===p&&e('"vs"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=f)):(g=
null,a=f),null===g&&(f=a,"vv"===b.substr(a,2)?(g="vv",a+=2):(g=null,0===p&&e('"vv"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=f)):(g=null,a=f),null===g&&(f=a,118===b.charCodeAt(a)?(g="v",a++):(g=null,0===p&&e('"v"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=f)):(g=null,a=f))))))),null!==g?(f=a,p++,/^[a-z]/.test(b.charAt(a))?(d=b.charAt(a),a++):(d=null,0===p&&e("[a-z]")),p--,null===d?d="":(d=null,a=f),null!==d?(f=u(),null!==f?c=[c,g,d,f]:(c=null,a=l)):(c=null,a=
l)):(c=null,a=l)):(c=null,a=l);null!==c&&(c={type:"v_explicit"});null===c&&(a=k);return c}function B(){var c,g,d,f,k,l,n,q,s,r;n=a;c=u();if(null!==c){58===b.charCodeAt(a)?(d=":",a++):(d=null,0===p&&e('":"'));if(null!==d)for(g=[];null!==d;)g.push(d),58===b.charCodeAt(a)?(d=":",a++):(d=null,0===p&&e('":"'));else g=null;null===g&&(q=a,46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(s=a,p++,r=a,d=u(),null!==d?(46===b.charCodeAt(a)?(f=".",a++):(f=null,0===p&&e('"."')),null!==f?(k=u(),
null!==k?(46===b.charCodeAt(a)?(l=".",a++):(l=null,0===p&&e('"."')),null!==l?d=[d,f,k,l]:(d=null,a=r)):(d=null,a=r)):(d=null,a=r)):(d=null,a=r),p--,null===d?d="":(d=null,a=s),null!==d?g=[g,d]:(g=null,a=q)):(g=null,a=q));null!==g?(d=u(),null!==d?c=[c,g,d]:(c=null,a=n)):(c=null,a=n)}else c=null,a=n;return c}function aa(){var c,g,d,f;f=a;c=u();null!==c?(/^["']/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[\"']")),null!==g?(d=u(),null!==d?c=[c,g,d]:(c=null,a=f)):(c=null,a=f)):(c=null,a=f);
null===c&&(c=S());return c}function y(){var c,g,d,f,k,l,n,q,s,r;n=a;/^[,;\/:&\-\u2013\u2014~]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[,;\\/:&\\-\\u2013\\u2014~]"));null===g&&(q=a,46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(s=a,p++,r=a,d=u(),null!==d?(46===b.charCodeAt(a)?(f=".",a++):(f=null,0===p&&e('"."')),null!==f?(k=u(),null!==k?(46===b.charCodeAt(a)?(l=".",a++):(l=null,0===p&&e('"."')),null!==l?d=[d,f,k,l]:(d=null,a=r)):(d=null,a=r)):(d=null,a=r)):(d=
null,a=r),p--,null===d?d="":(d=null,a=s),null!==d?g=[g,d]:(g=null,a=q)):(g=null,a=q),null===g&&("and"===b.substr(a,3)?(g="and",a+=3):(g=null,0===p&&e('"and"')),null===g&&("compare"===b.substr(a,7)?(g="compare",a+=7):(g=null,0===p&&e('"compare"')),null===g&&(q=a,"cf"===b.substr(a,2)?(g="cf",a+=2):(g=null,0===p&&e('"cf"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=q)):(g=null,a=q),null===g&&(q=a,"see"===b.substr(a,3)?(g="see",a+=3):(g=null,0===p&&e('"see"')),null!==g?(d=S(),null!==
d?("also"===b.substr(a,4)?(f="also",a+=4):(f=null,0===p&&e('"also"')),null!==f?g=[g,d,f]:(g=null,a=q)):(g=null,a=q)):(g=null,a=q),null===g&&("also"===b.substr(a,4)?(g="also",a+=4):(g=null,0===p&&e('"also"')),null===g&&("see"===b.substr(a,3)?(g="see",a+=3):(g=null,0===p&&e('"see"')),null===g&&(g=S()))))))));if(null!==g)for(c=[];null!==g;)c.push(g),/^[,;\/:&\-\u2013\u2014~]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[,;\\/:&\\-\\u2013\\u2014~]")),null===g&&(q=a,46===b.charCodeAt(a)?(g=
".",a++):(g=null,0===p&&e('"."')),null!==g?(s=a,p++,r=a,d=u(),null!==d?(46===b.charCodeAt(a)?(f=".",a++):(f=null,0===p&&e('"."')),null!==f?(k=u(),null!==k?(46===b.charCodeAt(a)?(l=".",a++):(l=null,0===p&&e('"."')),null!==l?d=[d,f,k,l]:(d=null,a=r)):(d=null,a=r)):(d=null,a=r)):(d=null,a=r),p--,null===d?d="":(d=null,a=s),null!==d?g=[g,d]:(g=null,a=q)):(g=null,a=q),null===g&&("and"===b.substr(a,3)?(g="and",a+=3):(g=null,0===p&&e('"and"')),null===g&&("compare"===b.substr(a,7)?(g="compare",a+=7):(g=null,
0===p&&e('"compare"')),null===g&&(q=a,"cf"===b.substr(a,2)?(g="cf",a+=2):(g=null,0===p&&e('"cf"')),null!==g?(d=A(),d=null!==d?d:"",null!==d?g=[g,d]:(g=null,a=q)):(g=null,a=q),null===g&&(q=a,"see"===b.substr(a,3)?(g="see",a+=3):(g=null,0===p&&e('"see"')),null!==g?(d=S(),null!==d?("also"===b.substr(a,4)?(f="also",a+=4):(f=null,0===p&&e('"also"')),null!==f?g=[g,d,f]:(g=null,a=q)):(g=null,a=q)):(g=null,a=q),null===g&&("also"===b.substr(a,4)?(g="also",a+=4):(g=null,0===p&&e('"also"')),null===g&&("see"===
b.substr(a,3)?(g="see",a+=3):(g=null,0===p&&e('"see"')),null===g&&(g=S()))))))));else c=null;null!==c&&(c="");null===c&&(a=n);return c}function R(){var c,g,d,f,k,l;k=a;c=u();if(null!==c){l=a;/^[\-\u2013\u2014]/.test(b.charAt(a))?(d=b.charAt(a),a++):(d=null,0===p&&e("[\\-\\u2013\\u2014]"));null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l);null===d&&(l=a,"through"===b.substr(a,7)?(d="through",a+=7):(d=null,0===p&&e('"through"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l),
null===d&&(l=a,"thru"===b.substr(a,4)?(d="thru",a+=4):(d=null,0===p&&e('"thru"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l),null===d&&(l=a,"to"===b.substr(a,2)?(d="to",a+=2):(d=null,0===p&&e('"to"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l))));if(null!==d)for(g=[];null!==d;)g.push(d),l=a,/^[\-\u2013\u2014]/.test(b.charAt(a))?(d=b.charAt(a),a++):(d=null,0===p&&e("[\\-\\u2013\\u2014]")),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l),null===d&&(l=a,"through"===
b.substr(a,7)?(d="through",a+=7):(d=null,0===p&&e('"through"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l),null===d&&(l=a,"thru"===b.substr(a,4)?(d="thru",a+=4):(d=null,0===p&&e('"thru"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l),null===d&&(l=a,"to"===b.substr(a,2)?(d="to",a+=2):(d=null,0===p&&e('"to"')),null!==d?(f=u(),null!==f?d=[d,f]:(d=null,a=l)):(d=null,a=l))));else g=null;null!==g?c=[c,g]:(c=null,a=k)}else c=null,a=k;return c}function pa(){var c,g,d,f;f=d=
a;c=B();null===c&&(c=y());c=null!==c?c:"";null!==c?("title"===b.substr(a,5)?(g="title",a+=5):(g=null,0===p&&e('"title"')),null!==g?c=[c,g]:(c=null,a=f)):(c=null,a=f);null!==c&&(c={type:"title",value:[c[1]],indices:[d,a-1]});null===c&&(a=d);return c}function ma(){var c,g,d,f,k,l,n,q,r,s,t;s=a;c=u();null!==c?("from"===b.substr(a,4)?(g="from",a+=4):(g=null,0===p&&e('"from"')),null===g&&("of"===b.substr(a,2)?(g="of",a+=2):(g=null,0===p&&e('"of"')),null===g&&("in"===b.substr(a,2)?(g="in",a+=2):(g=null,
0===p&&e('"in"')))),null!==g?(d=u(),null!==d?(t=a,"the"===b.substr(a,3)?(f="the",a+=3):(f=null,0===p&&e('"the"')),null!==f?(k=u(),null!==k?("book"===b.substr(a,4)?(l="book",a+=4):(l=null,0===p&&e('"book"')),null!==l?(n=u(),null!==n?("of"===b.substr(a,2)?(q="of",a+=2):(q=null,0===p&&e('"of"')),null!==q?(r=u(),null!==r?f=[f,k,l,n,q,r]:(f=null,a=t)):(f=null,a=t)):(f=null,a=t)):(f=null,a=t)):(f=null,a=t)):(f=null,a=t),f=null!==f?f:"",null!==f?c=[c,g,d,f]:(c=null,a=s)):(c=null,a=s)):(c=null,a=s)):(c=null,
a=s);return c}function A(){var c,g,d,f,k,l,n,q,r;n=a;c=u();null!==c?(46===b.charCodeAt(a)?(g=".",a++):(g=null,0===p&&e('"."')),null!==g?(q=a,p++,r=a,d=u(),null!==d?(46===b.charCodeAt(a)?(f=".",a++):(f=null,0===p&&e('"."')),null!==f?(k=u(),null!==k?(46===b.charCodeAt(a)?(l=".",a++):(l=null,0===p&&e('"."')),null!==l?d=[d,f,k,l]:(d=null,a=r)):(d=null,a=r)):(d=null,a=r)):(d=null,a=r),p--,null===d?d="":(d=null,a=q),null!==d?c=[c,g,d]:(c=null,a=n)):(c=null,a=n)):(c=null,a=n);return c}function qa(){var c,
g,d,f,k,l,n,q,r,s,t;r=q=a;c=u();if(null!==c)if(/^[([]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[([]")),null!==g)if(d=u(),null!==d){s=a;f=ba();if(null!==f){k=[];t=a;l=y();null!==l?(n=ba(),null!==n?l=[l,n]:(l=null,a=t)):(l=null,a=t);for(;null!==l;)k.push(l),t=a,l=y(),null!==l?(n=ba(),null!==n?l=[l,n]:(l=null,a=t)):(l=null,a=t);null!==k?f=[f,k]:(f=null,a=s)}else f=null,a=s;null!==f?(k=u(),null!==k?(/^[)\]]/.test(b.charAt(a))?(l=b.charAt(a),a++):(l=null,0===p&&e("[)\\]]")),null!==l?c=
[c,g,d,f,k,l]:(c=null,a=r)):(c=null,a=r)):(c=null,a=r)}else c=null,a=r;else c=null,a=r;else c=null,a=r;null!==c&&(c={type:"translation_sequence",value:c[3],indices:[q,a-1]});null===c&&(a=q);return c}function ra(){var c,g,d,f,k,l,n,q,r,s;q=n=a;c=u();if(null!==c)if(r=a,44===b.charCodeAt(a)?(g=",",a++):(g=null,0===p&&e('","')),null!==g?(d=u(),null!==d?g=[g,d]:(g=null,a=r)):(g=null,a=r),g=null!==g?g:"",null!==g){r=a;d=ba();if(null!==d){f=[];s=a;k=y();null!==k?(l=ba(),null!==l?k=[k,l]:(k=null,a=s)):(k=
null,a=s);for(;null!==k;)f.push(k),s=a,k=y(),null!==k?(l=ba(),null!==l?k=[k,l]:(k=null,a=s)):(k=null,a=s);null!==f?d=[d,f]:(d=null,a=r)}else d=null,a=r;null!==d?c=[c,g,d]:(c=null,a=q)}else c=null,a=q;else c=null,a=q;null!==c&&(c={type:"translation_sequence",value:c[2],indices:[n,a-1]});null===c&&(a=n);return c}function ba(){var c,g,d,f,k;k=f=a;30===b.charCodeAt(a)?(c="\u001e",a++):(c=null,0===p&&e('"\\x1E"'));null!==c?(g=ka(),null!==g?(30===b.charCodeAt(a)?(d="\u001e",a++):(d=null,0===p&&e('"\\x1E"')),
null!==d?c=[c,g,d]:(c=null,a=k)):(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"translation",value:c[1].value,indices:[f,a-1]});null===c&&(a=f);return c}function G(){var c,g,d,f,k,l;l=k=f=a;/^[0-9]/.test(b.charAt(a))?(c=b.charAt(a),a++):(c=null,0===p&&e("[0-9]"));null!==c?(/^[0-9]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[0-9]")),g=null!==g?g:"",null!==g?(/^[0-9]/.test(b.charAt(a))?(d=b.charAt(a),a++):(d=null,0===p&&e("[0-9]")),d=null!==d?d:"",null!==d?c=[c,g,d]:(c=null,a=l)):(c=null,
a=l)):(c=null,a=l);null!==c?(l=a,p++,/^[0-9]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[0-9]")),null===g&&(",000"===b.substr(a,4)?(g=",000",a+=4):(g=null,0===p&&e('",000"'))),p--,null===g?g="":(g=null,a=l),null!==g?c=[c,g]:(c=null,a=k)):(c=null,a=k);null!==c&&(c={type:"integer",value:parseInt(c[0].join(""),10),indices:[f,a-1]});null===c&&(a=f);return c}function ka(){var c,g,d;d=a;/^[0-9]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[0-9]"));if(null!==g)for(c=[];null!==g;)c.push(g),
/^[0-9]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[0-9]"));else c=null;null!==c&&(c={type:"integer",value:parseInt(c.join(""),10),indices:[d,a-1]});null===c&&(a=d);return c}function sa(){var c,g,d;d=a;/^[^\x1F\x1E([]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[^\\x1F\\x1E([]"));if(null!==g)for(c=[];null!==g;)c.push(g),/^[^\x1F\x1E([]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[^\\x1F\\x1E([]"));else c=null;null!==c&&(c={type:"word",value:c.join(""),indices:[d,
a-1]});null===c&&(a=d);return c}function ta(){var c,g;g=a;/^[([]/.test(b.charAt(a))?(c=b.charAt(a),a++):(c=null,0===p&&e("[([]"));null!==c&&(c={type:"stop",value:c,indices:[g,a-1]});null===c&&(a=g);return c}function u(){var b;b=S();return null!==b?b:""}function S(){var c,g;/^[\s\xa0*]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[\\s\\xa0*]"));if(null!==g)for(c=[];null!==g;)c.push(g),/^[\s\xa0*]/.test(b.charAt(a))?(g=b.charAt(a),a++):(g=null,0===p&&e("[\\s\\xa0*]"));else c=null;return c}
function la(b){b.sort();for(var a=null,c=[],e=0;e<b.length;e++)b[e]!==a&&(c.push(b[e]),a=b[e]);return c}function na(){for(var c=1,g=1,d=!1,e=0;e<Math.max(a,ha);e++){var f=b.charAt(e);"\n"===f?(d||c++,g=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(c++,g=1,d=!0):(g++,d=!1)}return{line:c,column:g}}var K={start:function(){var b,a;a=ja();null===a&&(a=f(),null===a&&(a=ia(),null===a&&(a=s(),null===a&&(a=U(),null===a&&(a=V(),null===a&&(a=C(),null===a&&(a=L(),null===a&&(a=D(),null===a&&(a=J(),null===a&&(a=
E(),null===a&&(a=r(),null===a&&(a=W(),null===a&&(a=M(),null===a&&(a=t(),null===a&&(a=N(),null===a&&(a=w(),null===a&&(a=X(),null===a&&(a=Y(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=qa(),null===a&&(a=ra(),null===a&&(a=y(),null===a&&(a=da(),null===a&&(a=ea(),null===a&&(a=Z(),null===a&&(a=$(),null===a&&(a=F(),null===a&&(a=G(),null===a&&(a=z(),null===a&&(a=x(),null===a&&(a=sa(),null===a&&(a=ta())))))))))))))))))))))))))))))))));if(null!==a)for(b=[];null!==a;)b.push(a),a=ja(),null===a&&(a=f(),null===
a&&(a=ia(),null===a&&(a=s(),null===a&&(a=U(),null===a&&(a=V(),null===a&&(a=C(),null===a&&(a=L(),null===a&&(a=D(),null===a&&(a=J(),null===a&&(a=E(),null===a&&(a=r(),null===a&&(a=W(),null===a&&(a=M(),null===a&&(a=t(),null===a&&(a=N(),null===a&&(a=w(),null===a&&(a=X(),null===a&&(a=Y(),null===a&&(a=O(),null===a&&(a=P(),null===a&&(a=qa(),null===a&&(a=ra(),null===a&&(a=y(),null===a&&(a=da(),null===a&&(a=ea(),null===a&&(a=Z(),null===a&&(a=$(),null===a&&(a=F(),null===a&&(a=G(),null===a&&(a=z(),null===a&&
(a=x(),null===a&&(a=sa(),null===a&&(a=ta())))))))))))))))))))))))))))))))));else b=null;return b},sequence:f,sequence_post_enclosed:l,sequence_post:q,range:s,b:w,b_range:t,bc:r,bc_comma:I,bc_title:C,bcv:D,bcv_weak:J,bcv_comma:V,bcv_hyphen_range:ja,bv:M,cb:O,cb_range:ia,cbv:X,cb_ordinal:P,cbv_ordinal:Y,c_psalm:N,cv_psalm:W,c_title:da,cv:Z,cv_weak:$,c:z,ff:U,integer_title:ea,ps151_b:T,ps151_bc:E,ps151_bcv:L,v_letter:F,v:x,c_explicit:fa,v_explicit:H,cv_sep:B,cv_sep_weak:aa,sequence_sep:y,range_sep:R,
title:pa,in_book_of:ma,abbrev:A,translation_sequence_enclosed:qa,translation_sequence:ra,translation:ba,integer:G,any_integer:ka,word:sa,word_parenthesis:ta,sp:u,space:S};if(void 0!==c){if(void 0===K[c])throw Error("Invalid rule name: "+k(c)+".");}else c="start";var a=0,p=0,ha=0,oa=[],K=K[c]();if(null===K||a!==b.length){var K=Math.max(a,ha),va=K<b.length?b.charAt(K):null,ua=na();throw new this.SyntaxError(la(oa),va,K,ua.line,ua.column);}return K},toSource:function(){return this._source},SyntaxError:function(b,
c,e,f,l){this.name="SyntaxError";this.expected=b;this.found=c;switch(b.length){case 0:b="end of input";break;case 1:b=b[0];break;default:b=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}c=c?k(c):"end of input";this.message="Expected "+b+" but "+c+" found.";this.offset=e;this.line=f;this.column=l}};b.SyntaxError.prototype=Error.prototype;return b}()}).call(this);
define("bcv", (function (global) {
    return function () {
        var ret, fn;
       fn = function () {
                return new this.bcv_parser();
            };
        ret = fn.apply(global, arguments);
        return ret || global.bcv_parser;
    };
}(this)));

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('verseKey',["bcv", "versificationMgr"], function (bcv, versificationMgr) {
    function parseVkey(inVKey, inV11n) {
        var key = {};
        key.osisRef = bcv.parse(inVKey).osis();
        if (key.osisRef === "") {
            //bcv.parse().osis() returns "" for passages it cannot resolve
            key.osisRef = "Matt.1"; //bcv.parse(inVKey + " 1").osis();
        }
        var split = key.osisRef.split("-")[0].split(".");

        key.book = split[0];
        key.chapter = (isNaN(parseInt(split[1], 10))) ? 1 : parseInt(split[1], 10);
        key.verse = parseInt(split[2], 10);
        key.bookNum = versificationMgr.getBookNum(key.book, inV11n);
        //console.log(key, key.osisRef, split);
        return key;
    }

    function parseVerseList(inVKey, inV11n) {
        var verseList = [],
            key = inVKey;
        if (typeof inVKey === "string")
            key = parseVkey(inVKey);

        //Check if we have a passage range like John.3.10-John.3.16 or Gen.3-Gen.4
        if (key.osisRef.search("-") !== -1) {
            var singlePassages = key.osisRef.split("-"),
                start = singlePassages[0].split("."),
                end = singlePassages[1].split(".");

            if(!isNaN(key.verse) && end.length === 3) {
                for (var z=key.verse;z<parseInt(end[2], 10)+1; z++) {
                    verseList.push({osis: key.book+"."+key.chapter+"."+(z), book: key.book, bookNum: bookNum, chapter: key.chapter, verse: z});
                }
            }
        //check if we have a passage like Mt 3 or Ps 123
        } else if (isNaN(key.verse)) {
            var bookNum = versificationMgr.getBookNum(key.book);
            var verseMax = versificationMgr.getVersesInChapter(bookNum, key.chapter, inV11n);
            for (var i=0;i<verseMax; i++) {
                verseList.push({osis: key.book+"."+key.chapter+"."+(i+1), book: key.book, bookNum: bookNum, chapter: key.chapter, verse: i+1});
            }
        } else {
            verseList.push(key);
        }

        return verseList;
    }

    function next(inVKey, inV11n) {
        var key = parseVkey(inVKey, inV11n),
            maxChapter = versificationMgr.getChapterMax(key.bookNum, inV11n);

        if (key.chapter < maxChapter) {
            key.chapter++;
        } else {
            key.bookNum = (key.bookNum < 65) ? ++key.bookNum : 65;
            key.chapter = (key.bookNum < 65) ? 1 : maxChapter;
            key.book = versificationMgr.getBook(key.bookNum, inV11n).abbrev;
        }
        key.osisRef = key.book+"."+key.chapter;

        return key;
    }

    function previous(inVKey, inV11n) {
        var key = parseVkey(inVKey, inV11n),
            maxChapter = versificationMgr.getChapterMax(key.bookNum-1, inV11n);

        if (key.chapter > 1) {
            --key.chapter;
        } else {
            key.bookNum = (key.bookNum > 0) ? --key.bookNum : 0;
            key.chapter = (key.bookNum === 0) ? 1 : maxChapter;
            key.book = versificationMgr.getBook(key.bookNum, inV11n).abbrev;
        }
        key.osisRef = key.book+"."+key.chapter;

        return key;
    }

    return {
        parse: parseVkey,
        parseVerseList: parseVerseList,
        next: next,
        previous: previous
    };
});
// wrapper for non-node envs
;(function (sax) {

sax.parser = function (strict, opt) { return new SAXParser(strict, opt) }
sax.SAXParser = SAXParser
sax.SAXStream = SAXStream
sax.createStream = createStream

// When we pass the MAX_BUFFER_LENGTH position, start checking for buffer overruns.
// When we check, schedule the next check for MAX_BUFFER_LENGTH - (max(buffer lengths)),
// since that's the earliest that a buffer overrun could occur.  This way, checks are
// as rare as required, but as often as necessary to ensure never crossing this bound.
// Furthermore, buffers are only tested at most once per write(), so passing a very
// large string into write() might have undesirable effects, but this is manageable by
// the caller, so it is assumed to be safe.  Thus, a call to write() may, in the extreme
// edge case, result in creating at most one complete copy of the string passed in.
// Set to Infinity to have unlimited buffers.
sax.MAX_BUFFER_LENGTH = 64 * 1024

var buffers = [
  "comment", "sgmlDecl", "textNode", "tagName", "doctype",
  "procInstName", "procInstBody", "entity", "attribName",
  "attribValue", "cdata", "script"
]

sax.EVENTS = // for discoverability.
  [ "text"
  , "processinginstruction"
  , "sgmldeclaration"
  , "doctype"
  , "comment"
  , "attribute"
  , "opentag"
  , "closetag"
  , "opencdata"
  , "cdata"
  , "closecdata"
  , "error"
  , "end"
  , "ready"
  , "script"
  , "opennamespace"
  , "closenamespace"
  ]

function SAXParser (strict, opt) {
  if (!(this instanceof SAXParser)) return new SAXParser(strict, opt)

  var parser = this
  clearBuffers(parser)
  parser.q = parser.c = ""
  parser.bufferCheckPosition = sax.MAX_BUFFER_LENGTH
  parser.opt = opt || {}
  parser.opt.lowercase = parser.opt.lowercase || parser.opt.lowercasetags
  parser.looseCase = parser.opt.lowercase ? "toLowerCase" : "toUpperCase"
  parser.tags = []
  parser.closed = parser.closedRoot = parser.sawRoot = false
  parser.tag = parser.error = null
  parser.strict = !!strict
  parser.noscript = !!(strict || parser.opt.noscript)
  parser.state = S.BEGIN
  parser.ENTITIES = Object.create(sax.ENTITIES)
  parser.attribList = []

  // namespaces form a prototype chain.
  // it always points at the current tag,
  // which protos to its parent tag.
  if (parser.opt.xmlns) parser.ns = Object.create(rootNS)

  // mostly just for error reporting
  parser.trackPosition = parser.opt.position !== false
  if (parser.trackPosition) {
    parser.position = parser.line = parser.column = 0
  }
  emit(parser, "onready")
}

if (!Object.create) Object.create = function (o) {
  function f () { this.__proto__ = o }
  f.prototype = o
  return new f
}

if (!Object.getPrototypeOf) Object.getPrototypeOf = function (o) {
  return o.__proto__
}

if (!Object.keys) Object.keys = function (o) {
  var a = []
  for (var i in o) if (o.hasOwnProperty(i)) a.push(i)
  return a
}

function checkBufferLength (parser) {
  var maxAllowed = Math.max(sax.MAX_BUFFER_LENGTH, 10)
    , maxActual = 0
  for (var i = 0, l = buffers.length; i < l; i ++) {
    var len = parser[buffers[i]].length
    if (len > maxAllowed) {
      // Text/cdata nodes can get big, and since they're buffered,
      // we can get here under normal conditions.
      // Avoid issues by emitting the text node now,
      // so at least it won't get any bigger.
      switch (buffers[i]) {
        case "textNode":
          closeText(parser)
        break

        case "cdata":
          emitNode(parser, "oncdata", parser.cdata)
          parser.cdata = ""
        break

        case "script":
          emitNode(parser, "onscript", parser.script)
          parser.script = ""
        break

        default:
          error(parser, "Max buffer length exceeded: "+buffers[i])
      }
    }
    maxActual = Math.max(maxActual, len)
  }
  // schedule the next check for the earliest possible buffer overrun.
  parser.bufferCheckPosition = (sax.MAX_BUFFER_LENGTH - maxActual)
                             + parser.position
}

function clearBuffers (parser) {
  for (var i = 0, l = buffers.length; i < l; i ++) {
    parser[buffers[i]] = ""
  }
}

function flushBuffers (parser) {
  closeText(parser)
  if (parser.cdata !== "") {
    emitNode(parser, "oncdata", parser.cdata)
    parser.cdata = ""
  }
  if (parser.script !== "") {
    emitNode(parser, "onscript", parser.script)
    parser.script = ""
  }
}

SAXParser.prototype =
  { end: function () { end(this) }
  , write: write
  , resume: function () { this.error = null; return this }
  , close: function () { return this.write(null) }
  , flush: function () { flushBuffers(this) }
  }

try {
  var Stream = require("stream").Stream
} catch (ex) {
  var Stream = function () {}
}


var streamWraps = sax.EVENTS.filter(function (ev) {
  return ev !== "error" && ev !== "end"
})

function createStream (strict, opt) {
  return new SAXStream(strict, opt)
}

function SAXStream (strict, opt) {
  if (!(this instanceof SAXStream)) return new SAXStream(strict, opt)

  Stream.apply(this)

  this._parser = new SAXParser(strict, opt)
  this.writable = true
  this.readable = true


  var me = this

  this._parser.onend = function () {
    me.emit("end")
  }

  this._parser.onerror = function (er) {
    me.emit("error", er)

    // if didn't throw, then means error was handled.
    // go ahead and clear error, so we can write again.
    me._parser.error = null
  }

  this._decoder = null;

  streamWraps.forEach(function (ev) {
    Object.defineProperty(me, "on" + ev, {
      get: function () { return me._parser["on" + ev] },
      set: function (h) {
        if (!h) {
          me.removeAllListeners(ev)
          return me._parser["on"+ev] = h
        }
        me.on(ev, h)
      },
      enumerable: true,
      configurable: false
    })
  })
}

SAXStream.prototype = Object.create(Stream.prototype,
  { constructor: { value: SAXStream } })

SAXStream.prototype.write = function (data) {
  if (typeof Buffer === 'function' &&
      typeof Buffer.isBuffer === 'function' &&
      Buffer.isBuffer(data)) {
    if (!this._decoder) {
      var SD = require('string_decoder').StringDecoder
      this._decoder = new SD('utf8')
    }
    data = this._decoder.write(data);
  }

  this._parser.write(data.toString())
  this.emit("data", data)
  return true
}

SAXStream.prototype.end = function (chunk) {
  if (chunk && chunk.length) this.write(chunk)
  this._parser.end()
  return true
}

SAXStream.prototype.on = function (ev, handler) {
  var me = this
  if (!me._parser["on"+ev] && streamWraps.indexOf(ev) !== -1) {
    me._parser["on"+ev] = function () {
      var args = arguments.length === 1 ? [arguments[0]]
               : Array.apply(null, arguments)
      args.splice(0, 0, ev)
      me.emit.apply(me, args)
    }
  }

  return Stream.prototype.on.call(me, ev, handler)
}



// character classes and tokens
var whitespace = "\r\n\t "
  // this really needs to be replaced with character classes.
  // XML allows all manner of ridiculous numbers and digits.
  , number = "0124356789"
  , letter = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
  // (Letter | "_" | ":")
  , quote = "'\""
  , entity = number+letter+"#"
  , attribEnd = whitespace + ">"
  , CDATA = "[CDATA["
  , DOCTYPE = "DOCTYPE"
  , XML_NAMESPACE = "http://www.w3.org/XML/1998/namespace"
  , XMLNS_NAMESPACE = "http://www.w3.org/2000/xmlns/"
  , rootNS = { xml: XML_NAMESPACE, xmlns: XMLNS_NAMESPACE }

// turn all the string character sets into character class objects.
whitespace = charClass(whitespace)
number = charClass(number)
letter = charClass(letter)

// http://www.w3.org/TR/REC-xml/#NT-NameStartChar
// This implementation works on strings, a single character at a time
// as such, it cannot ever support astral-plane characters (10000-EFFFF)
// without a significant breaking change to either this  parser, or the
// JavaScript language.  Implementation of an emoji-capable xml parser
// is left as an exercise for the reader.
var nameStart = /[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/

var nameBody = /[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/

quote = charClass(quote)
entity = charClass(entity)
attribEnd = charClass(attribEnd)

function charClass (str) {
  return str.split("").reduce(function (s, c) {
    s[c] = true
    return s
  }, {})
}

function isRegExp (c) {
  return Object.prototype.toString.call(c) === '[object RegExp]'
}

function is (charclass, c) {
  return isRegExp(charclass) ? !!c.match(charclass) : charclass[c]
}

function not (charclass, c) {
  return !is(charclass, c)
}

var S = 0
sax.STATE =
{ BEGIN                     : S++
, TEXT                      : S++ // general stuff
, TEXT_ENTITY               : S++ // &amp and such.
, OPEN_WAKA                 : S++ // <
, SGML_DECL                 : S++ // <!BLARG
, SGML_DECL_QUOTED          : S++ // <!BLARG foo "bar
, DOCTYPE                   : S++ // <!DOCTYPE
, DOCTYPE_QUOTED            : S++ // <!DOCTYPE "//blah
, DOCTYPE_DTD               : S++ // <!DOCTYPE "//blah" [ ...
, DOCTYPE_DTD_QUOTED        : S++ // <!DOCTYPE "//blah" [ "foo
, COMMENT_STARTING          : S++ // <!-
, COMMENT                   : S++ // <!--
, COMMENT_ENDING            : S++ // <!-- blah -
, COMMENT_ENDED             : S++ // <!-- blah --
, CDATA                     : S++ // <![CDATA[ something
, CDATA_ENDING              : S++ // ]
, CDATA_ENDING_2            : S++ // ]]
, PROC_INST                 : S++ // <?hi
, PROC_INST_BODY            : S++ // <?hi there
, PROC_INST_ENDING          : S++ // <?hi "there" ?
, OPEN_TAG                  : S++ // <strong
, OPEN_TAG_SLASH            : S++ // <strong /
, ATTRIB                    : S++ // <a
, ATTRIB_NAME               : S++ // <a foo
, ATTRIB_NAME_SAW_WHITE     : S++ // <a foo _
, ATTRIB_VALUE              : S++ // <a foo=
, ATTRIB_VALUE_QUOTED       : S++ // <a foo="bar
, ATTRIB_VALUE_CLOSED       : S++ // <a foo="bar"
, ATTRIB_VALUE_UNQUOTED     : S++ // <a foo=bar
, ATTRIB_VALUE_ENTITY_Q     : S++ // <foo bar="&quot;"
, ATTRIB_VALUE_ENTITY_U     : S++ // <foo bar=&quot;
, CLOSE_TAG                 : S++ // </a
, CLOSE_TAG_SAW_WHITE       : S++ // </a   >
, SCRIPT                    : S++ // <script> ...
, SCRIPT_ENDING             : S++ // <script> ... <
}

sax.ENTITIES =
{ "amp" : "&"
, "gt" : ">"
, "lt" : "<"
, "quot" : "\""
, "apos" : "'"
, "AElig" : 198
, "Aacute" : 193
, "Acirc" : 194
, "Agrave" : 192
, "Aring" : 197
, "Atilde" : 195
, "Auml" : 196
, "Ccedil" : 199
, "ETH" : 208
, "Eacute" : 201
, "Ecirc" : 202
, "Egrave" : 200
, "Euml" : 203
, "Iacute" : 205
, "Icirc" : 206
, "Igrave" : 204
, "Iuml" : 207
, "Ntilde" : 209
, "Oacute" : 211
, "Ocirc" : 212
, "Ograve" : 210
, "Oslash" : 216
, "Otilde" : 213
, "Ouml" : 214
, "THORN" : 222
, "Uacute" : 218
, "Ucirc" : 219
, "Ugrave" : 217
, "Uuml" : 220
, "Yacute" : 221
, "aacute" : 225
, "acirc" : 226
, "aelig" : 230
, "agrave" : 224
, "aring" : 229
, "atilde" : 227
, "auml" : 228
, "ccedil" : 231
, "eacute" : 233
, "ecirc" : 234
, "egrave" : 232
, "eth" : 240
, "euml" : 235
, "iacute" : 237
, "icirc" : 238
, "igrave" : 236
, "iuml" : 239
, "ntilde" : 241
, "oacute" : 243
, "ocirc" : 244
, "ograve" : 242
, "oslash" : 248
, "otilde" : 245
, "ouml" : 246
, "szlig" : 223
, "thorn" : 254
, "uacute" : 250
, "ucirc" : 251
, "ugrave" : 249
, "uuml" : 252
, "yacute" : 253
, "yuml" : 255
, "copy" : 169
, "reg" : 174
, "nbsp" : 160
, "iexcl" : 161
, "cent" : 162
, "pound" : 163
, "curren" : 164
, "yen" : 165
, "brvbar" : 166
, "sect" : 167
, "uml" : 168
, "ordf" : 170
, "laquo" : 171
, "not" : 172
, "shy" : 173
, "macr" : 175
, "deg" : 176
, "plusmn" : 177
, "sup1" : 185
, "sup2" : 178
, "sup3" : 179
, "acute" : 180
, "micro" : 181
, "para" : 182
, "middot" : 183
, "cedil" : 184
, "ordm" : 186
, "raquo" : 187
, "frac14" : 188
, "frac12" : 189
, "frac34" : 190
, "iquest" : 191
, "times" : 215
, "divide" : 247
, "OElig" : 338
, "oelig" : 339
, "Scaron" : 352
, "scaron" : 353
, "Yuml" : 376
, "fnof" : 402
, "circ" : 710
, "tilde" : 732
, "Alpha" : 913
, "Beta" : 914
, "Gamma" : 915
, "Delta" : 916
, "Epsilon" : 917
, "Zeta" : 918
, "Eta" : 919
, "Theta" : 920
, "Iota" : 921
, "Kappa" : 922
, "Lambda" : 923
, "Mu" : 924
, "Nu" : 925
, "Xi" : 926
, "Omicron" : 927
, "Pi" : 928
, "Rho" : 929
, "Sigma" : 931
, "Tau" : 932
, "Upsilon" : 933
, "Phi" : 934
, "Chi" : 935
, "Psi" : 936
, "Omega" : 937
, "alpha" : 945
, "beta" : 946
, "gamma" : 947
, "delta" : 948
, "epsilon" : 949
, "zeta" : 950
, "eta" : 951
, "theta" : 952
, "iota" : 953
, "kappa" : 954
, "lambda" : 955
, "mu" : 956
, "nu" : 957
, "xi" : 958
, "omicron" : 959
, "pi" : 960
, "rho" : 961
, "sigmaf" : 962
, "sigma" : 963
, "tau" : 964
, "upsilon" : 965
, "phi" : 966
, "chi" : 967
, "psi" : 968
, "omega" : 969
, "thetasym" : 977
, "upsih" : 978
, "piv" : 982
, "ensp" : 8194
, "emsp" : 8195
, "thinsp" : 8201
, "zwnj" : 8204
, "zwj" : 8205
, "lrm" : 8206
, "rlm" : 8207
, "ndash" : 8211
, "mdash" : 8212
, "lsquo" : 8216
, "rsquo" : 8217
, "sbquo" : 8218
, "ldquo" : 8220
, "rdquo" : 8221
, "bdquo" : 8222
, "dagger" : 8224
, "Dagger" : 8225
, "bull" : 8226
, "hellip" : 8230
, "permil" : 8240
, "prime" : 8242
, "Prime" : 8243
, "lsaquo" : 8249
, "rsaquo" : 8250
, "oline" : 8254
, "frasl" : 8260
, "euro" : 8364
, "image" : 8465
, "weierp" : 8472
, "real" : 8476
, "trade" : 8482
, "alefsym" : 8501
, "larr" : 8592
, "uarr" : 8593
, "rarr" : 8594
, "darr" : 8595
, "harr" : 8596
, "crarr" : 8629
, "lArr" : 8656
, "uArr" : 8657
, "rArr" : 8658
, "dArr" : 8659
, "hArr" : 8660
, "forall" : 8704
, "part" : 8706
, "exist" : 8707
, "empty" : 8709
, "nabla" : 8711
, "isin" : 8712
, "notin" : 8713
, "ni" : 8715
, "prod" : 8719
, "sum" : 8721
, "minus" : 8722
, "lowast" : 8727
, "radic" : 8730
, "prop" : 8733
, "infin" : 8734
, "ang" : 8736
, "and" : 8743
, "or" : 8744
, "cap" : 8745
, "cup" : 8746
, "int" : 8747
, "there4" : 8756
, "sim" : 8764
, "cong" : 8773
, "asymp" : 8776
, "ne" : 8800
, "equiv" : 8801
, "le" : 8804
, "ge" : 8805
, "sub" : 8834
, "sup" : 8835
, "nsub" : 8836
, "sube" : 8838
, "supe" : 8839
, "oplus" : 8853
, "otimes" : 8855
, "perp" : 8869
, "sdot" : 8901
, "lceil" : 8968
, "rceil" : 8969
, "lfloor" : 8970
, "rfloor" : 8971
, "lang" : 9001
, "rang" : 9002
, "loz" : 9674
, "spades" : 9824
, "clubs" : 9827
, "hearts" : 9829
, "diams" : 9830
}

Object.keys(sax.ENTITIES).forEach(function (key) {
    var e = sax.ENTITIES[key]
    var s = typeof e === 'number' ? String.fromCharCode(e) : e
    sax.ENTITIES[key] = s
})

for (var S in sax.STATE) sax.STATE[sax.STATE[S]] = S

// shorthand
S = sax.STATE

function emit (parser, event, data) {
  parser[event] && parser[event](data)
}

function emitNode (parser, nodeType, data) {
  if (parser.textNode) closeText(parser)
  emit(parser, nodeType, data)
}

function closeText (parser) {
  parser.textNode = textopts(parser.opt, parser.textNode)
  if (parser.textNode) emit(parser, "ontext", parser.textNode)
  parser.textNode = ""
}

function textopts (opt, text) {
  if (opt.trim) text = text.trim()
  if (opt.normalize) text = text.replace(/\s+/g, " ")
  return text
}

function error (parser, er) {
  closeText(parser)
  if (parser.trackPosition) {
    er += "\nLine: "+parser.line+
          "\nColumn: "+parser.column+
          "\nChar: "+parser.c
  }
  er = new Error(er)
  parser.error = er
  emit(parser, "onerror", er)
  return parser
}

function end (parser) {
  if (!parser.closedRoot) strictFail(parser, "Unclosed root tag")
  if ((parser.state !== S.BEGIN) && (parser.state !== S.TEXT)) error(parser, "Unexpected end")
  closeText(parser)
  parser.c = ""
  parser.closed = true
  emit(parser, "onend")
  SAXParser.call(parser, parser.strict, parser.opt)
  return parser
}

function strictFail (parser, message) {
  if (typeof parser !== 'object' || !(parser instanceof SAXParser))
    throw new Error('bad call to strictFail');
  if (parser.strict) error(parser, message)
}

function newTag (parser) {
  if (!parser.strict) parser.tagName = parser.tagName[parser.looseCase]()
  var parent = parser.tags[parser.tags.length - 1] || parser
    , tag = parser.tag = { name : parser.tagName, attributes : {} }

  // will be overridden if tag contails an xmlns="foo" or xmlns:foo="bar"
  if (parser.opt.xmlns) tag.ns = parent.ns
  parser.attribList.length = 0
}

function qname (name, attribute) {
  var i = name.indexOf(":")
    , qualName = i < 0 ? [ "", name ] : name.split(":")
    , prefix = qualName[0]
    , local = qualName[1]

  // <x "xmlns"="http://foo">
  if (attribute && name === "xmlns") {
    prefix = "xmlns"
    local = ""
  }

  return { prefix: prefix, local: local }
}

function attrib (parser) {
  if (!parser.strict) parser.attribName = parser.attribName[parser.looseCase]()

  if (parser.attribList.indexOf(parser.attribName) !== -1 ||
      parser.tag.attributes.hasOwnProperty(parser.attribName)) {
    return parser.attribName = parser.attribValue = ""
  }

  if (parser.opt.xmlns) {
    var qn = qname(parser.attribName, true)
      , prefix = qn.prefix
      , local = qn.local

    if (prefix === "xmlns") {
      // namespace binding attribute; push the binding into scope
      if (local === "xml" && parser.attribValue !== XML_NAMESPACE) {
        strictFail( parser
                  , "xml: prefix must be bound to " + XML_NAMESPACE + "\n"
                  + "Actual: " + parser.attribValue )
      } else if (local === "xmlns" && parser.attribValue !== XMLNS_NAMESPACE) {
        strictFail( parser
                  , "xmlns: prefix must be bound to " + XMLNS_NAMESPACE + "\n"
                  + "Actual: " + parser.attribValue )
      } else {
        var tag = parser.tag
          , parent = parser.tags[parser.tags.length - 1] || parser
        if (tag.ns === parent.ns) {
          tag.ns = Object.create(parent.ns)
        }
        tag.ns[local] = parser.attribValue
      }
    }

    // defer onattribute events until all attributes have been seen
    // so any new bindings can take effect; preserve attribute order
    // so deferred events can be emitted in document order
    parser.attribList.push([parser.attribName, parser.attribValue])
  } else {
    // in non-xmlns mode, we can emit the event right away
    parser.tag.attributes[parser.attribName] = parser.attribValue
    emitNode( parser
            , "onattribute"
            , { name: parser.attribName
              , value: parser.attribValue } )
  }

  parser.attribName = parser.attribValue = ""
}

function openTag (parser, selfClosing) {
  if (parser.opt.xmlns) {
    // emit namespace binding events
    var tag = parser.tag

    // add namespace info to tag
    var qn = qname(parser.tagName)
    tag.prefix = qn.prefix
    tag.local = qn.local
    tag.uri = tag.ns[qn.prefix] || ""

    if (tag.prefix && !tag.uri) {
      strictFail(parser, "Unbound namespace prefix: "
                       + JSON.stringify(parser.tagName))
      tag.uri = qn.prefix
    }

    var parent = parser.tags[parser.tags.length - 1] || parser
    if (tag.ns && parent.ns !== tag.ns) {
      Object.keys(tag.ns).forEach(function (p) {
        emitNode( parser
                , "onopennamespace"
                , { prefix: p , uri: tag.ns[p] } )
      })
    }

    // handle deferred onattribute events
    // Note: do not apply default ns to attributes:
    //   http://www.w3.org/TR/REC-xml-names/#defaulting
    for (var i = 0, l = parser.attribList.length; i < l; i ++) {
      var nv = parser.attribList[i]
      var name = nv[0]
        , value = nv[1]
        , qualName = qname(name, true)
        , prefix = qualName.prefix
        , local = qualName.local
        , uri = prefix == "" ? "" : (tag.ns[prefix] || "")
        , a = { name: name
              , value: value
              , prefix: prefix
              , local: local
              , uri: uri
              }

      // if there's any attributes with an undefined namespace,
      // then fail on them now.
      if (prefix && prefix != "xmlns" && !uri) {
        strictFail(parser, "Unbound namespace prefix: "
                         + JSON.stringify(prefix))
        a.uri = prefix
      }
      parser.tag.attributes[name] = a
      emitNode(parser, "onattribute", a)
    }
    parser.attribList.length = 0
  }

  parser.tag.isSelfClosing = !!selfClosing

  // process the tag
  parser.sawRoot = true
  parser.tags.push(parser.tag)
  emitNode(parser, "onopentag", parser.tag)
  if (!selfClosing) {
    // special case for <script> in non-strict mode.
    if (!parser.noscript && parser.tagName.toLowerCase() === "script") {
      parser.state = S.SCRIPT
    } else {
      parser.state = S.TEXT
    }
    parser.tag = null
    parser.tagName = ""
  }
  parser.attribName = parser.attribValue = ""
  parser.attribList.length = 0
}

function closeTag (parser) {
  if (!parser.tagName) {
    strictFail(parser, "Weird empty close tag.")
    parser.textNode += "</>"
    parser.state = S.TEXT
    return
  }

  if (parser.script) {
    if (parser.tagName !== "script") {
      parser.script += "</" + parser.tagName + ">"
      parser.tagName = ""
      parser.state = S.SCRIPT
      return
    }
    emitNode(parser, "onscript", parser.script)
    parser.script = ""
  }

  // first make sure that the closing tag actually exists.
  // <a><b></c></b></a> will close everything, otherwise.
  var t = parser.tags.length
  var tagName = parser.tagName
  if (!parser.strict) tagName = tagName[parser.looseCase]()
  var closeTo = tagName
  while (t --) {
    var close = parser.tags[t]
    if (close.name !== closeTo) {
      // fail the first time in strict mode
      strictFail(parser, "Unexpected close tag")
    } else break
  }

  // didn't find it.  we already failed for strict, so just abort.
  if (t < 0) {
    strictFail(parser, "Unmatched closing tag: "+parser.tagName)
    parser.textNode += "</" + parser.tagName + ">"
    parser.state = S.TEXT
    return
  }
  parser.tagName = tagName
  var s = parser.tags.length
  while (s --> t) {
    var tag = parser.tag = parser.tags.pop()
    parser.tagName = parser.tag.name
    emitNode(parser, "onclosetag", parser.tagName)

    var x = {}
    for (var i in tag.ns) x[i] = tag.ns[i]

    var parent = parser.tags[parser.tags.length - 1] || parser
    if (parser.opt.xmlns && tag.ns !== parent.ns) {
      // remove namespace bindings introduced by tag
      Object.keys(tag.ns).forEach(function (p) {
        var n = tag.ns[p]
        emitNode(parser, "onclosenamespace", { prefix: p, uri: n })
      })
    }
  }
  if (t === 0) parser.closedRoot = true
  parser.tagName = parser.attribValue = parser.attribName = ""
  parser.attribList.length = 0
  parser.state = S.TEXT
}

function parseEntity (parser) {
  var entity = parser.entity
    , entityLC = entity.toLowerCase()
    , num
    , numStr = ""
  if (parser.ENTITIES[entity])
    return parser.ENTITIES[entity]
  if (parser.ENTITIES[entityLC])
    return parser.ENTITIES[entityLC]
  entity = entityLC
  if (entity.charAt(0) === "#") {
    if (entity.charAt(1) === "x") {
      entity = entity.slice(2)
      num = parseInt(entity, 16)
      numStr = num.toString(16)
    } else {
      entity = entity.slice(1)
      num = parseInt(entity, 10)
      numStr = num.toString(10)
    }
  }
  entity = entity.replace(/^0+/, "")
  if (numStr.toLowerCase() !== entity) {
    strictFail(parser, "Invalid character entity")
    return "&"+parser.entity + ";"
  }

  return String.fromCodePoint(num)
}

function write (chunk) {
  var parser = this
  if (this.error) throw this.error
  if (parser.closed) return error(parser,
    "Cannot write after close. Assign an onready handler.")
  if (chunk === null) return end(parser)
  var i = 0, c = ""
  while (parser.c = c = chunk.charAt(i++)) {
    if (parser.trackPosition) {
      parser.position ++
      if (c === "\n") {
        parser.line ++
        parser.column = 0
      } else parser.column ++
    }
    switch (parser.state) {

      case S.BEGIN:
        if (c === "<") {
          parser.state = S.OPEN_WAKA
          parser.startTagPosition = parser.position
        } else if (not(whitespace,c)) {
          // have to process this as a text node.
          // weird, but happens.
          strictFail(parser, "Non-whitespace before first tag.")
          parser.textNode = c
          parser.state = S.TEXT
        }
      continue

      case S.TEXT:
        if (parser.sawRoot && !parser.closedRoot) {
          var starti = i-1
          while (c && c!=="<" && c!=="&") {
            c = chunk.charAt(i++)
            if (c && parser.trackPosition) {
              parser.position ++
              if (c === "\n") {
                parser.line ++
                parser.column = 0
              } else parser.column ++
            }
          }
          parser.textNode += chunk.substring(starti, i-1)
        }
        if (c === "<") {
          parser.state = S.OPEN_WAKA
          parser.startTagPosition = parser.position
        } else {
          if (not(whitespace, c) && (!parser.sawRoot || parser.closedRoot))
            strictFail(parser, "Text data outside of root node.")
          if (c === "&") parser.state = S.TEXT_ENTITY
          else parser.textNode += c
        }
      continue

      case S.SCRIPT:
        // only non-strict
        if (c === "<") {
          parser.state = S.SCRIPT_ENDING
        } else parser.script += c
      continue

      case S.SCRIPT_ENDING:
        if (c === "/") {
          parser.state = S.CLOSE_TAG
        } else {
          parser.script += "<" + c
          parser.state = S.SCRIPT
        }
      continue

      case S.OPEN_WAKA:
        // either a /, ?, !, or text is coming next.
        if (c === "!") {
          parser.state = S.SGML_DECL
          parser.sgmlDecl = ""
        } else if (is(whitespace, c)) {
          // wait for it...
        } else if (is(nameStart,c)) {
          parser.state = S.OPEN_TAG
          parser.tagName = c
        } else if (c === "/") {
          parser.state = S.CLOSE_TAG
          parser.tagName = ""
        } else if (c === "?") {
          parser.state = S.PROC_INST
          parser.procInstName = parser.procInstBody = ""
        } else {
          strictFail(parser, "Unencoded <")
          // if there was some whitespace, then add that in.
          if (parser.startTagPosition + 1 < parser.position) {
            var pad = parser.position - parser.startTagPosition
            c = new Array(pad).join(" ") + c
          }
          parser.textNode += "<" + c
          parser.state = S.TEXT
        }
      continue

      case S.SGML_DECL:
        if ((parser.sgmlDecl+c).toUpperCase() === CDATA) {
          emitNode(parser, "onopencdata")
          parser.state = S.CDATA
          parser.sgmlDecl = ""
          parser.cdata = ""
        } else if (parser.sgmlDecl+c === "--") {
          parser.state = S.COMMENT
          parser.comment = ""
          parser.sgmlDecl = ""
        } else if ((parser.sgmlDecl+c).toUpperCase() === DOCTYPE) {
          parser.state = S.DOCTYPE
          if (parser.doctype || parser.sawRoot) strictFail(parser,
            "Inappropriately located doctype declaration")
          parser.doctype = ""
          parser.sgmlDecl = ""
        } else if (c === ">") {
          emitNode(parser, "onsgmldeclaration", parser.sgmlDecl)
          parser.sgmlDecl = ""
          parser.state = S.TEXT
        } else if (is(quote, c)) {
          parser.state = S.SGML_DECL_QUOTED
          parser.sgmlDecl += c
        } else parser.sgmlDecl += c
      continue

      case S.SGML_DECL_QUOTED:
        if (c === parser.q) {
          parser.state = S.SGML_DECL
          parser.q = ""
        }
        parser.sgmlDecl += c
      continue

      case S.DOCTYPE:
        if (c === ">") {
          parser.state = S.TEXT
          emitNode(parser, "ondoctype", parser.doctype)
          parser.doctype = true // just remember that we saw it.
        } else {
          parser.doctype += c
          if (c === "[") parser.state = S.DOCTYPE_DTD
          else if (is(quote, c)) {
            parser.state = S.DOCTYPE_QUOTED
            parser.q = c
          }
        }
      continue

      case S.DOCTYPE_QUOTED:
        parser.doctype += c
        if (c === parser.q) {
          parser.q = ""
          parser.state = S.DOCTYPE
        }
      continue

      case S.DOCTYPE_DTD:
        parser.doctype += c
        if (c === "]") parser.state = S.DOCTYPE
        else if (is(quote,c)) {
          parser.state = S.DOCTYPE_DTD_QUOTED
          parser.q = c
        }
      continue

      case S.DOCTYPE_DTD_QUOTED:
        parser.doctype += c
        if (c === parser.q) {
          parser.state = S.DOCTYPE_DTD
          parser.q = ""
        }
      continue

      case S.COMMENT:
        if (c === "-") parser.state = S.COMMENT_ENDING
        else parser.comment += c
      continue

      case S.COMMENT_ENDING:
        if (c === "-") {
          parser.state = S.COMMENT_ENDED
          parser.comment = textopts(parser.opt, parser.comment)
          if (parser.comment) emitNode(parser, "oncomment", parser.comment)
          parser.comment = ""
        } else {
          parser.comment += "-" + c
          parser.state = S.COMMENT
        }
      continue

      case S.COMMENT_ENDED:
        if (c !== ">") {
          strictFail(parser, "Malformed comment")
          // allow <!-- blah -- bloo --> in non-strict mode,
          // which is a comment of " blah -- bloo "
          parser.comment += "--" + c
          parser.state = S.COMMENT
        } else parser.state = S.TEXT
      continue

      case S.CDATA:
        if (c === "]") parser.state = S.CDATA_ENDING
        else parser.cdata += c
      continue

      case S.CDATA_ENDING:
        if (c === "]") parser.state = S.CDATA_ENDING_2
        else {
          parser.cdata += "]" + c
          parser.state = S.CDATA
        }
      continue

      case S.CDATA_ENDING_2:
        if (c === ">") {
          if (parser.cdata) emitNode(parser, "oncdata", parser.cdata)
          emitNode(parser, "onclosecdata")
          parser.cdata = ""
          parser.state = S.TEXT
        } else if (c === "]") {
          parser.cdata += "]"
        } else {
          parser.cdata += "]]" + c
          parser.state = S.CDATA
        }
      continue

      case S.PROC_INST:
        if (c === "?") parser.state = S.PROC_INST_ENDING
        else if (is(whitespace, c)) parser.state = S.PROC_INST_BODY
        else parser.procInstName += c
      continue

      case S.PROC_INST_BODY:
        if (!parser.procInstBody && is(whitespace, c)) continue
        else if (c === "?") parser.state = S.PROC_INST_ENDING
        else parser.procInstBody += c
      continue

      case S.PROC_INST_ENDING:
        if (c === ">") {
          emitNode(parser, "onprocessinginstruction", {
            name : parser.procInstName,
            body : parser.procInstBody
          })
          parser.procInstName = parser.procInstBody = ""
          parser.state = S.TEXT
        } else {
          parser.procInstBody += "?" + c
          parser.state = S.PROC_INST_BODY
        }
      continue

      case S.OPEN_TAG:
        if (is(nameBody, c)) parser.tagName += c
        else {
          newTag(parser)
          if (c === ">") openTag(parser)
          else if (c === "/") parser.state = S.OPEN_TAG_SLASH
          else {
            if (not(whitespace, c)) strictFail(
              parser, "Invalid character in tag name")
            parser.state = S.ATTRIB
          }
        }
      continue

      case S.OPEN_TAG_SLASH:
        if (c === ">") {
          openTag(parser, true)
          closeTag(parser)
        } else {
          strictFail(parser, "Forward-slash in opening tag not followed by >")
          parser.state = S.ATTRIB
        }
      continue

      case S.ATTRIB:
        // haven't read the attribute name yet.
        if (is(whitespace, c)) continue
        else if (c === ">") openTag(parser)
        else if (c === "/") parser.state = S.OPEN_TAG_SLASH
        else if (is(nameStart, c)) {
          parser.attribName = c
          parser.attribValue = ""
          parser.state = S.ATTRIB_NAME
        } else strictFail(parser, "Invalid attribute name")
      continue

      case S.ATTRIB_NAME:
        if (c === "=") parser.state = S.ATTRIB_VALUE
        else if (c === ">") {
          strictFail(parser, "Attribute without value")
          parser.attribValue = parser.attribName
          attrib(parser)
          openTag(parser)
        }
        else if (is(whitespace, c)) parser.state = S.ATTRIB_NAME_SAW_WHITE
        else if (is(nameBody, c)) parser.attribName += c
        else strictFail(parser, "Invalid attribute name")
      continue

      case S.ATTRIB_NAME_SAW_WHITE:
        if (c === "=") parser.state = S.ATTRIB_VALUE
        else if (is(whitespace, c)) continue
        else {
          strictFail(parser, "Attribute without value")
          parser.tag.attributes[parser.attribName] = ""
          parser.attribValue = ""
          emitNode(parser, "onattribute",
                   { name : parser.attribName, value : "" })
          parser.attribName = ""
          if (c === ">") openTag(parser)
          else if (is(nameStart, c)) {
            parser.attribName = c
            parser.state = S.ATTRIB_NAME
          } else {
            strictFail(parser, "Invalid attribute name")
            parser.state = S.ATTRIB
          }
        }
      continue

      case S.ATTRIB_VALUE:
        if (is(whitespace, c)) continue
        else if (is(quote, c)) {
          parser.q = c
          parser.state = S.ATTRIB_VALUE_QUOTED
        } else {
          strictFail(parser, "Unquoted attribute value")
          parser.state = S.ATTRIB_VALUE_UNQUOTED
          parser.attribValue = c
        }
      continue

      case S.ATTRIB_VALUE_QUOTED:
        if (c !== parser.q) {
          if (c === "&") parser.state = S.ATTRIB_VALUE_ENTITY_Q
          else parser.attribValue += c
          continue
        }
        attrib(parser)
        parser.q = ""
        parser.state = S.ATTRIB_VALUE_CLOSED
      continue

      case S.ATTRIB_VALUE_CLOSED:
        if (is(whitespace, c)) {
          parser.state = S.ATTRIB
        } else if (c === ">") openTag(parser)
        else if (c === "/") parser.state = S.OPEN_TAG_SLASH
        else if (is(nameStart, c)) {
          strictFail(parser, "No whitespace between attributes")
          parser.attribName = c
          parser.attribValue = ""
          parser.state = S.ATTRIB_NAME
        } else strictFail(parser, "Invalid attribute name")
      continue

      case S.ATTRIB_VALUE_UNQUOTED:
        if (not(attribEnd,c)) {
          if (c === "&") parser.state = S.ATTRIB_VALUE_ENTITY_U
          else parser.attribValue += c
          continue
        }
        attrib(parser)
        if (c === ">") openTag(parser)
        else parser.state = S.ATTRIB
      continue

      case S.CLOSE_TAG:
        if (!parser.tagName) {
          if (is(whitespace, c)) continue
          else if (not(nameStart, c)) {
            if (parser.script) {
              parser.script += "</" + c
              parser.state = S.SCRIPT
            } else {
              strictFail(parser, "Invalid tagname in closing tag.")
            }
          } else parser.tagName = c
        }
        else if (c === ">") closeTag(parser)
        else if (is(nameBody, c)) parser.tagName += c
        else if (parser.script) {
          parser.script += "</" + parser.tagName
          parser.tagName = ""
          parser.state = S.SCRIPT
        } else {
          if (not(whitespace, c)) strictFail(parser,
            "Invalid tagname in closing tag")
          parser.state = S.CLOSE_TAG_SAW_WHITE
        }
      continue

      case S.CLOSE_TAG_SAW_WHITE:
        if (is(whitespace, c)) continue
        if (c === ">") closeTag(parser)
        else strictFail(parser, "Invalid characters in closing tag")
      continue

      case S.TEXT_ENTITY:
      case S.ATTRIB_VALUE_ENTITY_Q:
      case S.ATTRIB_VALUE_ENTITY_U:
        switch(parser.state) {
          case S.TEXT_ENTITY:
            var returnState = S.TEXT, buffer = "textNode"
          break

          case S.ATTRIB_VALUE_ENTITY_Q:
            var returnState = S.ATTRIB_VALUE_QUOTED, buffer = "attribValue"
          break

          case S.ATTRIB_VALUE_ENTITY_U:
            var returnState = S.ATTRIB_VALUE_UNQUOTED, buffer = "attribValue"
          break
        }
        if (c === ";") {
          parser[buffer] += parseEntity(parser)
          parser.entity = ""
          parser.state = returnState
        }
        else if (is(entity, c)) parser.entity += c
        else {
          strictFail(parser, "Invalid character entity")
          parser[buffer] += "&" + parser.entity + c
          parser.entity = ""
          parser.state = returnState
        }
      continue

      default:
        throw new Error(parser, "Unknown state: " + parser.state)
    }
  } // while
  // cdata blocks can get very big under normal conditions. emit and move on.
  // if (parser.state === S.CDATA && parser.cdata) {
  //   emitNode(parser, "oncdata", parser.cdata)
  //   parser.cdata = ""
  // }
  if (parser.position >= parser.bufferCheckPosition) checkBufferLength(parser)
  return parser
}

/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */
if (!String.fromCodePoint) {
        (function() {
                var stringFromCharCode = String.fromCharCode;
                var floor = Math.floor;
                var fromCodePoint = function() {
                        var MAX_SIZE = 0x4000;
                        var codeUnits = [];
                        var highSurrogate;
                        var lowSurrogate;
                        var index = -1;
                        var length = arguments.length;
                        if (!length) {
                                return '';
                        }
                        var result = '';
                        while (++index < length) {
                                var codePoint = Number(arguments[index]);
                                if (
                                        !isFinite(codePoint) || // `NaN`, `+Infinity`, or `-Infinity`
                                        codePoint < 0 || // not a valid Unicode code point
                                        codePoint > 0x10FFFF || // not a valid Unicode code point
                                        floor(codePoint) != codePoint // not an integer
                                ) {
                                        throw RangeError('Invalid code point: ' + codePoint);
                                }
                                if (codePoint <= 0xFFFF) { // BMP code point
                                        codeUnits.push(codePoint);
                                } else { // Astral code point; split in surrogate halves
                                        // http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae
                                        codePoint -= 0x10000;
                                        highSurrogate = (codePoint >> 10) + 0xD800;
                                        lowSurrogate = (codePoint % 0x400) + 0xDC00;
                                        codeUnits.push(highSurrogate, lowSurrogate);
                                }
                                if (index + 1 == length || codeUnits.length > MAX_SIZE) {
                                        result += stringFromCharCode.apply(null, codeUnits);
                                        codeUnits.length = 0;
                                }
                        }
                        return result;
                };
                if (Object.defineProperty) {
                        Object.defineProperty(String, 'fromCodePoint', {
                                'value': fromCodePoint,
                                'configurable': true,
                                'writable': true
                        });
                } else {
                        String.fromCodePoint = fromCodePoint;
                }
        }());
}

})(typeof exports === "undefined" ? sax = {} : exports)
;
define("sax", (function (global) {
    return function () {
        var ret, fn;
        return ret || global.sax;
    };
}(this)));

define('filters/osis',["sax", "bcv"], function (sax, bcv) {
    var osis = {},
        parser = sax.parser(true); //strict = true

    //* SWFilter Options
    var swFilterOptions = {
        headings: false,
        footnotes: false,
        crossReferences: false,
        strongsNumbers: false,
        wordsOfChristInRed: false,
        oneVersePerLine: false,
        array: false
    };

    var lastTag = "",
        currentNode = null,
        currentNote = null,
        currentRef = null,
        quote = null,
        verseData = null,
        noteText = "",
        outText = "",
        renderedText = "",
        verseArray = [],
        verseNumber = "",
        osisRef = "",
        footnotesData = {},
        isSelfClosing = false,
        isTitle = false,
        noteCount = 0;

    osis.processText = function (inRaw, inDirection, inOptions) {
        if (!inOptions || inOptions === {}) {
            inOptions = swFilterOptions;
        } else {
            inOptions.headings = (inOptions.headings) ? inOptions.headings : swFilterOptions.headings;
            inOptions.footnotes = (inOptions.footnotes) ? inOptions.footnotes : swFilterOptions.footnotes;
            inOptions.crossReferences = (inOptions.crossReferences) ? inOptions.crossReferences : swFilterOptions.crossReferences;
            inOptions.strongsNumbers = (inOptions.strongsNumbers) ? inOptions.strongsNumbers : swFilterOptions.strongsNumbers;
            inOptions.wordsOfChristInRed = (inOptions.wordsOfChristInRed) ? inOptions.wordsOfChristInRed : swFilterOptions.wordsOfChristInRed;
            inOptions.oneVersePerLine = (inOptions.oneVersePerLine) ? inOptions.oneVersePerLine : swFilterOptions.oneVersePerLine;
            inOptions.array = (inOptions.array) ? inOptions.array : swFilterOptions.array;
        }

        lastTag = "";
        currentNode = null;
        currentNote = null;
        currentRef = null;
        quote = null;
        verseData = null;
        noteText = "";
        outText = "";
        renderedText = "";
        verseArray = [];
        verseNumber = "";
        osisRef = "";
        footnotesData = {};
        isTitle = false;
        noteCount = 0;

        //Handle Parsing errors
        parser.onerror = function (e) {
            parser.resume();
        };

        //Text node
        parser.ontext = function (t) {
            //console.log("TEXT:", t, currentNode);
            if (currentNote) {
                outText += processFootnotes(t, inOptions);
            } else if (quote) {
                if (quote.attributes.who === "Jesus" && inOptions.wordsOfChristInRed) {
                    outText += "<span style='color: red'><span class='sword-woc'>" + t + " </span></span>";
                } else
                    outText += t;
            } else if (currentNode) {
                switch (currentNode.name) {
                    case "title":
                        if(inOptions.headings) {
                            if (currentNode.attributes.type === "section")
                                outText = "<h3>" + t + "</h3>" + outText;
                            else
                                outText = "<h1>" + t + "</h1>" + outText;
                        }
                    break;
                    case "hi":
                        outText += tagHi(currentNode, t);
                    break;
                    default:
                        outText += t;
                    break;
                }
            } else {
                outText += t;
            }


        };

        //Handle opening tags
        parser.onopentag = function (node) {
            //console.log(node);
            currentNode = node;
            lastTag = node.name;
            switch (node.name) {
                case "xml":
                    verseData = {osisRef: node.attributes.osisRef, verseNum: node.attributes.verseNum};
                    if (parseInt(verseData.verseNum, 10) === 0) {
                        if (inDirection === "RtoL")
                            outText += "<span dir='rtl'><div class='sword-intro'>";
                        else
                            outText += "<span class='sword-intro'>";
                    } else {
                        if (inDirection === "RtoL")
                            outText += "<span dir='rtl'><a href=\"?type=verseNum&osisRef=" + verseData.osisRef + "\" class='verse-number'> " + verseData.verseNum + " </a></span><span dir='rtl'>";
                        else
                            outText += "<a href=\"?type=verseNum&osisRef=" + verseData.osisRef + "\" class='verse-number'> " + verseData.verseNum + " </a>";
                    }
                break;
                case "note":
                    if (node.attributes.type === "crossReference" && inOptions.crossReferences)
                        outText += "<span class='sword-cross-reference'>[";
                    else if (inOptions.footnotes && node.attributes.type !== "crossReference") {
                        osisRef = node.attributes.osisRef || node.attributes.annotateRef || verseData.osisRef;
                        if (!node.attributes.n) noteCount++;
                        var n = node.attributes.n || noteCount;
                        outText += "<a class='sword-footnote' href=\"?type=footnote&osisRef=" + osisRef + "&n=" + n+ "\"><sup>" + "*n" + n + "</sup></a>";
                    }

                    currentNote = node;
                break;
                case "reference":
                    currentRef = node;
                break;
                case "q":
                    if(!node.isSelfClosing)
                        quote = node;
                break;
                case "div":
                    if(node.isSelfClosing && node.attributes.type === "paragraph" && node.attributes.sID)
                        outText += "<p>";
                    if(node.isSelfClosing && node.attributes.type === "paragraph" && node.attributes.eID)
                        outText += "</p>";
                break;
                case "l":
                    if(node.isSelfClosing && node.attributes.type === "x-br")
                        outText += "<br>";
                break;
            }
        };

        parser.onclosetag = function (tagName) {
            //console.log("CLOSE:", tagName);
            switch (tagName) {
                case "title":
                    currentNode = null;
                break;
                case "note":
                    if (currentNote.attributes.type === "crossReference" && inOptions.crossReferences)
                        outText += "]</span> ";
                    noteText = "";
                    currentNote = null;
                break;
                case "reference":
                    currentRef = null;
                break;
                case "q":
                    /*if (!quote.isSelfClosing && inOptions.wordsOfChristInRed) {
                        outText += "</span>";
                    }*/
                break;
                case "xml":
                    if(parseInt(verseData.verseNum, 10) === 0)
                        outText += "</div>";
                    if(inDirection === "RtoL")
                        outText += "</span>";
                break;
            }
            lastTag = "";
            currentNode = null;
        };

        //Handling Attributes
        parser.onattribute = function (attr) {
            //console.log(attr);
        };

        //End of parsing
        parser.onend = function () {
            //console.log("Finished parsing XML!");
        };

        var tmp = "";
        for (var i=0; i<inRaw.length; i++) {
            //console.log(inRaw[i].text);
            tmp = "<xml osisRef='" + inRaw[i].osis + "' verseNum = '" + inRaw[i].verse + "'>" + inRaw[i].text + "</xml>";
            parser.write(tmp);
            parser.close();
            if (!inOptions.array)
                renderedText += (inOptions.oneVersePerLine) ? "<div class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</div>" : "<span class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</span>";
            else
                verseArray.push({text: (inOptions.oneVersePerLine) ? "<div class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</div>" : "<span class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</span>", osisRef: inRaw[i].osis});
            outText = "";
        }

        if(inDirection === "RtoL")
            renderedText = "<div style='text-align: right;'>" + renderedText + "</div>";
        if(!inOptions.array)
            return {text: renderedText, footnotes: footnotesData};
        else
            return {verses: verseArray, footnotes: footnotesData};
    };

    /* FUNCTIONS TO PROCESS SPECIFIC OSIS TAGS */

    function processFootnotes(t, inOptions) {
        var out = "";
        if (currentNote.attributes.type === "crossReference" && inOptions.crossReferences) {
            if (lastTag !== "reference")
                out += processCrossReference(t);
            else {
                var crossRef = (currentRef) ? currentRef.attributes.osisRef : currentNote.attributes.osisRef;
                out += "<a href=\"?type=crossReference&osisRef=" + crossRef + "&n=" + currentNote.attributes.n + "\">" + t + "</a>";
            }
        } else if (inOptions.footnotes && currentNote.attributes.type !== "crossReference") {
            if (lastTag === "hi") {
                t = tagHi(currentNode, t);
            }
            osisRef = currentNote.attributes.osisRef || currentNote.attributes.annotateRef || verseData.osisRef;
            var n = currentNote.attributes.n || noteCount;
            if (!footnotesData.hasOwnProperty(osisRef))
                footnotesData[osisRef] = [{note: t, n: n}];
            else {
                if (footnotesData[osisRef][footnotesData[osisRef].length-1].n === n)
                    footnotesData[osisRef][footnotesData[osisRef].length-1]["note"] += t;
                else
                    footnotesData[osisRef].push({note: t, n: n});
            }
        }
        return out;
    }

    function processCrossReference(inText) {
        var out = "",
            osisRef = bcv.parse(inText).osis();
        if (osisRef !== "" && currentRef) {
            var n = currentRef.attributes.n || currentNote.attributes.n;
            out += "<a href=\"?type=crossReference&osisRef=" + osisRef + "&n=" + n + "\">" + inText + "</a>";
        } else
            out += inText;
        return out;
    }

    function tagHi (node, t) {
        switch (node.attributes.type) {
            case "italic":
                t = "<i>"+t+"</i>";
            break;
            case "bold":
                t = "<b>"+t+"</b>";
            break;
            case "line-through":
                t = "<s>"+t+"</s>";
            break;
            case "underline":
                t = "<u>"+t+"</u>";
            break;
            case "sub":
                t = "<sub>"+t+"</sub>";
            break;
            case "super":
                t = "<sup>"+t+"</sup>";
            break;
        }

        return t;
    }

    //Return osis filter methods
    return osis;
});
define('filters/plain',[], function () {
    //* SWFilter Options
    var plain = {},
        swFilterOptions = {
            oneVersePerLine: false,
            array: false
        };

    plain.processText = function (inRaw, inDirection, inOptions) {
        var renderedText = "",
            verseArray = [];

        if (!inOptions || inOptions === {}) {
            inOptions = swFilterOptions;
        } else {
            inOptions.oneVersePerLine = (inOptions.oneVersePerLine) ? inOptions.oneVersePerLine : swFilterOptions.oneVersePerLine;
            inOptions.array = (inOptions.array) ? inOptions.array : swFilterOptions.array;
        }

        for (var i=0; i<inRaw.length; i++) {
            outText = (inDirection !== "RtoL") ? "<a href=\"?type=verseNum&osisRef=" + inRaw[i].osis + "\" class='verse-number'> " + inRaw[i].verse + " </a>" : "<span dir='rtl'><a href=\"?type=verseNum&osisRef=" + inRaw[i].osis + "\" class='verse-number'> " + inRaw[i].verse + " </a></span>";
            outText += (inDirection !== "RtoL") ? inRaw[i].text : "<span dir='rtl'>" + inRaw[i].text + "</span>";
            if (!inOptions.array)
                renderedText += (inOptions.oneVersePerLine) ? "<div class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</div>" : "<span class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</span>";
            else
                verseArray.push({text: (inOptions.oneVersePerLine) ? "<div class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</div>" : "<span class='verse' id = '" + inRaw[i].osis + "'>" + outText + "</span>", osisRef: inRaw[i].osis});
            outText = "";
        }

        if(inDirection === "RtoL")
            renderedText = "<div style='text-align: right;'>" + renderedText + "</div>";

        if(!inOptions.array)
            return {text: renderedText};
        else
            return {verses: verseArray};


    };


    return plain;
});
define('filterMgr',["filters/osis", "filters/plain"], function (osis, plain) {
    function processText(inRaw, inSource, inDirection, inOptions) {
        if(inSource && inSource.toLowerCase() === "osis")
            return osis.processText(inRaw, inDirection, inOptions);
        else
            return plain.processText(inRaw, inDirection, inOptions);
    }

    return {
        processText: processText
    };
});
/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('swmodule',["has", "dataMgr", "verseKey", "zText", "filterMgr", "versificationMgr"], function (has, dataMgr, verseKey, zText, filterMgr, versificationMgr) {
    var otBin = null,
        ntBin = null;

    //Constructor
    function Module(inModName, inId, inConfig) {
        if (!(this instanceof Module)) {
            throw new TypeError("Module constructor cannot be called as a function.");
        }

        this.modKey = inModName;
        this.id = inId;
        this.config = inConfig;
    }

    Module.create = function (inModName, inId, inConfig) {
        return new Module(inModName, inId, inConfig);
    };

    //get a module's config
    function getConfig(inId, inCallback) {
        /*dataMgr.getDocument(inId, function (inError, inConfig) {
            if (!inError)
                inCallback(inConfig);
        });*/
    }

    //get the module binary files
    function getBinaryBlob(inId, inCallback) {
        dataMgr.getBlob(inId, inCallback);
    }

    //Module Instance
    Module.prototype = {
        constructor: Module,
        self: this,

        renderText: function (inVKey, inOptions, inCallback) {
            var bcvPos = null,
                blobId = null,
                self = this;
            if (typeof inOptions === "function")
                inCallback = inOptions;
            var vList = verseKey.parseVerseList(inVKey, this.config.Versification);
            //console.log(vList);
            if(vList.length !== 0 && vList[0].osisRef !== "") {
                dataMgr.get(self.config.bcvPosID, function(inError, inBcv) {
                    //console.log(inBcv);
                    if(!inError) {
                        if (inBcv.nt && inBcv.nt.hasOwnProperty(vList[0].book)) {
                            bcvPos = inBcv.nt[vList[0].book];
                            blobId = self.config.nt;
                        } else if (inBcv.ot && inBcv.ot.hasOwnProperty(vList[0].book)) {
                            bcvPos = inBcv.ot[vList[0].book];
                            blobId = self.config.ot;
                        }
                        //console.log(blobId);

                        if(bcvPos === null) {
                            inCallback({message: "The requested chapter is not available in this module."});
                        } else {
                            getBinaryBlob(blobId, function (inError, inBlob) {
                                if (!inError) {
                                    if(true) {
                                        require(["worker"], function (worker) {
                                            worker.getRawEntry(inBlob, bcvPos, vList, self.config.Encoding, inOptions.intro ? inOptions.intro : false, function (inError, inRaw) {
                                                if (!inError)
                                                    worker.processText(inRaw, self.config.SourceType, self.config.Direction, inOptions, function (inError, inResult) {
                                                        inCallback(null, inResult);
                                                    });
                                                else
                                                    inCallback(inError);
                                            });
                                        });
                                    } else {
                                        zText.getRawEntry(inBlob, bcvPos, vList, self.config.Encoding, inOptions.intro ? inOptions.intro : false, function (inError, inRaw) {
                                            //console.log(inError, inRaw);
                                            if (!inError) {
                                                var result = filterMgr.processText(inRaw, self.config.SourceType, self.config.Direction, inOptions);
                                                inCallback(null, result);
                                            } else
                                                inCallback(inError);
                                        });
                                    }

                                } else {
                                    inCallback(inError);
                                }

                            });
                        }
                    } else {
                        inCallback(inError);
                    }

                });
            } else {
                inCallback({message: "Wrong passage. The requested chapter is not available in this module."});
            }
        },

        getAllBooks: function () {
            return versificationMgr.getAllBooks(this.config.Versification);
        },

        //inOsis can be Matt.3
        getVersesInChapter: function (inOsis) {
            return versificationMgr.getVersesInChapter(versificationMgr.getBookNum(inOsis.split(".")[0], this.config.Versification), inOsis.split(".")[1], this.config.Versification);
        }
    };

    return Module;
});
/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

define('moduleMgr',["dataMgr", "swmodule"], function (dataMgr, Module) {
    var moduleMgr = {};

    moduleMgr.getModules = function (inCallback) {
        var modules = [];
        dataMgr.getModules(function (inError, inModules) {
            if(!inError) {
                inModules.forEach(function (mod) {
                    modules.push(new Module(mod.moduleKey, mod.id, {
                        id: mod.id,
                        Versification: mod.Versification,
                        Encoding: mod.Encoding,
                        Direction: mod.Direction,
                        SourceType: mod.SourceType,
                        bcvPosID: mod.bcvPosID,
                        //blobIds: mod.blobIds,
                        ot: mod.ot,
                        nt: mod.nt,
                        moduleKey: mod.moduleKey
                    }));
                });
                inCallback(null, modules);
            } else
                inCallback(inError);
        });
    };

    moduleMgr.getModule = function(inId, inCallback) {
        dataMgr.get(inId, function (inError, inMod) {
            if(!inError) inCallback(null, new Module(inMod.moduleKey, inId, inMod));
            else inCallback(null);
        });
    };

    return moduleMgr;
});
define('config',[], function () {
    var config = {};
    config.version = "0.2";
    config.workerPath = "lib/sword";
    config.setWorkerPath = function (inPath) {
        config.workerPath = inPath;
    };

    return config;
});
/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/
require.config({
    paths: {
        //"sword": "../sword.min",
        "text": "libs/text/text",
        "json": "libs/json/src/json",
        "async": "libs/async/lib/async",
        "bcv": "libs/bible-reference-parser/js/en_bcv_parser.min",
        "unzip": "libs/zlib/bin/unzip.min",
        "inflateStream": "libs/zlib/bin/inflate_stream.min",
        "sax": "libs/sax/lib/sax",
        "idb": "libs/IDBWrapper/idbstore.min",
        "has": "libs/has/has",
        //"pako": "libs/pako/dist/pako"

    },
    shim: {
        "bcv": {
            exports: "bcv_parser",
            init: function () {
                return new this.bcv_parser();
            }
        },
        "unzip": {
            exports: "Zlib"
        },
        "inflateStream": {
            exports: "Zlib"
        },
        "sax": {
            exports: "sax"
        }
    }
});

define('sword',["installMgr", "moduleMgr", "dataMgr", "versificationMgr", "verseKey", "config"],
    function (installMgr, moduleMgr, dataMgr, versificationMgr, verseKey, config) {
        var sword = {};
        sword.installMgr = installMgr;
        sword.moduleMgr = moduleMgr;
        sword.versificationMgr = versificationMgr;
        sword.dataMgr = dataMgr;
        sword.verseKey = verseKey;
        sword.config = config;

        //check if sword is supported in your environment
        sword.isSupported = function () {
            //simple Array forEach check
            var toString = {}.toString,
                EMPTY_ARRAY = [],
                FUNCTION_CLASS = "[object Function]";
            if (window.FileReader && toString.call(EMPTY_ARRAY.forEach) == FUNCTION_CLASS)
                return true;
            else
                return false;
        };

        return sword;
});
define('worker',["has", "config"], function (has, config) {
    var cb = {};
    var path = "";
    if (true && config.hasOwnProperty("workerPath")) {
        path = config.workerPath + "/swordWorker.min.js";
    } else {
        path = "swordWorker.min.js";
    }
    var worker = new Worker(path);

    worker.addEventListener('message', function(e) {
        var cmd = e.data.cmd,
            result = e.data.result;
        if(cmd && cb[cmd]) {
            cb[cmd](null, result);
            delete cb[cmd];
        } else {
            console.log(e.data);
        }

        return true;
    }, false);

    worker.addEventListener('error', function(e) {
        console.log('ERROR: ', e);
        return true;
    }, false);

    function getRawEntry(inBlob, bcvPos, vList, inEncoding, inIntro, inCallback) {
        cb["getRawEntry"] = inCallback;
        worker.postMessage({"cmd": "getRawEntry", "blob": inBlob, "bcvPos": bcvPos, "vList": vList, "encoding": inEncoding, "intro": inIntro});
    }

    function processText(inRaw, inSource, inDirection, inOptions, inCallback) {
        cb["processText"] = inCallback;
        worker.postMessage({"cmd": "processText", "raw": inRaw, "source": inSource, "direction": inDirection, "options": inOptions});
    }

    return {
        getRawEntry: getRawEntry,
        processText: processText
    };
});
    //The modules for your project will be inlined above
    //this snippet. Ask almond to synchronously require the
    //module value for 'main' here and return it as the
    //value to use for the public API for the built file.
    return require('sword');
}));