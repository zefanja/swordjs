/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */

/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/

/**
*
*  MD5 (Message-Digest Algorithm)
*
*  For original source see http://www.webtoolkit.info/
*  Download: 15.02.2009 from http://www.webtoolkit.info/javascript-md5.html
*
*  Licensed under CC-BY 2.0 License
*  (http://creativecommons.org/licenses/by/2.0/uk/)
*
**/

// parseUri 1.2.2
// (c) Steven Levithan <stevenlevithan.com>
// MIT License

/*### BEGIN LICENSE
# Copyright (C) 2013 Stephan Tetzel <info@zefanjas.de>
#
# This program is free software: you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 3, as published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranties of
# MERCHANTABILITY, SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR
# PURPOSE.  See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program.  If not, see <http://www.gnu.org/licenses/>.
### END LICENSE*/

/**
 * @license RequireJS text 2.0.7 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/** @license
 * RequireJS plugin for loading JSON files
 * - depends on Text plugin and it was HEAVILY "inspired" by it as well.
 * Author: Miller Medeiros
 * Version: 0.3.1 (2013/02/04)
 * Released under the MIT license
 */

// ### This code is based on the zTextReader class from cross-connect (https://code.google.com/p/cross-connect), Copyright (C) 2011 Thomas Dilts ###

(function(e,t){typeof define=="function"&&define.amd?define(t):e.sword=t()})(this,function(){var requirejs,require,define;return function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}}(),define("almond",function(){}),function(){function e(e){throw e}function i(e,n){var i=e.split("."),s=r;!(i[0]in s)&&s.execScript&&s.execScript("var "+i[0]);for(var o;i.length&&(o=i.shift());)!i.length&&n!==t?s[o]=n:s=s[o]?s[o]:s[o]={}}function c(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,i,o,u,a,f,l,c,h,p;for(h=0;h<t;++h)e[h]>n&&(n=e[h]),e[h]<r&&(r=e[h]);i=1<<n,o=new(s?Uint32Array:Array)(i),u=1,a=0;for(f=2;u<=n;){for(h=0;h<t;++h)if(e[h]===u){l=0,c=a;for(p=0;p<u;++p)l=l<<1|c&1,c>>=1;for(p=l;p<i;p+=f)o[p]=u<<16|h;++a}++u,a<<=1,f<<=1}return[o,n,r]}function v(t,n){this.l=[],this.m=32768,this.d=this.f=this.c=this.t=0,this.input=s?new Uint8Array(t):t,this.u=!1,this.n=g,this.K=!1;if(n||!(n={}))n.index&&(this.c=n.index),n.bufferSize&&(this.m=n.bufferSize),n.bufferType&&(this.n=n.bufferType),n.resize&&(this.K=n.resize);switch(this.n){case m:this.a=32768,this.b=new(s?Uint8Array:Array)(32768+this.m+258);break;case g:this.a=0,this.b=new(s?Uint8Array:Array)(this.m),this.e=this.W,this.B=this.R,this.q=this.V;break;default:e(Error("invalid inflate mode"))}}function B(n,r){for(var i=n.f,s=n.d,o=n.input,u=n.c,a;s<r;)a=o[u++],a===t&&e(Error("input buffer is broken")),i|=a<<s,s+=8;return a=i&(1<<r)-1,n.f=i>>>r,n.d=s-r,n.c=u,a}function j(e,n){for(var r=e.f,i=e.d,s=e.input,o=e.c,u=n[0],a=n[1],f,l,c;i<a;){f=s[o++];if(f===t)break;r|=f<<i,i+=8}return l=u[r&(1<<a)-1],c=l>>>16,e.f=r>>c,e.d=i-c,e.c=o,l&65535}function F(e){function t(e,t,n){var r,i,s,o;for(o=0;o<e;)switch(r=j(this,t),r){case 16:for(s=3+B(this,2);s--;)n[o++]=i;break;case 17:for(s=3+B(this,3);s--;)n[o++]=0;i=0;break;case 18:for(s=11+B(this,7);s--;)n[o++]=0;i=0;break;default:i=n[o++]=r}return n}var n=B(e,5)+257,r=B(e,5)+1,i=B(e,4)+4,o=new(s?Uint8Array:Array)(b.length),u,a,f,l;for(l=0;l<i;++l)o[b[l]]=B(e,3);u=c(o),a=new(s?Uint8Array:Array)(n),f=new(s?Uint8Array:Array)(r),e.q(c(t.call(e,n,u,a)),c(t.call(e,r,u,f)))}function I(e){e=e||{},this.files=[],this.v=e.comment}function q(e,t){t=t||{},this.input=s&&e instanceof Array?new Uint8Array(e):e,this.c=0,this.ba=t.verify||!1,this.j=t.password}function U(e,t){this.input=e,this.offset=t}function z(e,t){this.input=e,this.offset=t}function X(n){var r=[],i={},o,u,a,f;if(!n.i){if(n.o===t){var l=n.input,c;if(!n.D)e:{var h=n.input,p;for(p=h.length-12;0<p;--p)if(80===h[p]&&75===h[p+1]&&5===h[p+2]&&6===h[p+3]){n.D=p;break e}e(Error("End of Central Directory Record not found"))}c=n.D,(80!==l[c++]||75!==l[c++]||5!==l[c++]||6!==l[c++])&&e(Error("invalid signature")),n.ha=l[c++]|l[c++]<<8,n.ja=l[c++]|l[c++]<<8,n.ka=l[c++]|l[c++]<<8,n.aa=l[c++]|l[c++]<<8,n.Q=l[c++]|l[c++]<<8|l[c++]<<16|l[c++]<<24,n.o=l[c++]|l[c++]<<8|l[c++]<<16|l[c++]<<24,n.w=l[c++]|l[c++]<<8,n.v=s?l.subarray(c,c+n.w):l.slice(c,c+n.w)}o=n.o,a=0;for(f=n.aa;a<f;++a)u=new U(n.input,o),u.parse(),o+=u.length,r[a]=u,i[u.filename]=a;n.Q<o-n.o&&e(Error("invalid file header size")),n.i=r,n.G=i}}function V(e,t,n){return n^=e.s(t),e.k(t,n),n}var t=void 0,n,r=this,s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;new(s?Uint8Array:Array)(256);var o;for(o=0;256>o;++o)for(var u=o,a=7,u=u>>>1;u;u>>>=1)--a;var f=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],l=s?new Uint32Array(f):f,h=[],p;for(p=0;288>p;p++)switch(!0){case 143>=p:h.push([p+48,8]);break;case 255>=p:h.push([p-144+400,9]);break;case 279>=p:h.push([p-256+0,7]);break;case 287>=p:h.push([p-280+192,8]);break;default:e("invalid literal: "+p)}var d=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var n=[],r,i;for(r=3;258>=r;r++)i=t(r),n[r]=i[2]<<24|i[1]<<16|i[0];return n}();s&&new Uint32Array(d);var m=0,g=1;v.prototype.r=function(){for(;!this.u;){var n=B(this,3);n&1&&(this.u=!0),n>>>=1;switch(n){case 0:var r=this.input,i=this.c,o=this.b,u=this.a,a=t,f=t,l=t,c=o.length,h=t;this.d=this.f=0,a=r[i++],a===t&&e(Error("invalid uncompressed block header: LEN (first byte)")),f=a,a=r[i++],a===t&&e(Error("invalid uncompressed block header: LEN (second byte)")),f|=a<<8,a=r[i++],a===t&&e(Error("invalid uncompressed block header: NLEN (first byte)")),l=a,a=r[i++],a===t&&e(Error("invalid uncompressed block header: NLEN (second byte)")),l|=a<<8,f===~l&&e(Error("invalid uncompressed block header: length verify")),i+f>r.length&&e(Error("input buffer is broken"));switch(this.n){case m:for(;u+f>o.length;){h=c-u,f-=h;if(s)o.set(r.subarray(i,i+h),u),u+=h,i+=h;else for(;h--;)o[u++]=r[i++];this.a=u,o=this.e(),u=this.a}break;case g:for(;u+f>o.length;)o=this.e({H:2});break;default:e(Error("invalid inflate mode"))}if(s)o.set(r.subarray(i,i+f),u),u+=f,i+=f;else for(;f--;)o[u++]=r[i++];this.c=i,this.a=u,this.b=o;break;case 1:this.q(M,H);break;case 2:F(this);break;default:e(Error("unknown BTYPE: "+n))}}return this.B()};var y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=s?new Uint16Array(y):y,w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],E=s?new Uint16Array(w):w,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],x=s?new Uint8Array(S):S,T=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],N=s?new Uint16Array(T):T,C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=s?new Uint8Array(C):C,L=new(s?Uint8Array:Array)(288),A,O;A=0;for(O=L.length;A<O;++A)L[A]=143>=A?8:255>=A?9:279>=A?7:8;var M=c(L),_=new(s?Uint8Array:Array)(30),D,P;D=0;for(P=_.length;D<P;++D)_[D]=5;var H=c(_);n=v.prototype,n.q=function(e,t){var n=this.b,r=this.a;this.C=e;for(var i=n.length-258,s,o,u,a;256!==(s=j(this,e));)if(256>s)r>=i&&(this.a=r,n=this.e(),r=this.a),n[r++]=s;else{o=s-257,a=E[o],0<x[o]&&(a+=B(this,x[o])),s=j(this,t),u=N[s],0<k[s]&&(u+=B(this,k[s])),r>=i&&(this.a=r,n=this.e(),r=this.a);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.d;)this.d-=8,this.c--;this.a=r},n.V=function(e,t){var n=this.b,r=this.a;this.C=e;for(var i=n.length,s,o,u,a;256!==(s=j(this,e));)if(256>s)r>=i&&(n=this.e(),i=n.length),n[r++]=s;else{o=s-257,a=E[o],0<x[o]&&(a+=B(this,x[o])),s=j(this,t),u=N[s],0<k[s]&&(u+=B(this,k[s])),r+a>i&&(n=this.e(),i=n.length);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.d;)this.d-=8,this.c--;this.a=r},n.e=function(){var e=new(s?Uint8Array:Array)(this.a-32768),t=this.a-32768,n,r,i=this.b;if(s)e.set(i.subarray(32768,e.length));else{n=0;for(r=e.length;n<r;++n)e[n]=i[n+32768]}this.l.push(e),this.t+=e.length;if(s)i.set(i.subarray(t,t+32768));else for(n=0;32768>n;++n)i[n]=i[t+n];return this.a=32768,i},n.W=function(e){var t,n=this.input.length/this.c+1|0,r,i,o,u=this.input,a=this.b;return e&&("number"==typeof e.H&&(n=e.H),"number"==typeof e.P&&(n+=e.P)),2>n?(r=(u.length-this.c)/this.C[2],o=258*(r/2)|0,i=o<a.length?a.length+o:a.length<<1):i=a.length*n,s?(t=new Uint8Array(i),t.set(a)):t=a,this.b=t},n.B=function(){var e=0,t=this.b,n=this.l,r,i=new(s?Uint8Array:Array)(this.t+(this.a-32768)),o,u,a,f;if(0===n.length)return s?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);o=0;for(u=n.length;o<u;++o){r=n[o],a=0;for(f=r.length;a<f;++a)i[e++]=r[a]}o=32768;for(u=this.a;o<u;++o)i[e++]=t[o];return this.l=[],this.buffer=i},n.R=function(){var e,t=this.a;return s?this.K?(e=new Uint8Array(t),e.set(this.b.subarray(0,t))):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},I.prototype.L=function(e){this.j=e},I.prototype.s=function(e){var t=e[2]&65535|2;return t*(t^1)>>8&255},I.prototype.k=function(e,t){e[0]=(l[(e[0]^t)&255]^e[0]>>>8)>>>0,e[1]=(6681*(20173*(e[1]+(e[0]&255))>>>0)>>>0)+1>>>0,e[2]=(l[(e[2]^e[1]>>>24)&255]^e[2]>>>8)>>>0},I.prototype.T=function(e){var t=[305419896,591751049,878082192],n,r;s&&(t=new Uint32Array(t)),n=0;for(r=e.length;n<r;++n)this.k(t,e[n]&255);return t};var R={O:0,M:8};U.prototype.parse=function(){var t=this.input,n=this.offset;(80!==t[n++]||75!==t[n++]||1!==t[n++]||2!==t[n++])&&e(Error("invalid file header signature")),this.version=t[n++],this.ia=t[n++],this.Z=t[n++]|t[n++]<<8,this.I=t[n++]|t[n++]<<8,this.A=t[n++]|t[n++]<<8,this.time=t[n++]|t[n++]<<8,this.U=t[n++]|t[n++]<<8,this.p=(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,this.z=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.J=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.h=t[n++]|t[n++]<<8,this.g=t[n++]|t[n++]<<8,this.F=t[n++]|t[n++]<<8,this.ea=t[n++]|t[n++]<<8,this.ga=t[n++]|t[n++]<<8,this.fa=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.$=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.filename=String.fromCharCode.apply(null,s?t.subarray(n,n+=this.h):t.slice(n,n+=this.h)),this.X=s?t.subarray(n,n+=this.g):t.slice(n,n+=this.g),this.v=s?t.subarray(n,n+this.F):t.slice(n,n+this.F),this.length=n-this.offset};var W={N:1,ca:8,da:2048};z.prototype.parse=function(){var t=this.input,n=this.offset;(80!==t[n++]||75!==t[n++]||3!==t[n++]||4!==t[n++])&&e(Error("invalid local file header signature")),this.Z=t[n++]|t[n++]<<8,this.I=t[n++]|t[n++]<<8,this.A=t[n++]|t[n++]<<8,this.time=t[n++]|t[n++]<<8,this.U=t[n++]|t[n++]<<8,this.p=(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)>>>0,this.z=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.J=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,this.h=t[n++]|t[n++]<<8,this.g=t[n++]|t[n++]<<8,this.filename=String.fromCharCode.apply(null,s?t.subarray(n,n+=this.h):t.slice(n,n+=this.h)),this.X=s?t.subarray(n,n+=this.g):t.slice(n,n+=this.g),this.length=n-this.offset},n=q.prototype,n.Y=function(){var e=[],t,n,r;this.i||X(this),r=this.i,t=0;for(n=r.length;t<n;++t)e[t]=r[t].filename;return e},n.r=function(n){var r;this.G||X(this),r=this.G[n],r===t&&e(Error(n+" not found"));var i=this.input,o=this.i,u,a,f,c,h,p,d,m;o||X(this),o[r]===t&&e(Error("wrong index")),a=o[r].$,u=new z(this.input,a),u.parse(),a+=u.length,f=u.z;if(0!==(u.I&W.N)){this.j||e(Error("please set password")),p=this.S(this.j),d=a;for(m=a+12;d<m;++d)V(this,p,i[d]);a+=12,f-=12,d=a;for(m=a+f;d<m;++d)i[d]=V(this,p,i[d])}switch(u.A){case R.O:c=s?this.input.subarray(a,a+f):this.input.slice(a,a+f);break;case R.M:c=(new v(this.input,{index:a,bufferSize:u.J})).r();break;default:e(Error("unknown compression type"))}if(this.ba){var g=t,y,b="number"==typeof g?g:g=0,w=c.length;y=-1;for(b=w&7;b--;++g)y=y>>>8^l[(y^c[g])&255];for(b=w>>3;b--;g+=8)y=y>>>8^l[(y^c[g])&255],y=y>>>8^l[(y^c[g+1])&255],y=y>>>8^l[(y^c[g+2])&255],y=y>>>8^l[(y^c[g+3])&255],y=y>>>8^l[(y^c[g+4])&255],y=y>>>8^l[(y^c[g+5])&255],y=y>>>8^l[(y^c[g+6])&255],y=y>>>8^l[(y^c[g+7])&255];h=(y^4294967295)>>>0,u.p!==h&&e(Error("wrong crc: file=0x"+u.p.toString(16)+", data=0x"+h.toString(16)))}return c},n.L=function(e){this.j=e},n.k=I.prototype.k,n.S=I.prototype.T,n.s=I.prototype.s,i("Zlib.Unzip",q),i("Zlib.Unzip.prototype.decompress",q.prototype.r),i("Zlib.Unzip.prototype.getFilenames",q.prototype.Y),i("Zlib.Unzip.prototype.setPassword",q.prototype.L)}.call(this),define("unzip",function(e){return function(){var t,n;return t||e.Zlib}}(this)),function(){function r(e){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,e.apply(t,arguments)}}var e={},t,n;t=this,t!=null&&(n=t.async),e.noConflict=function(){return t.async=n,e};var i=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},s=function(e,t){if(e.map)return e.map(t);var n=[];return i(e,function(e,r,i){n.push(t(e,r,i))}),n},o=function(e,t,n){return e.reduce?e.reduce(t,n):(i(e,function(e,r,i){n=t(n,e,r,i)}),n)},u=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};typeof process=="undefined"||!process.nextTick?typeof setImmediate=="function"?(e.nextTick=function(e){setImmediate(e)},e.setImmediate=e.nextTick):(e.nextTick=function(e){setTimeout(e,0)},e.setImmediate=e.nextTick):(e.nextTick=process.nextTick,typeof setImmediate!="undefined"?e.setImmediate=setImmediate:e.setImmediate=e.nextTick),e.each=function(e,t,n){n=n||function(){};if(!e.length)return n();var s=0;i(e,function(i){t(i,r(function(t){t?(n(t),n=function(){}):(s+=1,s>=e.length&&n(null))}))})},e.forEach=e.each,e.eachSeries=function(e,t,n){n=n||function(){};if(!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n(null):i())})};i()},e.forEachSeries=e.eachSeries,e.eachLimit=function(e,t,n,r){var i=a(t);i.apply(null,[e,n,r])},e.forEachLimit=e.eachLimit;var a=function(e){return function(t,n,r){r=r||function(){};if(!t.length||e<=0)return r();var i=0,s=0,o=0;(function u(){if(i>=t.length)return r();while(o<e&&s<t.length)s+=1,o+=1,n(t[s-1],function(e){e?(r(e),r=function(){}):(i+=1,o-=1,i>=t.length?r():u())})})()}},f=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.each].concat(n))}},l=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[a(e)].concat(n))}},c=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.eachSeries].concat(n))}},h=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})};e.map=f(h),e.mapSeries=c(h),e.mapLimit=function(e,t,n,r){return p(t)(e,n,r)};var p=function(e){return l(e,h)};e.reduce=function(t,n,r,i){e.eachSeries(t,function(e,t){r(n,e,function(e,r){n=r,t(e)})},function(e){i(e,n)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(t,n,r,i){var o=s(t,function(e){return e}).reverse();e.reduce(o,n,r,i)},e.foldr=e.reduceRight;var d=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(s(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.filter=f(d),e.filterSeries=c(d),e.select=e.filter,e.selectSeries=e.filterSeries;var v=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(s(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.reject=f(v),e.rejectSeries=c(v);var m=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};e.detect=f(m),e.detectSeries=c(m),e.some=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e&&(r(!0),r=function(){}),t()})},function(e){r(!1)})},e.any=e.some,e.every=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e||(r(!1),r=function(){}),t()})},function(e){r(!0)})},e.all=e.every,e.sortBy=function(t,n,r){e.map(t,function(e,t){n(e,function(n,r){n?t(n):t(null,{value:e,criteria:r})})},function(e,t){if(e)return r(e);var n=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};r(null,s(t.sort(n),function(e){return e.value}))})},e.auto=function(t,n){n=n||function(){};var r=u(t);if(!r.length)return n(null);var s={},a=[],f=function(e){a.unshift(e)},l=function(e){for(var t=0;t<a.length;t+=1)if(a[t]===e){a.splice(t,1);return}},c=function(){i(a.slice(0),function(e){e()})};f(function(){u(s).length===r.length&&(n(null,s),n=function(){})}),i(r,function(r){var a=t[r]instanceof Function?[t[r]]:t[r],h=function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]);if(t){var a={};i(u(s),function(e){a[e]=s[e]}),a[r]=o,n(t,a),n=function(){}}else s[r]=o,e.setImmediate(c)},p=a.slice(0,Math.abs(a.length-1))||[],d=function(){return o(p,function(e,t){return e&&s.hasOwnProperty(t)},!0)&&!s.hasOwnProperty(r)};if(d())a[a.length-1](h,s);else{var v=function(){d()&&(l(v),a[a.length-1](h,s))};f(v)}})},e.waterfall=function(t,n){n=n||function(){};if(t.constructor!==Array){var r=new Error("First argument to waterfall must be an array of functions");return n(r)}if(!t.length)return n();var i=function(t){return function(r){if(r)n.apply(null,arguments),n=function(){};else{var s=Array.prototype.slice.call(arguments,1),o=t.next();o?s.push(i(o)):s.push(n),e.setImmediate(function(){t.apply(null,s)})}}};i(e.iterator(t))()};var g=function(e,t,n){n=n||function(){};if(t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(u(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};e.parallel=function(t,n){g({map:e.map,each:e.each},t,n)},e.parallelLimit=function(e,t,n){g({map:p(t),each:a(t)},e,n)},e.series=function(t,n){n=n||function(){};if(t.constructor===Array)e.mapSeries(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.eachSeries(u(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}},e.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},e.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var y=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};e.concat=f(y),e.concatSeries=c(y),e.whilst=function(t,n,r){t()?n(function(i){if(i)return r(i);e.whilst(t,n,r)}):r()},e.doWhilst=function(t,n,r){t(function(i){if(i)return r(i);n()?e.doWhilst(t,n,r):r()})},e.until=function(t,n,r){t()?r():n(function(i){if(i)return r(i);e.until(t,n,r)})},e.doUntil=function(t,n,r){t(function(i){if(i)return r(i);n()?r():e.doUntil(t,n,r)})},e.queue=function(t,n){function s(t,r,s,o){r.constructor!==Array&&(r=[r]),i(r,function(r){var i={data:r,callback:typeof o=="function"?o:null};s?t.tasks.unshift(i):t.tasks.push(i),t.saturated&&t.tasks.length===n&&t.saturated(),e.setImmediate(t.process)})}n===undefined&&(n=1);var o=0,u={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(e,t){s(u,e,!1,t)},unshift:function(e,t){s(u,e,!0,t)},process:function(){if(o<u.concurrency&&u.tasks.length){var e=u.tasks.shift();u.empty&&u.tasks.length===0&&u.empty(),o+=1;var n=function(){o-=1,e.callback&&e.callback.apply(e,arguments),u.drain&&u.tasks.length+o===0&&u.drain(),u.process()},i=r(n);t(e.data,i)}},length:function(){return u.tasks.length},running:function(){return o}};return u},e.cargo=function(t,n){var r=!1,o=[],u={tasks:o,payload:n,saturated:null,empty:null,drain:null,push:function(t,r){t.constructor!==Array&&(t=[t]),i(t,function(e){o.push({data:e,callback:typeof r=="function"?r:null}),u.saturated&&o.length===n&&u.saturated()}),e.setImmediate(u.process)},process:function a(){if(r)return;if(o.length===0){u.drain&&u.drain();return}var e=typeof n=="number"?o.splice(0,n):o.splice(0),f=s(e,function(e){return e.data});u.empty&&u.empty(),r=!0,t(f,function(){r=!1;var t=arguments;i(e,function(e){e.callback&&e.callback.apply(null,t)}),a()})},length:function(){return o.length},running:function(){return r}};return u};var b=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(t?console.error&&console.error(t):console[e]&&i(n,function(t){console[e](t)}))}]))}};e.log=b("log"),e.dir=b("dir"),e.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),s=i.pop(),o=t.apply(null,i);o in n?s.apply(null,n[o]):o in r?r[o].push(s):(r[o]=[s],e.apply(null,i.concat([function(){n[o]=arguments;var e=r[o];delete r[o];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},e.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},e.times=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.map(i,n,r)},e.timesSeries=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.mapSeries(i,n,r)},e.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();e.reduce(t,r,function(e,t,r){t.apply(n,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,t){i.apply(n,[e].concat(t))})}};var w=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};e.applyEach=f(w),e.applyEachSeries=c(w),e.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},typeof define!="undefined"&&define.amd?define("async",[],function(){return e}):typeof module!="undefined"&&module.exports?module.exports=e:t.async=e}(),function(){function pathToTree(e){var t=e.shift(),n=[t.id,t.opts,[]],r=n,i;while(e.length)t=e.shift(),i=[t.id,t.opts,[]],r[2].push(i),r=i;return n}function mergeTree(e,t){var n=[{tree1:e,tree2:t}],r=!1;while(n.length>0){var i=n.pop(),s=i.tree1,o=i.tree2;if(s[1].status||o[1].status)s[1].status=s[1].status==="available"||o[1].status==="available"?"available":"missing";for(var u=0;u<o[2].length;u++){if(!s[2][0]){r="new_leaf",s[2][0]=o[2][u];continue}var a=!1;for(var f=0;f<s[2].length;f++)s[2][f][0]===o[2][u][0]&&(n.push({tree1:s[2][f],tree2:o[2][u]}),a=!0);a||(r="new_branch",s[2].push(o[2][u]),s[2].sort())}}return{conflicts:r,tree:e}}function doMerge(e,t,n){var r=[],i=!1,s=!1,o,u;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])o=mergeTree(e.ids,t.ids),r.push({pos:e.pos,ids:o.tree}),i=i||o.conflicts,s=!0;else if(n!==!0){var u=e.pos<t.pos?e:t,a=e.pos<t.pos?t:e,f=a.pos-u.pos,l=[],c=[];c.push({ids:u.ids,diff:f,parent:null,parentIdx:null});while(c.length>0){var h=c.pop();if(h.diff===0){h.ids[0]===a.ids[0]&&l.push(h);continue}if(!h.ids)continue;h.ids[2].forEach(function(e,t){c.push({ids:e,diff:h.diff-1,parent:h.ids,parentIdx:t})})}var p=l[0];p?(o=mergeTree(p.ids,a.ids),p.parent[2][p.parentIdx]=o.tree,r.push({pos:u.pos,ids:u.ids}),i=i||o.conflicts,s=!0):r.push(e)}else r.push(e)}),s||r.push(t),r.sort(function(e,t){return e.pos-t.pos}),{tree:r,conflicts:i||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function stem(e,t){var n=rootToLeaf(e).map(function(e){var n=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-n.length),ids:pathToTree(n)}});return n.reduce(function(e,t,n,r){return doMerge(e,t,!0).tree},[n.shift()])}function replicate(e,t,n,r){function d(e,t,r){i.notifyRequestComplete();if(n.onChange)for(var s=0;s<r;s++)n.onChange.apply(this,[p]);f-=r,p.docs_written+=r,E()}function v(){if(!s.length)return i.notifyRequestComplete();var e=s.length;t.bulkDocs({docs:s},{new_edits:!1},function(t,n){d(t,n,e)}),s=[]}function m(t,n){e.get(t,{revs:!0,rev:n,attachments:!0},function(e,t){i.notifyRequestComplete(),s.push(t),i.enqueue(v)})}function g(e,t){i.notifyRequestComplete();if(e){c&&r.cancel(),call(n.complete,e,null);return}if(Object.keys(t).length===0){f--,E();return}var s=function(e){i.enqueue(m,[o,e])};for(var o in t)t[o].missing.forEach(s)}function y(e){t.revsDiff(e,g)}function b(e){l=e.seq,u.push(e),p.docs_read++,f++;var t={};t[e.id]=e.changes.map(function(e){return e.rev}),i.enqueue(y,[t])}function w(){a=!0,E()}function E(){a&&f===0&&(p.end_time=Date.now(),writeCheckpoint(t,o,l,function(e,t){call(n.complete,e,p)}))}var i=new RequestManager,s=[],o=genReplicationId(e,t,n),u=[],a=!1,f=0,l=0,c=n.continuous||!1,h=n.doc_ids,p={ok:!0,start_time:new Date,docs_read:0,docs_written:0};fetchCheckpoint(t,o,function(t,i){if(t)return call(n.complete,t);l=i;if(r.cancelled)return;var s={continuous:c,since:l,style:"all_docs",onChange:b,complete:w,doc_ids:h};n.filter&&(s.filter=n.filter),n.query_params&&(s.query_params=n.query_params);var o=e.changes(s);n.continuous&&(r.cancel=o.cancel)})}function toPouch(e,t){if(typeof e=="string")return new Pouch(e,t);t(null,e)}function parseUri(e){var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r}function encodeDocId(e){return/^_design/.test(e)?e:encodeURIComponent(e)}function getHost(e){if(/http(s?):/.test(e)){var t=parseUri(e);t.remote=!0;if(t.user||t.password)t.auth={username:t.user,password:t.password};var n=t.path.replace(/(^\/|\/$)/g,"").split("/");return t.db=n.pop(),t.path=n.join("/"),t}return{host:"",path:"/",db:e,auth:!1}}function genDBUrl(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+e.db+"/"+t}return"/"+e.db+"/"+t}function genUrl(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function quote(e){return"'"+e+"'"}(function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r=e,i=[];n=n||r.length;if(t)for(var s=0;s<t;s++)i[s]=r[0|Math.random()*n];else{var o;i[8]=i[13]=i[18]=i[23]="-",i[14]="4";for(var s=0;s<36;s++)i[s]||(o=0|Math.random()*16,i[s]=r[s==19?o&3|8:o])}return i.join("")}})();var Crypto={};(function(){Crypto.MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,s,o;return i=e&2147483648,s=t&2147483648,n=e&1073741824,r=t&1073741824,o=(e&1073741823)+(t&1073741823),n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function u(e,i,s,o,u,a,f){return e=n(e,n(n(r(i,s,o),u),f)),n(t(e,a),i)}function a(e,r,s,o,u,a,f){return e=n(e,n(n(i(r,s,o),u),f)),n(t(e,a),r)}function f(e,r,i,o,u,a,f){return e=n(e,n(n(s(r,i,o),u),f)),n(t(e,a),r)}function l(e,r,i,s,u,a,f){return e=n(e,n(n(o(r,i,s),u),f)),n(t(e,a),r)}function c(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o}function h(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t}var p=Array(),d,v,m,g,y,b,w,E,S,x=7,T=12,N=17,C=22,k=5,L=9,A=14,O=20,M=4,_=11,D=16,P=23,H=6,B=10,j=15,F=21;p=c(e),b=1732584193,w=4023233417,E=2562383102,S=271733878;for(d=0;d<p.length;d+=16)v=b,m=w,g=E,y=S,b=u(b,w,E,S,p[d+0],x,3614090360),S=u(S,b,w,E,p[d+1],T,3905402710),E=u(E,S,b,w,p[d+2],N,606105819),w=u(w,E,S,b,p[d+3],C,3250441966),b=u(b,w,E,S,p[d+4],x,4118548399),S=u(S,b,w,E,p[d+5],T,1200080426),E=u(E,S,b,w,p[d+6],N,2821735955),w=u(w,E,S,b,p[d+7],C,4249261313),b=u(b,w,E,S,p[d+8],x,1770035416),S=u(S,b,w,E,p[d+9],T,2336552879),E=u(E,S,b,w,p[d+10],N,4294925233),w=u(w,E,S,b,p[d+11],C,2304563134),b=u(b,w,E,S,p[d+12],x,1804603682),S=u(S,b,w,E,p[d+13],T,4254626195),E=u(E,S,b,w,p[d+14],N,2792965006),w=u(w,E,S,b,p[d+15],C,1236535329),b=a(b,w,E,S,p[d+1],k,4129170786),S=a(S,b,w,E,p[d+6],L,3225465664),E=a(E,S,b,w,p[d+11],A,643717713),w=a(w,E,S,b,p[d+0],O,3921069994),b=a(b,w,E,S,p[d+5],k,3593408605),S=a(S,b,w,E,p[d+10],L,38016083),E=a(E,S,b,w,p[d+15],A,3634488961),w=a(w,E,S,b,p[d+4],O,3889429448),b=a(b,w,E,S,p[d+9],k,568446438),S=a(S,b,w,E,p[d+14],L,3275163606),E=a(E,S,b,w,p[d+3],A,4107603335),w=a(w,E,S,b,p[d+8],O,1163531501),b=a(b,w,E,S,p[d+13],k,2850285829),S=a(S,b,w,E,p[d+2],L,4243563512),E=a(E,S,b,w,p[d+7],A,1735328473),w=a(w,E,S,b,p[d+12],O,2368359562),b=f(b,w,E,S,p[d+5],M,4294588738),S=f(S,b,w,E,p[d+8],_,2272392833),E=f(E,S,b,w,p[d+11],D,1839030562),w=f(w,E,S,b,p[d+14],P,4259657740),b=f(b,w,E,S,p[d+1],M,2763975236),S=f(S,b,w,E,p[d+4],_,1272893353),E=f(E,S,b,w,p[d+7],D,4139469664),w=f(w,E,S,b,p[d+10],P,3200236656),b=f(b,w,E,S,p[d+13],M,681279174),S=f(S,b,w,E,p[d+0],_,3936430074),E=f(E,S,b,w,p[d+3],D,3572445317),w=f(w,E,S,b,p[d+6],P,76029189),b=f(b,w,E,S,p[d+9],M,3654602809),S=f(S,b,w,E,p[d+12],_,3873151461),E=f(E,S,b,w,p[d+15],D,530742520),w=f(w,E,S,b,p[d+2],P,3299628645),b=l(b,w,E,S,p[d+0],H,4096336452),S=l(S,b,w,E,p[d+7],B,1126891415),E=l(E,S,b,w,p[d+14],j,2878612391),w=l(w,E,S,b,p[d+5],F,4237533241),b=l(b,w,E,S,p[d+12],H,1700485571),S=l(S,b,w,E,p[d+3],B,2399980690),E=l(E,S,b,w,p[d+10],j,4293915773),w=l(w,E,S,b,p[d+1],F,2240044497),b=l(b,w,E,S,p[d+8],H,1873313359),S=l(S,b,w,E,p[d+15],B,4264355552),E=l(E,S,b,w,p[d+6],j,2734768916),w=l(w,E,S,b,p[d+13],F,1309151649),b=l(b,w,E,S,p[d+4],H,4149444226),S=l(S,b,w,E,p[d+11],B,3174756917),E=l(E,S,b,w,p[d+2],j,718787259),w=l(w,E,S,b,p[d+9],F,3951481745),b=n(b,v),w=n(w,m),E=n(E,g),S=n(S,y);var I=h(b)+h(w)+h(E)+h(S);return I.toLowerCase()}})(),function(){if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()){var e=Object.defineProperty;Object.defineProperty=function(t,n,r){if(e)try{return e(t,n,r)}catch(i){}if(t!==Object(t))throw new TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in r&&Object.prototype.__defineGetter__.call(t,n,r.get),Object.prototype.__defineSetter__&&"set"in r&&Object.prototype.__defineSetter__.call(t,n,r.set),"value"in r&&(t[n]=r.value),t}}}(),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),Array.prototype.forEach||(Array.prototype.forEach=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=arguments[1],i;for(i=0;i<n;i++)i in t&&e.call(r,t[i],i,t)}),Array.prototype.map||(Array.prototype.map=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=[];r.length=n;var i=arguments[1],s;for(s=0;s<n;s++)s in t&&(r[s]=e.call(i,t[s],s,t));return r});var class2type={},types=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];for(var i=0;i<types.length;i++){var typename=types[i];class2type["[object "+typename+"]"]=typename.toLowerCase()}var core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,type=function(e){return e===null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isWindow=function(e){return e!==null&&e===e.window},isPlainObject=function(e){if(!e||type(e)!=="object"||e.nodeType||isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e,"constructor")&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return n===undefined||core_hasOwn.call(e,n)},isFunction=function(e){return type(e)==="function"},isArray=Array.isArray||function(e){return type(e)==="array"},extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(isPlainObject(r)||(i=isArray(r)))?(i?(i=!1,s=n&&isArray(n)?n:[]):s=n&&isPlainObject(n)?n:{},o[t]=extend(f,s,r)):r!==undefined&&(o[t]=r)}return o};typeof module!="undefined"&&module.exports&&(module.exports=extend);var ajax=function(t,n){typeof t=="function"&&(n=t,t={});var r=function(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)},i={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4};t=extend(!0,i,t);if(t.auth){var s=btoa(t.auth.username+":"+t.auth.password);t.headers.Authorization="Basic "+s}var o=function(e,n,i){if(!t.binary&&!t.json&&t.processData&&typeof e!="string")e=JSON.stringify(e);else if(!t.binary&&t.json&&typeof e=="string")try{e=JSON.parse(e)}catch(s){r(i,s);return}r(i,null,e,n)},u=function(e,t){var n,i={status:e.status};try{n=JSON.parse(e.responseText),i=extend(!0,{},i,n)}catch(s){}r(t,i)};if(typeof window!="undefined"&&window.XMLHttpRequest){var a,f=!1,l=new XMLHttpRequest;l.open(t.method,t.url),t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.body&&t.processData&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body))),t.binary&&(l.responseType="arraybuffer");for(var c in t.headers)l.setRequestHeader(c,t.headers[c]);"body"in t||(t.body=null);var h=function(){f=!0,l.abort(),r(u,l,n)};return l.onreadystatechange=function(){if(l.readyState!==4||f)return;clearTimeout(a);if(l.status>=200&&l.status<300){var e;t.binary?e=new Blob([l.response||""],{type:l.getResponseHeader("Content-Type")}):e=l.responseText,r(o,e,l,n)}else r(u,l,n)},t.timeout>0&&(a=setTimeout(h,t.timeout)),l.send(t.body),{abort:h}}return t.json&&(t.binary||(t.headers.Accept="application/json"),t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json"),t.binary&&(t.encoding=null,t.json=!1),t.processData||(t.json=!1),request(t,function(e,i,s){if(e)return e.status=i?i.statusCode:400,r(u,e,n);var a=i.headers["content-type"],f=s||"";!t.binary&&(t.json||!t.processData)&&typeof f!="object"&&(/json/.test(a)||/^[\s]*\{/.test(f)&&/\}[\s]*$/.test(f))&&(f=JSON.parse(f));if(i.statusCode>=200&&i.statusCode<300)r(o,f,i,n);else{if(t.binary)var f=JSON.parse(f.toString());f.status=i.statusCode,r(n,f)}})};typeof module!="undefined"&&module.exports&&(module.exports=ajax);var Pouch=function Pouch(e,t,n){if(!(this instanceof Pouch))return new Pouch(e,t,n);if(typeof t=="function"||typeof t=="undefined")n=t,t={};typeof e=="object"&&(t=e,e=undefined),typeof n=="undefined"&&(n=function(){});var r=Pouch.parseAdapter(t.name||e);t.originalName=e,t.name=t.name||r.name,t.adapter=t.adapter||r.adapter;if(!Pouch.adapters[t.adapter])throw"Adapter is missing";if(!Pouch.adapters[t.adapter].valid())throw"Invalid Adapter";var i=new PouchAdapter(t,function(e,t){if(e){n&&n(e);return}for(var r in Pouch.plugins){var i=Pouch.plugins[r](t);for(var s in i)s in t||(t[s]=i[s])}t.taskqueue.ready(!0),t.taskqueue.execute(t),n(null,t)});for(var s in i)this[s]=i[s];for(var o in Pouch.plugins){var u=Pouch.plugins[o](this);for(var a in u)a in this||(this[a]=u[a])}};Pouch.DEBUG=!1,Pouch.openReqList={},Pouch.adapters={},Pouch.plugins={},Pouch.prefix="_pouch_",Pouch.parseAdapter=function(e){var t=e.match(/([a-z\-]*):\/\/(.*)/),n;if(t){e=/http(s?)/.test(t[1])?t[1]+"://"+t[2]:t[2],n=t[1];if(!Pouch.adapters[n].valid())throw"Invalid adapter";return{name:e,adapter:t[1]}}var r=["idb","leveldb","websql"];for(var i=0;i<r.length;++i)if(r[i]in Pouch.adapters){n=Pouch.adapters[r[i]];var s="use_prefix"in n?n.use_prefix:!0;return{name:s?Pouch.prefix+e:e,adapter:r[i]}}throw"No valid adapter found"},Pouch.destroy=function(e,t){var n=Pouch.parseAdapter(e),r=function(r,i){if(r){t(r);return}for(var s in Pouch.plugins)Pouch.plugins[s]._delete(e);Pouch.DEBUG&&console.log(e+": Delete Database"),Pouch.adapters[n.adapter].destroy(n.name,t)};Pouch.removeFromAllDbs(n,r)},Pouch.removeFromAllDbs=function(e,t){if(!Pouch.enableAllDbs){t();return}var n=e.adapter;if(n==="http"||n==="https"){t();return}new Pouch(Pouch.allDBName(e.adapter),function(n,r){if(n){console.error(n),t();return}var i=Pouch.dbName(e.adapter,e.name);r.get(i,function(e,n){e?t():r.remove(n,function(e,n){e&&console.error(e),t()})})})},Pouch.adapter=function(e,t){t.valid()&&(Pouch.adapters[e]=t)},Pouch.plugin=function(e,t){Pouch.plugins[e]=t},Pouch.enableAllDbs=!1,Pouch.ALL_DBS="_allDbs",Pouch.dbName=function(e,t){return[e,"-",t].join("")},Pouch.realDBName=function(e,t){return[e,"://",t].join("")},Pouch.allDBName=function(e){return[e,"://",Pouch.prefix+Pouch.ALL_DBS].join("")},Pouch.open=function(e,t){if(!Pouch.enableAllDbs){t();return}var n=e.adapter;if(n==="http"||n==="https"){t();return}new Pouch(Pouch.allDBName(n),function(r,i){if(r){console.error(r),t();return}var s=Pouch.dbName(n,e.name);i.get(s,function(n,r){n&&n.status===404?i.put({_id:s,dbname:e.originalName},function(e){e&&console.error(e),t()}):t()})})},Pouch.allDbs=function(e){var t=function(n,r){if(n.length===0){var i=[];r.forEach(function(e){var t=i.some(function(t){return t.id===e.id});t||i.push(e)}),e(null,i.map(function(e){return e.doc.dbname}));return}var s=n.shift();if(s==="http"||s==="https"){t(n,r);return}new Pouch(Pouch.allDBName(s),function(i,s){if(i){e(i);return}s.allDocs({include_docs:!0},function(i,s){if(i){e(i);return}r.unshift.apply(r,s.rows),t(n,r)})})},n=Object.keys(Pouch.adapters);t(n,[])},Pouch.uuids=function(e,t){typeof t!="object"&&(t={});var n=t.length,r=t.radix,i=[];while(i.push(Math.uuid(n,r))<e);return i},Pouch.uuid=function(e){return Pouch.uuids(1,e)[0]},Pouch.Errors={MISSING_BULK_DOCS:{status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"},MISSING_DOC:{status:404,error:"not_found",reason:"missing"},REV_CONFLICT:{status:409,error:"conflict",reason:"Document update conflict"},INVALID_ID:{status:400,error:"invalid_id",reason:"_id field must contain a string"},MISSING_ID:{status:412,error:"missing_id",reason:"_id is required for puts"},RESERVED_ID:{status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."},NOT_OPEN:{status:412,error:"precondition_failed",reason:"Database not open so cannot close"},UNKNOWN_ERROR:{status:500,error:"unknown_error",reason:"Database encountered an unknown error"},BAD_ARG:{status:500,error:"badarg",reason:"Some query argument is invalid"},INVALID_REQUEST:{status:400,error:"invalid_request",reason:"Request was invalid"},QUERY_PARSE_ERROR:{status:400,error:"query_parse_error",reason:"Some query parameter is invalid"},DOC_VALIDATION:{status:500,error:"doc_validation",reason:"Bad special document member"},BAD_REQUEST:{status:400,error:"bad_request",reason:"Something wrong with the request"},NOT_AN_OBJECT:{status:400,error:"bad_request",reason:"Document must be a JSON object"}},Pouch.error=function(e,t){return extend({},e,{reason:t})};if(typeof module!="undefined"&&module.exports){global.Pouch=Pouch,Pouch.merge=require("./pouch.merge.js").merge,Pouch.collate=require("./pouch.collate.js").collate,Pouch.replicate=require("./pouch.replicate.js").replicate,Pouch.utils=require("./pouch.utils.js"),extend=Pouch.utils.extend,module.exports=Pouch;var PouchAdapter=require("./pouch.adapter.js"),adapters=["leveldb","http"];adapters.map(function(e){var t="./adapters/pouch."+e+".js";require(t)}),require("./plugins/pouchdb.mapreduce.js"),require("./deps/uuid.js")}else window.Pouch=Pouch;typeof module!="undefined"&&module.exports&&(module.exports=Pouch);var stringCollate=function(e,t){return e===t?0:e>t?1:-1},objectCollate=function(e,t){var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length);for(var s=0;s<i;s++){var o=Pouch.collate(n[s],r[s]);if(o!==0)return o;o=Pouch.collate(e[n[s]],t[r[s]]);if(o!==0)return o}return n.length===r.length?0:n.length>r.length?1:-1},arrayCollate=function(e,t){var n=Math.min(e.length,t.length);for(var r=0;r<n;r++){var i=Pouch.collate(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1},collationIndex=function(e){var t=["boolean","number","string","object"];if(t.indexOf(typeof e)!==-1)return e===null?1:t.indexOf(typeof e)+2;if(Array.isArray(e))return 4.5};Pouch.collate=function(e,t){var n=collationIndex(e),r=collationIndex(t);if(n-r!==0)return n-r;if(e===null)return 0;if(typeof e=="number")return e-t;if(typeof e=="boolean")return e<t?-1:1;if(typeof e=="string")return stringCollate(e,t);if(Array.isArray(e))return arrayCollate(e,t);if(typeof e=="object")return objectCollate(e,t)};if(typeof module!="undefined"&&module.exports){module.exports=Pouch;var utils=require("./pouch.utils.js");for(var k in utils)global[k]=utils[k]}Pouch.merge=function(e,t,n){e=extend(!0,[],e),t=extend(!0,{},t);var r=doMerge(e,t);return{tree:stem(r.tree,n),conflicts:r.conflicts}},Pouch.merge.winningRev=function(e){var t=[];return Pouch.merge.traverseRevTree(e.rev_tree,function(e,n,r,i,s){e&&t.push({pos:n,id:r,deleted:!!s.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},Pouch.merge.traverseRevTree=function(e,t){var n=[];e.forEach(function(e){n.push({pos:e.pos,ids:e.ids})});while(n.length>0){var r=n.pop(),i=r.pos,s=r.ids,o=t(s[2].length===0,i,s[0],r.ctx,s[1]);s[2].forEach(function(e){n.push({pos:i+1,ids:e,ctx:o})})}},Pouch.merge.collectLeaves=function(e){var t=[];return Pouch.merge.traverseRevTree(e,function(e,n,r,i,s){e&&t.unshift({rev:n+"-"+r,pos:n,opts:s})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},Pouch.merge.collectConflicts=function(e){var t=Pouch.merge.winningRev(e),n=Pouch.merge.collectLeaves(e.rev_tree),r=[];return n.forEach(function(e){e.rev!==t&&!e.opts.deleted&&r.push(e.rev)}),r},typeof module!="undefined"&&module.exports&&(module.exports=Pouch);var Promise=function(){this.cancelled=!1,this.cancel=function(){this.cancelled=!0}},RequestManager=function(){var e=[],t={},n=!1;return t.enqueue=function(r,i){e.push({fun:r,args:i}),n||t.process()},t.process=function(){if(n||!e.length)return;n=!0;var t=e.shift();t.fun.apply(null,t.args)},t.notifyRequestComplete=function(){n=!1,t.process()},t},genReplicationId=function(e,t,n){var r=n.filter?n.filter.toString():"";return"_local/"+Crypto.MD5(e.id()+t.id()+r)},fetchCheckpoint=function(e,t,n){e.get(t,function(e,t){e&&e.status===404?n(null,0):n(null,t.last_seq)})},writeCheckpoint=function(e,t,n,r){var i={_id:t,last_seq:n};e.get(i._id,function(t,n){n&&n._rev&&(i._rev=n._rev),e.put(i,function(e,t){r()})})};Pouch.replicate=function(e,t,n,r){n instanceof Function&&(r=n,n={}),n===undefined&&(n={}),n.complete=r;var i=new Promise;return toPouch(e,function(e,s){if(e)return call(r,e);toPouch(t,function(e,t){if(e)return call(r,e);replicate(s,t,n,i)})}),i};var call=function(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)},yankError=function(e){return function(t,n){t||n[0].error?call(e,t||n[0]):call(e,null,n[0])}},isLocalId=function(e){return/^_local/.test(e)},isAttachmentId=function(e){return/\//.test(e)&&!isLocalId(e)&&!/^_design/.test(e)},isValidId=function(e){return/^_/.test(e)?/^_(design|local)/.test(e):!0},reservedWords=["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"],parseDoc=function(e,t){var n=null,r,i,s,o={status:"available"};e._deleted&&(o.deleted=!0);if(t){e._id||(e._id=Pouch.uuid()),i=Pouch.uuid({length:32,radix:16}).toLowerCase();if(e._rev){s=/^(\d+)-(.+)$/.exec(e._rev);if(!s)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(s[1],10),ids:[s[2],{status:"missing"},[[i,o,[]]]]}],r=parseInt(s[1],10)+1}else e._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1}else{e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return e===null?[t,o,[]]:[t,{status:"missing"},[e]]},null)}],r=e._revisions.start,i=e._revisions.ids[0]);if(!e._rev_tree){s=/^(\d+)-(.+)$/.exec(e._rev);if(!s)return Pouch.Errors.BAD_ARG;r=parseInt(s[1],10),i=s[2],e._rev_tree=[{pos:parseInt(s[1],10),ids:[s[2],o,[]]}]}}typeof e._id!="string"?n=Pouch.Errors.INVALID_ID:isValidId(e._id)||(n=Pouch.Errors.RESERVED_ID);for(var u in e)e.hasOwnProperty(u)&&u[0]==="_"&&reservedWords.indexOf(u)===-1&&(n=extend({},Pouch.Errors.DOC_VALIDATION),n.reason+=": "+u);return e._id=decodeURIComponent(e._id),e._rev=[r,i].join("-"),n?n:Object.keys(e).reduce(function(t,n){return/^_/.test(n)&&n!=="_attachments"?t.metadata[n.slice(1)]=e[n]:t.data[n]=e[n],t},{metadata:{},data:{}})},compareRevs=function(e,t){return e.id!==t.id?e.id<t.id?-1:1:e.deleted^t.deleted?e.deleted?-1:1:e.rev_tree[0].pos===t.rev_tree[0].pos?e.rev_tree[0].ids<t.rev_tree[0].ids?-1:1:e.rev_tree[0].start<t.rev_tree[0].start?-1:1},computeHeight=function(e){var t={},n=[];return Pouch.merge.traverseRevTree(e,function(e,r,i,s){var o=r+"-"+i;return e&&(t[o]=0),s!==undefined&&n.push({from:s,to:o}),o}),n.reverse(),n.forEach(function(e){t[e.from]===undefined?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t},arrayFirst=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1},filterChange=function(e){return function(t){var n={};return n.query=e.query_params,e.filter&&!e.filter.call(this,t.doc,n)?!1:e.doc_ids&&e.doc_ids.indexOf(t.id)!==-1?!1:(e.include_docs||delete t.doc,!0)}},processChanges=function(e,t,n){t=t.filter(filterChange(e)),e.limit&&e.limit<t.length&&(t.length=e.limit),t.forEach(function(t){call(e.onChange,t)}),call(e.complete,null,{results:t,last_seq:n})},rootToLeaf=function(e){var t=[];return Pouch.merge.traverseRevTree(e,function(e,n,r,i,s){i=i?i.slice(0):[],i.push({id:r,opts:s});if(e){var o=n+1-i.length;t.unshift({pos:o,ids:i})}return i}),t},isDeleted=function(e,t){t||(t=Pouch.merge.winningRev(e)),t.indexOf("-")>=0&&(t=t.split("-")[1]);var n=!1;return Pouch.merge.traverseRevTree(e.rev_tree,function(e,r,i,s,o){i===t&&(n=!!o.deleted)}),n},isChromeApp=function(){return typeof chrome!="undefined"&&typeof chrome.storage!="undefined"&&typeof chrome.storage.local!="undefined"},isCordova=function(){return typeof cordova!="undefined"||typeof PhoneGap!="undefined"||typeof phonegap!="undefined"};if(typeof module!="undefined"&&module.exports){var crypto=require("crypto"),Crypto={MD5:function(e){return crypto.createHash("md5").update(e).digest("hex")}},extend=require("./deps/extend"),ajax=require("./deps/ajax");request=require("request"),_=require("underscore"),$=_,module.exports={Crypto:Crypto,call:call,yankError:yankError,isLocalId:isLocalId,isAttachmentId:isAttachmentId,parseDoc:parseDoc,isDeleted:isDeleted,compareRevs:compareRevs,computeHeight:computeHeight,arrayFirst:arrayFirst,filterChange:filterChange,processChanges:processChanges,atob:function(e){var t=new Buffer(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},btoa:function(e){return(new Buffer(e,"binary")).toString("base64")},extend:extend,ajax:ajax,rootToLeaf:rootToLeaf,isChromeApp:isChromeApp,isCordova:isCordova}}var Changes=function(){var e={},t={};return isChromeApp()?chrome.storage.onChanged.addListener(function(t){e.notify(t.db_name.newValue)}):window.addEventListener("storage",function(t){e.notify(t.key)}),e.addListener=function(e,n,r,i){t[e]||(t[e]={}),t[e][n]={db:r,opts:i}},e.removeListener=function(e,n){delete t[e][n]},e.clearListeners=function(e){delete t[e]},e.notifyLocalWindows=function(e){isChromeApp()?chrome.storage.local.set({db_name:e}):localStorage[e]=localStorage[e]==="a"?"b":"a"},e.notify=function(e){if(!t[e])return;Object.keys(t[e]).forEach(function(n){var r=t[e][n].opts;t[e][n].db.changes({include_docs:r.include_docs,conflicts:r.conflicts,continuous:!1,descending:!1,filter:r.filter,since:r.since,query_params:r.query_params,onChange:function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,call(r.onChange,e))}})})},e},PouchAdapter=function(e,t){var n={},r=Pouch.adapters[e.adapter](e,function(r,i){if(r){t&&t(r);return}for(var s in n)i.hasOwnProperty(s)||(i[s]=n[s]);e.name===Pouch.prefix+Pouch.ALL_DBS?t(r,i):Pouch.open(e,function(e){t(e,i)})}),i=e.auto_compaction===!0,s=function(e){return i?function(t,n){if(t)call(e,t);else{var r=n.length,i=function(){r--,r||call(e,null,n)};n.forEach(function(e){e.ok?o(e.id,1,i):i()})}}:e};n.post=function(e,t,n){return typeof t=="function"&&(n=t,t={}),typeof e!="object"||Array.isArray(e)?call(n,Pouch.Errors.NOT_AN_OBJECT):r.bulkDocs({docs:[e]},t,s(yankError(n)))},n.put=function(e,t,n){return typeof t=="function"&&(n=t,t={}),typeof e!="object"?call(n,Pouch.Errors.NOT_AN_OBJECT):"_id"in e?r.bulkDocs({docs:[e]},t,s(yankError(n))):call(n,Pouch.Errors.MISSING_ID)},n.putAttachment=function(e,t,r,i,s,o){function u(e){e._attachments=e._attachments||{},e._attachments[t]={content_type:s,data:i},n.put(e,o)}typeof s=="function"&&(o=s,s=i,i=r,r=null),typeof s=="undefined"&&(s=i,i=r,r=null),n.get(e,function(t,n){if(t&&t.error===Pouch.Errors.MISSING_DOC.error){u({_id:e});return}if(t){call(o,t);return}if(n._rev!==r){call(o,Pouch.Errors.REV_CONFLICT);return}u(n)})},n.removeAttachment=function(e,t,r,i){n.get(e,function(e,s){if(e){call(i,e);return}if(s._rev!==r){call(i,Pouch.Errors.REV_CONFLICT);return}if(!s._attachments)return call(i,null);delete s._attachments[t],Object.keys(s._attachments).length===0&&delete s._attachments,n.put(s,i)})},n.remove=function(e,t,n){typeof t=="function"&&(n=t,t={}),t===undefined&&(t={}),t.was_delete=!0;var i={_id:e._id,_rev:e._rev};return i._deleted=!0,r.bulkDocs({docs:[i]},t,yankError(n))},n.revsDiff=function(e,t,r){function u(t,n,u){e[u].map(function(e){var t=function(t){return t.rev!==e};if(!n||n._revs_info.every(t))o[u]||(o[u]={missing:[]}),o[u].missing.push(e)});if(++s===i.length)return call(r,null,o)}typeof t=="function"&&(r=t,t={});var i=Object.keys(e),s=0,o={};i.map(function(e){n.get(e,{revs_info:!0},function(t,n){u(t,n,e)})})};var o=function(e,t,n){r._getRevisionTree(e,function(i,s){if(i)return call(n);var o=computeHeight(s),u=[],a=[];Object.keys(o).forEach(function(e){o[e]>t&&u.push(e)}),Pouch.merge.traverseRevTree(s,function(e,t,n,r,i){var s=t+"-"+n;i.status==="available"&&u.indexOf(s)!==-1&&(i.status="missing",a.push(s))}),r._doCompaction(e,s,a,n)})};n.compact=function(e){n.changes({complete:function(t,n){if(t){call(e);return}var r=n.results.length;if(!r){call(e);return}n.results.forEach(function(t){o(t.id,0,function(){r--,r||call(e)})})}})},n.get=function(e,t,i){function o(){var r=[],o=s.length;if(!o)return call(i,null,r);s.forEach(function(s){n.get(e,{rev:s,revs:t.revs},function(e,t){e?r.push({missing:s}):r.push({ok:t}),o--,o||call(i,null,r)})})}if(!n.taskqueue.ready()){n.taskqueue.addTask("get",arguments);return}typeof t=="function"&&(i=t,t={});var s=[];if(t.open_revs){if(t.open_revs==="all")r._getRevisionTree(e,function(e,t){e&&(t=[]),s=Pouch.merge.collectLeaves(t).map(function(e){return e.rev}),o()});else{if(!Array.isArray(t.open_revs))return call(i,Pouch.error(Pouch.Errors.UNKNOWN_ERROR,"function_clause"));s=t.open_revs;for(var u=0;u<s.length;u++){var a=s[u];if(typeof a!="string"||!/^\d+-/.test(a))return call(i,Pouch.error(Pouch.Errors.BAD_REQUEST,"Invalid rev format"))}o()}return}return r._get(e,t,function(e,n){if(e)return call(i,e);var s=n.doc,o=n.metadata,u=n.ctx;if(t.conflicts){var a=Pouch.merge.collectConflicts(o);a.length&&(s._conflicts=a)}if(t.revs||t.revs_info){var f=rootToLeaf(o.rev_tree),l=arrayFirst(f,function(e){return e.ids.map(function(e){return e.id}).indexOf(s._rev.split("-")[1])!==-1});l.ids.splice(l.ids.map(function(e){return e.id}).indexOf(s._rev.split("-")[1])+1),l.ids.reverse(),t.revs&&(s._revisions={start:l.pos+l.ids.length-1,ids:l.ids.map(function(e){return e.id})});if(t.revs_info){var c=l.pos+l.ids.length;s._revs_info=l.ids.map(function(e){return c--,{rev:c+"-"+e.id,status:e.opts.status}})}}t.local_seq&&(s._local_seq=n.metadata.seq);if(t.attachments&&s._attachments){var h=s._attachments,p=Object.keys(h).length;if(p===0)return call(i,null,s);Object.keys(h).forEach(function(e){r._getAttachment(h[e],{encode:!0,ctx:u},function(t,n){s._attachments[e].data=n,--p||call(i,null,s)})})}else{if(s._attachments)for(var d in s._attachments)s._attachments[d].stub=!0;call(i,null,s)}})},n.getAttachment=function(e,t,n,i){n instanceof Function&&(i=n,n={}),r._get(e,n,function(e,s){if(e)return call(i,e);if(!s.doc._attachments||!s.doc._attachments[t])return call(i,Pouch.Errors.MISSING_DOC);n.ctx=s.ctx,r._getAttachment(s.doc._attachments[t],n,i)})},n.allDocs=function(e,t){if(!n.taskqueue.ready()){n.taskqueue.addTask("allDocs",arguments);return}typeof e=="function"&&(t=e,e={});if("keys"in e){if("startkey"in e){call(t,Pouch.error(Pouch.Errors.QUERY_PARSE_ERROR,"Query parameter `start_key` is not compatible with multi-get"));return}if("endkey"in e){call(t,Pouch.error(Pouch.Errors.QUERY_PARSE_ERROR,"Query parameter `end_key` is not compatible with multi-get"));return}}return r._allDocs(e,t)},n.changes=function(e){if(!n.taskqueue.ready()){n.taskqueue.addTask("changes",arguments);return}return e=extend(!0,{},e),e.since||(e.since=0),"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,r._changes(e)},n.close=function(e){if(!n.taskqueue.ready()){n.taskqueue.addTask("close",arguments);return}return r._close(e)},n.info=function(e){if(!n.taskqueue.ready()){n.taskqueue.addTask("info",arguments);return}return r._info(e)},n.id=function(){return r._id()},n.type=function(){return typeof r._type=="function"?r._type():e.adapter},n.bulkDocs=function(e,t,i){if(!n.taskqueue.ready()){n.taskqueue.addTask("bulkDocs",arguments);return}typeof t=="function"&&(i=t,t={}),t?t=extend(!0,{},t):t={};if(!e||!e.docs||e.docs.length<1)return call(i,Pouch.Errors.MISSING_BULK_DOCS);if(!Array.isArray(e.docs))return call(i,Pouch.Errors.QUERY_PARSE_ERROR);for(var o=0;o<e.docs.length;++o)if(typeof e.docs[o]!="object"||Array.isArray(e.docs[o]))return call(i,Pouch.Errors.NOT_AN_OBJECT);return e=extend(!0,{},e),"new_edits"in t||(t.new_edits=!0),r._bulkDocs(e,t,s(i))};var u={};u.ready=!1,u.queue=[],n.taskqueue={},n.taskqueue.execute=function(e){u.ready&&u.queue.forEach(function(t){e[t.task].apply(null,t.parameters)})},n.taskqueue.ready=function(){if(arguments.length===0)return u.ready;u.ready=arguments[0]},n.taskqueue.addTask=function(e,t){u.queue.push({task:e,parameters:t})},n.replicate={},n.replicate.from=function(e,t,n){return typeof t=="function"&&(n=t,t={}),Pouch.replicate(e,r,t,n)},n.replicate.to=function(e,t,n){return typeof t=="function"&&(n=t,t={}),Pouch.replicate(r,e,t,n)};for(var a in n)r.hasOwnProperty(a)||(r[a]=n[a]);return e.skipSetup&&(n.taskqueue.ready(!0),n.taskqueue.execute(n)),isCordova()&&cordova.fireWindowEvent(e.name+"_pouch",{}),r};typeof module!="undefined"&&module.exports&&(module.exports=PouchAdapter);var HTTP_TIMEOUT=1e4;parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var HttpPouch=function(e,t){var n=getHost(e.name);e.auth&&(n.auth=e.auth);var r=genDBUrl(n,""),i={},s={list:[],get:function(e,t){typeof e=="function"&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(s.list=s.list.concat(n.uuids),call(t,null,"OK")):call(t,e||Pouch.Errors.UNKNOWN_ERROR)},i="?count="+e.count;ajax({auth:n.auth,method:"GET",url:genUrl(n,"_uuids")+i},r)}},o=function(){ajax({auth:n.auth,method:"PUT",url:r},function(e,s){e&&e.status===401?ajax({auth:n.auth,method:"HEAD",url:r},function(e,n){e?call(t,e):call(t,null,i)}):!e||e.status===412?call(t,null,i):call(t,Pouch.Errors.UNKNOWN_ERROR)})};return e.skipSetup||ajax({auth:n.auth,method:"GET",url:r},function(e,n){e?e.status===404?o():call(t,e):call(t,null,i)}),i.type=function(){return"http"},i.id=function(){return genDBUrl(n,"")},i.request=function(e,t){if(!i.taskqueue.ready()){i.taskqueue.addTask("request",arguments);return}e.auth=n.auth,e.url=genDBUrl(n,e.url),ajax(e,t)},i.compact=function(e,t){if(!i.taskqueue.ready()){i.taskqueue.addTask("compact",arguments);return}typeof e=="function"&&(t=e,e={}),ajax({auth:n.auth,url:genDBUrl(n,"_compact"),method:"POST"},function(){function n(){i.info(function(r,i){i.compact_running?setTimeout(n,e.interval||200):call(t,null)})}typeof t=="function"&&n()})},i.info=function(e){if(!i.taskqueue.ready()){i.taskqueue.addTask("info",arguments);return}ajax({auth:n.auth,method:"GET",url:genDBUrl(n,"")},e)},i.get=function(e,t,r){if(!i.taskqueue.ready()){i.taskqueue.addTask("get",arguments);return}typeof t=="function"&&(r=t,t={}),t.auto_encode===undefined&&(t.auto_encode=!0);var s=[];t.revs&&s.push("revs=true"),t.revs_info&&s.push("revs_info=true"),t.local_seq&&s.push("local_seq=true"),t.open_revs&&(t.open_revs!=="all"&&(t.open_revs=JSON.stringify(t.open_revs)),s.push("open_revs="+t.open_revs)),t.attachments&&s.push("attachments=true"),t.rev&&s.push("rev="+t.rev),t.conflicts&&s.push("conflicts="+t.conflicts),s=s.join("&"),s=s===""?"":"?"+s,t.auto_encode&&(e=encodeDocId(e));var o={auth:n.auth,method:"GET",url:genDBUrl(n,e+s)},u=e.split("/");if(u.length>1&&u[0]!=="_design"&&u[0]!=="_local"||u.length>2&&u[0]==="_design"&&u[0]!=="_local")o.binary=!0;ajax(o,function(e,t,n){if(e)return call(r,e);call(r,null,t,n)})},i.remove=function(e,t,r){if(!i.taskqueue.ready()){i.taskqueue.addTask("remove",arguments);return}typeof t=="function"&&(r=t,t={}),ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,encodeDocId(e._id))+"?rev="+e._rev},r)},i.getAttachment=function(e,t,n,r){typeof n=="function"&&(r=n,n={}),n.auto_encode===undefined&&(n.auto_encode=!0),n.auto_encode&&(e=encodeDocId(e)),n.auto_encode=!1,i.get(e+"/"+t,n,r)},i.removeAttachment=function(e,t,r,s){if(!i.taskqueue.ready()){i.taskqueue.addTask("removeAttachment",arguments);return}ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,encodeDocId(e)+"/"+t)+"?rev="+r},s)},i.putAttachment=function(e,t,r,s,o,u){if(!i.taskqueue.ready()){i.taskqueue.addTask("putAttachment",arguments);return}typeof o=="function"&&(u=o,o=s,s=r,r=null),typeof o=="undefined"&&(o=s,s=r,r=null);var a=encodeDocId(e)+"/"+t,f=genDBUrl(n,a);r&&(f+="?rev="+r),ajax({auth:n.auth,method:"PUT",url:f,headers:{"Content-Type":o},processData:!1,body:s},u)},i.put=function(e,t,r){if(!i.taskqueue.ready()){i.taskqueue.addTask("put",arguments);return}typeof t=="function"&&(r=t,t={});if(typeof e!="object")return call(r,Pouch.Errors.NOT_AN_OBJECT);if(!("_id"in e))return call(r,Pouch.Errors.MISSING_ID);var s=[];t&&typeof t.new_edits!="undefined"&&s.push("new_edits="+t.new_edits),s=s.join("&"),s!==""&&(s="?"+s),ajax({auth:n.auth,method:"PUT",url:genDBUrl(n,encodeDocId(e._id))+s,body:e},r)},i.post=function(e,t,n){if(!i.taskqueue.ready()){i.taskqueue.addTask("post",arguments);return}typeof t=="function"&&(n=t,t={});if(typeof e!="object")return call(n,Pouch.Errors.NOT_AN_OBJECT);"_id"in e?i.put(e,t,n):s.list.length>0?(e._id=s.list.pop(),i.put(e,t,n)):s.get(function(r,o){if(r)return call(n,Pouch.Errors.UNKNOWN_ERROR);e._id=s.list.pop(),i.put(e,t,n)})},i.bulkDocs=function(e,t,r){if(!i.taskqueue.ready()){i.taskqueue.addTask("bulkDocs",arguments);return}typeof t=="function"&&(r=t,t={}),t||(t={}),typeof t.new_edits!="undefined"&&(e.new_edits=t.new_edits),ajax({auth:n.auth,method:"POST",url:genDBUrl(n,"_bulk_docs"),body:e},r)},i.allDocs=function(e,t){if(!i.taskqueue.ready()){i.taskqueue.addTask("allDocs",arguments);return}typeof e=="function"&&(t=e,e={});var r=[],s,o="GET";e.conflicts&&r.push("conflicts=true"),e.descending&&r.push("descending=true"),e.include_docs&&r.push("include_docs=true"),e.startkey&&r.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&r.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),e.limit&&r.push("limit="+e.limit),r=r.join("&"),r!==""&&(r="?"+r),typeof e.keys!="undefined"&&(o="POST",s=JSON.stringify({keys:e.keys})),ajax({auth:n.auth,method:o,url:genDBUrl(n,"_all_docs"+r),body:s},t)},i.changes=function(e){var t=25;if(!i.taskqueue.ready()){i.taskqueue.addTask("changes",arguments);return}Pouch.DEBUG&&console.log(r+": Start Changes Feed: continuous="+e.continuous);var s={},o=typeof e.limit!="undefined"?e.limit:!1;o===0&&(o=1);var u=o;e.style&&(s.style=e.style);if(e.include_docs||e.filter&&typeof e.filter=="function")s.include_docs=!0;e.continuous&&(s.feed="longpoll"),e.conflicts&&(s.conflicts=!0),e.descending&&(s.descending=!0),e.filter&&typeof e.filter=="string"&&(s.filter=e.filter);if(e.query_params&&typeof e.query_params=="object")for(var a in e.query_params)e.query_params.hasOwnProperty(a)&&(s[a]=e.query_params[a]);var f,l,c,h=function(r,i){s.since=r,s.limit=!o||u>t?t:u;var a="?"+Object.keys(s).map(function(e){return e+"="+s[e]}).join("&"),c={auth:n.auth,method:"GET",url:genDBUrl(n,"_changes"+a),timeout:null};l=r;if(e.aborted)return;f=ajax(c,i)},p=10,d=0,v=function(t,n){if(n&&n.results){var r=e.filter&&typeof e.filter=="function",i={};i.query=e.query_params,n.results=n.results.filter(function(t){return u--,e.aborted||r&&!e.filter.apply(this,[t.doc,i])?!1:e.doc_ids&&e.doc_ids.indexOf(t.id)!==-1?!1:(call(e.onChange,t),!0)})}n&&n.last_seq&&(l=n.last_seq);var s=o&&u<=0||!o&&l===c||e.descending&&l!==0;if(e.continuous||!s){t?d+=1:d=0;var a=1<<d,f=p*a,m=e.maximumWait||3e4;f>m&&call(e.complete,t||Pouch.Errors.UNKNOWN_ERROR,null),setTimeout(function(){h(l,v)},f)}else call(e.complete,null,n)};return e.continuous?h(e.since||0,v):i.info(function(t,n){c=n.update_seq,h(e.since||0,v)}),{cancel:function(){Pouch.DEBUG&&console.log(r+": Cancel Changes Feed"),e.aborted=!0,f.abort()}}},i.revsDiff=function(e,t,r){if(!i.taskqueue.ready()){i.taskqueue.addTask("revsDiff",arguments);return}typeof t=="function"&&(r=t,t={}),ajax({auth:n.auth,method:"POST",url:genDBUrl(n,"_revs_diff"),body:e},function(e,t){call(r,e,t)})},i.close=function(e){if(!i.taskqueue.ready()){i.taskqueue.addTask("close",arguments);return}call(e,null)},i};HttpPouch.destroy=function(e,t){var n=getHost(e);ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,"")},t)},HttpPouch.valid=function(){return!0};if(typeof module!="undefined"&&module.exports){var pouchdir="../";Pouch=require(pouchdir+"pouch.js"),ajax=Pouch.utils.ajax}Pouch.adapter("http",HttpPouch),Pouch.adapter("https",HttpPouch);var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB,IDBTransaction=window.IDBTransaction&&window.IDBTransaction.READ_WRITE?window.IDBTransaction:window.webkitIDBTransaction&&window.webkitIDBTransaction.READ_WRITE?window.webkitIDBTransaction:{READ_WRITE:"readwrite"},IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,idbError=function(e){return function(t){call(e,{status:500,error:t.type,reason:t.target})}},IdbPouch=function(opts,callback){function createSchema(e){e.createObjectStore(DOC_STORE,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),e.createObjectStore(BY_SEQ_STORE,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(ATTACH_STORE,{keyPath:"digest"}),e.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(DETECT_BLOB_SUPPORT_STORE)}function fixBinary(e){var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);for(var i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function sortByBulkSeq(e,t){return e._bulk_seq-t._bulk_seq}var POUCH_VERSION=1,DOC_STORE="document-store",BY_SEQ_STORE="by-sequence",ATTACH_STORE="attach-store",META_STORE="meta-store",DETECT_BLOB_SUPPORT_STORE="detect-blob-support",name=opts.name,req=indexedDB.open(name,POUCH_VERSION);Pouch.openReqList&&(Pouch.openReqList[name]=req);var meta={id:"meta-store",updateSeq:0},blobSupport=null,instanceId=null,api={},idb=null;return Pouch.DEBUG&&console.log(name+": Open Database"),req.onupgradeneeded=function(e){var t=e.target.result,n=e.oldVersion;while(n!==e.newVersion)n===0&&createSchema(t),n++},req.onsuccess=function(e){idb=e.target.result;var t=idb.transaction([META_STORE,DETECT_BLOB_SUPPORT_STORE],IDBTransaction.READ_WRITE);idb.onversionchange=function(){idb.close()};if(idb.setVersion&&Number(idb.version)!==POUCH_VERSION){var n=idb.setVersion(POUCH_VERSION);n.onsuccess=function(t){function n(){r.onsuccess(e)}t.target.result.oncomplete=n,r.onupgradeneeded(e)};return}var r=t.objectStore(META_STORE).get("meta-store");r.onsuccess=function(e){var n,r;e.target.result&&(meta=e.target.result),name+"_id"in meta?instanceId=meta[name+"_id"]:(instanceId=Pouch.uuid(),meta[name+"_id"]=instanceId,n=t.objectStore(META_STORE).put(meta));try{t.objectStore(DETECT_BLOB_SUPPORT_STORE).put(new Blob,"key"),blobSupport=!0}catch(i){blobSupport=!1}finally{call(callback,null,api)}}},req.onerror=idbError(callback),api.type=function(){return"idb"},api.id=function(){return instanceId},api._bulkDocs=function(t,n,r){function f(){if(!o.length)return;var e=o.shift(),t=y.objectStore(DOC_STORE).get(e.metadata.id);t.onsuccess=function(n){var r=n.target.result;r?d(r,e):v(e)}}function l(e){var t=[];a.sort(sortByBulkSeq),a.forEach(function(e){delete e._bulk_seq;if(e.error){t.push(e);return}var n=e.metadata,r=Pouch.merge.winningRev(n);t.push({ok:!0,id:n.id,rev:r});if(isLocalId(n.id))return;IdbPouch.Changes.notify(name),IdbPouch.Changes.notifyLocalWindows(name)}),call(r,null,t)}function c(e,t){if(e.stub)return t();if(typeof e.data=="string"){var n;try{n=atob(e.data)}catch(i){return call(r,Pouch.error(Pouch.Errors.BAD_ARG,"Attachments need to be base64 encoded"))}e.digest="md5-"+Crypto.MD5(n);if(blobSupport){var s=e.content_type;n=fixBinary(n),e.data=new Blob([n],{type:s})}return t()}var o=new FileReader;o.onloadend=function(n){e.digest="md5-"+Crypto.MD5(this.result),blobSupport||(e.data=btoa(this.result)),t()},o.readAsBinaryString(e.data)}function h(e){function n(){t++,o.length===t&&e()}if(!o.length)return e();var t=0;o.forEach(function(e){function i(){r++,r===t.length&&n()}var t=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!t.length)return n();var r=0;for(var s in e.data._attachments)c(e.data._attachments[s],i)})}function p(e,t){function o(e){n||(e?(n=e,call(t,n)):r===s.length&&h())}function u(e){r++,o(e)}function h(){e.data._doc_id_rev=e.data._id+"::"+e.data._rev;var n=y.objectStore(BY_SEQ_STORE).put(e.data);n.onsuccess=function(n){Pouch.DEBUG&&console.log(name+": Wrote Document ",e.metadata.id),e.metadata.seq=n.target.result,delete e.metadata.rev;var r=y.objectStore(DOC_STORE).put(e.metadata);r.onsuccess=function(){a.push(e),call(t)}}}var n=null,r=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,meta.updateSeq++;var i=y.objectStore(META_STORE).put(meta);isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var s=e.data._attachments?Object.keys(e.data._attachments):[];for(var f in e.data._attachments)if(!e.data._attachments[f].stub){var l=e.data._attachments[f].data;delete e.data._attachments[f].data;var c=e.data._attachments[f].digest;g(e,c,l,u)}else r++,o();s.length||h()}function d(e,t){var n=Pouch.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=isDeleted(e),s=r&&isDeleted(t.metadata)||!r&&i&&n.conflicts!=="new_leaf";if(s)return a.push(m(Pouch.Errors.REV_CONFLICT,t._bulk_seq)),f();t.metadata.rev_tree=n.tree,p(t,f)}function v(e){if("was_delete"in n&&isDeleted(e.metadata))return a.push(Pouch.Errors.MISSING_DOC),f();p(e,f)}function m(e,t){return e._bulk_seq=t,e}function g(e,t,n,r){var i=y.objectStore(ATTACH_STORE),s=i.get(t).onsuccess=function(s){var o=s.target.result&&s.target.result.refs||{},u=[e.metadata.id,e.metadata.rev].join("@"),a={digest:t,body:n,refs:o};a.refs[u]=!0;var f=i.put(a).onsuccess=function(e){call(r)}}}var i=n.new_edits,s=t.docs,o=s.map(function(e,t){var n=parseDoc(e,i);return n._bulk_seq=t,n}),u=o.filter(function(e){return e.error});if(u.length)return call(r,u[0]);var a=[],y;h(function(){y=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE],IDBTransaction.READ_WRITE),y.onerror=idbError(r),y.ontimeout=idbError(r),y.oncomplete=l,f()})},api._get=function(t,n,r){function a(){call(r,o,{doc:i,metadata:s,ctx:u})}var i,s,o,u;n.ctx?u=n.ctx:u=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly"),u.objectStore(DOC_STORE).get(t).onsuccess=function(e){s=e.target.result;if(!s)return o=Pouch.Errors.MISSING_DOC,a();if(isDeleted(s)&&!n.rev)return o=Pouch.error(Pouch.Errors.MISSING_DOC,"deleted"),a();var t=Pouch.merge.winningRev(s),r=s.id+"::"+(n.rev?n.rev:t),f=u.objectStore(BY_SEQ_STORE).index("_doc_id_rev");f.get(r).onsuccess=function(e){i=e.target.result,i&&i._doc_id_rev&&delete i._doc_id_rev;if(!i)return o=Pouch.Errors.MISSING_DOC,a();a()}}},api._getAttachment=function(e,t,n){var r,i;t.ctx?i=t.ctx:i=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");var s=e.digest,o=e.content_type;i.objectStore(ATTACH_STORE).get(s).onsuccess=function(e){var i=e.target.result.body;if(t.encode)if(blobSupport){var s=new FileReader;s.onloadend=function(e){r=btoa(this.result),call(n,null,r)},s.readAsBinaryString(i)}else r=i,call(n,null,r);else blobSupport?r=i:(i=fixBinary(atob(i)),r=new Blob([i],{type:o})),call(n,null,r)}},api._allDocs=function(t,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,s="descending"in t?t.descending:!1;s=s?"prev":null;var o=r&&i?IDBKeyRange.bound(r,i):r?IDBKeyRange.lowerBound(r):i?IDBKeyRange.upperBound(i):null,u=idb.transaction([DOC_STORE,BY_SEQ_STORE],"readonly");u.oncomplete=function(){"keys"in t&&(t.keys.forEach(function(e){e in c?l.push(c[e]):l.push({key:e,error:"not_found"})}),t.descending&&l.reverse()),call(n,null,{total_rows:l.length,rows:"limit"in t?l.slice(0,t.limit):l})};var a=u.objectStore(DOC_STORE),f=s?a.openCursor(o,s):a.openCursor(o),l=[],c={};f.onsuccess=function(e){function i(e,r){if(isLocalId(e.id))return n["continue"]();var i={id:e.id,key:e.id,value:{rev:Pouch.merge.winningRev(e)}};t.include_docs&&(i.doc=r,i.doc._rev=Pouch.merge.winningRev(e),i.doc._doc_id_rev&&delete i.doc._doc_id_rev,t.conflicts&&(i.doc._conflicts=Pouch.merge.collectConflicts(e).map(function(e){return e}))),"keys"in t?t.keys.indexOf(e.id)>-1&&(isDeleted(e)&&(i.value.deleted=!0,i.doc=null),c[i.id]=i):isDeleted(e)||l.push(i),n["continue"]()}if(!e.target.result)return;var n=e.target.result,r=n.value;if(!t.include_docs)i(r);else{var s=u.objectStore(BY_SEQ_STORE).index("_doc_id_rev"),o=Pouch.merge.winningRev(r),a=r.id+"::"+o;s.get(a).onsuccess=function(e){i(n.value,e.target.result)}}}},api._info=function(t){var n=0,r,i=idb.transaction([DOC_STORE],"readonly");i.oncomplete=function(){t(null,r)},i.objectStore(DOC_STORE).openCursor().onsuccess=function(e){var t=e.target.result;if(!t){r={db_name:name,doc_count:n,update_seq:meta.updateSeq};return}t.value.deleted!==!0&&n++,t["continue"]()}},api._changes=function idb_changes(opts){function fetchChanges(){txn=idb.transaction([DOC_STORE,BY_SEQ_STORE]),txn.oncomplete=onTxnComplete;var e;descending?e=txn.objectStore(BY_SEQ_STORE).openCursor(IDBKeyRange.lowerBound(opts.since,!0),descending):e=txn.objectStore(BY_SEQ_STORE).openCursor(IDBKeyRange.lowerBound(opts.since,!0)),e.onsuccess=onsuccess,e.onerror=onerror}function onsuccess(e){if(!e.target.result){for(var t=0,n=results.length;t<n;t++){var r=results[t];r&&dedupResults.push(r)}return!1}var i=e.target.result,s=i.value._id,o=resultIndices[s];if(o!==undefined)return results[o].seq=i.key,results.push(results[o]),results[o]=null,resultIndices[s]=results.length-1,i["continue"]();var u=txn.objectStore(DOC_STORE);u.get(i.value._id).onsuccess=function(e){var t=e.target.result;if(isLocalId(t.id))return i["continue"]();last_seq<t.seq&&(last_seq=t.seq);var n=Pouch.merge.winningRev(t),r=t.id+"::"+n,s=txn.objectStore(BY_SEQ_STORE).index("_doc_id_rev");s.get(r).onsuccess=function(e){var r=e.target.result;delete r._doc_id_rev;var s=[{rev:n}];opts.style==="all_docs"&&(s=Pouch.merge.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var o={id:t.id,seq:i.key,changes:s,doc:r};isDeleted(t,n)&&(o.deleted=!0),opts.conflicts&&(o.doc._conflicts=Pouch.merge.collectConflicts(t).map(function(e){return e}));var u=o.id,a=resultIndices[u];a!==undefined&&(results[a]=null),results.push(o),resultIndices[u]=results.length-1,i["continue"]()}}}function onTxnComplete(){processChanges(opts,dedupResults,last_seq)}function onerror(e){call(opts.complete)}Pouch.DEBUG&&console.log(name+": Start Changes Feed: continuous="+opts.continuous);if(opts.continuous){var id=name+":"+Pouch.uuid();return opts.cancelled=!1,IdbPouch.Changes.addListener(name,id,api,opts),IdbPouch.Changes.notify(name),{cancel:function(){Pouch.DEBUG&&console.log(name+": Cancel Changes Feed"),opts.cancelled=!0,IdbPouch.Changes.removeListener(name,id)}}}var descending=opts.descending?"prev":null,last_seq=0;opts.since=opts.since&&!descending?opts.since:0;var results=[],resultIndices={},dedupResults=[],txn;if(opts.filter&&typeof opts.filter=="string"){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function() { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges()},api._close=function(e){if(idb===null)return call(e,Pouch.Errors.NOT_OPEN);idb.close(),call(e,null)},api._getRevisionTree=function(e,t){var n=idb.transaction([DOC_STORE],"readonly"),r=n.objectStore(DOC_STORE).get(e);r.onsuccess=function(e){var n=e.target.result;n?call(t,null,n.rev_tree):call(t,Pouch.Errors.MISSING_DOC)}},api._doCompaction=function(e,t,n,r){var i=idb.transaction([DOC_STORE,BY_SEQ_STORE],IDBTransaction.READ_WRITE),s=i.objectStore(DOC_STORE);s.get(e).onsuccess=function(r){var s=r.target.result;s.rev_tree=t;var o=n.length;n.forEach(function(t){var n=i.objectStore(BY_SEQ_STORE).index("_doc_id_rev"),r=e+"::"+t;n.getKey(r).onsuccess=function(e){var t=e.target.result;if(!t)return;var n=i.objectStore(BY_SEQ_STORE)["delete"](t);o--,o||i.objectStore(DOC_STORE).put(s)}})},i.oncomplete=function(){call(r)}},api};IdbPouch.valid=function(){return!!indexedDB},IdbPouch.destroy=function(t,n){Pouch.DEBUG&&console.log(t+": Delete Database"),IdbPouch.Changes.clearListeners(t),Pouch.openReqList[t]&&Pouch.openReqList[t].result&&Pouch.openReqList[t].result.close();var r=indexedDB.deleteDatabase(t);r.onsuccess=function(){Pouch.openReqList[t]&&(Pouch.openReqList[t]=null),call(n,null)},r.onerror=idbError(n)},IdbPouch.Changes=new Changes,Pouch.adapter("idb",IdbPouch);var POUCH_VERSION=1,POUCH_SIZE=5242880,DOC_STORE=quote("document-store"),BY_SEQ_STORE=quote("by-sequence"),ATTACH_STORE=quote("attach-store"),META_STORE=quote("metadata-store"),unknownError=function(e){return function(t){call(e,{status:500,error:t.type,reason:t.target})}},webSqlPouch=function(opts,callback){function dbCreated(){callback(null,api)}function setup(){db.transaction(function(e){var t="CREATE TABLE IF NOT EXISTS "+META_STORE+" (update_seq, dbid)",n="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest, json, body BLOB)",r="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, seq, json, winningseq)",i="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json)";e.executeSql(n),e.executeSql(r),e.executeSql(i),e.executeSql(t);var s="SELECT update_seq FROM "+META_STORE;e.executeSql(s,[],function(e,t){if(!t.rows.length){var n="INSERT INTO "+META_STORE+" (update_seq) VALUES (?)",r=Pouch.uuid();e.executeSql(n,[0]);return}update_seq=t.rows.item(0).update_seq});var o="SELECT dbid FROM "+META_STORE+" WHERE dbid IS NOT NULL";e.executeSql(o,[],function(e,t){if(!t.rows.length){var n="UPDATE "+META_STORE+" SET dbid=?";instanceId=Pouch.uuid(),e.executeSql(n,[instanceId]);return}instanceId=t.rows.item(0).dbid})},unknownError(callback),dbCreated)}function makeRevs(e){return e.map(function(e){return{rev:e.rev}})}function makeIds(e){return e.map(function(e){return e.id})}var api={},update_seq=0,instanceId=null,name=opts.name,db=openDatabase(name,POUCH_VERSION,name,POUCH_SIZE);return db?(isCordova()?window.addEventListener(name+"_pouch",setup,!1):setup(),api.type=function(){return"websql"},api.id=function(){return instanceId},api._info=function(e){db.transaction(function(t){var n="SELECT COUNT(id) AS count FROM "+DOC_STORE;t.executeSql(n,[],function(t,n){e(null,{db_name:name,doc_count:n.rows.item(0).count,update_seq:update_seq})})})},api._bulkDocs=function(t,n,r){function c(e,t){return e._bulk_seq-t._bulk_seq}function h(e){var t=[];f.sort(c),f.forEach(function(e){delete e._bulk_seq;if(e.error){t.push(e);return}var n=e.metadata,r=Pouch.merge.winningRev(n);t.push({ok:!0,id:n.id,rev:r});if(isLocalId(n.id))return;update_seq++;var i="UPDATE "+META_STORE+" SET update_seq=?";a.executeSql(i,[update_seq],function(){webSqlPouch.Changes.notify(name),webSqlPouch.Changes.notifyLocalWindows(name)})}),call(r,null,t)}function p(e,t){if(e.stub)return t();if(typeof e.data=="string"){try{e.data=atob(e.data)}catch(n){return call(r,Pouch.error(Pouch.Errors.BAD_ARG,"Attachments need to be base64 encoded"))}return e.digest="md5-"+Crypto.MD5(e.data),t()}var i=new FileReader;i.onloadend=function(n){e.data=this.result,e.digest="md5-"+Crypto.MD5(this.result),t()},i.readAsBinaryString(e.data)}function d(e){function r(){t++,o.length===t&&e()}if(!o.length)return e();var t=0,n=0;o.forEach(function(e){function i(){n++,n===t.length&&r()}var t=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!t.length)return r();for(var s in e.data._attachments)p(e.data._attachments[s],i)})}function v(e,t,n){function r(){var t=e.data,n="INSERT INTO "+BY_SEQ_STORE+" (doc_id_rev, json) VALUES (?, ?);";a.executeSql(n,[t._id+"::"+t._rev,JSON.stringify(t)],d)}function i(e){s||(e?(s=e,call(t,s)):o===u.length&&r())}function l(e){o++,i(e)}function d(r,i){var s=e.metadata.seq=i.insertId;delete e.metadata.rev;var o=Pouch.merge.winningRev(e.metadata),u=n?"UPDATE "+DOC_STORE+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, seq, winningseq, json) VALUES (?, ?, ?, ?);",a=JSON.stringify(e.metadata),l=e.metadata.id+"::"+o,c=n?[s,a,l,e.metadata.id]:[e.metadata.id,s,s,a];r.executeSql(u,c,function(n,r){f.push(e),call(t,null)})}var s=null,o=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var u=e.data._attachments?Object.keys(e.data._attachments):[];for(var c in e.data._attachments)if(!e.data._attachments[c].stub){var h=e.data._attachments[c].data;delete e.data._attachments[c].data;var p=e.data._attachments[c].digest;w(e,p,h,l)}else o++,i();u.length||r()}function m(e,t){var n=Pouch.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=isDeleted(e)&&isDeleted(t.metadata)||!isDeleted(e)&&i&&n.conflicts!=="new_leaf";if(r)return f.push(b(Pouch.Errors.REV_CONFLICT,t._bulk_seq)),y();t.metadata.rev_tree=n.tree,v(t,y,!0)}function g(e){if("was_delete"in n&&isDeleted(e.metadata))return f.push(Pouch.Errors.MISSING_DOC),y();v(e,y,!1)}function y(){if(!o.length)return h();var e=o.shift(),t=e.metadata.id;t in l?m(l[t],e):(l[t]=e.metadata,g(e))}function b(e,t){return e._bulk_seq=t,e}function w(e,t,n,r){var i=[e.metadata.id,e.metadata.rev].join("@"),s={digest:t},o="SELECT digest, json FROM "+ATTACH_STORE+" WHERE digest=?";a.executeSql(o,[t],function(e,u){u.rows.length?(s.refs=JSON.parse(u.rows.item(0).json).refs,o="UPDATE "+ATTACH_STORE+" SET json=?, body=? WHERE digest=?",e.executeSql(o,[JSON.stringify(s),n,t],function(){call(r,null)})):(s.refs={},s.refs[i]=!0,o="INSERT INTO "+ATTACH_STORE+"(digest, json, body) VALUES (?, ?, ?)",e.executeSql(o,[t,JSON.stringify(s),n],function(){call(r,null)}))})}function E(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);l[r.id]=JSON.parse(r.json)}y()}var i=n.new_edits,s=t.docs,o=s.map(function(e,t){var n=parseDoc(e,i);return n._bulk_seq=t,n}),u=o.filter(function(e){return e.error});if(u.length)return call(r,u[0]);var a,f=[],l={};d(function(){db.transaction(function(e){a=e;var t="("+o.map(function(e){return quote(e.metadata.id)}).join(",")+")",n="SELECT * FROM "+DOC_STORE+" WHERE id IN "+t;a.executeSql(n,[],E)},unknownError(r))})},api._get=function(e,t,n){function u(){call(n,s,{doc:r,metadata:i,ctx:o})}var r,i,s;if(!t.ctx){db.transaction(function(r){t.ctx=r,api._get(e,t,n)});return}var o=t.ctx,a="SELECT * FROM "+DOC_STORE+" WHERE id=?";o.executeSql(a,[e],function(e,n){if(!n.rows.length)return s=Pouch.Errors.MISSING_DOC,u();i=JSON.parse(n.rows.item(0).json);if(isDeleted(i)&&!t.rev)return s=Pouch.error(Pouch.Errors.MISSING_DOC,"deleted"),u();var a=Pouch.merge.winningRev(i),f=t.rev?t.rev:a;f=i.id+"::"+f;var l="SELECT * FROM "+BY_SEQ_STORE+" WHERE doc_id_rev=?";o.executeSql(l,[f],function(e,t){if(!t.rows.length)return s=Pouch.Errors.MISSING_DOC,u();r=JSON.parse(t.rows.item(0).json),u()})})},api._allDocs=function(e,t){var n=[],r={},i="startkey"in e?e.startkey:!1,s="endkey"in e?e.endkey:!1,o="descending"in e?e.descending:!1,u="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";"keys"in e?u+=" WHERE "+DOC_STORE+".id IN ("+e.keys.map(function(e){return quote(e)}).join(",")+")":(i&&(u+=" WHERE "+DOC_STORE+'.id >= "'+i+'"'),s&&(u+=(i?" AND ":" WHERE ")+DOC_STORE+'.id <= "'+s+'"'),u+=" ORDER BY "+DOC_STORE+".id "+(o?"DESC":"ASC")),db.transaction(function(t){t.executeSql(u,[],function(t,i){for(var s=0,o=i.rows.length;s<o;s++){var u=i.rows.item(s),a=JSON.parse(u.metadata),f=JSON.parse(u.data);isLocalId(a.id)||(u={id:a.id,key:a.id,value:{rev:Pouch.merge.winningRev(a)}},e.include_docs&&(u.doc=f,u.doc._rev=Pouch.merge.winningRev(a),e.conflicts&&(u.doc._conflicts=makeIds(Pouch.merge.collectConflicts(a)))),"keys"in e?e.keys.indexOf(a.id)>-1&&(isDeleted(a)&&(u.value.deleted=!0,u.doc=null),r[u.id]=u):isDeleted(a)||n.push(u))}})},unknownError(t),function(){"keys"in e&&(e.keys.forEach(function(e){e in r?n.push(r[e]):n.push({key:e,error:"not_found"})}),e.descending&&n.reverse()),call(t,null,{total_rows:n.length,rows:"limit"in e?n.slice(0,e.limit):n})})},api._changes=function idb_changes(opts){function fetchChanges(){var e="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE "+DOC_STORE+".seq > "+opts.since+" ORDER BY "+DOC_STORE+".seq "+(descending?"DESC":"ASC");db.transaction(function(t){t.executeSql(e,[],function(e,t){var n=0;for(var r=0,i=t.rows.length;r<i;r++){var s=t.rows.item(r),o=JSON.parse(s.metadata);if(!isLocalId(o.id)){n<s.seq&&(n=s.seq);var u=JSON.parse(s.data),a=u._rev,f=[{rev:a}];opts.style==="all_docs"&&(f=makeRevs(Pouch.merge.collectLeaves(o.rev_tree)));var l={id:o.id,seq:s.seq,changes:f,doc:u};isDeleted(o,a)&&(l.deleted=!0),opts.conflicts&&(l.doc._conflicts=Pouch.merge.collectConflicts(o)),results.push(l)}}processChanges(opts,results,n)})})}Pouch.DEBUG&&console.log(name+": Start Changes Feed: continuous="+opts.continuous);if(opts.continuous){var id=name+":"+Pouch.uuid();return opts.cancelled=!1,webSqlPouch.Changes.addListener(name,id,api,opts),webSqlPouch.Changes.notify(name),{cancel:function(){Pouch.DEBUG&&console.log(name+": Cancel Changes Feed"),opts.cancelled=!0,webSqlPouch.Changes.removeListener(name,id)}}}var descending=opts.descending;opts.since=opts.since&&!descending?opts.since:0;var results=[],txn;if(opts.filter&&typeof opts.filter=="string"){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function() { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges()},api._close=function(e){call(e,null)},api._getAttachment=function(e,t,n){var r,i=t.ctx,s=e.digest,o=e.content_type,u="SELECT body FROM "+ATTACH_STORE+" WHERE digest=?";i.executeSql(u,[s],function(e,i){var s=i.rows.item(0).body;t.encode?r=btoa(s):r=new Blob([s],{type:o}),call(n,null,r)})},api._getRevisionTree=function(e,t){db.transaction(function(n){var r="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(!n.rows.length)call(t,Pouch.Errors.MISSING_DOC);else{var r=JSON.parse(n.rows.item(0).metadata);call(t,null,r.rev_tree)}})})},api._doCompaction=function(e,t,n,r){db.transaction(function(i){var s="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";i.executeSql(s,[e],function(i,s){if(!s.rows.length)return call(r);var o=JSON.parse(s.rows.item(0).metadata);o.rev_tree=t;var u="DELETE FROM "+BY_SEQ_STORE+" WHERE doc_id_rev IN ("+n.map(function(t){return quote(e+"::"+t)}).join(",")+")";i.executeSql(u,[],function(t,n){var i="UPDATE "+DOC_STORE+" SET json = ? WHERE id = ?";t.executeSql(i,[JSON.stringify(o),e],function(e,t){r()})})})})},api):call(callback,Pouch.Errors.UNKNOWN_ERROR)};webSqlPouch.valid=function(){return!!window.openDatabase},webSqlPouch.destroy=function(e,t){var n=openDatabase(e,POUCH_VERSION,e,POUCH_SIZE);n.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS "+DOC_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+BY_SEQ_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+ATTACH_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+META_STORE,[])},unknownError(t),function(){call(t,null)})},webSqlPouch.Changes=new Changes,Pouch.adapter("websql",webSqlPouch);var MapReduce=function(db){function viewQuery(fun,options){function sum(e){return e.reduce(function(e,t){return e+t},0)}if(!options.complete)return;fun.reduce||(options.reduce=!1);var builtInReduce={_sum:function(e,t){return sum(t)},_count:function(e,t,n){return n?sum(t):t.length},_stats:function(e,t,n){return{sum:sum(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(){var e=0;for(var n in t)e+=t[n]*t[n];return e}()}}},results=[],current=null,num_started=0,completed=!1,emit=function(e,t){var n={id:current.doc._id,key:e,value:t};if(options.startkey&&Pouch.collate(e,options.startkey)<0)return;if(options.endkey&&Pouch.collate(e,options.endkey)>0)return;if(options.key&&Pouch.collate(e,options.key)!==0)return;num_started++;if(options.include_docs){if(t&&typeof t=="object"&&t._id){db.get(t._id,function(e,t){t&&(n.doc=t),results.push(n),checkComplete()});return}n.doc=current.doc}results.push(n)};eval("fun.map = "+fun.map.toString()+";"),fun.reduce&&(builtInReduce[fun.reduce]&&(fun.reduce=builtInReduce[fun.reduce]),eval("fun.reduce = "+fun.reduce.toString()+";"));var checkComplete=function(){if(completed&&results.length==num_started){results.sort(function(e,t){return Pouch.collate(e.key,t.key)}),options.descending&&results.reverse();if(options.reduce===!1)return options.complete(null,{rows:"limit"in options?results.slice(0,options.limit):results,total_rows:results.length});var e=[];results.forEach(function(t){var n=e[e.length-1]||null;if(n&&Pouch.collate(n.key[0][0],t.key)===0){n.key.push([t.key,t.id]),n.value.push(t.value);return}e.push({key:[[t.key,t.id]],value:[t.value]})}),e.forEach(function(e){e.value=fun.reduce(e.key,e.value)||null,e.key=e.key[0][0]}),options.complete(null,{rows:"limit"in options?e.slice(0,options.limit):e,total_rows:e.length})}};db.changes({conflicts:!0,include_docs:!0,onChange:function(e){"deleted"in e||(current={doc:e.doc},fun.map.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})}function httpQuery(e,t,n){var r=[],i=undefined,s="GET";typeof t.reduce!="undefined"&&r.push("reduce="+t.reduce),typeof t.include_docs!="undefined"&&r.push("include_docs="+t.include_docs),typeof t.limit!="undefined"&&r.push("limit="+t.limit),typeof t.descending!="undefined"&&r.push("descending="+t.descending),typeof t.startkey!="undefined"&&r.push("startkey="+encodeURIComponent(JSON.stringify(t.startkey))),typeof t.endkey!="undefined"&&r.push("endkey="+encodeURIComponent(JSON.stringify(t.endkey))),typeof t.key!="undefined"&&r.push("key="+encodeURIComponent(JSON.stringify(t.key))),typeof t.group!="undefined"&&r.push("group="+t.group),typeof t.group_level!="undefined"&&r.push("group_level="+t.group_level),typeof t.keys!="undefined"&&(s="POST",i=JSON.stringify({keys:t.keys})),r=r.join("&"),r=r===""?"":"?"+r;if(typeof e=="string"){var o=e.split("/");db.request({method:s,url:"_design/"+o[0]+"/_view/"+o[1]+r,body:i},n);return}var u=JSON.parse(JSON.stringify(e,function(e,t){return typeof t=="function"?t+"":t}));db.request({method:"POST",url:"_temp_view"+r,body:u},n)}function query(e,t,n){typeof t=="function"&&(n=t,t={}),n&&(t.complete=n);if(db.type()==="http")return typeof e=="function"?httpQuery({map:e},t,n):httpQuery(e,t,n);if(typeof e=="object")return viewQuery(e,t);if(typeof e=="function")return viewQuery({map:e},t);var r=e.split("/");db.get("_design/"+r[0],function(e,i){if(e){n&&n(e);return}if(!i.views[r[1]]){n&&n({error:"not_found",reason:"missing_named_view"});return}viewQuery({map:i.views[r[1]].map,reduce:i.views[r[1]].reduce},t)})}return{query:query}};MapReduce._delete=function(){},Pouch.plugin("mapreduce",MapReduce)}(this),define("pouchdb",function(e){return function(){var t,n;return t||e.Pouch}}(this)),define("tools",[],function(){function e(e){var t=e.split(/[\r\n]+/g),n={};return n.GlobalOptionFilter=[],n.Feature=[],t.forEach(function(e,t){splittedLine=e.split(/=(.+)/),splittedLine[0]!==""&&(splittedLine[0].search(/\[.*\]/)!==-1?n.moduleKey=splittedLine[0].replace("[","").replace("]",""):splittedLine[0]==="GlobalOptionFilter"?n[splittedLine[0]].push(splittedLine[1]):splittedLine[0]==="Feature"?n[splittedLine[0]].push(splittedLine[1]):splittedLine[0]==="Versification"?n[splittedLine[0]]=splittedLine[1].toLowerCase():n[splittedLine[0]]=splittedLine[1])}),n}function t(e){return function(t,n){return t[e]>n[e]?1:t[e]<n[e]?-1:0}}function n(){var e=arguments;return function(n,r){var i=0,s=0,o=e.length;while(s===0&&i<o)s=t(e[i])(n,r),i++;return s}}return{readConf:e,dynamicSort:t,dynamicSortMultiple:n}}),define("dataMgr",["async","pouchdb","tools"],function(e,t,n){function s(e,t){i.get(e,function(e,n){t(e,n)})}function o(e,t){var r=new FileReader;r.readAsText(e),r.onload=function(e){var r=n.readConf(e.target.result);i.post(r,function(e,n){e?t(e):t(null,{id:n.id,modKey:r.moduleKey,v11n:r.Versification})})}}function u(t,n,r){var s=t.length,o={},u=null,f=null;o.docId=n.id,e.eachSeries(t,function(e,t){u=e.name.split("/"),f=u[u.length-3],i.post({fileName:u[u.length-1],modKey:n.modKey,driver:f},function(n,r){n?t(n):i.putAttachment(r.id+"/binary",f,e.blob,f,function(e,n){e?t(e):o[u[u.length-1].split(".")[0]]=r.id,t(null)})})},function(e){e?r(e):a(o,r)})}function a(e,t){i.get(e.docId,function(n,r){n?t(n):(r.nt=e.nt,r.ot=e.ot,i.put(r,function(e,n){e?t(e):t()}))})}function f(e,t){var n="ztext";i.getAttachment(e+"/binary",n,function(e,n){t(e,n)})}function l(e,t,n,r){i.post({modKey:n.modKey,ot:e,nt:t},function(e,t){e?r(e):i.get(n.id,function(e,n){e?r(e):(n.bcvPosID=t.id,i.put(n,function(e,t){e?r(e):r()}))})})}function c(){t.destroy("swordjs",function(e,n){console.log(e,n),e||(i=new t("swordjs"))})}var r={},i=new t("swordjs");return{db:i,clearDatabase:c,saveConfig:o,saveModule:u,saveBCVPos:l,getBlob:f,getDocument:s}}),function(){function r(t,r){var i=t.split("."),s=n;!(i[0]in s)&&s.execScript&&s.execScript("var "+i[0]);for(var o;i.length&&(o=i.shift());)!i.length&&r!==e?s[o]=r:s=s[o]?s[o]:s[o]={}}function s(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,s,o,u,a,f,l,c,h,p;for(h=0;h<t;++h)e[h]>n&&(n=e[h]),e[h]<r&&(r=e[h]);s=1<<n,o=new(i?Uint32Array:Array)(s),u=1,a=0;for(f=2;u<=n;){for(h=0;h<t;++h)if(e[h]===u){l=0,c=a;for(p=0;p<u;++p)l=l<<1|c&1,c>>=1;for(p=l;p<s;p+=f)o[p]=u<<16|h;++a}++u,a<<=1,f<<=1}return[o,n,r]}function o(t,n,r){this.t=[],this.q=r?r:32768,this.u=0,this.a=n===e?0:n,this.d=this.e=0,this.input=i?new Uint8Array(t):t,this.c=new(i?Uint8Array:Array)(this.q),this.b=0,this.s=this.l=!1,this.f=0,this.status=u}function C(t,n){for(var r=t.e,i=t.d,s=t.input,o=t.a,u;i<n;){u=s[o++];if(u===e)return-1;r|=u<<i,i+=8}return u=r&(1<<n)-1,t.e=r>>>n,t.d=i-n,t.a=o,u}function k(t,n){for(var r=t.e,i=t.d,s=t.input,o=t.a,u=n[0],a=n[1],f,l,c;i<a;){f=s[o++];if(f===e)return-1;r|=f<<i,i+=8}return l=u[r&(1<<a)-1],c=l>>>16,t.e=r>>c,t.d=i-c,t.a=o,l&65535}function L(t){var n,r,i,s=t.input,o=t.a;t.status=3,n=s[o++];if(n===e)return-1;r=n,n=s[o++];if(n===e)return-1;r|=n<<8,n=s[o++];if(n===e)return-1;i=n,n=s[o++];if(n===e)return-1;if(r===~(i|n<<8))throw Error("invalid uncompressed block header: length verify");t.e=0,t.d=0,t.a=o,t.m=r,t.status=4}function A(e){e.r=e.a,e.p=e.d,e.o=e.e}function O(e){e.a=e.r,e.d=e.p,e.e=e.o}function M(e){function t(){function e(e,t,n){for(var r,i,s,o=0,u,o=0;o<e;){r=k(this,t);if(0>r)throw Error("not enough input");switch(r){case 16:if(0>(u=C(this,2)))throw Error("not enough input");for(s=3+u;s--;)n[o++]=i;break;case 17:if(0>(u=C(this,3)))throw Error("not enough input");for(s=3+u;s--;)n[o++]=0;i=0;break;case 18:if(0>(u=C(this,7)))throw Error("not enough input");for(s=11+u;s--;)n[o++]=0;i=0;break;default:i=n[o++]=r}}return n}var t;for(h=0;h<o;++h){if(0>(t=C(this,3)))throw Error("not enough input");u[f[h]]=t}a=s(u),l=new(i?Uint8Array:Array)(n),c=new(i?Uint8Array:Array)(r),this.k=s(e.call(this,n,a,l)),this.n=s(e.call(this,r,a,c))}var n,r,o,u=new(i?Uint8Array:Array)(f.length),a,l,c,h=0;e.status=3,A(e),n=C(e,5)+257,r=C(e,5)+1,o=C(e,4)+4;if(0>n||0>r||0>o)return O(e),-1;try{t.call(e)}catch(p){return O(e),-1}return e.status=4,0}function _(e){var t=e.c,n=e.b,r,i,s,o,u=e.k,a=e.n,f=t.length,l;for(e.status=5;;){A(e),r=k(e,u);if(0>r)return e.b=n,O(e),-1;if(256===r)break;if(256>r)n===f&&(t=D(e),f=t.length),t[n++]=r;else{i=r-257,o=c[i];if(0<p[i]){l=C(e,p[i]);if(0>l)return e.b=n,O(e),-1;o+=l}r=k(e,a);if(0>r)return e.b=n,O(e),-1;s=v[r];if(0<g[r]){l=C(e,g[r]);if(0>l)return e.b=n,O(e),-1;s+=l}n+o>=f&&(t=D(e),f=t.length);for(;o--;)t[n]=t[n++ -s];if(e.a===e.input.length)return e.b=n,-1}}for(;8<=e.d;)e.d-=8,e.a--;e.b=n,e.status=6}function D(e){var t,n=e.input.length/e.a+1|0,r,s,o,u=e.input,a=e.c;return 2>n?(r=(u.length-e.a)/e.k[2],o=258*(r/2)|0,s=o<a.length?a.length+o:a.length<<1):s=a.length*n,i?(t=new Uint8Array(s),t.set(a)):t=a,e.c=t,e.c}function P(t){this.input=t===e?new(i?Uint8Array:Array):t,this.a=0,this.h=new o(this.input,this.a),this.c=this.h.c}var e=void 0,t=!0,n=this,i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,u=0;o.prototype.i=function(n,r){var s=!1;n!==e&&(this.input=n),r!==e&&(this.a=r);for(;!s;)switch(this.status){case u:case 1:var o,a=e;this.status=1,A(this);if(0>(a=C(this,3)))O(this),o=-1;else{a&1&&(this.l=t),a>>>=1;switch(a){case 0:this.g=0;break;case 1:this.g=1;break;case 2:this.g=2;break;default:throw Error("unknown BTYPE: "+a)}this.status=2,o=e}0>o&&(s=t);break;case 2:case 3:switch(this.g){case 0:0>L(this)&&(s=t);break;case 1:this.status=3,this.k=E,this.n=N,this.status=4;break;case 2:0>M(this)&&(s=t)}break;case 4:case 5:switch(this.g){case 0:var f;e:{var l=this.input,c=this.a,h=this.c,p=this.b,d=this.m;for(this.status=5;d--;){p===h.length&&(h=D(this));if(l[c]===e){this.a=c,this.b=p,this.m=d+1,f=-1;break e}h[p++]=l[c++]}0>d&&(this.status=6),this.a=c,this.b=p,f=0}0>f&&(s=t);break;case 1:case 2:0>_(this)&&(s=t)}break;case 6:this.l?s=t:this.status=u}var v,m=this.b;return this.s?i?(v=new Uint8Array(m),v.set(this.c.subarray(this.f,m))):v=this.c.slice(this.f,m):v=i?this.c.subarray(this.f,m):this.c.slice(this.f,m),this.buffer=v,this.f=m,this.buffer};var a=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=i?new Uint16Array(a):a,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],c=i?new Uint16Array(l):l,h=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],p=i?new Uint8Array(h):h,d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],v=i?new Uint16Array(d):d,m=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],g=i?new Uint8Array(m):m,y=new(i?Uint8Array:Array)(288),b,w;b=0;for(w=y.length;b<w;++b)y[b]=143>=b?8:255>=b?9:279>=b?7:8;var E=s(y),S=new(i?Uint8Array:Array)(30),x,T;x=0;for(T=S.length;x<T;++x)S[x]=5;var N=s(S);o.prototype.j=function(){return i?this.c.subarray(0,this.b):this.c.slice(0,this.b)},P.prototype.i=function(t){var n;if(t!==e)if(i){var r=new Uint8Array(this.input.length+t.length);r.set(this.input,0),r.set(t,this.input.length),this.input=r}else this.input=this.input.concat(t);var s;if(s=this.method===e){var o,u=this.a,a=this.input,f=a[u++],l=a[u++];if(f===e||l===e)o=-1;else{switch(f&15){case 8:this.method=8;break;default:throw Error("unsupported compression method")}if(0!==((f<<8)+l)%31)throw Error("invalid fcheck flag:"+((f<<8)+l)%31);if(l&32)throw Error("fdict flag is not supported");this.a=u,o=e}s=0>o}return s?new(i?Uint8Array:Array):(n=this.h.i(this.input,this.a),this.a=this.h.a,n)},P.prototype.j=function(){return this.h.j()},r("Zlib.InflateStream",P),r("Zlib.InflateStream.prototype.decompress",P.prototype.i),r("Zlib.InflateStream.prototype.getBytes",P.prototype.j)}.call(this),define("inflateStream",function(e){return function(){var t,n;return t||e.Zlib}}(this)),define("zText",["inflateStream","async"],function(e,t){var n={},r=new FileReader,i=new FileReader;return n.getRawEntry=function(n,s,o,u){if(!s[o[0].chapter-1])u({message:"Wrong passage. The requested chapter is not available in this module."});else{var a=s[o[0].chapter-1].bookStartPos,f=s[o[0].chapter-1].startPos,l=s[o[0].chapter-1].length,c=a+f,h=c+l,p=n.slice(a,h);r.readAsArrayBuffer(p),r.onload=function(n){var r=new Uint8Array(n.target.result),a=new e.InflateStream,l=new Blob([a.decompress(r)]),c=[],h=0,p=0,d=0;t.whilst(function(){return d<o.length},function(e){h=f+s[o[d].chapter-1].verses[o[d].verse-1].startPos,p=h+s[o[d].chapter-1].verses[o[d].verse-1].length,i.readAsText(l.slice(h,p)),i.onload=function(t){c.push({text:t.target.result,osis:o[d].osis,verse:o[d].verse}),d++,e()}},function(e){u(e,c)})}}},n}),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h={},p=e.config&&e.config()||{};t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("json",["text"],function(text){function cacheBust(e){return e=e.replace(CACHE_BUST_FLAG,""),e+=e.indexOf("?")<0?"?":"&",e+CACHE_BUST_QUERY_PARAM+"="+Math.round(2147483647*Math.random())}var CACHE_BUST_QUERY_PARAM="bust",CACHE_BUST_FLAG="!bust",jsonParse=typeof JSON!="undefined"&&typeof JSON.parse=="function"?JSON.parse:function(val){return eval("("+val+")")},buildMap={};return{load:function(e,t,n,r){!r.isBuild||r.inlineJSON!==!1&&e.indexOf(CACHE_BUST_QUERY_PARAM+"=")===-1?text.get(t.toUrl(e),function(t){r.isBuild?(buildMap[e]=t,n(t)):n(jsonParse(t))},n.error,{accept:"application/json"}):n(null)},normalize:function(e,t){return e.indexOf(CACHE_BUST_FLAG)===-1?e:cacheBust(e)},write:function(e,t,n){if(t in buildMap){var r=buildMap[t];n('define("'+e+"!"+t+'", function(){ return '+r+";});\n")}}}}),define("json!../data/kjv.json",function(){return{ot:[{name:"Genesis",abbrev:"Gen",maxChapter:50},{name:"Exodus",abbrev:"Exod",maxChapter:40},{name:"Leviticus",abbrev:"Lev",maxChapter:27},{name:"Numbers",abbrev:"Num",maxChapter:36},{name:"Deuteronomy",abbrev:"Deut",maxChapter:34},{name:"Joshua",abbrev:"Josh",maxChapter:24},{name:"Judges",abbrev:"Judg",maxChapter:21},{name:"Ruth",abbrev:"Ruth",maxChapter:4},{name:"I Samuel",abbrev:"1Sam",maxChapter:31},{name:"II Samuel",abbrev:"2Sam",maxChapter:24},{name:"I Kings",abbrev:"1Kgs",maxChapter:22},{name:"II Kings",abbrev:"2Kgs",maxChapter:25},{name:"I Chronicles",abbrev:"1Chr",maxChapter:29},{name:"II Chronicles",abbrev:"2Chr",maxChapter:36},{name:"Ezra",abbrev:"Ezra",maxChapter:10},{name:"Nehemiah",abbrev:"Neh",maxChapter:13},{name:"Esther",abbrev:"Esth",maxChapter:10},{name:"Job",abbrev:"Job",maxChapter:42},{name:"Psalms",abbrev:"Ps",maxChapter:150},{name:"Proverbs",abbrev:"Prov",maxChapter:31},{name:"Ecclesiastes",abbrev:"Eccl",maxChapter:12},{name:"Song of Solomon",abbrev:"Song",maxChapter:8},{name:"Isaiah",abbrev:"Isa",maxChapter:66},{name:"Jeremiah",abbrev:"Jer",maxChapter:52},{name:"Lamentations",abbrev:"Lam",maxChapter:5},{name:"Ezekiel",abbrev:"Ezek",maxChapter:48},{name:"Daniel",abbrev:"Dan",maxChapter:12},{name:"Hosea",abbrev:"Hos",maxChapter:14},{name:"Joel",abbrev:"Joel",maxChapter:3},{name:"Amos",abbrev:"Amos",maxChapter:9},{name:"Obadiah",abbrev:"Obad",maxChapter:1},{name:"Jonah",abbrev:"Jonah",maxChapter:4},{name:"Micah",abbrev:"Mic",maxChapter:7},{name:"Nahum",abbrev:"Nah",maxChapter:3},{name:"Habakkuk",abbrev:"Hab",maxChapter:3},{name:"Zephaniah",abbrev:"Zeph",maxChapter:3},{name:"Haggai",abbrev:"Hag",maxChapter:2},{name:"Zechariah",abbrev:"Zech",maxChapter:14},{name:"Malachi",abbrev:"Mal",maxChapter:4}],nt:[{name:"Matthew",abbrev:"Matt",maxChapter:28},{name:"Mark",abbrev:"Mark",maxChapter:16},{name:"Luke",abbrev:"Luke",maxChapter:24},{name:"John",abbrev:"John",maxChapter:21},{name:"Acts",abbrev:"Acts",maxChapter:28},{name:"Romans",abbrev:"Rom",maxChapter:16},{name:"I Corinthians",abbrev:"1Cor",maxChapter:16},{name:"II Corinthians",abbrev:"2Cor",maxChapter:13},{name:"Galatians",abbrev:"Gal",maxChapter:6},{name:"Ephesians",abbrev:"Eph",maxChapter:6},{name:"Philippians",abbrev:"Phil",maxChapter:4},{name:"Colossians",abbrev:"Col",maxChapter:4},{name:"I Thessalonians",abbrev:"1Thess",maxChapter:5},{name:"II Thessalonians",abbrev:"2Thess",maxChapter:3},{name:"I Timothy",abbrev:"1Tim",maxChapter:6},{name:"II Timothy",abbrev:"2Tim",maxChapter:4},{name:"Titus",abbrev:"Titus",maxChapter:3},{name:"Philemon",abbrev:"Phlm",maxChapter:1},{name:"Hebrews",abbrev:"Heb",maxChapter:13},{name:"James",abbrev:"Jas",maxChapter:5},{name:"I Peter",abbrev:"1Pet",maxChapter:5},{name:"II Peter",abbrev:"2Pet",maxChapter:3},{name:"I John",abbrev:"1John",maxChapter:5},{name:"II John",abbrev:"2John",maxChapter:1},{name:"III John",abbrev:"3John",maxChapter:1},{name:"Jude",abbrev:"Jude",maxChapter:1},{name:"Revelation of John",abbrev:"Rev",maxChapter:22}],osisToBookNum:{Gen:0,Exod:1,Lev:2,Num:3,Deut:4,Josh:5,Judg:6,Ruth:7,"1Sam":8,"2Sam":9,"1Kgs":10,"2Kgs":11,"1Chr":12,"2Chr":13,Ezra:14,Neh:15,Esth:16,Job:17,Ps:18,Prov:19,Eccl:20,Song:21,Isa:22,Jer:23,Lam:24,Ezek:25,Dan:26,Hos:27,Joel:28,Amos:29,Obad:30,Jonah:31,Mic:32,Nah:33,Hab:34,Zeph:35,Hag:36,Zech:37,Mal:38,Matt:39,Mark:40,Luke:41,John:42,Acts:43,Rom:44,"1Cor":45,"2Cor":46,Gal:47,Eph:48,Phil:49,Col:50,"1Thess":51,"2Thess":52,"1Tim":53,"2Tim":54,Titus:55,Phlm:56,Heb:57,Jas:58,"1Pet":59,"2Pet":60,"1John":61,"2John":62,"3John":63,Jude:64,Rev:65},versesInChapter:[[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,55,32,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],[22,25,22,31,23,30,25,32,35,29,10,51,22,31,27,36,16,27,25,26,36,31,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],[17,16,17,35,19,30,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,50,13,32,22,29,35,41,30,25,18,65,23,31,40,16,54,42,56,29,34,13],[46,37,29,49,33,25,26,20,29,22,32,32,18,29,23,22,20,22,21,20,23,30,25,22,19,19,26,68,29,20,30,52,29,12],[18,24,17,24,15,27,26,35,27,43,23,24,33,15,63,10,18,28,51,9,45,34,16,33],[36,23,31,24,31,40,25,35,57,18,40,15,25,20,20,31,13,31,30,48,25],[22,23,18,22],[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,15,23,29,22,44,25,12,25,11,31,13],[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,33,43,26,22,51,39,25],[53,46,28,34,18,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,53],[18,25,27,44,27,33,20,29,37,36,21,21,25,29,38,20,41,37,37,21,26,20,37,20,30],[54,55,24,43,26,81,40,40,44,14,47,40,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],[17,18,17,22,14,42,22,18,31,19,23,16,22,15,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],[11,70,13,24,17,22,28,36,15,44],[11,20,32,23,19,19,73,18,38,39,36,47,31],[22,23,15,17,14,14,10,17,32,3],[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,24,34,17],[6,12,8,8,12,10,17,9,20,18,7,8,6,7,5,11,15,50,14,9,13,31,6,10,22,12,14,9,11,12,24,11,22,22,28,12,40,22,13,17,13,11,5,26,17,11,9,14,20,23,19,9,6,7,23,13,11,11,17,12,8,12,11,10,13,20,7,35,36,5,24,20,28,23,10,12,20,72,13,19,16,8,18,12,13,17,7,18,52,17,16,15,5,23,11,13,12,9,9,5,8,28,22,35,45,48,43,13,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,13,10,7,12,15,21,10,20,14,9,6],[33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31],[18,26,22,16,20,12,29,17,18,20,10,14],[17,17,11,16,16,13,13,14],[31,22,26,6,30,13,25,22,21,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,12,25,24],[19,37,25,31,31,30,34,22,26,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],[22,22,66,22,22],[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,49,32,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],[21,49,30,37,31,28,28,27,27,21,45,13],[11,23,5,19,15,11,16,14,17,15,12,14,16,9],[20,32,21],[15,16,15,13,27,14,17,14,15],[21],[17,10,10,11],[16,13,12,13,15,16,20],[15,13,19],[17,20,19],[18,15,20],[15,23],[21,13,10,14,11,15,14,23,17,12,17,14,9,21],[14,17,18,6],[25,23,17,25,48,34,29,34,38,42,30,50,58,36,39,28,27,35,30,34,46,46,39,51,46,75,66,20],[45,28,35,41,43,56,37,38,50,52,33,44,37,72,47,20],[80,52,38,44,39,49,50,56,62,42,54,59,35,35,32,31,37,43,48,47,38,71,56,53],[51,25,36,54,47,71,53,59,41,42,57,50,38,31,27,33,26,40,42,31,25],[26,47,26,37,42,15,60,40,43,48,30,25,52,28,41,40,34,28,41,38,40,30,35,27,27,32,44,31],[32,29,31,25,21,23,25,39,33,21,36,21,14,23,33,27],[31,16,23,21,13,20,40,13,27,33,34,31,13,40,58,24],[24,17,18,18,21,18,16,24,15,18,33,21,14],[24,21,29,31,26,18],[23,22,21,32,33,24],[30,30,21,23],[29,23,25,18],[10,20,13,18,28],[12,17,18],[20,15,16,16,25,21],[18,26,17,22],[16,15,15],[25],[14,18,19,16,14,20,28,13,28,39,40,29,25],[27,26,18,17,20],[25,25,22,19,14],[21,22,18],[10,29,24,21,21],[13],[14],[25],[20,29,22,11,14,17,17,13,21,11,19,17,18,20,8,21,18,24,21,15,27,21]]}}),define("json!../data/german.json",function(){return{ot:[{name:"Genesis",abbrev:"Gen",maxChapter:50},{name:"Exodus",abbrev:"Exod",maxChapter:40},{name:"Leviticus",abbrev:"Lev",maxChapter:27},{name:"Numbers",abbrev:"Num",maxChapter:36},{name:"Deuteronomy",abbrev:"Deut",maxChapter:34},{name:"Joshua",abbrev:"Josh",maxChapter:24},{name:"Judges",abbrev:"Judg",maxChapter:21},{name:"Ruth",abbrev:"Ruth",maxChapter:4},{name:"I Samuel",abbrev:"1Sam",maxChapter:31},{name:"II Samuel",abbrev:"2Sam",maxChapter:24},{name:"I Kings",abbrev:"1Kgs",maxChapter:22},{name:"II Kings",abbrev:"2Kgs",maxChapter:25},{name:"I Chronicles",abbrev:"1Chr",maxChapter:29},{name:"II Chronicles",abbrev:"2Chr",maxChapter:36},{name:"Ezra",abbrev:"Ezra",maxChapter:10},{name:"Nehemiah",abbrev:"Neh",maxChapter:13},{name:"Esther",abbrev:"Esth",maxChapter:10},{name:"Job",abbrev:"Job",maxChapter:42},{name:"Psalms",abbrev:"Ps",maxChapter:150},{name:"Proverbs",abbrev:"Prov",maxChapter:31},{name:"Ecclesiastes",abbrev:"Eccl",maxChapter:12},{name:"Song of Solomon",abbrev:"Song",maxChapter:8},{name:"Isaiah",abbrev:"Isa",maxChapter:66},{name:"Jeremiah",abbrev:"Jer",maxChapter:52},{name:"Lamentations",abbrev:"Lam",maxChapter:5},{name:"Ezekiel",abbrev:"Ezek",maxChapter:48},{name:"Daniel",abbrev:"Dan",maxChapter:12},{name:"Hosea",abbrev:"Hos",maxChapter:14},{name:"Joel",abbrev:"Joel",maxChapter:4},{name:"Amos",abbrev:"Amos",maxChapter:9},{name:"Obadiah",abbrev:"Obad",maxChapter:1},{name:"Jonah",abbrev:"Jonah",maxChapter:4},{name:"Micah",abbrev:"Mic",maxChapter:7},{name:"Nahum",abbrev:"Nah",maxChapter:3},{name:"Habakkuk",abbrev:"Hab",maxChapter:3},{name:"Zephaniah",abbrev:"Zeph",maxChapter:3},{name:"Haggai",abbrev:"Hag",maxChapter:2},{name:"Zechariah",abbrev:"Zech",maxChapter:14},{name:"Malachi",abbrev:"Mal",maxChapter:3}],versesInChapter:[[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,54,33,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],[22,25,22,31,23,30,29,28,35,29,10,51,22,31,27,36,16,27,25,26,37,30,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],[17,16,17,35,26,23,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,35,28,32,22,29,35,41,30,25,19,65,23,31,39,17,54,42,56,29,34,13],[46,37,29,49,33,25,26,20,29,22,32,31,19,29,23,22,20,22,21,20,23,29,26,22,19,19,26,69,28,20,30,52,29,12],[18,24,17,24,15,27,26,35,27,43,23,24,33,15,63,10,18,28,51,9,45,34,16,33],[36,23,31,24,31,40,25,35,57,18,40,15,25,20,20,31,13,31,30,48,25],[22,23,18,22],[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,16,23,28,23,44,25,12,25,11,31,13],[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,32,44,26,22,51,39,25],[53,46,28,20,32,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,54],[18,25,27,44,27,33,20,29,37,36,20,22,25,29,39,20,41,37,37,21,26,20,37,20,30],[54,55,24,43,41,66,40,40,44,14,47,41,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],[18,17,17,22,14,42,22,18,31,19,23,16,23,14,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],[11,70,13,24,17,22,28,36,15,44],[11,20,38,17,19,19,73,18,37,40,36,47,31],[22,23,15,17,14,14,10,17,32,3],[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,32,26,17],[6,12,9,9,13,11,18,10,21,18,7,9,6,7,5,11,15,51,15,10,14,32,6,10,22,12,14,9,11,13,25,11,22,23,28,13,40,23,14,18,14,12,5,27,18,12,10,15,21,23,21,11,7,9,24,14,12,12,18,14,9,13,12,11,14,20,8,36,37,6,24,20,28,23,11,13,21,72,13,20,17,8,19,13,14,17,7,19,53,17,16,16,5,23,11,13,12,9,9,5,8,29,22,35,45,48,43,14,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,14,10,8,12,15,21,10,20,14,9,6],[33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31],[18,26,22,17,19,12,29,17,18,20,10,14],[17,17,11,16,16,12,14,14],[31,22,26,6,30,13,25,23,20,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,11,25,24],[19,37,25,31,31,30,34,23,25,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],[22,22,66,22,22],[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,44,37,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],[21,49,33,34,30,29,28,27,27,21,45,13],[9,25,5,19,15,11,16,14,17,15,11,15,15,10],[20,27,5,21],[15,16,15,13,27,14,17,14,15],[21],[16,11,10,11],[16,13,12,14,14,16,20],[14,14,19],[17,20,19],[18,15,20],[15,23],[17,17,10,14,11,15,14,23,17,12,17,14,9,21],[14,17,24],[25,23,17,25,48,34,29,34,38,42,30,50,58,36,39,28,27,35,30,34,46,46,39,51,46,75,66,20],[45,28,35,41,43,56,37,38,50,52,33,44,37,72,47,20],[80,52,38,44,39,49,50,56,62,42,54,59,35,35,32,31,37,43,48,47,38,71,56,53],[51,25,36,54,47,71,53,59,41,42,57,50,38,31,27,33,26,40,42,31,25],[26,47,26,37,42,15,60,40,43,48,30,25,52,28,41,40,34,28,40,38,40,30,35,27,27,32,44,31],[32,29,31,25,21,23,25,39,33,21,36,21,14,23,33,27],[31,16,23,21,13,20,40,13,27,33,34,31,13,40,58,24],[24,17,18,18,21,18,16,24,15,18,33,21,13],[24,21,29,31,26,18],[23,22,21,32,33,24],[30,30,21,23],[29,23,25,18],[10,20,13,18,28],[12,17,18],[20,15,16,16,25,21],[18,26,17,22],[16,15,15],[25],[14,18,19,16,14,20,28,13,28,39,40,29,25],[27,26,18,17,20],[25,25,22,19,14],[21,22,18],[10,29,24,21,21],[13],[15],[25],[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21]]}}),define("versificationMgr",["json!../data/kjv.json","json!../data/german.json"],function(e,t){function r(e){return e!==undefined&&n[e]?n[e].ot.length:n.kjv.ot.length}function i(e){return e!==undefined&&n[e]?n[e].nt.length:n.kjv.nt.length}function s(e,t){var i=r(t),s=e<i?"ot":"nt";return e=e<i?e:e-i,t!==undefined&&n[t]?n[t][s][e].maxChapter:n.kjv[s][e].maxChapter}function o(e,t,r){return r!==undefined&&n[r]?n[r].versesInChapter[e][t]:n.kjv.versesInChapter[e][t]}function u(e,t){var i=r(t),s=e<i?"ot":"nt";return e=e<i?e:e-i,t!==undefined&&n[t]?n[t][s][e]:n.kjv[s][e]}function a(e,t){return t!==undefined&&n[t]?n[t].osisToBookNum[e]:n.kjv.osisToBookNum[e]}function f(e){var t=[];return e!==undefined&&n[e]?t.concat(n[e].ot,n[e].nt):t.concat(n.kjv.ot,n.kjv.nt)}var n={};return n.kjv=e,t.nt=e.nt,t.osisToBookNum=e.osisToBookNum,n.german=t,{getBooksInOT:r,getBooksInNT:i,getChapterMax:s,getVersesInChapter:o,getBook:u,getBookNum:a,getAllBooks:f}}),define("installMgr",["unzip","dataMgr","zText","versificationMgr","async","tools"],function(e,t,n,r,i,s){function u(e){f("http://crosswire.org/ftpmirror/pub/sword/masterRepoList.conf","text",function(t,n){var r=[],i=null;n.split(/[\r\n]+/g).forEach(function(e){i=e.split("|"),i.length>1&&i[0].search("CrossWire")!==-1&&r.push({name:i[0].split("=")[2],url:"http://crosswire.org/ftpmirror"+i[2].replace("raw","packages")+"/rawzip/",confUrl:"http://crosswire.org/ftpmirror"+i[2]+"/mods.d"})}),e(t,r)})}function a(e,t){f(e.confUrl,"document",function(n,r){if(!n){var o=[],u="",a=r.getElementsByTagName("a");for(var l=0;l<a.length;l++)a[l].href.search(".conf")!==-1&&(u=a[l].baseURI+"/"+a[l].textContent,o.push(function(t){return function(n){f(t,"text",function(t,r){var i=s.readConf(r);i.url=e.url+i.moduleKey+".zip",n(t,i)})}}(u)));i.parallel(o,function(e,n){t(e,n.sort(s.dynamicSortMultiple("Lang","moduleKey")))})}else t(n)})}function f(e,t,n){var r=new XMLHttpRequest({mozSystem:!0});r.open("GET",e,!0),r.responseType=t,r.onreadystatechange=function(){r.readyState==4&&n&&n(null,r.response)},r.onerror=function(e){n(e)},r.send(null)}function l(e,t){typeof e=="string"?f(e,"blob",function(e,n){e?t(e):c(n,t)}):c(e,t)}function c(n,r){var i=null,s=new FileReader;s.onload=function(n){var i=new e.Unzip(new Uint8Array(n.target.result)),s=i.getFilenames();s.forEach(function(e,n){e.search(".conf")!==-1&&t.saveConfig(new Blob([i.decompress(e)]),function(e,t){e?r(e):h(i,t.v11n,t,r)})})},s.readAsArrayBuffer(n)}function h(e,n,r,s){var o={};o.bin=[];var u=e.getFilenames();u.forEach(function(t,n){t.search("nt.bzs")!==-1?o.ntB=t:t.search("nt.bzv")!==-1?o.ntCV=t:t.search("ot.bzs")!==-1?o.otB=t:t.search("ot.bzv")!==-1?o.otCV=t:t.search(".conf")===-1&&o.bin.push({blob:new Blob([e.decompress(t)]),name:t})}),i.parallel([function(e){t.saveModule(o.bin,r,function(t,n){t?e(t):e(null)})},function(i){var s=p(e.decompress(o.otB)),u=v(e.decompress(o.otCV),s,"ot",n),a=p(e.decompress(o.ntB)),f=v(e.decompress(o.ntCV),a,"nt",n);t.saveBCVPos(u,f,r,function(e,t){e?i(e):i(null)})}],function(e,t){e?cb(e):s(null,r.id)})}function p(e,t){var n=0,r=0,i=0,s=!1,u=[];o=0;while(!s){res=m(e),n=res[0],s=res[1];if(!s){res=m(e),r=res[0],s=res[1];if(!s){res=m(e),i=res[0],s=res[1];if(s)break;u.push({startPos:n,length:r,unused:i})}}}return u}function d(e){o=0;for(var t=0;t<4;t++)g(e),y(e),g(e)}function v(e,t,n,i){d(e);var s=n==="ot"?0:r.getBooksInOT(i),o=n==="ot"?r.getBooksInOT(i):r.getBooksInOT(i)+r.getBooksInNT(i),u=0,a=0,f=0,l=0,c=0,h=0,p=0,v=null,m=0,b={},w={};for(var E=s;E<o;E++){v=r.getBook(E,i),w[v.abbrev]=[];for(var S=0;S<v.maxChapter;S++){f=0,l=0,b={},b.verses=[],c=0;for(var x=0;x<r.getVersesInChapter(E,S,i);x++)p=g(e)[0],m=y(e)[0],m!==0&&(l=m),c=g(e)[0],x===0&&(f=m,h=0,p<t.length&&(h=t[p].startPos),b.startPos=f,b.booknum=E,b.bookStartPos=h),p===0&&m===0&&c===0?b!=={}&&b.verses.push({startPos:0,length:0}):b!=={}&&b.verses.push({startPos:m-f,length:c});b!={}&&(b.length=l-f+c,w[v.abbrev].push(b)),g(e),y(e),g(e)}g(e),y(e),g(e)}return w}function m(e,t){buf=e.subarray(o,o+4),isEnd=!1,o+=4,buf.length!==4&&(isEnd=!0);if(!t)return[buf[3]*1048576+buf[2]*65536+buf[1]*256+buf[0],isEnd];t(buf[3]*1048576+buf[2]*65536+buf[1]*256+buf[0],isEnd)}function g(e,t){buf=e.subarray(o,o+2),isEnd=!1,o+=2,buf.length!==2&&(isEnd=!0);if(!t)return[buf[1]*256+buf[0],isEnd];t(buf[1]*256+buf[0],isEnd)}function y(e,t){buf=e.subarray(o,o+6),isEnd=!1,o+=6,buf.length!==6&&(isEnd=!0);if(!t)return[buf[1]*17592186044416+buf[0]*4294967296+buf[5]*16777216+buf[4]*65536+buf[3]*256+buf[2],isEnd];t(buf[1]*17592186044416+buf[0]*4294967296+buf[5]*16777216+buf[4]*65536+buf[3]*256+buf[2],isEnd)}var o=0;return db=t.db,{getRepositories:u,getModules:a,installModule:l}}),function(){var e,t,n,r={}.hasOwnProperty,i=function(){var e,t,n;this.options={},n=i.prototype.options;for(e in n)r.call(n,e)&&(t=n[e],this.options[e]=t);this.versification_system(this.options.versification_system)};i.prototype.s="",i.prototype.entities=[],i.prototype.passage=null,i.prototype.regexps={},i.prototype.options={consecutive_combination_strategy:"combine",osis_compaction_strategy:"b",book_sequence_strategy:"ignore",invalid_sequence_strategy:"ignore",sequence_combination_strategy:"combine",invalid_passage_strategy:"ignore",zero_chapter_strategy:"error",zero_verse_strategy:"error",non_latin_digits_strategy:"ignore",book_alone_strategy:"ignore",captive_end_digits_strategy:"delete",end_range_digits_strategy:"verse",include_apocrypha:!1,ps151_strategy:"c",versification_system:"default",case_sensitive:"none"},i.prototype.parse=function(e){var t,n,r;this.reset(),this.s=e,e=this.replace_control_characters(e),n=this.match_books(e),e=n[0],this.passage.books=n[1],e=this.match_passages(e),this.entities=[],n=0;for(r=e.length;n<r;n++)t=e[n],t=this.passage.handle_array([t])[0],this.entities=this.entities.concat(t);return this},i.prototype.reset=function(){return this.s="",this.entities=[],this.passage?(this.passage.books=[],this.passage.indices={}):(this.passage=new t,this.passage.options=this.options,this.passage.translations=this.translations)},i.prototype.set_options=function(e){var t,n;for(t in e)r.call(e,t)&&((n=e[t],"include_apocrypha"===t||"versification_system"===t||"case_sensitive"===t)?this[t](n):this.options[t]=n);return this},i.prototype.include_apocrypha=function(e){return null==e||!0!==e&&!1!==e?this:(this.options.include_apocrypha=e,this.regexps.books=this.regexps.get_books(e,this.options.case_sensitive),!0===e?this.translations["default"].chapters.Ps[150]=this.translations["default"].chapters.Ps151[0]:!1===e&&151===this.translations["default"].chapters.Ps.length&&this.translations["default"].chapters.Ps.pop(),this)},i.prototype.versification_system=function(e){var t,i;if(null==e||null==this.translations.alternates[e])return this;this.options.versification_system=e,null==(i=this.translations.alternates)["default"]&&(i["default"]={order:null,chapters:{}}),null!=this.translations.alternates[e].order&&(null==this.translations.alternates["default"].order&&(this.translations.alternates["default"].order=n.shallow_clone(this.translations["default"].order)),this.translations["default"].order=n.shallow_clone(this.translations.alternates[e].order));if(null!=this.translations.alternates[e].chapters)for(t in i=this.translations.alternates[e].chapters,i)r.call(i,t)&&(e=i[t],null==this.translations.alternates["default"].chapters[t]&&(this.translations.alternates["default"].chapters[t]=n.shallow_clone_array(this.translations["default"].chapters[t])),this.translations["default"].chapters[t]=n.shallow_clone_array(e));return this.include_apocrypha(this.options.include_apocrypha),this},i.prototype.case_sensitive=function(e){return null==e||"none"!==e&&"books"!==e||e===this.options.case_sensitive?this:(this.options.case_sensitive=e,this.regexps.books=this.regexps.get_books(this.options.include_apocrypha,e),this)},i.prototype.replace_control_characters=function(e){return e=e.replace(this.regexps.control," "),"replace"===this.options.non_latin_digits_strategy&&(e=e.replace(/[\u0660\u06f0\u07c0\u0966\u09e6\u0a66\u0ae6\u0b660\u0c66\u0ce6\u0d66\u0e50\u0ed0\u0f20\u1040\u1090\u17e0\u1810\u1946\u19d0\u1a80\u1a90\u1b50\u1bb0\u1c40\u1c50\ua620\ua8d0\ua900\ua9d0\uaa50\uabf0\uff10]/g,"0"),e=e.replace(/[\u0661\u06f1\u07c1\u0967\u09e7\u0a67\u0ae7\u0b67\u0be7\u0c67\u0ce7\u0d67\u0e51\u0ed1\u0f21\u1041\u1091\u17e1\u1811\u1947\u19d1\u1a81\u1a91\u1b51\u1bb1\u1c41\u1c51\ua621\ua8d1\ua901\ua9d1\uaa51\uabf1\uff11]/g,"1"),e=e.replace(/[\u0662\u06f2\u07c2\u0968\u09e8\u0a68\u0ae8\u0b68\u0be8\u0c68\u0ce8\u0d68\u0e52\u0ed2\u0f22\u1042\u1092\u17e2\u1812\u1948\u19d2\u1a82\u1a92\u1b52\u1bb2\u1c42\u1c52\ua622\ua8d2\ua902\ua9d2\uaa52\uabf2\uff12]/g,"2"),e=e.replace(/[\u0663\u06f3\u07c3\u0969\u09e9\u0a69\u0ae9\u0b69\u0be9\u0c69\u0ce9\u0d69\u0e53\u0ed3\u0f23\u1043\u1093\u17e3\u1813\u1949\u19d3\u1a83\u1a93\u1b53\u1bb3\u1c43\u1c53\ua623\ua8d3\ua903\ua9d3\uaa53\uabf3\uff13]/g,"3"),e=e.replace(/[\u0664\u06f4\u07c4\u096a\u09ea\u0a6a\u0aea\u0b6a\u0bea\u0c6a\u0cea\u0d6a\u0e54\u0ed4\u0f24\u1044\u1094\u17e4\u1814\u194a\u19d4\u1a84\u1a94\u1b54\u1bb4\u1c44\u1c54\ua624\ua8d4\ua904\ua9d4\uaa54\uabf4\uff14]/g,"4"),e=e.replace(/[\u0665\u06f5\u07c5\u096b\u09eb\u0a6b\u0aeb\u0b6b\u0beb\u0c6b\u0ceb\u0d6b\u0e55\u0ed5\u0f25\u1045\u1095\u17e5\u1815\u194b\u19d5\u1a85\u1a95\u1b55\u1bb5\u1c45\u1c55\ua625\ua8d5\ua905\ua9d5\uaa55\uabf5\uff15]/g,"5"),e=e.replace(/[\u0666\u06f6\u07c6\u096c\u09ec\u0a6c\u0aec\u0b6c\u0bec\u0c6c\u0cec\u0d6c\u0e56\u0ed6\u0f26\u1046\u1096\u17e6\u1816\u194c\u19d6\u1a86\u1a96\u1b56\u1bb6\u1c46\u1c56\ua626\ua8d6\ua906\ua9d6\uaa56\uabf6\uff16]/g,"6"),e=e.replace(/[\u0667\u06f7\u07c7\u096d\u09ed\u0a6d\u0aed\u0b6d\u0bed\u0c6d\u0ced\u0d6d\u0e57\u0ed7\u0f27\u1047\u1097\u17e7\u1817\u194d\u19d7\u1a87\u1a97\u1b57\u1bb7\u1c47\u1c57\ua627\ua8d7\ua907\ua9d7\uaa57\uabf7\uff17]/g,"7"),e=e.replace(/[\u0668\u06f8\u07c8\u096e\u09ee\u0a6e\u0aee\u0b6e\u0bee\u0c6e\u0cee\u0d6e\u0e58\u0ed8\u0f28\u1048\u1098\u17e8\u1818\u194e\u19d8\u1a88\u1a98\u1b58\u1bb8\u1c48\u1c58\ua628\ua8d8\ua908\ua9d8\uaa58\uabf8\uff18]/g,"8"),e=e.replace(/[\u0669\u06f9\u07c9\u096f\u09ef\u0a6f\u0aef\u0b6f\u0bef\u0c6f\u0cef\u0d6f\u0e59\u0ed9\u0f29\u1049\u1099\u17e9\u1819\u194f\u19d9\u1a89\u1a99\u1b59\u1bb9\u1c49\u1c59\ua629\ua8d9\ua909\ua9d9\uaa59\uabf9\uff19]/g,"9")),e},i.prototype.match_books=function(e){var t,n,r,i,s;n=[],s=this.regexps.books,r=0;for(i=s.length;r<i;r++)t=s[r],e=e.replace(t.regexp,function(e,r,i){return n.push({value:i,parsed:t.osis}),""+r+""+(n.length-1)+(null!=t.extra?"/"+t.extra:"")+""});return e=e.replace(this.regexps.translations,function(e){return n.push({value:e,parsed:e.toLowerCase()}),""+(n.length-1)+""}),[e,this.get_book_indices(n,e)]},i.prototype.get_book_indices=function(e,t){var n,r,i;n=0;for(i=/([\x1f\x1e])(\d+)(?:\/[a-z])?\1/g;r=i.exec(t);)e[r[2]].start_index=r.index+n,n+=e[r[2]].value.length-r[0].length;return e},i.prototype.match_passages=function(e){var t,n,r,i,s;for(s=[];r=this.regexps.escaped_passage.exec(e);)n=r[0],i=r[1],t=r[2],r.index+=n.length-i.length,/\s[2-9]\d\d\s*$|\s\d{4,}\s*$/.test(i)&&(n=/\s+\d+\s*$/,i=i.replace(n,"")),/[\d\x1f\x1e)]$/.test(i)||(i=this.replace_match_end(i)),"delete"===this.options.captive_end_digits_strategy&&(r=r.index+i.length,e.length>r&&/^\w/.test(e.substr(r,1))&&(i=i.replace(/[\s*]+\d+$/,"")),i=i.replace(/(\x1e[)\]]?)[\s*]*\d+$/,"$1")),i=i.replace(/[A-Z]+/g,function(e){return e.toLowerCase()}),r=i.substr(0,!1)?0:i.split("")[0].length,i={value:o.parse(i),type:"base",start_index:this.passage.books[t].start_index-r,match:i},"full"===this.options.book_alone_strategy&&1===i.value.length&&"b"===i.value[0].type&&0===r&&1===this.passage.books[t].parsed.length&&/^[234]/.test(this.passage.books[t].parsed[0])&&this.create_book_range(e,i,t),s.push(i);return s},i.prototype.replace_match_end=function(e){var t,n;for(n=e.length;t=this.regexps.match_end_split.exec(e);)n=t.index+t[0].length;return n<e.length&&(e=e.substr(0,n)),e},i.prototype.create_book_range=function(e,t,n){var r,s,o,u,a;r=[i.prototype.regexps.first,i.prototype.regexps.second,i.prototype.regexps.third],o=parseInt(this.passage.books[n].parsed[0].substr(0,1),10);for(s=a=1;1<=o?a<o:a>o;s=1<=o?++a:--a)if(u=s===o-1?i.prototype.regexps.range_and:i.prototype.regexps.range_only,u=e.match(RegExp("(?:^|\\W)("+r[s-1]+"\\s*"+u+"\\s*)\\x1f"+n+"\\x1f","i")),null!=u)return this.add_book_range_object(t,u,s);return!1},i.prototype.add_book_range_object=function(e,t,n){var r;return r=t[1].length,e.value[0]={type:"b_range_pre",value:[{type:"b_pre",value:n.toString(),indices:[t.index,t.index+r]},e.value[0]],indices:[0,e.value[0].indices[1]+r]},e.value[0].value[1].indices[0]+=r,e.value[0].value[1].indices[1]+=r,e.start_index-=r,e.match=t[1]+e.match},i.prototype.osis=function(){var e,t,n,r,i;t=[],i=this.parsed_entities(),n=0;for(r=i.length;n<r;n++)e=i[n],0<e.osis.length&&t.push(e.osis);return t.join(",")},i.prototype.osis_and_translations=function(){var e,t,n,r,i;t=[],i=this.parsed_entities(),n=0;for(r=i.length;n<r;n++)e=i[n],0<e.osis.length&&t.push([e.osis,e.translations.join(",")]);return t},i.prototype.osis_and_indices=function(){var e,t,n,r,i;t=[],i=this.parsed_entities(),n=0;for(r=i.length;n<r;n++)e=i[n],0<e.osis.length&&t.push({osis:e.osis,translations:e.translations,indices:e.indices});return t},i.prototype.parsed_entities=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;s=[],t=f=0;for(c=this.entities.length;0<=c?f<c:f>c;t=0<=c?++f:--f)if(e=this.entities[t],e.type&&"translation_sequence"===e.type&&0<s.length&&t===s[s.length-1].entity_id+1&&(s[s.length-1].indices[1]=e.absolute_indices[1]),null!=e.passages&&("b"!==e.type&&"b_range"!==e.type||"ignore"!==this.options.book_alone_strategy)){a=[],u=null;if(null!=e.passages[0].translations){l=e.passages[0].translations,r=0;for(o=l.length;r<o;r++)i=l[r],n=0<(null!=(h=i.osis)?h.length:void 0)?i.osis:"",null==u&&(u=i.alias),a.push(n)}else a=[""],u="default";i=[],r=e.passages.length;for(n=l=0;0<=r?l<r:l>r;n=0<=r?++l:--l){o=e.passages[n],null==o.type&&(o.type=e.type);if(!1===o.valid.valid&&("ignore"===this.options.invalid_sequence_strategy&&"sequence"===e.type&&this.snap_sequence("ignore",e,i,n,r),"ignore"===this.options.invalid_passage_strategy))continue;"b"!==o.type&&"b_range"!==o.type||"ignore"!==this.options.book_sequence_strategy||"sequence"!==e.type?(null==o.absolute_indices&&(o.absolute_indices=e.absolute_indices),i.push({osis:o.valid.valid?this.to_osis(o.start,o.end,u):"",type:o.type,indices:o.absolute_indices,translations:a,start:o.start,end:o.end,enclosed_indices:o.enclosed_absolute_indices,entity_id:t,entities:[o]})):this.snap_sequence("book",e,i,n,r)}if(0!==i.length)if(1<i.length&&"combine"===this.options.consecutive_combination_strategy&&(i=this.combine_consecutive_passages(i,u)),"separate"===this.options.sequence_combination_strategy)s=s.concat(i);else{u=[],n=i.length-1,null!=i[n].enclosed_indices&&0<=i[n].enclosed_indices[1]&&(e.absolute_indices[1]=i[n].enclosed_indices[1]),r=0;for(o=i.length;r<o;r++)n=i[r],0<n.osis.length&&u.push(n.osis);s.push({osis:u.join(","),indices:e.absolute_indices,translations:a,entity_id:t,entities:i})}}return s},i.prototype.to_osis=function(e,t,n){var r;return null==t.c&&null==t.v&&e.b===t.b&&null==e.c&&null==e.v&&"first_chapter"===this.options.book_alone_strategy&&(t.c=1),null==e.c&&(e.c=1),null==e.v&&(e.v=1),null==t.c&&(t.c=this.passage.translations[n].chapters[t.b].length),null==t.v&&(t.v=this.passage.translations[n].chapters[t.b][t.c-1]),this.options.include_apocrypha&&"b"===this.options.ps151_strategy&&(151===e.c&&"Ps"===e.b||151===t.c&&"Ps"===t.b)&&this.fix_ps151(e,t,n),"b"===this.options.osis_compaction_strategy&&1===e.c&&1===e.v&&t.c===this.passage.translations[n].chapters[t.b].length&&t.v===this.passage.translations[n].chapters[t.b][t.c-1]?(n=e.b,r=t.b):2>=this.options.osis_compaction_strategy.length&&1===e.v&&t.v===this.passage.translations[n].chapters[t.b][t.c-1]?(n=e.b+"."+e.c.toString(),r=t.b+"."+t.c.toString()):(n=e.b+"."+e.c.toString()+"."+e.v.toString(),r=t.b+"."+t.c.toString()+"."+t.v.toString()),n=n===r?n:n+"-"+r,null!=e.extra&&(n=e.extra+","+n),null!=t.extra&&(n+=","+t.extra),n},i.prototype.fix_ps151=function(e,t,n){return 151===e.c&&"Ps"===e.b?151===t.c&&"Ps"===t.b?(e.b="Ps151",e.c=1,t.b="Ps151",t.c=1):(e.extra=this.to_osis({b:"Ps151",c:1,v:e.v},{b:"Ps151",c:1,v:this.passage.translations[n].chapters.Ps151[0]},n),e.b="Prov",e.c=1,e.v=1):(t.extra=this.to_osis({b:"Ps151",c:1,v:1},{b:"Ps151",c:1,v:t.v},n),t.c=150,t.v=this.passage.translations[n].chapters.Ps[149])},i.prototype.combine_consecutive_passages=function(e,t){var n,r,i,s,o,u,a,f,l,c;a=[],f={},o=e.length-1,n=-1,r=!1;for(i=c=0;0<=o?c<=o:c>=o;i=0<=o?++c:--c)(u=e[i],0<u.osis.length)?(l=a.length-1,s=!1,u.enclosed_indices[0]!==n&&(n=u.enclosed_indices[0]),0<=n&&(i===o||e[i+1].enclosed_indices[0]!==u.enclosed_indices[0])&&(r=s=!0),this.is_verse_consecutive(f,u.start,t)?(a[l].end=u.end,a[l].is_enclosed_last=s,a[l].indices[1]=u.indices[1],a[l].enclosed_indices[1]=u.enclosed_indices[1],a[l].osis=this.to_osis(a[l].start,u.end,t)):a.push(u),f={b:u.end.b,c:u.end.c,v:u.end.v}):(a.push(u),f={});return r&&this.snap_enclosed_indices(a),a},i.prototype.snap_enclosed_indices=function(e){var t,n,r;n=0;for(r=e.length;n<r;n++)t=e[n],null!=t.is_enclosed_last&&(0>t.enclosed_indices[0]&&t.is_enclosed_last&&(t.indices[1]=t.enclosed_indices[1]),delete t.is_enclosed_last);return e},i.prototype.is_verse_consecutive=function(e,t,n){var r;if(null==e.b)return!1;r=null!=this.passage.translations[n].order?this.passage.translations[n].order:this.passage.translations["default"].order;if(e.b===t.b){if(e.c===t.c){if(e.v===t.v-1)return!0}else if(1===t.v&&e.c===t.c-1&&e.v===this.passage.translations[n].chapters[e.b][e.c-1])return!0}else if(1===t.c&&1===t.v&&r[e.b]===r[t.b]-1&&e.c===this.passage.translations[n].chapters[e.b].length&&e.v===this.passage.translations[n].chapters[e.b][e.c-1])return!0;return!1},i.prototype.snap_sequence=function(e,t,n,r,i){var s;return s=t.passages[r],s.absolute_indices[0]===t.absolute_indices[0]&&r<i-1&&this.get_snap_sequence_i(t.passages,r,i)!==r?(t.absolute_indices[0]=t.passages[r+1].absolute_indices[0],this.remove_absolute_indices(t.passages,r+1)):s.absolute_indices[1]===t.absolute_indices[1]&&0<r?t.absolute_indices[1]=0<n.length?n[n.length-1].indices[1]:t.passages[r-1].absolute_indices[1]:"book"===e&&r<i-1&&!this.starts_with_book(t.passages[r+1])&&(t.passages[r+1].absolute_indices[0]=s.absolute_indices[0]),t},i.prototype.get_snap_sequence_i=function(e,t,n){var r,i,s;for(r=i=s=t+1;s<=n?i<n:i>n;r=s<=n?++i:--i){if(this.starts_with_book(e[r]))return r;if(e[r].valid.valid)break}return t},i.prototype.starts_with_book=function(e){return"b"===e.type.substr(0,1)||("range"===e.type||"ff"===e.type)&&"b"===e.start.type.substr(0,1)?!0:!1},i.prototype.remove_absolute_indices=function(e,t){var n,r,i,s,o,u;if(0>e[t].enclosed_absolute_indices[0])return!1;n=e[t].enclosed_absolute_indices,i=n[0],n=n[1],u=e.slice(t),s=0;for(o=u.length;s<o;s++){if(r=u[s],r.enclosed_absolute_indices[0]!==i||r.enclosed_absolute_indices[1]!==n)break;r.enclosed_absolute_indices=[-1,-1]}return!0},this.bcv_parser=e=i;var s=function(){};s.prototype.books=[],s.prototype.indices={},s.prototype.options={},s.prototype.translations={},s.prototype.handle_array=function(e,t,n){var r,i,s;null==t&&(t=[]),null==n&&(n={}),i=0;for(s=e.length;i<s;i++){r=e[i];if("stop"===r.type)break;n=this.handle_obj(r,t,n),t=n[0],n=n[1]}return[t,n]},s.prototype.handle_obj=function(e,t,n){return null!=e.type&&null!=this[e.type]?this[e.type](e,t,n):[t,n]},s.prototype.b=function(e,t,r){var i,s,o,u,a;e.start_context=n.shallow_clone(r),e.passages=[],r=[],a=this.books[e.value].parsed,o=0;for(u=a.length;o<u;o++)i=a[o],s=this.validate_ref(e.start_context.translations,{b:i}),i={start:{b:i},end:{b:i},valid:s},0===e.passages.length&&s.valid?e.passages.push(i):r.push(i);return 0===e.passages.length&&e.passages.push(r.shift()),0<r.length&&(e.passages[0].alternates=r),null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),t.push(e),r={b:e.passages[0].start.b},null!=e.start_context.translations&&(r.translations=e.start_context.translations),[t,r]},s.prototype.b_range=function(e,t,n){return this.range(e,t,n)},s.prototype.b_range_pre=function(e,t,r){var i,s;return e.start_context=n.shallow_clone(r),e.passages=[],i=this.pluck("b",e.value),r=this.b(i,[],r),i=r[0][0],r=r[1],null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),s={b:e.value[0].value+i.passages[0].start.b.substr(1),type:"b"},e.passages=[{start:s,end:i.passages[0].end,valid:i.passages[0].valid}],null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),t.push(e),[t,r]},s.prototype.base=function(e,t,n){return this.indices=this.calculate_indices(e.match,e.start_index),this.handle_array(e.value,t,n)},s.prototype.bc=function(e,t,r){var i,s,o,u,a,f,l,c,h;e.start_context=n.shallow_clone(r),e.passages=[],this.reset_context(r,["b","c","v"]),o=this.pluck("c",e.value).value,i=[],h=this.books[this.pluck("b",e.value).value].parsed,l=0;for(c=h.length;l<c;l++)s=h[l],u="c",f=this.validate_ref(e.start_context.translations,{b:s,c:o}),a={start:{b:s},end:{b:s},valid:f},f.messages.start_chapter_not_exist_in_single_chapter_book&&(a.valid=this.validate_ref(e.start_context.translations,{b:s,v:o}),a.start.c=1,a.end.c=1,u="v"),a.start[u]=o,s=this.fix_start_zeroes(a.valid,a.start.c,a.start.v),a.start.c=s[0],a.start.v=s[1],a.end[u]=a.start[u],0===e.passages.length&&a.valid.valid?e.passages.push(a):i.push(a);return 0===e.passages.length&&e.passages.push(i.shift()),0<i.length&&(e.passages[0].alternates=i),null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),this.set_context_from_object(r,["b","c","v"],e.passages[0].start),t.push(e),[t,r]},s.prototype.bc_title=function(e,t,r){var i,s,o,u;e.start_context=n.shallow_clone(r),r=this.bc(this.pluck("bc",e.value),[],r),i=r[0][0],r=r[1];if("Ps"!==i.passages[0].start.b.substr(0,2)&&null!=i.passages[0].alternates){s=o=0;for(u=i.passages[0].alternates.length;0<=u?o<u:o>u;s=0<=u?++o:--o)if("Ps"===i.passages[0].alternates[s].start.b.substr(0,2)){i.passages[0]=i.passages[0].alternates[s];break}}return"Ps"!==i.passages[0].start.b.substr(0,2)?(t.push(i),[t,r]):(this.books[this.pluck("b",i.value).value].parsed=["Ps"],i=this.pluck("title",e.value),e.value[1]={type:"v",value:[{type:"integer",value:1,indices:i.indices}],indices:i.indices},e.original_type="bc_title",e.type="bcv",this.bcv(e,t,e.start_context))},s.prototype.bcv=function(e,t,r){var i,s,o,u,a,f,l,c;e.start_context=n.shallow_clone(r),e.passages=[],this.reset_context(r,["b","c","v"]),o=this.pluck("bc",e.value),u=this.pluck("c",o.value).value,a=this.pluck("v",e.value).value,i=[],c=this.books[this.pluck("b",o.value).value].parsed,f=0;for(l=c.length;f<l;f++)s=c[f],o=this.validate_ref(e.start_context.translations,{b:s,c:u,v:a}),a=this.fix_start_zeroes(o,u,a),u=a[0],a=a[1],s={start:{b:s,c:u,v:a},end:{b:s,c:u,v:a},valid:o},0===e.passages.length&&o.valid?e.passages.push(s):i.push(s);return 0===e.passages.length&&e.passages.push(i.shift()),0<i.length&&(e.passages[0].alternates=i),null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),this.set_context_from_object(r,["b","c","v"],e.passages[0].start),t.push(e),[t,r]},s.prototype.bv=function(e,t,r){var i;return e.start_context=n.shallow_clone(r),i=e.value,i={indices:e.indices,value:[{type:"bc",value:[i[0],{type:"c",value:[{type:"integer",value:1}]}]},i[1]]},r=this.bcv(i,[],r),i=r[0][0],r=r[1],e.passages=i.passages,null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),t.push(e),[t,r]},s.prototype.c=function(e,t,r){var i,s;return e.start_context=n.shallow_clone(r),i="integer"===e.type?e.value:this.pluck("integer",e.value).value,s=this.validate_ref(e.start_context.translations,{b:r.b,c:i}),!s.valid&&s.messages.start_chapter_not_exist_in_single_chapter_book?this.v(e,t,r):(i=this.fix_start_zeroes(s,i)[0],e.passages=[{start:{b:r.b,c:i},end:{b:r.b,c:i},valid:s}],null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),t.push(e),r.c=i,this.reset_context(r,["v"]),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),[t,r])},s.prototype.c_psalm=function(e,t,n){var r;return e.original_type=e.type,e.original_value=e.value,e.type="bc",r=parseInt(this.books[e.value].value.match(/^\d+/)[0],10),e.value=[{type:"b",value:e.original_value,indices:e.indices},{type:"c",value:[{type:"integer",value:r,indices:e.indices}],indices:e.indices}],this.bc(e,t,n)},s.prototype.c_title=function(e,t,r){return e.start_context=n.shallow_clone(r),"Ps"!==r.b?this.c(e.value[0],t,r):(r=this.pluck("title",e.value),e.value[1]={type:"v",value:[{type:"integer",value:1,indices:r.indices}],indices:r.indices},e.original_type="c_title",e.type="cv",this.cv(e,t,e.start_context))},s.prototype.cv=function(e,t,r){var i,s,o;return e.start_context=n.shallow_clone(r),i=this.pluck("c",e.value).value,s=this.pluck("v",e.value).value,o=this.validate_ref(e.start_context.translations,{b:r.b,c:i,v:s}),s=this.fix_start_zeroes(o,i,s),i=s[0],s=s[1],e.passages=[{start:{b:r.b,c:i,v:s},end:{b:r.b,c:i,v:s},valid:o}],null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),t.push(e),r.c=i,r.v=s,null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),[t,r]},s.prototype.cb_range=function(e,t,n){var r,i,s;return e.original_type=e.type,e.type="range",i=e.value,r=i[0],s=i[1],i=i[2],e.original_value=[r,s,i],e.value=[{type:"bc",value:[r,s],indices:e.indices},i],i.indices[1]=e.indices[1],this.range(e,t,n)},s.prototype.cv_psalm=function(e,t,r){var i,s;return e.start_context=n.shallow_clone(r),e.original_type=e.type,s=e.original_value=e.value,i=s[0],s=s[1],e.type="bcv",i=this.c_psalm(i,[],e.start_context)[0][0],e.value=[i,s],this.bcv(e,t,r)},s.prototype.ff=function(e,t,r){return e.start_context=n.shallow_clone(r),e.value.push({type:"integer",indices:e.indices,value:999}),r=this.range(e,[],e.start_context),e=r[0][0],r=r[1],e.value.pop(),null!=e.passages[0].valid.end_verse_not_exist&&delete e.passages[0].valid.end_verse_not_exist,null!=e.passages[0].valid.end_chapter_not_exist&&delete e.passages[0].valid.end_chapter_not_exist,null!=e.passages[0].end.original_c&&delete e.passages[0].end.original_c,t.push(e),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),[t,r]},s.prototype.integer_title=function(e,t,r){return e.start_context=n.shallow_clone(r),"Ps"!==r.b?this.integer(e.value[0],t,r):(e.value[0]={type:"c",value:[e.value[0]],indices:[e.value[0].indices[0],e.value[0].indices[1]]},r=[e.indices[1]-5,e.indices[1]],e.value[1]={type:"v",value:[{type:"integer",value:1,indices:r}],indices:r},e.original_type="integer_title",e.type="cv",this.cv(e,t,e.start_context))},s.prototype.integer=function(e,t,n){return null!=n.v?this.v(e,t,n):this.c(e,t,n)},s.prototype.sequence=function(e,t,r){var i,s,o,u,a,f,l,c;e.start_context=n.shallow_clone(r),e.passages=[],l=e.value,o=0;for(a=l.length;o<a;o++){i=l[o],r=this.handle_array(i,[],r),i=r[0],i=i[0],r=r[1],c=i.passages,u=0;for(f=c.length;u<f;u++)s=c[u],null==s.type&&(s.type=i.type),null==s.absolute_indices&&(s.absolute_indices=i.absolute_indices),null!=i.start_context.translations&&(s.translations=i.start_context.translations),s.enclosed_absolute_indices="sequence_post_enclosed"===i.type?i.absolute_indices:[-1,-1],e.passages.push(s)}return null==e.absolute_indices&&(e.absolute_indices=0<e.passages.length&&"sequence"===e.type?[e.passages[0].absolute_indices[0],e.passages[e.passages.length-1].absolute_indices[1]]:this.get_absolute_indices(e.indices)),t.push(e),[t,r]},s.prototype.sequence_post_enclosed=function(e,t,n){return this.sequence(e,t,n)},s.prototype.v=function(e,t,r){var i,s,o;return s="integer"===e.type?e.value:this.pluck("integer",e.value).value,e.start_context=n.shallow_clone(r),i=null!=r.c?r.c:1,o=this.validate_ref(e.start_context.translations,{b:r.b,c:i,v:s}),s=this.fix_start_zeroes(o,0,s)[1],e.passages=[{start:{b:r.b,c:i,v:s},end:{b:r.b,c:i,v:s},valid:o}],null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),t.push(e),r.v=s,[t,r]},s.prototype.range=function(e,t,r){var i,s,o,u,a;e.start_context=n.shallow_clone(r),s=e.value,o=s[0],i=s[1];if("v"!==i.type||"bc"!==o.type&&"c"!==o.type||"verse"!==this.options.end_range_digits_strategy)return r=this.handle_obj(o,[],r),o=r[0][0],r=r[1],r=this.handle_obj(i,[],r),i=r[0][0],r=r[1],e.value=[o,i],e.indices=[o.indices[0],i.indices[1]],delete e.absolute_indices,u={b:o.passages[0].start.b,c:o.passages[0].start.c,v:o.passages[0].start.v,type:o.type},s={b:i.passages[0].end.b,c:i.passages[0].end.c,v:i.passages[0].end.v,type:i.type},i.passages[0].valid.messages.start_chapter_is_zero&&(s.c=0),i.passages[0].valid.messages.start_verse_is_zero&&(s.v=0),a=this.validate_ref(e.start_context.translations,u,s),a.valid?(i=this.range_handle_valid(a,e,o,u,i,s,t),o=i[0],i=i[1],o)?i:(null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),e.passages=[{start:u,end:s,valid:a}],null!=e.start_context.translations&&(e.passages[0].translations=e.start_context.translations),t.push(e),[t,r]):this.range_handle_invalid(a,e,o,u,i,s,t);return this.range_change_integer_end(e,t)},s.prototype.range_change_end=function(e,t,n){var r;return r=e.value[1],"integer"===r.type?(r.original_value=r.value,r.value=n):"v"===r.type?(r=this.pluck("integer",r.value),r.original_value=r.value,r.value=n):"cv"===r.type&&(r=this.pluck("c",r.value),r.original_value=r.value,r.value=n),this.handle_obj(e,t,e.start_context)},s.prototype.range_change_integer_end=function(e,t){var n,r;return n=e.value,r=n[0],n=n[1],e.original_type=e.type,e.original_value=[r,n],e.type="integer"===r.type?"cv":r.type+"v","integer"===r.type&&(e.value[0]={type:"c",value:[r],indices:r.indices}),"integer"===n.type&&(e.value[1]={type:"v",value:[n],indices:n.indices}),this.handle_obj(e,t,e.start_context)},s.prototype.range_change_cv_end=function(e,t){var r,i,s;return r=e.value,s=r[0],r=r[1],e.original_type=e.type,e.original_value=[s,r],e.type="sequence",i=r.value,r=i[0],i=i[1],r=n.shallow_clone(r),r.original_type=r.type,r.type="v",e.value=[[{type:"range",value:[s,r],indices:[s.indices[0],r.indices[1]]}],[i]],this.sequence(e,t,e.start_context)},s.prototype.range_validate=function(e,t,n,r){return e.messages.end_chapter_not_exist?(n.original_c=n.c,n.c=e.messages.end_chapter_not_exist,null!=n.v&&(n.v=this.validate_ref(r.start_context.translations,{b:n.b,c:n.c,v:999}).messages.end_verse_not_exist)):e.messages.end_verse_not_exist&&(n.original_v=n.v,n.v=e.messages.end_verse_not_exist),e.messages.end_verse_is_zero&&"allow"!==this.options.zero_verse_strategy&&(n.v=e.messages.end_verse_is_zero),e.messages.end_chapter_is_zero&&(n.c=e.messages.end_chapter_is_zero),e=this.fix_start_zeroes(e,t.c,t.v),t.c=e[0],t.v=e[1],!0},s.prototype.range_check_new_end=function(e,t,n,r){var i,s;return i=0,s=null,r.messages.end_chapter_before_start?s="c":r.messages.end_verse_before_start&&(s="v"),null!=s&&(i=this.range_get_new_end_value(t,n,r,s)),0<i&&(t={b:n.b,c:n.c,v:n.v},t[s]=i,e=this.validate_ref(e,t),e.valid||(i=0)),i},s.prototype.range_get_new_end_value=function(e,t,n,r){var i;return i=0,"c"===r&&n.messages.end_chapter_is_zero||"v"===r&&n.messages.end_verse_is_zero?i:(10<=e[r]&&10>t[r]&&e[r]-10*Math.floor(e[r]/10)<t[r]?i=t[r]+10*Math.floor(e[r]/10):100<=e[r]&&100>t[r]&&e[r]-100<t[r]&&(i=t[r]+100),i)},s.prototype.range_handle_valid=function(e,t,n,r,i,s,o){if(e.messages.end_chapter_not_exist&&"verse"===this.options.end_range_digits_strategy&&null==r.v&&("integer"===i.type||"v"===i.type))if(n="v"===i.type?this.pluck("integer",i.value):i.value,n=this.validate_ref(t.start_context.translations,{b:r.b,c:r.c,v:n}),n.valid)return[!0,this.range_change_integer_end(t,o)];return e.messages.end_chapter_not_exist&&"verse"===this.options.end_range_digits_strategy&&null!=r.v&&"cv"===i.type&&(n=this.validate_ref(t.start_context.translations,{b:s.b,c:r.c,v:s.c}),n.valid&&(n=this.validate_ref(t.start_context.translations,{b:s.b,c:r.c,v:s.v})),n.valid)?[!0,this.range_change_cv_end(t,o)]:(this.range_validate(e,r,s,t),[!1,null])},s.prototype.range_handle_invalid=function(e,t,n,r,i,s,o){if((e.messages.end_chapter_before_start||e.messages.end_verse_before_start)&&("integer"===i.type||"v"===i.type)||e.messages.end_chapter_before_start&&"cv"===i.type)if(e=this.range_check_new_end(t.start_context.translations,r,s,e),0<e)return this.range_change_end(t,o,e);if("verse"===this.options.end_range_digits_strategy&&void 0===r.v&&("integer"===i.type||"v"===i.type))if(e="v"===i.type?this.pluck("integer",i.value):i.value,r=this.validate_ref(t.start_context.translations,{b:r.b,c:r.c,v:e}),r.valid)return this.range_change_integer_end(t,o);return r=[t.type,"sequence"],t.original_type=r[0],t.type=r[1],n=[[n,i],[[n],[i]]],t.original_value=n[0],t.value=n[1],this.handle_obj(t,o,t.start_context)},s.prototype.translation_sequence=function(e,t,n){var r,i,s,o,u;i=[],i.push({translation:this.books[e.value[0].value].parsed}),u=e.value[1],s=0;for(o=u.length;s<o;s++)r=u[s],r=this.books[this.pluck("translation",r).value].parsed,null!=r&&i.push({translation:r});s=0;for(o=i.length;s<o;s++)r=i[s],null!=this.translations.aliases[r.translation]?(r.alias=this.translations.aliases[r.translation].alias,r.osis=this.translations.aliases[r.translation].osis):(r.alias="default",r.osis=r.translation.toUpperCase());if(0<t.length){s=0;for(r=o=u=t.length-1;0>=u?0>=o:0<=o;r=0>=u?++o:--o)if(null!=t[r].original_type&&(t[r].type=t[r].original_type),null!=t[r].original_value&&(t[r].value=t[r].original_value),"translation_sequence"===t[r].type){s=r+1;break}s<t.length&&(t[s].start_context.translations=i,n=this.handle_array(t.slice(s),[],t[s].start_context),n=n[1])}return null==e.absolute_indices&&(e.absolute_indices=this.get_absolute_indices(e.indices)),t.push(e),this.reset_context(n,["translations"]),[t,n]},s.prototype.pluck=function(e,t){var n,r,i;r=0;for(i=t.length;r<i;r++)if(n=t[r],null!=n.type&&n.type===e)return"c"===e||"v"===e?this.pluck("integer",n.value):n;return null},s.prototype.set_context_from_object=function(e,t,n){var r,i,s,o;o=[],i=0;for(s=t.length;i<s;i++)r=t[i],null!=n[r]&&o.push(e[r]=n[r]);return o},s.prototype.reset_context=function(e,t){var n,r,i,s;s=[],r=0;for(i=t.length;r<i;r++)n=t[r],s.push(delete e[n]);return s},s.prototype.fix_start_zeroes=function(e,t,n){return e.valid&&(e.messages.start_chapter_is_zero&&(t=e.messages.start_chapter_is_zero),e.messages.start_verse_is_zero&&"allow"!==this.options.zero_verse_strategy&&(n=e.messages.start_verse_is_zero)),[t,n]},s.prototype.calculate_indices=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;a="book",r=[],i=0,t=parseInt(t,10),u=[e],p=["",""],f=0;for(c=p.length;f<c;f++){n=p[f],o=[],l=0;for(h=u.length;l<h;l++)s=u[l],o=o.concat(s.split(n));u=o}f=0;for(l=u.length;f<l;f++)s=u[f],a="book"===a?"rest":"book",o=s.length,0!==o&&("book"===a?(s=s.replace(/\/[a-z]$/,""),n=i+o,0<r.length&&r[r.length-1].index===t?r[r.length-1].end=n:r.push({start:i,end:n,index:t}),i+=o+2,t=this.books[s].start_index+this.books[s].value.length-i,r.push({start:n+1,end:n+1,index:t})):(n=i+o-1,0<r.length&&r[r.length-1].index===t?r[r.length-1].end=n:r.push({start:i,end:n,index:t}),i+=o));return r},s.prototype.get_absolute_indices=function(e){var t,n,r,i,s,o,u;r=e[0],e=e[1],t=i=null,u=this.indices,s=0;for(o=u.length;s<o;s++)if(n=u[s],null===i&&n.start<=r&&r<=n.end&&(i=r+n.index),n.start<=e&&e<=n.end){t=e+n.index+1;break}return[i,t]},s.prototype.validate_ref=function(e,t,n){var r,i;return e||(e=[{translation:"default",osis:"",alias:"default"}]),i=e[0],null==i?{valid:!1,messages:{translation_invalid:!0}}:(r={},null==i.alias&&(i.alias="default"),null==i.alias?{valid:!1,messages:{translation_invalid:!0}}:(null==this.translations.aliases[i.alias]&&(i.alias="default",r.translation_unknown=!0),r=this.validate_start_ref(i.alias,t,!0,r),e=r[0],r=r[1],n&&(t=this.validate_end_ref(i.alias,t,n,e,r),e=t[0],r=t[1]),{valid:e,messages:r}))},s.prototype.validate_start_ref=function(e,t,n,r){var i,s;"default"!==e&&null==(null!=(i=this.translations[e])?i.chapters[t.b]:void 0)&&this.promote_book_to_translation(t.b,e),i=null!=(null!=(s=this.translations[e])?s.order:void 0)?e:"default";if(null!=this.translations[i].order[t.b]){null==t.c&&(t.c=1),t.c=parseInt(t.c,10);if(isNaN(t.c))return r.start_chapter_not_numeric=!0,[!1,r];0===t.c&&(r.start_chapter_is_zero=1,"error"===this.options.zero_chapter_strategy?n=!1:t.c=1),0<t.c&&null!=this.translations[e].chapters[t.b][t.c-1]?null!=t.v&&(t.v=parseInt(t.v,10),isNaN(t.v)?(n=!1,r.start_verse_not_numeric=!0):0===t.v?(r.start_verse_is_zero=1,"error"===this.options.zero_verse_strategy?n=!1:"upgrade"===this.options.zero_verse_strategy&&(t.v=1)):t.v>this.translations[e].chapters[t.b][t.c-1]&&(n=!1,r.start_verse_not_exist=this.translations[e].chapters[t.b][t.c-1])):(n=!1,1!==t.c&&1===this.translations[e].chapters[t.b].length?r.start_chapter_not_exist_in_single_chapter_book=1:0<t.c&&(r.start_chapter_not_exist=this.translations[e].chapters[t.b].length))}else n=!1,r.start_book_not_exist=!0;return[n,r]},s.prototype.validate_end_ref=function(e,t,n,r,i){var s,o;return"default"!==e&&null==(null!=(s=this.translations[e])?s.chapters[n.b]:void 0)&&this.promote_book_to_translation(n.b,e),s=null!=(null!=(o=this.translations[e])?o.order:void 0)?e:"default",null!=n.c&&(n.c=parseInt(n.c,10)),null!=n.v&&(n.v=parseInt(n.v,10)),null!=n.c&&!isNaN(n.c)&&0===n.c&&(i.end_chapter_is_zero=1,"error"===this.options.zero_chapter_strategy?r=!1:n.c=1),null!=this.translations[s].order[n.b]?(null!=this.translations[s].order[t.b]&&this.translations[s].order[t.b]>this.translations[s].order[n.b]&&(r=!1,i.end_book_before_start=!0),t.b===n.b&&null!=n.c&&!isNaN(n.c)&&(null==t.c&&(t.c=1),!isNaN(parseInt(t.c,10))&&t.c>n.c?(r=!1,i.end_chapter_before_start=!0):t.c===n.c&&null!=n.v&&!isNaN(n.v)&&(null==t.v&&(t.v=1),!isNaN(parseInt(t.v,10))&&t.v>n.v&&(r=!1,i.end_verse_before_start=!0))),null!=n.c&&!isNaN(n.c)&&null==this.translations[e].chapters[n.b][n.c-1]&&(1===this.translations[e].chapters[n.b].length?i.end_chapter_not_exist_in_single_chapter_book=1:0<n.c&&(i.end_chapter_not_exist=this.translations[e].chapters[n.b].length)),null!=n.v&&!isNaN(n.v)&&(null==n.c&&(n.c=this.translations[e].chapters[n.b].length),n.v>this.translations[e].chapters[n.b][n.c-1]?i.end_verse_not_exist=this.translations[e].chapters[n.b][n.c-1]:0===n.v&&(i.end_verse_is_zero=1,"error"===this.options.zero_verse_strategy?r=!1:"upgrade"===this.options.zero_verse_strategy&&(n.v=1)))):(r=!1,i.end_book_not_exist=!0),null!=n.c&&isNaN(n.c)&&(r=!1,i.end_chapter_not_numeric=!0),null!=n.v&&isNaN(n.v)&&(r=!1,i.end_verse_not_numeric=!0),[r,i]},s.prototype.promote_book_to_translation=function(e,t){var r,i,s;return null==(r=this.translations)[t]&&(r[t]={}),null==(r=this.translations[t]).chapters&&(r.chapters={}),null!=(null!=(i=this.translations.alternates[t])?null!=(s=i.chapters)?s[e]:void 0:void 0)?this.translations[t].chapters[e]=this.translations.alternates[t].chapters[e]:this.translations[t].chapters[e]=n.shallow_clone_array(this.translations["default"].chapters[e])},t=s,n={shallow_clone:function(e){var t,n,i;if(null==e)return e;n={};for(t in e)r.call(e,t)&&(i=e[t],n[t]=i);return n},shallow_clone_array:function(e){var t,n,r,i;if(null==e)return e;n=[],t=r=0;for(i=e.length;0<=i?r<=i:r>=i;t=0<=i?++r:--r)"undefined"!=typeof e[t]&&(n[t]=e[t]);return n}},e.prototype.regexps.translations=/(?:AMP|ASV|CE[BV]|E[RS]V|HCSB|N?KJV|MSG|NAB(?:RE)?|NASB?|NIR?V|NLT|N?RSV|TNIV)\b/gi,e.prototype.translations={aliases:{ceb:{osis:"CEB",alias:"ceb"},kjv:{osis:"KJV",alias:"kjv"},nab:{osis:"NAB",alias:"nab"},nas:{osis:"NASB",alias:"default"},nirv:{osis:"NIrV",alias:"kjv"},niv:{osis:"NIV",alias:"kjv"},nkjv:{osis:"NKJV",alias:"nkjv"},nlt:{osis:"NLT",alias:"nlt"},nrsv:{osis:"NRSV",alias:"nrsv"},"default":{osis:"",alias:"default"}},"default":{order:{Gen:1,Exod:2,Lev:3,Num:4,Deut:5,Josh:6,Judg:7,Ruth:8,"1Sam":9,"2Sam":10,"1Kgs":11,"2Kgs":12,"1Chr":13,"2Chr":14,Ezra:15,Neh:16,Esth:17,Job:18,Ps:19,Prov:20,Eccl:21,Song:22,Isa:23,Jer:24,Lam:25,Ezek:26,Dan:27,Hos:28,Joel:29,Amos:30,Obad:31,Jonah:32,Mic:33,Nah:34,Hab:35,Zeph:36,Hag:37,Zech:38,Mal:39,Matt:40,Mark:41,Luke:42,John:43,Acts:44,Rom:45,"1Cor":46,"2Cor":47,Gal:48,Eph:49,Phil:50,Col:51,"1Thess":52,"2Thess":53,"1Tim":54,"2Tim":55,Titus:56,Phlm:57,Heb:58,Jas:59,"1Pet":60,"2Pet":61,"1John":62,"2John":63,"3John":64,Jude:65,Rev:66,Tob:67,Jdt:68,GkEsth:69,Wis:70,Sir:71,Bar:72,PrAzar:73,Sus:74,Bel:75,SgThree:76,EpJer:77,"1Macc":78,"2Macc":79,"3Macc":80,"4Macc":81,"1Esd":82,"2Esd":83,PrMan:84,Ps151:85},chapters:{Gen:[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,55,32,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],Exod:[22,25,22,31,23,30,25,32,35,29,10,51,22,31,27,36,16,27,25,26,36,31,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],Lev:[17,16,17,35,19,30,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],Num:[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,50,13,32,22,29,35,41,30,25,18,65,23,31,40,16,54,42,56,29,34,13],Deut:[46,37,29,49,33,25,26,20,29,22,32,32,18,29,23,22,20,22,21,20,23,30,25,22,19,19,26,68,29,20,30,52,29,12],Josh:[18,24,17,24,15,27,26,35,27,43,23,24,33,15,63,10,18,28,51,9,45,34,16,33],Judg:[36,23,31,24,31,40,25,35,57,18,40,15,25,20,20,31,13,31,30,48,25],Ruth:[22,23,18,22],"1Sam":[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,15,23,29,22,44,25,12,25,11,31,13],"2Sam":[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,33,43,26,22,51,39,25],"1Kgs":[53,46,28,34,18,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,53],"2Kgs":[18,25,27,44,27,33,20,29,37,36,21,21,25,29,38,20,41,37,37,21,26,20,37,20,30],"1Chr":[54,55,24,43,26,81,40,40,44,14,47,40,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],"2Chr":[17,18,17,22,14,42,22,18,31,19,23,16,22,15,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],Ezra:[11,70,13,24,17,22,28,36,15,44],Neh:[11,20,32,23,19,19,73,18,38,39,36,47,31],Esth:[22,23,15,17,14,14,10,17,32,3],Job:[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,24,34,17],Ps:[6,12,8,8,12,10,17,9,20,18,7,8,6,7,5,11,15,50,14,9,13,31,6,10,22,12,14,9,11,12,24,11,22,22,28,12,40,22,13,17,13,11,5,26,17,11,9,14,20,23,19,9,6,7,23,13,11,11,17,12,8,12,11,10,13,20,7,35,36,5,24,20,28,23,10,12,20,72,13,19,16,8,18,12,13,17,7,18,52,17,16,15,5,23,11,13,12,9,9,5,8,28,22,35,45,48,43,13,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,13,10,7,12,15,21,10,20,14,9,6],Prov:[33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31],Eccl:[18,26,22,16,20,12,29,17,18,20,10,14],Song:[17,17,11,16,16,13,13,14],Isa:[31,22,26,6,30,13,25,22,21,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,12,25,24],Jer:[19,37,25,31,31,30,34,22,26,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],Lam:[22,22,66,22,22],Ezek:[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,49,32,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],Dan:[21,49,30,37,31,28,28,27,27,21,45,13],Hos:[11,23,5,19,15,11,16,14,17,15,12,14,16,9],Joel:[20,32,21],Amos:[15,16,15,13,27,14,17,14,15],Obad:[21],Jonah:[17,10,10,11],Mic:[16,13,12,13,15,16,20],Nah:[15,13,19],Hab:[17,20,19],Zeph:[18,15,20],Hag:[15,23],Zech:[21,13,10,14,11,15,14,23,17,12,17,14,9,21],Mal:[14,17,18,6],Matt:[25,23,17,25,48,34,29,34,38,42,30,50,58,36,39,28,27,35,30,34,46,46,39,51,46,75,66,20],Mark:[45,28,35,41,43,56,37,38,50,52,33,44,37,72,47,20],Luke:[80,52,38,44,39,49,50,56,62,42,54,59,35,35,32,31,37,43,48,47,38,71,56,53],John:[51,25,36,54,47,71,53,59,41,42,57,50,38,31,27,33,26,40,42,31,25],Acts:[26,47,26,37,42,15,60,40,43,48,30,25,52,28,41,40,34,28,41,38,40,30,35,27,27,32,44,31],Rom:[32,29,31,25,21,23,25,39,33,21,36,21,14,23,33,27],"1Cor":[31,16,23,21,13,20,40,13,27,33,34,31,13,40,58,24],"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,14],Gal:[24,21,29,31,26,18],Eph:[23,22,21,32,33,24],Phil:[30,30,21,23],Col:[29,23,25,18],"1Thess":[10,20,13,18,28],"2Thess":[12,17,18],"1Tim":[20,15,16,16,25,21],"2Tim":[18,26,17,22],Titus:[16,15,15],Phlm:[25],Heb:[14,18,19,16,14,20,28,13,28,39,40,29,25],Jas:[27,26,18,17,20],"1Pet":[25,25,22,19,14],"2Pet":[21,22,18],"1John":[10,29,24,21,21],"2John":[13],"3John":[15],Jude:[25],Rev:[20,29,22,11,14,17,17,13,21,11,19,17,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,16,21,6,13,18,22,17,15],Jdt:[16,28,10,15,24,21,32,36,14,23,23,20,20,19,14,25],GkEsth:[22,23,15,17,14,14,10,17,32,13,12,6,18,19,16,24],Wis:[16,24,19,20,23,25,30,21,18,21,26,27,19,31,19,29,21,25,22],Sir:[30,18,31,31,15,37,36,19,18,31,34,18,26,27,20,30,32,33,30,31,28,27,27,34,26,29,30,26,28,25,31,24,33,31,26,31,31,34,35,30,22,25,33,23,26,20,25,25,16,29,30],Bar:[22,35,37,37,9],PrAzar:[68],Sus:[64],Bel:[42],SgThree:[39],EpJer:[73],"1Macc":[64,70,60,61,68,63,50,32,73,89,74,53,53,49,41,24],"2Macc":[36,32,40,50,27,31,42,36,29,38,38,45,26,46,39],"3Macc":[29,33,30,21,51,41,23],"4Macc":[35,24,21,26,38,35,23,29,32,21,27,19,27,20,32,25,24,24],"1Esd":[58,30,24,63,73,34,15,96,55],"2Esd":[40,48,36,52,56,59,70,63,47,59,46,51,58,48,63,78],PrMan:[15],Ps151:[7]}},alternates:{ceb:{chapters:{"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,16,21,6,13,18,22,18,15],PrAzar:[67],EpJer:[72],"1Esd":[55,26,24,63,71,33,15,92,55]}},kjv:{chapters:{"3John":[14]}},nab:{chapters:{Gen:[31,25,24,26,32,22,24,22,29,32,32,20,18,24,21,16,27,33,38,18,34,24,20,67,34,35,46,22,35,43,54,33,20,31,29,43,36,30,23,23,57,38,34,34,28,34,31,22,33,26],Exod:[22,25,22,31,23,30,29,28,35,29,10,51,22,31,27,36,16,27,25,26,37,30,33,18,40,37,21,43,46,38,18,35,23,35,35,38,29,31,43,38],Lev:[17,16,17,35,26,23,38,36,24,20,47,8,59,57,33,34,16,30,37,27,24,33,44,23,55,46,34],Num:[54,34,51,49,31,27,89,26,23,36,35,16,33,45,41,35,28,32,22,29,35,41,30,25,19,65,23,31,39,17,54,42,56,29,34,13],Deut:[46,37,29,49,33,25,26,20,29,22,32,31,19,29,23,22,20,22,21,20,23,29,26,22,19,19,26,69,28,20,30,52,29,12],"1Sam":[28,36,21,22,12,21,17,22,27,27,15,25,23,52,35,23,58,30,24,42,16,23,28,23,44,25,12,25,11,31,13],"2Sam":[27,32,39,12,25,23,29,18,13,19,27,31,39,33,37,23,29,32,44,26,22,51,39,25],"1Kgs":[53,46,28,20,32,38,51,66,28,29,43,33,34,31,34,34,24,46,21,43,29,54],"2Kgs":[18,25,27,44,27,33,20,29,37,36,20,22,25,29,38,20,41,37,37,21,26,20,37,20,30],"1Chr":[54,55,24,43,41,66,40,40,44,14,47,41,14,17,29,43,27,17,19,8,30,19,32,31,31,32,34,21,30],"2Chr":[18,17,17,22,14,42,22,18,31,19,23,16,23,14,19,14,19,34,11,37,20,12,21,27,28,23,9,27,36,27,21,33,25,33,27,23],Neh:[11,20,38,17,19,19,72,18,37,40,36,47,31],Job:[22,13,26,21,27,30,21,22,35,22,20,25,28,22,35,22,16,21,29,29,34,30,17,25,6,14,23,28,25,31,40,22,33,37,16,33,24,41,30,32,26,17],Ps:[6,11,9,9,13,11,18,10,21,18,7,9,6,7,5,11,15,51,15,10,14,32,6,10,22,12,14,9,11,13,25,11,22,23,28,13,40,23,14,18,14,12,5,27,18,12,10,15,21,23,21,11,7,9,24,14,12,12,18,14,9,13,12,11,14,20,8,36,37,6,24,20,28,23,11,13,21,72,13,20,17,8,19,13,14,17,7,19,53,17,16,16,5,23,11,13,12,9,9,5,8,29,22,35,45,48,43,14,31,7,10,10,9,8,18,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,14,10,8,12,15,21,10,20,14,9,6],Eccl:[18,26,22,17,19,12,29,17,18,20,10,14],Song:[17,17,11,16,16,12,14,14],Isa:[31,22,26,6,30,13,25,23,20,34,16,6,22,32,9,14,14,7,25,6,17,25,18,23,12,21,13,29,24,33,9,20,24,17,10,22,38,22,8,31,29,25,28,28,25,13,15,22,26,11,23,15,12,17,13,12,21,14,21,22,11,12,19,11,25,24],Jer:[19,37,25,31,31,30,34,23,25,25,23,17,27,22,21,21,27,23,15,18,14,30,40,10,38,24,22,17,32,24,40,44,26,22,19,32,21,28,18,16,18,22,13,30,5,28,7,47,39,46,64,34],Ezek:[28,10,27,17,17,14,27,18,11,22,25,28,23,23,8,63,24,32,14,44,37,31,49,27,17,21,36,26,21,26,18,32,33,31,15,38,28,23,29,49,26,20,27,31,25,24,23,35],Dan:[21,49,100,34,30,29,28,27,27,21,45,13,64,42],Hos:[9,25,5,19,15,11,16,14,17,15,11,15,15,10],Joel:[20,27,5,21],Jonah:[16,11,10,11],Mic:[16,13,12,14,14,16,20],Nah:[14,14,19],Zech:[17,17,10,14,11,15,14,23,17,12,17,14,9,21],Mal:[14,17,24],Acts:[26,47,26,37,42,15,60,40,43,49,30,25,52,28,41,40,34,28,40,38,40,30,35,27,27,32,44,31],"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21],Tob:[22,14,17,21,22,18,17,21,6,13,18,22,18,15],Sir:[30,18,31,31,15,37,36,19,18,31,34,18,26,27,20,30,32,33,30,31,28,27,27,33,26,29,30,26,28,25,31,24,33,31,26,31,31,34,35,30,22,25,33,23,26,20,25,25,16,29,30],Bar:[22,35,38,37,9,72],"2Macc":[36,32,40,50,27,31,42,36,29,38,38,46,26,46,39]}},nlt:{chapters:{Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21]}},nrsv:{chapters:{"2Cor":[24,17,18,18,21,18,16,24,15,18,33,21,13],Rev:[20,29,22,11,14,17,17,13,21,11,19,18,18,20,8,21,18,24,21,15,27,21]}},vulgate:{chapters:{Ps:[6,13,9,10,13,11,18,10,39,8,9,6,7,5,10,15,51,15,10,14,32,6,10,22,12,14,9,11,13,25,11,22,23,28,13,40,23,14,18,14,12,5,26,18,12,10,15,21,23,21,11,7,9,24,13,12,12,18,14,9,13,12,11,14,20,8,36,37,6,24,20,28,23,11,13,21,72,13,20,17,8,19,13,14,17,7,19,53,17,16,16,5,23,11,13,12,9,9,5,8,29,22,35,45,48,43,14,31,7,10,10,9,26,9,19,2,29,176,7,8,9,4,8,5,6,5,6,8,8,3,18,3,3,21,26,9,8,24,14,10,8,12,15,21,10,11,20,14,9,7]}}}},e.prototype.regexps.escaped_passage=/(?:^|[^\w\x1f\x1e])((?:(?:ch(?:apters?|a?pts?\.?|a?p?s?\.?)?\s*\d+\s*(?:[\u2013\u2014\-]|through|thru|to)\s*\d+\s*(?:from|of|in)(?:\s+the\s+book\s+of)?\s*)|(?:ch(?:apters?|a?pts?\.?|a?p?s?\.?)?\s*\d+\s*(?:from|of|in)(?:\s+the\s+book\s+of)?\s*)|(?:\d+(?:th|nd|st)\s*ch(?:apter|a?pt\.?|a?p?\.?)?\s*(?:from|of|in)(?:\s+the\s+book\s+of)?\s*))?\x1f(\d+)(?:\/[a-z])?\x1f(?:c(?:f|ompare|h(?:apters?|a?pts?|a?p?s?))|a(?:nd|lso)|\/[pq]\x1f|[\d.:,;\x1e\x1f&\(\)\[\]\/"'\*=~\-\u2013\u2014\s\xa0]|[a-e](?!\w)|ff?\b|see|title(?![a-z])|thr(?:ough|u)|to|v(?:erses?|er|ss?|v)?|$)+)/gi,e.prototype.regexps.match_end_split=/\d+\W*title|\d+\W*ff?(?:[\s\xa0*]*\.)?|\d+[\s\xa0*]*[a-e](?!\w)|\x1e(?:[\s\xa0*]*[)\]])?|[\d\x1f]+/gi,e.prototype.regexps.space="[\\s\\xa0]",e.prototype.regexps.control=/[\x1e\x1f]/g,e.prototype.regexps.first="(?:1st|1|I|First)\\.?"+e.prototype.regexps.space+"*",e.prototype.regexps.second="(?:2nd|2|II|Second)\\.?"+e.prototype.regexps.space+"*",e.prototype.regexps.third="(?:3rd|3|III|Third)\\.?"+e.prototype.regexps.space+"*",e.prototype.regexps.fourth="(?:4th|4|IV|Fourth)\\.?"+e.prototype.regexps.space+"*",e.prototype.regexps.gospel="(?:(?:The[.\\s\\xa0-]*)?Gospel[.\\s\\xa0-]?(?:of[.\\s\\xa0-]*|according[\\s\\xa0-]*?to[.\\s\\xa0-]*)(?:[.\\s\\xa0-]*?(?:Saint|St)[.\\s\\xa0-]*)?|(?:(?:Saint|St)[.\\s\\xa0-]*))?",e.prototype.regexps.range_and="(?:[&–—-]|and|through|to)",e.prototype.regexps.range_only="(?:[–—-]|through|to)",e.prototype.regexps.get_books=function(t,n){var r,i,s,o,u;i=[{osis:["Gen"],regexp:/(\d|\b)(Ge(?:nn?[ei][ei]?s[eiu]s|nn?[es]is|nes[ei]|n)|G[en])(?:\b|(?=\d))/gi},{osis:["Exod"],regexp:/(\d|\b)(Ex(?:od[ui]s|od[se]|od|[do]?))(?:\b|(?=\d))/gi},{osis:["Lev"],regexp:/(\d|\b)(L(?:[ei]v[ei]t[ei]?cus|evi|ev|[ev]))(?:\b|(?=\d))/gi},{osis:["Num"],regexp:/(\d|\b)(N(?:umbers?|umb?|[um]))(?:\b|(?=\d))/gi},{osis:["Deut"],regexp:/(\d|\b)(D(?:eut[eo]?rono?my|ueteronomy|eut?|uet|t))(?:\b|(?=\d))/gi},{osis:["Josh"],regexp:/(\d|\b)(J(?:ou?sh?ua|o?sh|os))(?:\b|(?=\d))/gi},{osis:["Judg"],regexp:/(\d|\b)(J(?:udges|udg|d?gs?))(?:\b|(?=\d))/gi},{osis:["Ruth"],regexp:/(\d|\b)(R(?:uth?|th|u))(?:\b|(?=\d))/gi},{osis:["Isa"],regexp:/(\d|\b)(I(?:saiah|sais?ha?|s[ai]{2,}ha?|s[is]ah|sa[hi]?|sa?|a))(?:\b|(?=\d))/gi},{osis:["2Sam"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"(?:Samu[ae]l[ls]?|Sam|Sma|S[am]|Kingdoms)|2"+e.prototype.regexps.space+"*S)(?:\\b|(?=\\d))","gi")},{osis:["1Sam"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?Samu[ae]l[ls]?|"+e.prototype.regexps.first+"(?:Sam|Sma|S[am]|Kingdoms)|1"+e.prototype.regexps.space+"*S)(?:\\b|(?=\\d))","gi")},{osis:["2Kgs"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"Ki?n?g?s?|"+e.prototype.regexps.fourth+"Kingdoms)(?:\\b|(?=\\d))","gi")},{osis:["1Kgs"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?K(?:i?ngs|in|gs)|"+e.prototype.regexps.first+"Ki?n?g?s?|"+e.prototype.regexps.third+"Kingdoms)(?:\\b|(?=\\d))","gi")},{osis:["2Chr"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"(?:Ch?o?ron[io]cles?|Chronicals|Chro?n?|Cron|Paralipomenon)|2"+e.prototype.regexps.space+"*Ch)(?:\\b|(?=\\d))","gi")},{osis:["1Chr"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?(?:Ch?o?ron[io]cles?|Chronicals|Paralipomenon)|"+e.prototype.regexps.first+"(?:Chro?n?|Cron)|1"+e.prototype.regexps.space+"*Ch)(?:\\b|(?=\\d))","gi")},{osis:["Ezra"],regexp:/(\d|\b)(E(?:zra?|sra))(?:\b|(?=\d))/gi},{osis:["Neh"],regexp:/(\d|\b)(N(?:eh[ei]m[ai]{1,3}h|eh?))(?:\b|(?=\d))/gi},{osis:["GkEsth"],apocrypha:!0,regexp:RegExp("(\\d|\\b)(Greek"+e.prototype.regexps.space+"*Esther|Esther"+e.prototype.regexps.space+"*\\(Greek\\)|G(?:ree)?k"+e.prototype.regexps.space+"*Esth?)(?:\\b|(?=\\d))","gi")},{osis:["Esth"],regexp:/(\d|\b)(E(?:sth?er|sth?|s))(?:\b|(?=\d))/gi},{osis:["Job"],regexp:/(\d|\b)(Jo?b)(?:\b|(?=\d))/gi},{osis:["Ps"],extra:"p",regexp:RegExp("(\\b)((?:(?:(?:1[02-5]|[2-9])?(?:1"+e.prototype.regexps.space+"*st|2"+e.prototype.regexps.space+"*nd|3"+e.prototype.regexps.space+"*rd))|1?1[123]"+e.prototype.regexps.space+"*th|(?:150|1[0-4][04-9]|[1-9][04-9]|[4-9])"+e.prototype.regexps.space+"*th)"+e.prototype.regexps.space+"*Psalm)\\b","gi")},{osis:["Ps"],apocrypha:!0,extra:"q",regexp:/(\b)(Ps151)(?=\.1)/g},{osis:["Ps"],regexp:/(\d|\b)(P(?:s[alm]{2,4}s?|a[slm]{3,4}s?|l[sam]{2,4}s?|s[as]?m?))(?:\b|(?=\d))/gi},{osis:["Prov"],regexp:/(\d|\b)(P(?:r[eo]?verbs?|robv?erbs|or?verbs|rovebs|rvbs?|ro?v?|v)|Oroverbs)(?:\b|(?=\d))/gi},{osis:["Eccl"],regexp:/(\d|\b)(E(?:cc?less?[ia]{1,4}s?tes?|cclesiastic?es|ccles|ccl?|cl?))(?:\b|(?=\d))/gi},{osis:["SgThree"],apocrypha:!0,regexp:RegExp("(\\d|\\b)((?:The"+e.prototype.regexps.space+"*)?Song"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*(?:the"+e.prototype.regexps.space+"*)?(?:3|Three)"+e.prototype.regexps.space+"*(?:Holy"+e.prototype.regexps.space+"*Children|Young"+e.prototype.regexps.space+"*Men|Youths|Jews)|S\\.?"+e.prototype.regexps.space+"*(?:of)?"+e.prototype.regexps.space+"*(?:Three|Th|3)\\.?"+e.prototype.regexps.space+"*(?:Ch|Y)|So?n?gThree)(?:\\b|(?=\\d))","gi")},{osis:["Song"],regexp:RegExp("(\\d|\\b)((?:The"+e.prototype.regexps.space+"*)?Songs?"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*(?:S[ao]lom[ao]ns?|Songs?)|(?:S(?:n?gs?|ongs?|"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*S|o?S|o[ln]?)))(?:\\b|(?=\\d))","gi")},{osis:["EpJer"],apocrypha:!0,regexp:RegExp("(\\d|\\b)((?:The"+e.prototype.regexps.space+"*)?(?:Ep(?:istle)?|Let(?:ter))\\.?"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*Jeremiah|EpJer)(?:\\b|(?=\\d))","gi")},{osis:["Jer"],regexp:/(\d|\b)(Jer(?:emaiah|[ae]maih|[ae]miha|[aei]mi[ai]h|[ei]mi?ah|[ai]mih|[ae]mia|[am][im]ah|emi[he]?|e?)|J[er])(?:\b|(?=\d))/gi},{osis:["Lam"],regexp:/(\d|\b)(L(?:am[ei]ntations?|am?|m))(?:\b|(?=\d))/gi},{osis:["Ezek"],regexp:/(\d|\b)(E(?:[zx][ei]{1,2}ki?el|zekial|zek|z[ek]))(?:\b|(?=\d))/gi},{osis:["Dan"],regexp:/(\d|\b)(D(?:aniel|a?n|[al]))(?:\b|(?=\d))/gi},{osis:["Hos"],regexp:/(\d|\b)(H(?:osea|o?s|os?))(?:\b|(?=\d))/gi},{osis:["Joel"],regexp:/(\d|\b)(J(?:oel?|l))(?:\b|(?=\d))/gi},{osis:["Amos"],regexp:/(\d|\b)(Amo?s?)(?:\b|(?=\d))/gi},{osis:["Obad"],regexp:/(\d|\b)(O(?:badiah?|bidah|ba?d?))(?:\b|(?=\d))/gi},{osis:["Jonah"],regexp:/(\d|\b)(J(?:onah|on|nh))(?:\b|(?=\d))/gi},{osis:["Mic"],regexp:/(\d|\b)(M(?:ich?ah?|ic?))(?:\b|(?=\d))/gi},{osis:["Nah"],regexp:/(\d|\b)(N(?:ahum?|ah?))(?:\b|(?=\d))/gi},{osis:["Hab"],regexp:/(\d|\b)(H(?:abb?akk?[au]kk?|abk?))(?:\b|(?=\d))/gi},{osis:["Zeph"],regexp:/(\d|\b)(Z(?:ephana?iah?|e?ph?))(?:\b|(?=\d))/gi},{osis:["Hag"],regexp:/(\d|\b)(H(?:agg?ai|aggia[ih]|a?gg?))(?:\b|(?=\d))/gi},{osis:["Zech"],regexp:/(\d|\b)(Z(?:[ae]ch[ae]r[ai]{1,2}h|ach?|e?ch?))(?:\b|(?=\d))/gi},{osis:["Mal"],regexp:/(\d|\b)(M(?:alachi?|alichi|alaci|al))(?:\b|(?=\d))/gi},{osis:["Matt"],regexp:RegExp("(\\d|\\b)("+e.prototype.regexps.gospel+"M(?:at[th]{1,3}i?ew|atthwe|a?tt?))(?:\\b|(?=\\d))","gi")},{osis:["Mark"],regexp:RegExp("(\\d|\\b)("+e.prototype.regexps.gospel+"M(?:a?rk?|k))(?:\\b|(?=\\d))","gi")},{osis:["Luke"],regexp:RegExp("(\\d|\\b)("+e.prototype.regexps.gospel+"L(?:uke?|[uk]))(?:\\b|(?=\\d))","gi")},{osis:["1John"],regexp:RegExp("(\\b)("+e.prototype.regexps.first+"J(?:o?phn|[ho][ho]n|onh|ohm|hn|o[hn]?|[hn]))(?:\\b|(?=\\d))","gi")},{osis:["2John"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"J(?:o?phn|[ho][ho]n|onh|ohm|hn|o[hn]?|[hn]))(?:\\b|(?=\\d))","gi")},{osis:["3John"],regexp:RegExp("(\\b)("+e.prototype.regexps.third+"J(?:o?phn|[ho][ho]n|onh|ohm|hn|o[hn]?|[hn]))(?:\\b|(?=\\d))","gi")},{osis:["John"],regexp:RegExp("([04-9]|\\b)("+e.prototype.regexps.gospel+"J(?:o?phn|[ho][ho]n|onh|ohm|hn|oh|[hn]))(?:\\b|(?=\\d))","gi")},{osis:["Acts"],regexp:RegExp("(\\d|\\b)(A(?:cts"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*the"+e.prototype.regexps.space+"*Apostles|cts*|ct?))(?:\\b|(?=\\d))","gi")},{osis:["Rom"],regexp:/(\d|\b)(R(?:omans?|pmans|oamns|omands|omasn|om?s?|mn?s?))(?:\b|(?=\d))/gi},{osis:["2Cor"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"C(?:h?orr?[in]{1,3}th[aio]{1,3}ns|orin[ai]?th[ai]{1,3}n[aio]{0,3}s|orinti[ao]ns|orinthian|orthians?|orint?h?|orth|or?))(?:\\b|(?=\\d))","gi")},{osis:["1Cor"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?C(?:h?orr?[in]{1,3}th[aio]{1,3}ns|orin[ai]?th[ai]{1,3}n[aio]{0,3}s|orinti[ao]ns)|"+e.prototype.regexps.first+"C(?:orinthian|orthians?|orint?h?|orth|or?))(?:\\b|(?=\\d))","gi")},{osis:["Gal"],regexp:/(\d|\b)(G(?:alatians?|all?at[aino]{1,4}s|alat?|al?|l))(?:\b|(?=\d))/gi},{osis:["Eph"],regexp:/(\d|\b)(E(?:phesians?|phi?sians?|phesains?|sphesians|pehesians|h?pesians|phesiand|phesions|alat?|phe?s?|ph?|hp))(?:\b|(?=\d))/gi},{osis:["Phil"],regexp:/(\d|\b)(P(?:hil{1,}i?p{1,}[aei]{1,3}ns?|hi?li?p{0,2}|hil?|hp))(?:\b|(?=\d))/gi},{osis:["Col"],regexp:/(\d|\b)(C(?:[ao]ll?[ao]ss?i[ao]ns|olossi?ans?|ol?))(?:\b|(?=\d))/gi},{osis:["2Thess"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"T(?:hess?[aeo]lon[ieaoc]{1,4}ns?|he?s{1,3}|h))(?:\\b|(?=\\d))","gi")},{osis:["1Thess"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?Thess?[aeo]lon[ieaoc]{1,4}ns?|"+e.prototype.regexps.first+"T(?:he?s{1,3}|h))(?:\\b|(?=\\d))","gi")},{osis:["2Tim"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"T(?:imothy?|himoth?y|omothy|imoty|im?|m))(?:\\b|(?=\\d))","gi")},{osis:["1Tim"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?Timothy?|"+e.prototype.regexps.first+"T(?:himoth?y|omothy|imoty|im?|m))(?:\\b|(?=\\d))","gi")},{osis:["Titus"],regexp:/(\d|\b)(T(?:itus|it?))(?:\b|(?=\d))/gi},{osis:["Phlm"],regexp:/(\d|\b)(Ph(?:ilemon|l?mn?|ilem?))(?:\b|(?=\d))/gi},{osis:["Heb"],regexp:/(\d|\b)(H(?:eb[rew]{1,3}s|[ew]{0,2}brew{1,2}s|ebrew|eb))(?:\b|(?=\d))/gi},{osis:["Jas"],regexp:/(\d|\b)(J(?:ames?|a[ms]?|ms?))(?:\b|(?=\d))/gi},{osis:["2Pet"],regexp:RegExp("(\\b)("+e.prototype.regexps.second+"P(?:eter?|e?t?r?))(?:\\b|(?=\\d))","gi")},{osis:["1Pet"],regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?Peter|"+e.prototype.regexps.first+"P(?:eter?|e?t?r?))(?:\\b|(?=\\d))","gi")},{osis:["Jude"],regexp:/(\d|\b)(Ju?de)(?:\b|(?=\d))/gi},{osis:["Rev"],regexp:/(\d|\b)(R(?:ev[aeo]?lations?|evel|e?v|e))(?:\b|(?=\d))/gi},{osis:["Tob"],apocrypha:!0,regexp:/(\d|\b)(Tobi?t?|Tb)(?:\b|(?=\d))/gi},{osis:["Jdt"],apocrypha:!0,regexp:/(\d|\b)(Ju?di?th?)(?:\b|(?=\d))/gi},{osis:["Wis"],apocrypha:!0,regexp:RegExp("(\\d|\\b)((?:The"+e.prototype.regexps.space+"*)Wisd?(?:om)?"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*Solomon|Wisdom|Wisd?)(?:\\b|(?=\\d))","gi")},{osis:["Sir"],apocrypha:!0,regexp:RegExp("(\\d|\\b)(Sirach|Ben"+e.prototype.regexps.space+"*Sira|Sir|Eccl[eu]siasticus|Ecclus|Eccs|(?:The"+e.prototype.regexps.space+"*)Wisdom"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*Jesus"+e.prototype.regexps.space+"*(?:Son"+e.prototype.regexps.space+"*of|ben)"+e.prototype.regexps.space+"*Sirach)(?:\\b|(?=\\d))","gi")},{osis:["Bar"],apocrypha:!0,regexp:/(\d|\b)(Baruch|Bar)(?:\b|(?=\d))/gi},{osis:["PrAzar"],apocrypha:!0,regexp:RegExp("(\\d|\\b)((?:The"+e.prototype.regexps.space+"*)?Pr(?:ayers?)?"+e.prototype.regexps.space+"*of"+e.prototype.regexps.space+"*Azariah?|Azariah?|PrAza?r)(?:\\b|(?=\\d))","gi")},{osis:["Sus"],apocrypha:!0,regexp:/(\d|\b)(Susannah?|Shoshana|Sus)(?:\b|(?=\d))/gi},{osis:["Bel"],apocrypha:!0,regexp:RegExp("(\\d|\\b)(Bel"+e.prototype.regexps.space+"*(?:and|&)"+e.prototype.regexps.space+"*(?:the"+e.prototype.regexps.space+"*)?(?:Dragon|Serpent|Snake)|Bel)(?:\\b|(?=\\d))","gi")},{osis:["2Macc"],apocrypha:!0,regexp:RegExp("(\\b)("+e.prototype.regexps.second+"Mac{1,3}(?:ab{1,3}e{1,3}s?)?|2"+e.prototype.regexps.space+"*Mc)(?:\\b|(?=\\d))","gi")},{osis:["3Macc"],apocrypha:!0,regexp:RegExp("(\\b)("+e.prototype.regexps.third+"Mac{1,3}(?:ab{1,3}e{1,3}s?)?|3"+e.prototype.regexps.space+"*Mc)(?:\\b|(?=\\d))","gi")},{osis:["4Macc"],apocrypha:!0,regexp:RegExp("(\\b)("+e.prototype.regexps.fourth+e.prototype.regexps.space+"*Mac{1,3}(?:ab{1,3}e{1,3}s?)?|4"+e.prototype.regexps.space+"*Mc)(?:\\b|(?=\\d))","gi")},{osis:["1Macc"],apocrypha:!0,regexp:RegExp("(\\b)((?:"+e.prototype.regexps.first+")?Mac{1,3}ab{1,3}e{1,3}s?|"+e.prototype.regexps.first+"Mac{1,3}|1"+e.prototype.regexps.space+"*Mc)(?:\\b|(?=\\d))","gi")},{osis:["1Esd"],apocrypha:!0,regexp:RegExp("(\\b)("+e.prototype.regexps.first+"Esdras|1"+e.prototype.regexps.space+"*Esdr?)(?:\\b|(?=\\d))","gi")},{osis:["2Esd"],apocrypha:!0,regexp:RegExp("(\\b)("+e.prototype.regexps.second+"Esdras|2"+e.prototype.regexps.space+"*Esdr?)(?:\\b|(?=\\d))","gi")},{osis:["PrMan"],apocrypha:!0,regexp:RegExp("(\\d|\\b)((?:(?:The"+e.prototype.regexps.space+"*)Pr(?:ayers?)?"+e.prototype.regexps.space+"*(?:of"+e.prototype.regexps.space+"*)?M[ae]n{1,2}[ae]s{1,2}[ae]h)|PrMan)(?:\\b|(?=\\d))","gi")},{osis:["Ezek","Ezra"],regexp:/(\d|\b)(Ez)(?:\b|(?=\d))/gi},{osis:["Hab","Hag"],regexp:/(\d|\b)(Ha)(?:\b|(?=\d))/gi},{osis:["Heb","Hab"],regexp:/(\d|\b)(Hb)(?:\b|(?=\d))/gi},{osis:["John","Jonah","Job","Josh","Joel"],regexp:/(\d|\b)(Jo)(?:\b|(?=\d))/gi},{osis:["Jude","Judg"],regexp:/(\d|\b)(Jd)(?:\b|(?=\d))/gi},{osis:["Jude","Judg"],regexp:/(\d|\b)(Jud)(?:\b|(?=\d))/gi},{osis:["Jude","Judg"],regexp:/(\d|\b)(Ju)(?:\b|(?=\d))/gi},{osis:["Matt","Mark","Mal"],regexp:/(\d|\b)(Ma)(?:\b|(?=\d))/gi},{osis:["Phil","Phlm"],regexp:/(\d|\b)(Ph)(?:\b|(?=\d))/gi},{osis:["Zeph","Zech"],regexp:/(\d|\b)(Ze)(?:\b|(?=\d))/gi}];if(!0===t&&"none"===n)return i;s=[],o=0;for(u=i.length;o<u;o++)r=i[o],null!=r.apocrypha&&!0===r.apocrypha||("books"===n&&(r.regexp=RegExp(r.regexp.source,"g")),s.push(r));return s},e.prototype.regexps.books=e.prototype.regexps.get_books(!1,"none");var o,u=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'},s={parse:function(e,t){function n(e){nt<it||(nt>it&&(it=nt,st=[]),st.push(e))}function r(){var e,t,n,r,i,u,c;u=i=nt,e=b(),null===e&&(e=m(),null===e&&(e=o(),null===e&&(e=A(),null===e&&(e=v(),null===e&&(e=h(),null===e&&(e=D(),null===e&&(e=p(),null===e&&(e=d(),null===e&&(e=_(),null===e&&(e=l(),null===e&&(e=T(),null===e&&(e=g(),null===e&&(e=f(),null===e&&(e=x(),null===e&&(e=a(),null===e&&(e=w(),null===e&&(e=S(),null===e&&(e=y(),null===e&&(e=E())))))))))))))))))));if(null!==e){c=nt,n=q(),n=null!==n?n:"",null!==n?(r=s(),null!==r?n=[n,r]:(n=null,nt=c)):(n=null,nt=c);if(null!==n)for(t=[];null!==n;)t.push(n),c=nt,n=q(),n=null!==n?n:"",null!==n?(r=s(),null!==r?n=[n,r]:(n=null,nt=c)):(n=null,nt=c);else t=null;null!==t?e=[e,t]:(e=null,nt=u)}else e=null,nt=u;return null!==e&&(t=e[1],t.unshift([e[0]]),e={type:"sequence",value:t,indices:[i,nt-1]}),null===e&&(nt=i),e}function i(){var t,r,i,o,u,a,f,l,c,h;c=l=nt,40===e.charCodeAt(nt)?(t="(",nt++):(t=null,0===rt&&n('"("'));if(null!==t)if(r=Y(),null!==r)if(i=q(),i=null!==i?i:"",null!==i)if(o=s(),null!==o){u=[],h=nt,a=q(),a=null!==a?a:"",null!==a?(f=s(),null!==f?a=[a,f]:(a=null,nt=h)):(a=null,nt=h);for(;null!==a;)u.push(a),h=nt,a=q(),a=null!==a?a:"",null!==a?(f=s(),null!==f?a=[a,f]:(a=null,nt=h)):(a=null,nt=h);null!==u?(a=Y(),null!==a?(41===e.charCodeAt(nt)?(f=")",nt++):(f=null,0===rt&&n('")"')),null!==f?t=[t,r,i,o,u,a,f]:(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)}else t=null,nt=c;else t=null,nt=c;else t=null,nt=c;else t=null,nt=c;return null!==t&&(r=t[4],"undefined"==typeof r&&(r=[]),r.unshift([t[3]]),t={type:"sequence_post_enclosed",value:r,indices:[l,nt-1]}),null===t&&(nt=l),t}function s(){var e;return e=i(),null===e&&(e=b(),null===e&&(e=m(),null===e&&(e=o(),null===e&&(e=A(),null===e&&(e=v(),null===e&&(e=h(),null===e&&(e=D(),null===e&&(e=p(),null===e&&(e=d(),null===e&&(e=_(),null===e&&(e=l(),null===e&&(e=T(),null===e&&(e=g(),null===e&&(e=f(),null===e&&(e=x(),null===e&&(e=a(),null===e&&(e=w(),null===e&&(e=S(),null===e&&(e=y(),null===e&&(e=E(),null===e&&(e=N(),null===e&&(e=O(),null===e&&(e=C(),null===e&&(e=k(),null===e&&(e=P(),null===e&&(e=J(),null===e&&(e=L(),null===e&&(e=H())))))))))))))))))))))))))))),e}function o(){var e,t,n,r,i;return i=r=nt,e=v(),null===e&&(e=h(),null===e&&(e=D(),null===e&&(e=p(),null===e&&(e=d(),null===e&&(e=_(),null===e&&(e=l(),null===e&&(e=T(),null===e&&(e=g(),null===e&&(e=w(),null===e&&(e=S(),null===e&&(e=x(),null===e&&(e=y(),null===e&&(e=E(),null===e&&(e=N(),null===e&&(e=O(),null===e&&(e=C(),null===e&&(e=k(),null===e&&(e=P(),null===e&&(e=J(),null===e&&(e=L(),null===e&&(e=H()))))))))))))))))))))),null!==e?(t=R(),null!==t?(n=A(),null===n&&(n=v(),null===n&&(n=h(),null===n&&(n=D(),null===n&&(n=p(),null===n&&(n=d(),null===n&&(n=_(),null===n&&(n=l(),null===n&&(n=T(),null===n&&(n=g(),null===n&&(n=w(),null===n&&(n=S(),null===n&&(n=x(),null===n&&(n=y(),null===n&&(n=E(),null===n&&(n=N(),null===n&&(n=O(),null===n&&(n=C(),null===n&&(n=P(),null===n&&(n=J(),null===n&&(n=k(),null===n&&(n=L(),null===n&&(n=H())))))))))))))))))))))),null!==n?e=[e,t,n]:(e=null,nt=i)):(e=null,nt=i)):(e=null,nt=i),null!==e&&(e={type:"range",value:[e[0],e[2]],indices:[r,nt-1]}),null===e&&(nt=r),e}function a(){var t,r,i,s,o,u,a;return u=o=nt,31===e.charCodeAt(nt)?(t="",nt++):(t=null,0===rt&&n('"\\x1F"')),null!==t?(r=K(),null!==r?(a=nt,47===e.charCodeAt(nt)?(i="/",nt++):(i=null,0===rt&&n('"/"')),null!==i?(/^[a-z]/.test(e.charAt(nt))?(s=e.charAt(nt),nt++):(s=null,0===rt&&n("[a-z]")),null!==s?i=[i,s]:(i=null,nt=a)):(i=null,nt=a),i=null!==i?i:"",null!==i?(31===e.charCodeAt(nt)?(s="",nt++):(s=null,0===rt&&n('"\\x1F"')),null!==s?t=[t,r,i,s]:(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u),null!==t&&(t={type:"b",value:t[1].value,indices:[o,nt-1]}),null===t&&(nt=o),t}function f(){var e,t,n,r,i,s;return s=i=nt,e=a(),null!==e?(t=R(),null!==t?(r=nt,rt++,n=o(),null===n&&(n=A(),null===n&&(n=D(),null===n&&(n=p(),null===n&&(n=d(),null===n&&(n=_(),null===n&&(n=l(),null===n&&(n=g()))))))),rt--,null===n?n="":(n=null,nt=r),null!==n?(r=a(),null!==r?e=[e,t,n,r]:(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s),null!==e&&(e={type:"b_range",value:[e[0],e[3]],indices:[i,nt-1]}),null===e&&(nt=i),e}function l(){var e,t,n,r,i,s,o,u,f,l;o=s=nt,e=a();if(null!==e){u=nt,t=j(),null!==t?(f=nt,rt++,l=nt,n=L(),null!==n?(r=F(),null!==r?(i=H(),null!==i?n=[n,r,i]:(n=null,nt=l)):(n=null,nt=l)):(n=null,nt=l),rt--,null!==n?(n="",nt=f):n=null,null!==n?t=[t,n]:(t=null,nt=u)):(t=null,nt=u);if(null===t){n=F();if(null!==n)for(t=[];null!==n;)t.push(n),n=F();else t=null;if(null===t){n=I();if(null!==n)for(t=[];null!==n;)t.push(n),n=I();else t=null;if(null===t){n=R();if(null!==n)for(t=[];null!==n;)t.push(n),n=R();else t=null;null===t&&(t=Y())}}}null!==t?(n=L(),null!==n?e=[e,t,n]:(e=null,nt=o)):(e=null,nt=o)}else e=null,nt=o;return null!==e&&(e={type:"bc",value:[e[0],e[2]],indices:[s,nt-1]}),null===e&&(nt=s),e}function c(){var t,r,i,s,o,u,f;return f=u=nt,t=a(),null!==t?(r=Y(),null!==r?(44===e.charCodeAt(nt)?(i=",",nt++):(i=null,0===rt&&n('","')),null!==i?(s=Y(),null!==s?(o=L(),null!==o?t=[t,r,i,s,o]:(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f),null!==t&&(t={type:"bc",value:[t[0],t[4]],indices:[u,nt-1]}),null===t&&(nt=u),t}function h(){var e,t,n,r;return r=n=nt,e=_(),null===e&&(e=l()),null!==e?(t=U(),null!==t?e=[e,t]:(e=null,nt=r)):(e=null,nt=r),null!==e&&(e={type:"bc_title",value:[e[0],e[1]],indices:[n,nt-1]}),null===e&&(nt=n),e}function p(){var t,r,i,s,o,u,a,f;return u=o=nt,t=_(),null===t&&(t=l()),null!==t?(a=nt,rt++,f=nt,46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(i=j(),null!==i?(s=H(),null!==s?r=[r,i,s]:(r=null,nt=f)):(r=null,nt=f)):(r=null,nt=f),rt--,null===r?r="":(r=null,nt=a),null!==r?(a=nt,i=F(),null===i&&(i=q()),i=null!==i?i:"",null!==i?(s=j(),null!==s?i=[i,s]:(i=null,nt=a)):(i=null,nt=a),null===i&&(i=F()),null!==i?(s=P(),null===s&&(s=H()),null!==s?t=[t,r,i,s]:(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u),null!==t&&(t={type:"bcv",value:[t[0],t[3]],indices:[o,nt-1]}),null===t&&(nt=o),t}function d(){var e,t,n,r,i,s,o,u,a;return o=s=nt,e=_(),null===e&&(e=l()),null!==e?(t=I(),null!==t?(n=P(),null===n&&(n=H()),null!==n?(u=nt,rt++,a=nt,r=F(),null!==r?(i=H(),null!==i?r=[r,i]:(r=null,nt=a)):(r=null,nt=a),rt--,null===r?r="":(r=null,nt=u),null!==r?e=[e,t,n,r]:(e=null,nt=o)):(e=null,nt=o)):(e=null,nt=o)):(e=null,nt=o),null!==e&&(e={type:"bcv",value:[e[0],e[2]],indices:[s,nt-1]}),null===e&&(nt=s),e}function v(){var t,r,i,s,o,u,a,f,l,h,p;return l=f=nt,t=c(),null!==t?(r=Y(),null!==r?(44===e.charCodeAt(nt)?(i=",",nt++):(i=null,0===rt&&n('","')),null!==i?(s=Y(),null!==s?(o=P(),null===o&&(o=H()),null!==o?(h=nt,rt++,p=nt,u=F(),null!==u?(a=H(),null!==a?u=[u,a]:(u=null,nt=p)):(u=null,nt=p),rt--,null===u?u="":(u=null,nt=h),null!==u?t=[t,r,i,s,o,u]:(t=null,nt=l)):(t=null,nt=l)):(t=null,nt=l)):(t=null,nt=l)):(t=null,nt=l)):(t=null,nt=l),null!==t&&(t={type:"bcv",value:[t[0],t[4]],indices:[f,nt-1]}),null===t&&(nt=f),t}function m(){var t,r,i,s,o,u,f,l,c;return c=l=nt,t=a(),null!==t?(45===e.charCodeAt(nt)?(r="-",nt++):(r=null,0===rt&&n('"-"')),null===r&&(r=Z()),r=null!==r?r:"",null!==r?(i=L(),null!==i?(45===e.charCodeAt(nt)?(s="-",nt++):(s=null,0===rt&&n('"-"')),null!==s?(o=H(),null!==o?(45===e.charCodeAt(nt)?(u="-",nt++):(u=null,0===rt&&n('"-"')),null!==u?(f=H(),null!==f?t=[t,r,i,s,o,u,f]:(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c),null!==t&&(t={type:"range",value:[{type:"bcv",value:[{type:"bc",value:[t[0],t[2]],indices:[t[0].indices[0],t[2].indices[1]]},t[4]],indices:[t[0].indices[0],t[4].indices[1]]},t[6]],indices:[l,nt-1]}),null===t&&(nt=l),t}function g(){var e,t,n,r,i,s,o;i=r=nt,e=a();if(null!==e){n=F();if(null!==n)for(t=[];null!==n;)t.push(n),n=F();else t=null;if(null===t){n=I();if(null!==n)for(t=[];null!==n;)t.push(n),n=I();else t=null;if(null===t){n=R();if(null!==n)for(t=[];null!==n;)t.push(n),n=R();else t=null;if(null===t){s=nt,n=q();if(null!==n)for(t=[];null!==n;)t.push(n),n=q();else t=null;null!==t?(o=nt,rt++,n=j(),rt--,null!==n?(n="",nt=o):n=null,null!==n?t=[t,n]:(t=null,nt=s)):(t=null,nt=s),null===t&&(t=Y())}}}null!==t?(n=P(),null===n&&(n=H()),null!==n?e=[e,t,n]:(e=null,nt=i)):(e=null,nt=i)}else e=null,nt=i;return null!==e&&(e={type:"bv",value:[e[0],e[2]],indices:[r,nt-1]}),null===e&&(nt=r),e}function y(){var e,t,n,r,i,s;return s=i=nt,e=B(),null!==e?(t=L(),null!==t?(n=z(),n=null!==n?n:"",null!==n?(r=a(),null!==r?e=[e,t,n,r]:(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s),null!==e&&(e={type:"bc",value:[e[3],e[1]],indices:[i,nt-1]}),null===e&&(nt=i),e}function b(){var e,t,n,r,i,s,o,u;return u=o=nt,e=B(),null!==e?(t=L(),null!==t?(n=R(),null!==n?(r=L(),null!==r?(i=z(),i=null!==i?i:"",null!==i?(s=a(),null!==s?e=[e,t,n,r,i,s]:(e=null,nt=u)):(e=null,nt=u)):(e=null,nt=u)):(e=null,nt=u)):(e=null,nt=u)):(e=null,nt=u),null!==e&&(e={type:"cb_range",value:[e[5],e[1],e[3]],indices:[o,nt-1]}),null===e&&(nt=o),e}function w(){var e,t,n,r,i,s;return s=i=nt,e=y(),null!==e?(t=q(),t=null!==t?t:"",null!==t?(n=j(),null!==n?(r=H(),null!==r?e=[e,t,n,r]:(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s),null!==e&&(e={type:"bcv",value:[e[0],e[3]],indices:[i,nt-1]}),null===e&&(nt=i),e}function E(){var t,r,i,s,o,u,f;return f=u=nt,t=L(),null!==t?("th"===e.substr(nt,2)?(r="th",nt+=2):(r=null,0===rt&&n('"th"')),null===r&&("nd"===e.substr(nt,2)?(r="nd",nt+=2):(r=null,0===rt&&n('"nd"')),null===r&&("st"===e.substr(nt,2)?(r="st",nt+=2):(r=null,0===rt&&n('"st"')))),null!==r?(i=B(),null!==i?(s=z(),s=null!==s?s:"",null!==s?(o=a(),null!==o?t=[t,r,i,s,o]:(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f),null!==t&&(t={type:"bc",value:[t[4],t[0]],indices:[u,nt-1]}),null===t&&(nt=u),t}function S(){var e,t,n,r,i,s;return s=i=nt,e=E(),null!==e?(t=q(),t=null!==t?t:"",null!==t?(n=j(),null!==n?(r=H(),null!==r?e=[e,t,n,r]:(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s),null!==e&&(e={type:"bcv",value:[e[0],e[3]],indices:[i,nt-1]}),null===e&&(nt=i),e}function x(){var t,r,i,s,o;return o=s=nt,31===e.charCodeAt(nt)?(t="",nt++):(t=null,0===rt&&n('"\\x1F"')),null!==t?(r=K(),null!==r?("/p"===e.substr(nt,3)?(i="/p",nt+=3):(i=null,0===rt&&n('"/p\\x1F"')),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"c_psalm",value:t[1].value,indices:[s,nt-1]}),null===t&&(nt=s),t}function T(){var e,t,n,r,i,s;return s=i=nt,e=x(),null!==e?(t=q(),t=null!==t?t:"",null!==t?(n=j(),null!==n?(r=H(),null!==r?e=[e,t,n,r]:(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s)):(e=null,nt=s),null!==e&&(e={type:"cv_psalm",value:[e[0],e[3]],indices:[i,nt-1]}),null===e&&(nt=i),e}function N(){var e,t,n,r,i;return i=r=nt,e=B(),null!==e?(t=L(),null!==t?(n=U(),null!==n?e=[e,t,n]:(e=null,nt=i)):(e=null,nt=i)):(e=null,nt=i),null!==e&&(e={type:"c_title",value:[e[1],e[2]],indices:[r,nt-1]}),null===e&&(nt=r),e}function C(){var t,r,i,s,o,u,a,f;return u=o=nt,t=L(),null!==t?(a=nt,rt++,f=nt,46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(i=j(),null!==i?(s=H(),null!==s?r=[r,i,s]:(r=null,nt=f)):(r=null,nt=f)):(r=null,nt=f),rt--,null===r?r="":(r=null,nt=a),null!==r?(a=nt,i=F(),i=null!==i?i:"",null!==i?(s=j(),null!==s?i=[i,s]:(i=null,nt=a)):(i=null,nt=a),null===i&&(i=F()),null!==i?(s=P(),null===s&&(s=H()),null!==s?t=[t,r,i,s]:(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u),null!==t&&(t={type:"cv",value:[t[0],t[3]],indices:[o,nt-1]}),null===t&&(nt=o),t}function k(){var e,t,n,r,i,s,o,u,a;return o=s=nt,e=L(),null!==e?(t=I(),null!==t?(n=P(),null===n&&(n=H()),null!==n?(u=nt,rt++,a=nt,r=F(),null!==r?(i=H(),null!==i?r=[r,i]:(r=null,nt=a)):(r=null,nt=a),rt--,null===r?r="":(r=null,nt=u),null!==r?e=[e,t,n,r]:(e=null,nt=o)):(e=null,nt=o)):(e=null,nt=o)):(e=null,nt=o),null!==e&&(e={type:"cv",value:[e[0],e[2]],indices:[s,nt-1]}),null===e&&(nt=s),e}function L(){var e,t,n,r;return r=n=nt,e=B(),e=null!==e?e:"",null!==e?(t=J(),null!==t?e=[e,t]:(e=null,nt=r)):(e=null,nt=r),null!==e&&(e={type:"c",value:[e[1]],indices:[n,nt-1]}),null===e&&(nt=n),e}function A(){var t,r,i,s,o,u,a,f,c;return f=a=nt,t=p(),null===t&&(t=d(),null===t&&(t=l(),null===t&&(t=C(),null===t&&(t=k(),null===t&&(t=J(),null===t&&(t=L(),null===t&&(t=H()))))))),null!==t?(r=Y(),null!==r?(102===e.charCodeAt(nt)?(i="f",nt++):(i=null,0===rt&&n('"f"')),null!==i?(102===e.charCodeAt(nt)?(s="f",nt++):(s=null,0===rt&&n('"f"')),s=null!==s?s:"",null!==s?(o=W(),o=null!==o?o:"",null!==o?(c=nt,rt++,/^[a-z]/.test(e.charAt(nt))?(u=e.charAt(nt),nt++):(u=null,0===rt&&n("[a-z]")),rt--,null===u?u="":(u=null,nt=c),null!==u?t=[t,r,i,s,o,u]:(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f),null!==t&&(t={type:"ff",value:[t[0]],indices:[a,nt-1]}),null===t&&(nt=a),t}function O(){var t,r,i,s,o;return o=s=nt,t=J(),null!==t?(r=F(),null===r&&(r=q()),r=null!==r?r:"",null!==r?("title"===e.substr(nt,5)?(i="title",nt+=5):(i=null,0===rt&&n('"title"')),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"integer_title",value:[t[0]],indices:[s,nt-1]}),null===t&&(nt=s),t}function M(){var t,r,i,s,o;return o=s=nt,31===e.charCodeAt(nt)?(t="",nt++):(t=null,0===rt&&n('"\\x1F"')),null!==t?(r=K(),null!==r?("/q"===e.substr(nt,3)?(i="/q",nt+=3):(i=null,0===rt&&n('"/q\\x1F"')),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"b",value:t[1].value,indices:[s,nt-1]}),null===t&&(nt=s),t}function _(){var t,r,i,s,o,u;return o=s=nt,t=M(),null!==t?(".1"===e.substr(nt,2)?(r=".1",nt+=2):(r=null,0===rt&&n('".1"')),null!==r?(u=nt,rt++,/^[0-9]/.test(e.charAt(nt))?(i=e.charAt(nt),nt++):(i=null,0===rt&&n("[0-9]")),rt--,null===i?i="":(i=null,nt=u),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"bc",value:[t[0],{type:"c",value:[{type:"integer",value:151,indices:[nt-2,nt-1]}],indices:[nt-2,nt-1]}],indices:[s,nt-1]}),null===t&&(nt=s),t}function D(){var t,r,i,s,o;return o=s=nt,t=_(),null!==t?(46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(i=J(),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"bcv",value:[t[0],{type:"v",value:[t[2]],indices:[t[2].indices[0],t[2].indices[1]]}],indices:[s,nt-1]}),null===t&&(nt=s),t}function P(){var t,r,i,s,o,u,a,f;return a=u=nt,t=j(),t=null!==t?t:"",null!==t?(r=J(),null!==r?(i=Y(),null!==i?(/^[a-e]/.test(e.charAt(nt))?(s=e.charAt(nt),nt++):(s=null,0===rt&&n("[a-e]")),null!==s?(f=nt,rt++,/^[a-z]/.test(e.charAt(nt))?(o=e.charAt(nt),nt++):(o=null,0===rt&&n("[a-z]")),rt--,null===o?o="":(o=null,nt=f),null!==o?t=[t,r,i,s,o]:(t=null,nt=a)):(t=null,nt=a)):(t=null,nt=a)):(t=null,nt=a)):(t=null,nt=a),null!==t&&(t={type:"v",value:[t[1]],indices:[u,nt-1]}),null===t&&(nt=u),t}function H(){var e,t,n,r;return r=n=nt,e=j(),e=null!==e?e:"",null!==e?(t=J(),null!==t?e=[e,t]:(e=null,nt=r)):(e=null,nt=r),null!==e&&(e={type:"v",value:[e[1]],indices:[n,nt-1]}),null===e&&(nt=n),e}function B(){var t,r,i,s,o,u,a,f,l;return f=a=nt,t=Y(),null!==t?(l=nt,"chapter"===e.substr(nt,7)?(r="chapter",nt+=7):(r=null,0===rt&&n('"chapter"')),null!==r?(115===e.charCodeAt(nt)?(i="s",nt++):(i=null,0===rt&&n('"s"')),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=l)):(r=null,nt=l),null===r&&(l=nt,"ch"===e.substr(nt,2)?(r="ch",nt+=2):(r=null,0===rt&&n('"ch"')),null!==r?(97===e.charCodeAt(nt)?(i="a",nt++):(i=null,0===rt&&n('"a"')),i=null!==i?i:"",null!==i?("pt"===e.substr(nt,2)?(s="pt",nt+=2):(s=null,0===rt&&n('"pt"')),null!==s?(115===e.charCodeAt(nt)?(o="s",nt++):(o=null,0===rt&&n('"s"')),o=null!==o?o:"",null!==o?(u=W(),u=null!==u?u:"",null!==u?r=[r,i,s,o,u]:(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l),null===r&&(l=nt,"ch"===e.substr(nt,2)?(r="ch",nt+=2):(r=null,0===rt&&n('"ch"')),null!==r?(97===e.charCodeAt(nt)?(i="a",nt++):(i=null,0===rt&&n('"a"')),i=null!==i?i:"",null!==i?(112===e.charCodeAt(nt)?(s="p",nt++):(s=null,0===rt&&n('"p"')),s=null!==s?s:"",null!==s?(115===e.charCodeAt(nt)?(o="s",nt++):(o=null,0===rt&&n('"s"')),o=null!==o?o:"",null!==o?(u=W(),u=null!==u?u:"",null!==u?r=[r,i,s,o,u]:(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l)):(r=null,nt=l))),null!==r?(i=Y(),null!==i?t=[t,r,i]:(t=null,nt=f)):(t=null,nt=f)):(t=null,nt=f),null!==t&&(t={type:"c_explicit"}),null===t&&(nt=a),t}function j(){var t,r,i,s,o,u,a,f;return a=u=nt,t=Y(),null!==t?(f=nt,"verse"===e.substr(nt,5)?(r="verse",nt+=5):(r=null,0===rt&&n('"verse"')),null!==r?(115===e.charCodeAt(nt)?(i="s",nt++):(i=null,0===rt&&n('"s"')),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&(f=nt,"vv"===e.substr(nt,2)?(r="vv",nt+=2):(r=null,0===rt&&n('"vv"')),null!==r?(i=W(),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&(f=nt,"ver"===e.substr(nt,3)?(r="ver",nt+=3):(r=null,0===rt&&n('"ver"')),null!==r?(i=W(),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&(f=nt,118===e.charCodeAt(nt)?(r="v",nt++):(r=null,0===rt&&n('"v"')),null!==r?(115===e.charCodeAt(nt)?(i="s",nt++):(i=null,0===rt&&n('"s"')),i=null!==i?i:"",null!==i?(115===e.charCodeAt(nt)?(s="s",nt++):(s=null,0===rt&&n('"s"')),s=null!==s?s:"",null!==s?(o=W(),o=null!==o?o:"",null!==o?r=[r,i,s,o]:(r=null,nt=f)):(r=null,nt=f)):(r=null,nt=f)):(r=null,nt=f)))),null!==r?(i=Y(),null!==i?t=[t,r,i]:(t=null,nt=a)):(t=null,nt=a)):(t=null,nt=a),null!==t&&(t={type:"v_explicit"}),null===t&&(nt=u),t}function F(){var t,r,i,s,o,u,a,f,l,c;a=nt,t=Y();if(null!==t){58===e.charCodeAt(nt)?(i=":",nt++):(i=null,0===rt&&n('":"'));if(null!==i)for(r=[];null!==i;)r.push(i),58===e.charCodeAt(nt)?(i=":",nt++):(i=null,0===rt&&n('":"'));else r=null;null===r&&(f=nt,46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(l=nt,rt++,c=nt,i=Y(),null!==i?(46===e.charCodeAt(nt)?(s=".",nt++):(s=null,0===rt&&n('"."')),null!==s?(o=Y(),null!==o?(46===e.charCodeAt(nt)?(u=".",nt++):(u=null,0===rt&&n('"."')),null!==u?i=[i,s,o,u]:(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c),rt--,null===i?i="":(i=null,nt=l),null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f)),null!==r?(i=Y(),null!==i?t=[t,r,i]:(t=null,nt=a)):(t=null,nt=a)}else t=null,nt=a;return t}function I(){var t,r,i,s;return s=nt,t=Y(),null!==t?(/^["']/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[\"']")),null!==r?(i=Y(),null!==i?t=[t,r,i]:(t=null,nt=s)):(t=null,nt=s)):(t=null,nt=s),null===t&&(t=Z()),t}function q(){var t,r,i,s,o,u,a,f,l,c;a=nt,/^[,;\/:&\-\u2013\u2014~]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[,;\\/:&\\-\\u2013\\u2014~]")),null===r&&(f=nt,46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(l=nt,rt++,c=nt,i=Y(),null!==i?(46===e.charCodeAt(nt)?(s=".",nt++):(s=null,0===rt&&n('"."')),null!==s?(o=Y(),null!==o?(46===e.charCodeAt(nt)?(u=".",nt++):(u=null,0===rt&&n('"."')),null!==u?i=[i,s,o,u]:(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c),rt--,null===i?i="":(i=null,nt=l),null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&("see"===e.substr(nt,3)?(r="see",nt+=3):(r=null,0===rt&&n('"see"')),null===r&&("compare"===e.substr(nt,7)?(r="compare",nt+=7):(r=null,0===rt&&n('"compare"')),null===r&&(f=nt,"cf"===e.substr(nt,2)?(r="cf",nt+=2):(r=null,0===rt&&n('"cf"')),null!==r?(i=W(),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&("and"===e.substr(nt,3)?(r="and",nt+=3):(r=null,0===rt&&n('"and"')),null===r&&("also"===e.substr(nt,4)?(r="also",nt+=4):(r=null,0===rt&&n('"also"')),null===r&&(r=Z())))))));if(null!==r)for(t=[];null!==r;)t.push(r),/^[,;\/:&\-\u2013\u2014~]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[,;\\/:&\\-\\u2013\\u2014~]")),null===r&&(f=nt,46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(l=nt,rt++,c=nt,i=Y(),null!==i?(46===e.charCodeAt(nt)?(s=".",nt++):(s=null,0===rt&&n('"."')),null!==s?(o=Y(),null!==o?(46===e.charCodeAt(nt)?(u=".",nt++):(u=null,0===rt&&n('"."')),null!==u?i=[i,s,o,u]:(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c)):(i=null,nt=c),rt--,null===i?i="":(i=null,nt=l),null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&("see"===e.substr(nt,3)?(r="see",nt+=3):(r=null,0===rt&&n('"see"')),null===r&&("compare"===e.substr(nt,7)?(r="compare",nt+=7):(r=null,0===rt&&n('"compare"')),null===r&&(f=nt,"cf"===e.substr(nt,2)?(r="cf",nt+=2):(r=null,0===rt&&n('"cf"')),null!==r?(i=W(),i=null!==i?i:"",null!==i?r=[r,i]:(r=null,nt=f)):(r=null,nt=f),null===r&&("and"===e.substr(nt,3)?(r="and",nt+=3):(r=null,0===rt&&n('"and"')),null===r&&("also"===e.substr(nt,4)?(r="also",nt+=4):(r=null,0===rt&&n('"also"')),null===r&&(r=Z())))))));else t=null;return null!==t&&(t=""),null===t&&(nt=a),t}function R(){var t,r,i,s,o,u;o=nt,t=Y();if(null!==t){u=nt,/^[\-\u2013\u2014]/.test(e.charAt(nt))?(i=e.charAt(nt),nt++):(i=null,0===rt&&n("[\\-\\u2013\\u2014]")),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"through"===e.substr(nt,7)?(i="through",nt+=7):(i=null,0===rt&&n('"through"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"thru"===e.substr(nt,4)?(i="thru",nt+=4):(i=null,0===rt&&n('"thru"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"to"===e.substr(nt,2)?(i="to",nt+=2):(i=null,0===rt&&n('"to"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u))));if(null!==i)for(r=[];null!==i;)r.push(i),u=nt,/^[\-\u2013\u2014]/.test(e.charAt(nt))?(i=e.charAt(nt),nt++):(i=null,0===rt&&n("[\\-\\u2013\\u2014]")),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"through"===e.substr(nt,7)?(i="through",nt+=7):(i=null,0===rt&&n('"through"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"thru"===e.substr(nt,4)?(i="thru",nt+=4):(i=null,0===rt&&n('"thru"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u),null===i&&(u=nt,"to"===e.substr(nt,2)?(i="to",nt+=2):(i=null,0===rt&&n('"to"')),null!==i?(s=Y(),null!==s?i=[i,s]:(i=null,nt=u)):(i=null,nt=u))));else r=null;null!==r?t=[t,r]:(t=null,nt=o)}else t=null,nt=o;return t}function U(){var t,r,i,s;return s=i=nt,t=F(),null===t&&(t=q()),t=null!==t?t:"",null!==t?("title"===e.substr(nt,5)?(r="title",nt+=5):(r=null,0===rt&&n('"title"')),null!==r?t=[t,r]:(t=null,nt=s)):(t=null,nt=s),null!==t&&(t={type:"title",value:[t[1]],indices:[i,nt-1]}),null===t&&(nt=i),t}function z(){var t,r,i,s,o,u,a,f,l,c,h;return c=nt,t=Y(),null!==t?("from"===e.substr(nt,4)?(r="from",nt+=4):(r=null,0===rt&&n('"from"')),null===r&&("of"===e.substr(nt,2)?(r="of",nt+=2):(r=null,0===rt&&n('"of"')),null===r&&("in"===e.substr(nt,2)?(r="in",nt+=2):(r=null,0===rt&&n('"in"')))),null!==r?(i=Y(),null!==i?(h=nt,"the"===e.substr(nt,3)?(s="the",nt+=3):(s=null,0===rt&&n('"the"')),null!==s?(o=Y(),null!==o?("book"===e.substr(nt,4)?(u="book",nt+=4):(u=null,0===rt&&n('"book"')),null!==u?(a=Y(),null!==a?("of"===e.substr(nt,2)?(f="of",nt+=2):(f=null,0===rt&&n('"of"')),null!==f?(l=Y(),null!==l?s=[s,o,u,a,f,l]:(s=null,nt=h)):(s=null,nt=h)):(s=null,nt=h)):(s=null,nt=h)):(s=null,nt=h)):(s=null,nt=h),s=null!==s?s:"",null!==s?t=[t,r,i,s]:(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c)):(t=null,nt=c),t}function W(){var t,r,i,s,o,u,a,f,l;return a=nt,t=Y(),null!==t?(46===e.charCodeAt(nt)?(r=".",nt++):(r=null,0===rt&&n('"."')),null!==r?(f=nt,rt++,l=nt,i=Y(),null!==i?(46===e.charCodeAt(nt)?(s=".",nt++):(s=null,0===rt&&n('"."')),null!==s?(o=Y(),null!==o?(46===e.charCodeAt(nt)?(u=".",nt++):(u=null,0===rt&&n('"."')),null!==u?i=[i,s,o,u]:(i=null,nt=l)):(i=null,nt=l)):(i=null,nt=l)):(i=null,nt=l),rt--,null===i?i="":(i=null,nt=f),null!==i?t=[t,r,i]:(t=null,nt=a)):(t=null,nt=a)):(t=null,nt=a),t}function X(){var t,r,i,s,o,u,a,f,l,c,h;l=f=nt,t=Y();if(null!==t)if(/^[([]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[([]")),null!==r)if(i=Y(),null!==i){c=nt,s=$();if(null!==s){o=[],h=nt,u=q(),null!==u?(a=$(),null!==a?u=[u,a]:(u=null,nt=h)):(u=null,nt=h);for(;null!==u;)o.push(u),h=nt,u=q(),null!==u?(a=$(),null!==a?u=[u,a]:(u=null,nt=h)):(u=null,nt=h);null!==o?s=[s,o]:(s=null,nt=c)}else s=null,nt=c;null!==s?(o=Y(),null!==o?(/^[)\]]/.test(e.charAt(nt))?(u=e.charAt(nt),nt++):(u=null,0===rt&&n("[)\\]]")),null!==u?t=[t,r,i,s,o,u]:(t=null,nt=l)):(t=null,nt=l)):(t=null,nt=l)}else t=null,nt=l;else t=null,nt=l;else t=null,nt=l;return null!==t&&(t={type:"translation_sequence",value:t[3],indices:[f,nt-1]}),null===t&&(nt=f),t}function V(){var t,r,i,s,o,u,a,f,l,c;f=a=nt,t=Y();if(null!==t)if(l=nt,44===e.charCodeAt(nt)?(r=",",nt++):(r=null,0===rt&&n('","')),null!==r?(i=Y(),null!==i?r=[r,i]:(r=null,nt=l)):(r=null,nt=l),r=null!==r?r:"",null!==r){l=nt,i=$();if(null!==i){s=[],c=nt,o=q(),null!==o?(u=$(),null!==u?o=[o,u]:(o=null,nt=c)):(o=null,nt=c);for(;null!==o;)s.push(o),c=nt,o=q(),null!==o?(u=$(),null!==u?o=[o,u]:(o=null,nt=c)):(o=null,nt=c);null!==s?i=[i,s]:(i=null,nt=l)}else i=null,nt=l;null!==i?t=[t,r,i]:(t=null,nt=f)}else t=null,nt=f;else t=null,nt=f;return null!==t&&(t={type:"translation_sequence",value:t[2],indices:[a,nt-1]}),null===t&&(nt=a),t}function $(){var t,r,i,s,o;return o=s=nt,30===e.charCodeAt(nt)?(t="",nt++):(t=null,0===rt&&n('"\\x1E"')),null!==t?(r=K(),null!==r?(30===e.charCodeAt(nt)?(i="",nt++):(i=null,0===rt&&n('"\\x1E"')),null!==i?t=[t,r,i]:(t=null,nt=o)):(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"translation",value:t[1].value,indices:[s,nt-1]}),null===t&&(nt=s),t}function J(){var t,r,i,s,o,u;return u=o=s=nt,/^[0-9]/.test(e.charAt(nt))?(t=e.charAt(nt),nt++):(t=null,0===rt&&n("[0-9]")),null!==t?(/^[0-9]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[0-9]")),r=null!==r?r:"",null!==r?(/^[0-9]/.test(e.charAt(nt))?(i=e.charAt(nt),nt++):(i=null,0===rt&&n("[0-9]")),i=null!==i?i:"",null!==i?t=[t,r,i]:(t=null,nt=u)):(t=null,nt=u)):(t=null,nt=u),null!==t?(u=nt,rt++,/^[0-9]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[0-9]")),null===r&&(",000"===e.substr(nt,4)?(r=",000",nt+=4):(r=null,0===rt&&n('",000"'))),rt--,null===r?r="":(r=null,nt=u),null!==r?t=[t,r]:(t=null,nt=o)):(t=null,nt=o),null!==t&&(t={type:"integer",value:parseInt(t[0].join(""),10),indices:[s,nt-1]}),null===t&&(nt=s),t}function K(){var t,r,i;i=nt,/^[0-9]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[0-9]"));if(null!==r)for(t=[];null!==r;)t.push(r),/^[0-9]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[0-9]"));else t=null;return null!==t&&(t={type:"integer",value:parseInt(t.join(""),10),indices:[i,nt-1]}),null===t&&(nt=i),t}function Q(){var t,r,i;i=nt,/^[^\x1F\x1E([]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[^\\x1F\\x1E([]"));if(null!==r)for(t=[];null!==r;)t.push(r),/^[^\x1F\x1E([]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[^\\x1F\\x1E([]"));else t=null;return null!==t&&(t={type:"word",value:t.join(""),indices:[i,nt-1]}),null===t&&(nt=i),t}function G(){var t,r;return r=nt,/^[([]/.test(e.charAt(nt))?(t=e.charAt(nt),nt++):(t=null,0===rt&&n("[([]")),null!==t&&(t={type:"stop",value:t,indices:[r,nt-1]}),null===t&&(nt=r),t}function Y(){var e;return e=Z(),null!==e?e:""}function Z(){var t,r;/^[\s\xa0*]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[\\s\\xa0*]"));if(null!==r)for(t=[];null!==r;)t.push(r),/^[\s\xa0*]/.test(e.charAt(nt))?(r=e.charAt(nt),nt++):(r=null,0===rt&&n("[\\s\\xa0*]"));else t=null;return t}function et(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}var tt={start:function(){var e,t;t=m(),null===t&&(t=r(),null===t&&(t=b(),null===t&&(t=o(),null===t&&(t=A(),null===t&&(t=v(),null===t&&(t=h(),null===t&&(t=D(),null===t&&(t=p(),null===t&&(t=d(),null===t&&(t=_(),null===t&&(t=l(),null===t&&(t=T(),null===t&&(t=g(),null===t&&(t=f(),null===t&&(t=x(),null===t&&(t=a(),null===t&&(t=w(),null===t&&(t=S(),null===t&&(t=y(),null===t&&(t=E(),null===t&&(t=X(),null===t&&(t=V(),null===t&&(t=q(),null===t&&(t=N(),null===t&&(t=O(),null===t&&(t=C(),null===t&&(t=k(),null===t&&(t=P(),null===t&&(t=J(),null===t&&(t=L(),null===t&&(t=H(),null===t&&(t=Q(),null===t&&(t=G())))))))))))))))))))))))))))))))));if(null!==t)for(e=[];null!==t;)e.push(t),t=m(),null===t&&(t=r(),null===t&&(t=b(),null===t&&(t=o(),null===t&&(t=A(),null===t&&(t=v(),null===t&&(t=h(),null===t&&(t=D(),null===t&&(t=p(),null===t&&(t=d(),null===t&&(t=_(),null===t&&(t=l(),null===t&&(t=T(),null===t&&(t=g(),null===t&&(t=f(),null===t&&(t=x(),null===t&&(t=a(),null===t&&(t=w(),null===t&&(t=S(),null===t&&(t=y(),null===t&&(t=E(),null===t&&(t=X(),null===t&&(t=V(),null===t&&(t=q(),null===t&&(t=N(),null===t&&(t=O(),null===t&&(t=C(),null===t&&(t=k(),null===t&&(t=P(),null===t&&(t=J(),null===t&&(t=L(),null===t&&(t=H(),null===t&&(t=Q(),null===t&&(t=G())))))))))))))))))))))))))))))))));else e=null;return e},sequence:r,sequence_post_enclosed:i,sequence_post:s,range:o,b:a,b_range:f,bc:l,bc_comma:c,bc_title:h,bcv:p,bcv_weak:d,bcv_comma:v,bcv_hyphen_range:m,bv:g,cb:y,cb_range:b,cbv:w,cb_ordinal:E,cbv_ordinal:S,c_psalm:x,cv_psalm:T,c_title:N,cv:C,cv_weak:k,c:L,ff:A,integer_title:O,ps151_b:M,ps151_bc:_,ps151_bcv:D,v_letter:P,v:H,c_explicit:B,v_explicit:j,cv_sep:F,cv_sep_weak:I,sequence_sep:q,range_sep:R,title:U,in_book_of:z,abbrev:W,translation_sequence_enclosed:X,translation_sequence:V,translation:$,integer:J,any_integer:K,word:Q,word_parenthesis:G,sp:Y,space:Z};if(void 0!==t){if(void 0===tt[t])throw Error("Invalid rule name: "+u(t)+".")}else t="start";var nt=0,rt=0,it=0,st=[],tt=tt[t]();if(null===tt||nt!==e.length){for(var tt=Math.max(nt,it),ot=tt<e.length?e.charAt(tt):null,ut=1,at=1,ft=!1,lt=0;lt<Math.max(nt,it);lt++){var ct=e.charAt(lt);"\n"===ct?(ft||ut++,at=1,ft=!1):"\r"===ct||"\u2028"===ct||"\u2029"===ct?(ut++,at=1,ft=!0):(at++,ft=!1)}throw new this.SyntaxError(et(st),ot,tt,ut,at)}return tt},toSource:function(){return this._source},SyntaxError:function(e,t,n,r,i){this.name="SyntaxError",this.expected=e,this.found=t;switch(e.length){case 0:e="end of input";break;case 1:e=e[0];break;default:e=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}t=t?u(t):"end of input",this.message="Expected "+e+" but "+t+" found.",this.offset=n,this.line=r,this.column=i}};s.SyntaxError.prototype=Error.prototype,o=s}.call(this),define("bcv",function(e){return function(){var t,n;return n=function(){return new this.bcv_parser},t=n.apply(e,arguments),t||e.bcv_parser}}(this)),define("verseKey",["bcv","versificationMgr"],function(e,t){function n(t,n){var r={};r.osis=e.parse(t).osis(),r.osis===""&&(r.osis="Matt.1");var i=r.osis.split("-")[0].split(".");return r.book=i[0],r.chapter=isNaN(parseInt(i[1],10))?1:parseInt(i[1],10),r.verse=parseInt(i[2],10),r}function r(e,r){var i=[],s=e;typeof e=="string"&&(s=n(e));if(!(s.osis.split("-").length>1))if(isNaN(s.verse)){var o=t.getBookNum(s.book);for(var u=0;u<t.getVersesInChapter(o,s.chapter-1,r);u++)i.push({osis:s.book+"."+s.chapter+"."+(u+1),book:s.book,bookNum:o,chapter:s.chapter,verse:u+1})}else i.push(s);return i}function i(e,n){var r=parse(e,n),i=t.getChapterMax(t.getBookNum(r.book,n),n);r.chapter=r.chapter<i?r.chapter+1:1}function s(e,t){}return{parse:n,parseVerseList:r,next:i,previous:s}}),function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var s=this;i(s),s.q=s.c="",s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.opt=r||{},s.opt.lowercase=s.opt.lowercase||s.opt.lowercasetags,s.looseCase=s.opt.lowercase?"toLowerCase":"toUpperCase",s.tags=[],s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.strict=!!t,s.noscript=!!t||!!s.opt.noscript,s.state=k.BEGIN,s.ENTITIES=Object.create(e.ENTITIES),s.attribList=[],s.opt.xmlns&&(s.ns=Object.create(w)),s.trackPosition=s.opt.position!==!1,s.trackPosition&&(s.position=s.line=s.column=0),L(s,"onready")}function r(n){var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0;for(var s=0,o=t.length;s<o;s++){var u=n[t[s]].length;if(u>r)switch(t[s]){case"textNode":O(n);break;case"cdata":A(n,"oncdata",n.cdata),n.cdata="";break;case"script":A(n,"onscript",n.script),n.script="";break;default:_(n,"Max buffer length exceeded: "+t[s])}i=Math.max(i,u)}n.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+n.position}function i(e){for(var n=0,r=t.length;n<r;n++)e[t[n]]=""}function a(e,t){return new f(e,t)}function f(e,t){if(!(this instanceof f))return new f(e,t);s.apply(this),this._parser=new n(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},u.forEach(function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t;r.on(e,t)},enumerable:!0,configurable:!1})})}function x(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function T(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function N(e,t){return T(e)?!!t.match(e):e[t]}function C(e,t){return!N(e,t)}function L(e,t,n){e[t]&&e[t](n)}function A(e,t,n){e.textNode&&O(e),L(e,t,n)}function O(e){e.textNode=M(e.opt,e.textNode),e.textNode&&L(e,"ontext",e.textNode),e.textNode=""}function M(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function _(e,t){return O(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,L(e,"onerror",t),e}function D(e){return e.closedRoot||P(e,"Unclosed root tag"),e.state!==k.TEXT&&_(e,"Unexpected end"),O(e),e.c="",e.closed=!0,L(e,"onend"),n.call(e,e.strict,e.opt),e}function P(e,t){if(!(typeof e=="object"&&e instanceof n))throw new Error("bad call to strictFail");e.strict&&_(e,t)}function H(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0}function B(e){var t=e.indexOf(":"),n=t<0?["",e]:e.split(":"),r=n[0],i=n[1];return e==="xmlns"&&(r="xmlns",i=""),{prefix:r,local:i}}function j(e){e.strict||(e.attribName=e.attribName[e.looseCase]());if(e.attribList.indexOf(e.attribName)!==-1||e.tag.attributes.hasOwnProperty(e.attribName))return e.attribName=e.attribValue="";if(e.opt.xmlns){var t=B(e.attribName),n=t.prefix,r=t.local;if(n==="xmlns")if(r==="xml"&&e.attribValue!==y)P(e,"xml: prefix must be bound to "+y+"\n"+"Actual: "+e.attribValue);else if(r==="xmlns"&&e.attribValue!==b)P(e,"xmlns: prefix must be bound to "+b+"\n"+"Actual: "+e.attribValue);else{var i=e.tag,s=e.tags[e.tags.length-1]||e;i.ns===s.ns&&(i.ns=Object.create(s.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,A(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function F(e,t){if(e.opt.xmlns){var n=e.tag,r=B(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(P(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){A(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var s=0,o=e.attribList.length;s<o;s++){var u=e.attribList[s],a=u[0],f=u[1],l=B(a),c=l.prefix,h=l.local,p=c==""?"":n.ns[c]||"",d={name:a,value:f,prefix:c,local:h,uri:p};c&&c!="xmlns"&&!p&&(P(e,"Unbound namespace prefix: "+JSON.stringify(c)),d.uri=c),e.tag.attributes[a]=d,A(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),A(e,"onopentag",e.tag),t||(!e.noscript&&e.tagName.toLowerCase()==="script"?e.state=k.SCRIPT:e.state=k.TEXT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function I(e){if(!e.tagName){P(e,"Weird empty close tag."),e.textNode+="</>",e.state=k.TEXT;return}if(e.script){if(e.tagName!=="script"){e.script+="</"+e.tagName+">",e.tagName="",e.state=k.SCRIPT;return}A(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());var r=n;while(t--){var i=e.tags[t];if(i.name===r)break;P(e,"Unexpected close tag")}if(t<0){P(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=k.TEXT;return}e.tagName=n;var s=e.tags.length;while(s-->t){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,A(e,"onclosetag",e.tagName);var u={};for(var a in o.ns)u[a]=o.ns[a];var f=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==f.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];A(e,"onclosenamespace",{prefix:t,uri:n})})}t===0&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=k.TEXT}function q(e){var t=e.entity,n=t.toLowerCase(),r,i="";return e.ENTITIES[t]?e.ENTITIES[t]:e.ENTITIES[n]?e.ENTITIES[n]:(t=n,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),r=parseInt(t,16),i=r.toString(16)):(t=t.slice(1),r=parseInt(t,10),i=r.toString(10))),t=t.replace(/^0+/,""),i.toLowerCase()!==t?(P(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCharCode(r))}function R(e){var t=this;if(this.error)throw this.error;if(t.closed)return _(t,"Cannot write after close. Assign an onready handler.");if(e===null)return D(t);var n=0,i="";while(t.c=i=e.charAt(n++)){t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);switch(t.state){case k.BEGIN:i==="<"?(t.state=k.OPEN_WAKA,t.startTagPosition=t.position):C(l,i)&&(P(t,"Non-whitespace before first tag."),t.textNode=i,t.state=k.TEXT);continue;case k.TEXT:if(t.sawRoot&&!t.closedRoot){var s=n-1;while(i&&i!=="<"&&i!=="&")i=e.charAt(n++),i&&t.trackPosition&&(t.position++,i==="\n"?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(s,n-1)}i==="<"?(t.state=k.OPEN_WAKA,t.startTagPosition=t.position):(C(l,i)&&(!t.sawRoot||t.closedRoot)&&P(t,"Text data outside of root node."),i==="&"?t.state=k.TEXT_ENTITY:t.textNode+=i);continue;case k.SCRIPT:i==="<"?t.state=k.SCRIPT_ENDING:t.script+=i;continue;case k.SCRIPT_ENDING:i==="/"?t.state=k.CLOSE_TAG:(t.script+="<"+i,t.state=k.SCRIPT);continue;case k.OPEN_WAKA:if(i==="!")t.state=k.SGML_DECL,t.sgmlDecl="";else if(!N(l,i))if(N(E,i))t.state=k.OPEN_TAG,t.tagName=i;else if(i==="/")t.state=k.CLOSE_TAG,t.tagName="";else if(i==="?")t.state=k.PROC_INST,t.procInstName=t.procInstBody="";else{P(t,"Unencoded <");if(t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;i=(new Array(o)).join(" ")+i}t.textNode+="<"+i,t.state=k.TEXT}continue;case k.SGML_DECL:(t.sgmlDecl+i).toUpperCase()===m?(A(t,"onopencdata"),t.state=k.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+i==="--"?(t.state=k.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+i).toUpperCase()===g?(t.state=k.DOCTYPE,(t.doctype||t.sawRoot)&&P(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):i===">"?(A(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=k.TEXT):N(p,i)?(t.state=k.SGML_DECL_QUOTED,t.sgmlDecl+=i):t.sgmlDecl+=i;continue;case k.SGML_DECL_QUOTED:i===t.q&&(t.state=k.SGML_DECL,t.q=""),t.sgmlDecl+=i;continue;case k.DOCTYPE:i===">"?(t.state=k.TEXT,A(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=i,i==="["?t.state=k.DOCTYPE_DTD:N(p,i)&&(t.state=k.DOCTYPE_QUOTED,t.q=i));continue;case k.DOCTYPE_QUOTED:t.doctype+=i,i===t.q&&(t.q="",t.state=k.DOCTYPE);continue;case k.DOCTYPE_DTD:t.doctype+=i,i==="]"?t.state=k.DOCTYPE:N(p,i)&&(t.state=k.DOCTYPE_DTD_QUOTED,t.q=i);continue;case k.DOCTYPE_DTD_QUOTED:t.doctype+=i,i===t.q&&(t.state=k.DOCTYPE_DTD,t.q="");continue;case k.COMMENT:i==="-"?t.state=k.COMMENT_ENDING:t.comment+=i;continue;case k.COMMENT_ENDING:i==="-"?(t.state=k.COMMENT_ENDED,t.comment=M(t.opt,t.comment),t.comment&&A(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+i,t.state=k.COMMENT);continue;case k.COMMENT_ENDED:i!==">"?(P(t,"Malformed comment"),t.comment+="--"+i,t.state=k.COMMENT):t.state=k.TEXT;continue;case k.CDATA:i==="]"?t.state=k.CDATA_ENDING:t.cdata+=i;continue;case k.CDATA_ENDING:i==="]"?t.state=k.CDATA_ENDING_2:(t.cdata+="]"+i,t.state=k.CDATA);continue;case k.CDATA_ENDING_2:i===">"?(t.cdata&&A(t,"oncdata",t.cdata),A(t,"onclosecdata"),t.cdata="",t.state=k.TEXT):i==="]"?t.cdata+="]":(t.cdata+="]]"+i,t.state=k.CDATA);continue;case k.PROC_INST:i==="?"?t.state=k.PROC_INST_ENDING:N(l,i)?t.state=k.PROC_INST_BODY:t.procInstName+=i;continue;case k.PROC_INST_BODY:if(!t.procInstBody&&N(l,i))continue;i==="?"?t.state=k.PROC_INST_ENDING:t.procInstBody+=i;continue;case k.PROC_INST_ENDING:i===">"?(A(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=k.TEXT):(t.procInstBody+="?"+i,t.state=k.PROC_INST_BODY);continue;case k.OPEN_TAG:N(S,i)?t.tagName+=i:(H(t),i===">"?F(t):i==="/"?t.state=k.OPEN_TAG_SLASH:(C(l,i)&&P(t,"Invalid character in tag name"),t.state=k.ATTRIB));continue;case k.OPEN_TAG_SLASH:i===">"?(F(t,!0),I(t)):(P(t,"Forward-slash in opening tag not followed by >"),t.state=k.ATTRIB);continue;case k.ATTRIB:if(N(l,i))continue;i===">"?F(t):i==="/"?t.state=k.OPEN_TAG_SLASH:N(E,i)?(t.attribName=i,t.attribValue="",t.state=k.ATTRIB_NAME):P(t,"Invalid attribute name");continue;case k.ATTRIB_NAME:i==="="?t.state=k.ATTRIB_VALUE:i===">"?(P(t,"Attribute without value"),t.attribValue=t.attribName,j(t),F(t)):N(l,i)?t.state=k.ATTRIB_NAME_SAW_WHITE:N(S,i)?t.attribName+=i:P(t,"Invalid attribute name");continue;case k.ATTRIB_NAME_SAW_WHITE:if(i==="=")t.state=k.ATTRIB_VALUE;else{if(N(l,i))continue;P(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",A(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",i===">"?F(t):N(E,i)?(t.attribName=i,t.state=k.ATTRIB_NAME):(P(t,"Invalid attribute name"),t.state=k.ATTRIB)}continue;case k.ATTRIB_VALUE:if(N(l,i))continue;N(p,i)?(t.q=i,t.state=k.ATTRIB_VALUE_QUOTED):(P(t,"Unquoted attribute value"),t.state=k.ATTRIB_VALUE_UNQUOTED,t.attribValue=i);continue;case k.ATTRIB_VALUE_QUOTED:if(i!==t.q){i==="&"?t.state=k.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=i;continue}j(t),t.q="",t.state=k.ATTRIB;continue;case k.ATTRIB_VALUE_UNQUOTED:if(C(v,i)){i==="&"?t.state=k.ATTRIB_VALUE_ENTITY_U:t.attribValue+=i;continue}j(t),i===">"?F(t):t.state=k.ATTRIB;continue;case k.CLOSE_TAG:if(!t.tagName){if(N(l,i))continue;C(E,i)?t.script?(t.script+="</"+i,t.state=k.SCRIPT):P(t,"Invalid tagname in closing tag."):t.tagName=i}else i===">"?I(t):N(S,i)?t.tagName+=i:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=k.SCRIPT):(C(l,i)&&P(t,"Invalid tagname in closing tag"),t.state=k.CLOSE_TAG_SAW_WHITE);continue;case k.CLOSE_TAG_SAW_WHITE:if(N(l,i))continue;i===">"?I(t):P(t,"Invalid characters in closing tag");continue;case k.TEXT_ENTITY:case k.ATTRIB_VALUE_ENTITY_Q:case k.ATTRIB_VALUE_ENTITY_U:switch(t.state){case k.TEXT_ENTITY:var u=k.TEXT,a="textNode";break;case k.ATTRIB_VALUE_ENTITY_Q:var u=k.ATTRIB_VALUE_QUOTED,a="attribValue";break;case k.ATTRIB_VALUE_ENTITY_U:var u=k.ATTRIB_VALUE_UNQUOTED,a="attribValue"}i===";"?(t[a]+=q(t),t.entity="",t.state=u):N(d,i)?t.entity+=i:(P(t,"Invalid character entity"),t[a]+="&"+t.entity+i,t.entity="",t.state=u);continue;default:throw new Error(t,"Unknown state: "+t.state)}}return t.position>=t.bufferCheckPosition&&r(t),t}e.parser=function(e,t){return new n(e,t)},e.SAXParser=n,e.SAXStream=f,e.createStream=a,e.MAX_BUFFER_LENGTH=65536;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),n.prototype={end:function(){D(this)},write:R,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{var s=require("stream").Stream}catch(o){var s=function(){}}var u=e.EVENTS.filter(function(e){return e!=="error"&&e!=="end"});f.prototype=Object.create(s.prototype,{constructor:{value:f}}),f.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},f.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},f.prototype.on=function(e,t){var n=this;return!n._parser["on"+e]&&u.indexOf(e)!==-1&&(n._parser["on"+e]=function(){var t=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),s.prototype.on.call(n,e,t)};var l="\r\n	 ",c="0124356789",h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",p="'\"",d=c+h+"#",v=l+">",m="[CDATA[",g="DOCTYPE",y="http://www.w3.org/XML/1998/namespace",b="http://www.w3.org/2000/xmlns/",w={xml:y,xmlns:b};l=x(l),c=x(c),h=x(h);var E=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;p=x(p),d=x(d),v=x(v);var k=0;e.STATE={BEGIN:k++,TEXT:k++,TEXT_ENTITY:k++,OPEN_WAKA:k++,SGML_DECL:k++,SGML_DECL_QUOTED:k++,DOCTYPE:k++,DOCTYPE_QUOTED:k++,DOCTYPE_DTD:k++,DOCTYPE_DTD_QUOTED:k++,COMMENT_STARTING:k++,COMMENT:k++,COMMENT_ENDING:k++,COMMENT_ENDED:k++,CDATA:k++,CDATA_ENDING:k++,CDATA_ENDING_2:k++,PROC_INST:k++,PROC_INST_BODY:k++,PROC_INST_ENDING:k++,OPEN_TAG:k++,OPEN_TAG_SLASH:k++,ATTRIB:k++,ATTRIB_NAME:k++,ATTRIB_NAME_SAW_WHITE:k++,ATTRIB_VALUE:k++,ATTRIB_VALUE_QUOTED:k++,ATTRIB_VALUE_UNQUOTED:k++,ATTRIB_VALUE_ENTITY_Q:k++,ATTRIB_VALUE_ENTITY_U:k++,CLOSE_TAG:k++,CLOSE_TAG_SAW_WHITE:k++,SCRIPT:k++,SCRIPT_ENDING:k++},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r=typeof n=="number"?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var k in e.STATE)e.STATE[e.STATE[k]]=k;k=e.STATE}(typeof exports=="undefined"?sax={}:exports),define("sax",function(e){return function(){var t,n;return t||e.sax}}(this)),define("filters/osis",["sax","bcv"],function(e,t){function s(e,n){var r="";return t.parse(e).osis()!==""?r='<a href="?type=crossReference&osisRef='+t.parse(e).osis()+"&n="+n.attributes.n+'">'+e+"</a>":r=e,r}var n={},r=e.parser(!0),i={headings:!1,footnotes:!1,strongsNumbers:!1,wordsOfChristInRed:!1,oneVersePerLine:!1};return n.processText=function(e,t){!t||t==={}?t=i:(t.headings=t.headings?t.headings:i.headings,t.footnotes=t.footnotes?t.footnotes:i.footnotes,t.strongsNumbers=t.strongsNumbers?t.strongsNumbers:i.strongsNumbers,t.wordsOfChristInRed=t.wordsOfChristInRed?t.wordsOfChristInRed:i.wordsOfChristInRed,t.oneVersePerLine=t.oneVersePerLine?t.oneVersePerLine:i.oneVersePerLine);var n="",o=null,u=null,a=null,f="",l="",c="",h="",p=!1;r.onerror=function(e){console.log("ERROR parsing XML",e,n,o)},r.ontext=function(e){if(u)t.footnotes&&u.attributes.type==="crossReference"&&(n!=="reference"?l+=s(e,u):l+='<a href="?type=crossReference&osisRef='+a.attributes.osisRef+"&n="+u.attributes.n+'">'+e+"</a>");else if(o)switch(o.name){case"title":o.attributes.type==="section"?l="<h3>"+e+"</h3>"+l:l="<h1>"+e+"</h1>"+l;break;default:l+=e}else l+=e},r.onopentag=function(e){o=e,n=e.name;switch(e.name){case"xml":l+="<span class='verse-number' osisRef='"+e.attributes.osisRef+"'> "+e.attributes.verseNum+" </span>";break;case"note":e.attributes.type==="crossReference"&&t.footnotes&&(l+="["),u=e;break;case"reference":a=e}},r.onclosetag=function(e){switch(e){case"title":o=null;break;case"note":u.attributes.type==="crossReference"&&t.footnotes&&(l+="] "),f="",u=null;break;case"reference":a=null}n=""},r.onattribute=function(e){},r.onend=function(){};var d="";for(var v=0;v<e.length;v++)d="<xml osisRef='"+e[v].osis+"' verseNum = '"+e[v].verse+"'>"+e[v].text+"</xml>",r.write(d),r.close(),c+=t.oneVersePerLine?"<div class='verse'>"+l+"</div>":"<span class='verse'>"+l+"</span>",l="";return c},n}),define("filterMgr",["filters/osis"],function(e){function t(t,n,r){return n.toLowerCase()==="osis"?e.processText(t,r):t}return{processText:t}}),define("swmodule",["dataMgr","verseKey","zText","filterMgr","versificationMgr"],function(e,t,n,r,i){function u(e,t,n){if(!(this instanceof u))throw new TypeError("Module constructor cannot be called as a function.");this.modKey=e,this.id=t,this.config=n}function a(e,t){}function f(t,n){e.getBlob(t,n)}var s=null,o=null;return u.create=function(e,t,n){return new u(e,t,n)},u.prototype={constructor:u,self:this,renderText:function(i,s,o){var u=null,a=null,l=this;typeof s=="function"&&(o=s);var c=t.parseVerseList(i,this.config.Versification);c.length!==0&&c[0].osis!==""?e.getDocument(l.config.bcvPosID,function(e,t){t.nt.hasOwnProperty(c[0].book)?(u=t.nt[c[0].book],a=l.config.nt):t.ot.hasOwnProperty(c[0].book)&&(u=t.ot[c[0].book],a=l.config.ot),f(a,function(e,t){e||n.getRawEntry(t,u,c,function(e,t){e?o(e):o(null,r.processText(t,l.config.SourceType,s))})})}):o({message:"Wrong passage. The requested chapter is not available in this module."})},getAllBooks:function(){return i.getAllBooks(this.config.Versification)}},u}),define("moduleMgr",["dataMgr","swmodule"],function(e,t){function i(e){e.moduleKey&&emit(e.moduleKey,e)}var n={},r=e.db;return n.getModules=function(e){var n=[];r.query({map:i},{reduce:!0},function(r,i){r?e(r):(i.rows.forEach(function(e){n.push(new t(e.key,e.id,e.value))}),e(null,n))})},n.getModule=function(n,r){e.getDocument(n,function(e,i){e?r(null):r(null,new t(i.moduleKey,n,i))})},n}),require.config({paths:{text:"libs/text/text",json:"libs/json/src/json",async:"libs/async/lib/async",bcv:"libs/bible-reference-parser/js/en_bcv_parser.min",unzip:"libs/zlib/bin/unzip.min",inflateStream:"libs/zlib/bin/inflate_stream.min",sax:"libs/sax/lib/sax"},shim:{bcv:{exports:"bcv_parser",init:function(){return new this.bcv_parser}},pouchdb:{exports:"Pouch"},unzip:{exports:"Zlib"},inflateStream:{exports:"Zlib"},sax:{exports:"sax"}}}),define("sword",["installMgr","moduleMgr","dataMgr","versificationMgr","verseKey"],function(e,t,n,r,i){var s={};return s.installMgr=e,s.moduleMgr=t,s.versificationMgr=r,s.dataMgr=n,s.verseKey=i,s.isSupported=function(){var e={}.toString,t=[],n="[object Function]";return window.FileReader&&e.call(t.forEach)==n?!0:!1},s}),require("sword")});